import{Point as t,util as e}from"fabric";import{collectVerticalPoint as o,collectHorizontalPoint as r}from"./util/collect-point.min.mjs";import{drawPointList as n,drawVerticalLine as c,drawHorizontalLine as i}from"./util/draw.min.mjs";import{getObjectsByTarget as s}from"./util/get-objects-by-target.min.mjs";import{collectLine as f}from"./util/collect-line.min.mjs";import{AligningLineConfig as a}from"./constant.min.mjs";function l(l){let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.assign(a,m);const g=new Set,d=new Set;let p=!1;const u=new Map,b=t=>{const o=[t.calcTransformMatrix().toString(),t.width,t.height].join(),r=u.get(o);if(r)return r;const n=t.getCoords(),c=[e.makeBoundingBoxFromPoints(n),n];return u.set(o,c),c};function j(t){const e=t.target;e.setCoords(),p=!1,d.clear(),g.clear();const o=s(e),r=e.getBoundingRect();for(const t of o){const o=b(t)[0],{vLines:n,hLines:c}=f({activeObject:e,activeObjectRect:r,objectRect:o});n.forEach((t=>{d.add(JSON.stringify(t))})),c.forEach((t=>{g.add(JSON.stringify(t))}))}}function h(e){const n=e.target;n.setCoords();const c=String(e.transform.action).startsWith("scale");d.clear(),g.clear();const i=s(n);let f=e.transform.corner;n.flipX&&(f=f.replace("l","r").replace("r","l")),n.flipY&&(f=f.replace("t","b").replace("b","t"));let a=["tl","tr","br","bl","mt","mr","mb","ml"].indexOf(f);if(-1==a)return;if(p=a>3,p){if(n.getTotalAngle()%90!=0)return;a-=4}let l=n.getCoords()[a];for(const e of i){const[i,s]=b(e),f={activeObject:n,point:l,list:[...s,new t(i.left+i.width/2,i.top+i.height/2)],isScale:c,index:a},m=o(f),p=r(f);m.forEach((t=>{d.add(JSON.stringify(t))})),p.forEach((t=>{g.add(JSON.stringify(t))})),(m.length||p.length)&&(l=n.getCoords()[a])}}function O(){l.clearContext(l.contextTop)}function S(){if(p){const t=[];for(const e of d)t.push(JSON.parse(e));for(const e of g)t.push(JSON.parse(e));n(l,t)}else{for(const t of d)c(l,JSON.parse(t));for(const t of g)i(l,JSON.parse(t))}}function J(){d.clear(),g.clear(),u.clear(),l.requestRenderAll()}return l.on("object:resizing",h),l.on("object:scaling",h),l.on("object:moving",j),l.on("before:render",O),l.on("after:render",S),l.on("mouse:up",J),()=>{l.off("object:resizing",h),l.off("object:scaling",h),l.off("object:moving",j),l.off("before:render",O),l.off("after:render",S),l.off("mouse:up",J)}}export{l as initAligningGuidelines};
//# sourceMappingURL=index.min.mjs.map
