!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("fabric")):"function"==typeof define&&define.amd?define(["exports","fabric"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).fabricExtensions={},t.fabric)}(this,(function(t,e){"use strict";const n={margin:4,width:1,color:"rgb(255,0,0,0.9)"};function o(t,e){return Math.abs(t-e)}const r=["left","center","right"],i=["top","center","bottom"];function c(t){var e,o;const i=n.margin,{activeObject:c,isScale:s,index:f,point:l,list:d}=t,{dis:u,arr:g}=a(l,d,"x");if(u>i/(null!==(e=null===(o=c.canvas)||void 0===o?void 0:o.getZoom())&&void 0!==e?e:1))return[];let x=g[g.length-1].x-l.x;const h=0==f||3==f?-1:1;x*=h;const{width:p,scaleX:y,left:m}=c,b=c._getTransformedDimensions(),v=(x+b.x)/b.x;s?c.set("scaleX",y*v):c.set("width",p*v);const O=[0,x/2*h,x*h];h<0&&O.reverse();const j=O[r.indexOf(c.originX)];return c.set("left",m+j),c.setCoords(),g.map((t=>({x:t.x,y1:t.y,y2:l.y})))}function s(t){var e,o;const r=n.margin,{activeObject:c,isScale:s,index:f,point:l,list:d}=t,{dis:u,arr:g}=a(l,d,"y");if(u>r/(null!==(e=null===(o=c.canvas)||void 0===o?void 0:o.getZoom())&&void 0!==e?e:1))return[];let x=g[g.length-1].y-l.y;const h=f<2?-1:1;x*=h;const{height:p,scaleY:y,top:m}=c,b=c._getTransformedDimensions(),v=(x+b.y)/b.y;s?c.set("scaleY",y*v):c.set("height",p*v);const O=[0,x/2*h,x*h];h<0&&O.reverse();const j=O[i.indexOf(c.originY)];return c.set("top",m+j),c.setCoords(),g.map((t=>({y:t.y,x1:t.x,x2:l.x})))}function a(t,e,n){let r=1/0,i=[];for(const c of e){const e=o(t[n],c[n]);r>e&&(i=[],r=e),r==e&&i.push(c)}return{dis:r,arr:i}}function f(t,e,o){const{width:r,color:i}=n,c=t.getSelectionContext(),s=t.viewportTransform,a=t.getZoom();c.save(),c.transform(...s),c.lineWidth=r/a,c.strokeStyle=i,c.beginPath(),c.moveTo(e.x,e.y),c.lineTo(o.x,o.y),c.stroke(),d(c,a,e),d(c,a,o),c.restore()}const l=2.4;function d(t,e,n){const o=l/e;t.save(),t.translate(n.x,n.y),t.beginPath(),t.moveTo(-o,-o),t.lineTo(o,o),t.moveTo(o,-o),t.lineTo(-o,o),t.stroke(),t.restore()}function u(t,o){!function(t,e){const{width:o,color:r}=n,i=t.getSelectionContext(),c=t.viewportTransform,s=t.getZoom();i.save(),i.transform(...c),i.lineWidth=o/s,i.strokeStyle=r;for(const t of e)d(i,s,t);i.restore()}(t,o.map((t=>{const n="y2"in t,o=n?t.x:t.x1,r=n?t.y1:t.y;return new e.Point(o,r)})))}function g(t,n){const o=n.x;f(t,new e.Point(o,n.y1),new e.Point(o,n.y2))}function x(t,n){const o=n.y;f(t,new e.Point(n.x1,o),new e.Point(n.x2,o))}function h(t){const n=new Set,o=t.canvas;if(!o)return n;const r=t instanceof e.ActiveSelection?t.getObjects():[t];return o.forEachObject((t=>{t.isOnScreen()&&t.visible&&(t.constructor!=e.Group?n.add(t):y(n,t))})),p(n,r),n}function p(t,n){for(const o of n)o.constructor==e.Group?p(t,o.getObjects()):t.delete(o)}function y(t,n){const o=n.getObjects();for(const n of o)n.visible&&(n.constructor!=e.Group?t.add(n):y(t,n))}function m(t){var e,o;const r=n.margin,{activeObject:i,activeObjectRect:c,objectRect:s}=t,a={target:i,list:v(s),aList:v(c),margin:r/(null!==(e=null===(o=i.canvas)||void 0===o?void 0:o.getZoom())&&void 0!==e?e:1)},f=function(t){const{target:e,list:n,aList:o,margin:r}=t,i=o.map((t=>b(t,n,"x"))),c=Math.min(...i.map((t=>t.dis)));if(c>r)return[];const s=[],a=o[0].x2-o[0].x,f=o[0].y2-o[0].y;let l=!1;for(let t=0;t<i.length;t++){const r=i[t];if(c==r.dis){const i=n[r.index],d=o[r.index],u=i.x,g=d.y,x=Math.min(i.y,i.y2,g,d.y2),h=Math.max(i.y,i.y2,g,d.y2);if(s.push({x:u,y1:x,y2:h}),l)continue;l=!0,O({target:e,x:u,y:g,centerX:t-1,centerY:r.index-1,width:a,height:f,dir:"x"});const p=c*r.dir;o.forEach((t=>t.x-=p))}}return s}(a),l=function(t){const{target:e,list:n,aList:o,margin:r}=t,i=o.map((t=>b(t,n,"y"))),c=Math.min(...i.map((t=>t.dis)));if(c>r)return[];const s=[],a=o[0].x2-o[0].x,f=o[0].y2-o[0].y;let l=!1;for(let t=0;t<i.length;t++){const r=i[t];if(c==r.dis){const i=n[r.index],d=o[r.index],u=i.y,g=d.x,x=Math.min(i.x,i.x2,g,d.x2),h=Math.max(i.x,i.x2,g,d.x2);if(s.push({y:u,x1:x,x2:h}),l)continue;l=!0,O({target:e,x:g,y:u,centerX:r.index-1,centerY:t-1,width:a,height:f,dir:"y"});const p=c*r.dir;o.forEach((t=>t.y-=p))}}return s}(a);return{vLines:f,hLines:l}}function b(t,e,n){let r=1/0,i=-1,c=1;for(let s=0;s<e.length;s++){const a=o(t[n],e[s][n]);r>a&&(i=s,r=a,c=t[n]>e[s][n]?1:-1)}return{dis:r,index:i,dir:c}}function v(t){const{left:e,top:n,width:o,height:r}=t,i=e+o/2,c=n+r/2;return[{x:e,y:n,x2:e+o,y2:n+r},{x:i,y:c,x2:i,y2:c},{x:e+o,x2:e,y:n+r,y2:n}]}function O(t){const{target:n,centerX:o,centerY:r,width:i,height:c,dir:s}=t;let{x:a,y:f}=t;a-=o*i/2,f-=r*c/2,function(t,e,n){const o=t.translateToCenterPoint(e,"center","center"),r=t.translateToOriginPoint(o,t.originX,t.originY);"x"==n?t.setX(r.x):t.setY(r.y)}(n,new e.Point(a,f),s),n.setCoords()}const j=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"left",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"top";return async function(r){const{originX:i=n,originY:c=o}=r;delete r.originX,delete r.originY;for(var s=arguments.length,a=new Array(s>1?s-1:0),f=1;f<s;f++)a[f-1]=arguments[f];const l=await t.call(this,r,...a),d=new e.Point(l.left,l.top);return l.setPositionByOrigin(d,i,c),l}};t.gradientUpdaterWrapper=t=>async function(n){const{colorStops:o}=n,r=null==o?void 0:o.map((t=>{let{color:n,opacity:o,offset:r}=t;if(void 0===o||1===o)return{color:n,offset:r};return{color:new e.Color(n).setAlpha(o).toRgba(),offset:r}}));return await t.call(this,{...n,colorStops:r})},t.initAligningGuidelines=function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.assign(n,o);const r=new Set,i=new Set;let a=!1;const f=new Map,l=t=>{const n=[t.calcTransformMatrix().toString(),t.width,t.height].join(),o=f.get(n);if(o)return o;const r=t.getCoords(),i=[e.util.makeBoundingBoxFromPoints(r),r];return f.set(n,i),i};function d(t){const e=t.target;e.setCoords(),a=!1,i.clear(),r.clear();const n=h(e),o=e.getBoundingRect();for(const t of n){const n=l(t)[0],{vLines:c,hLines:s}=m({activeObject:e,activeObjectRect:o,objectRect:n});c.forEach((t=>{i.add(JSON.stringify(t))})),s.forEach((t=>{r.add(JSON.stringify(t))}))}}function p(t){const n=t.target;n.setCoords();const o=String(t.transform.action).startsWith("scale");i.clear(),r.clear();const f=h(n);let d=t.transform.corner;n.flipX&&(d=d.replace("l","r").replace("r","l")),n.flipY&&(d=d.replace("t","b").replace("b","t"));let u=["tl","tr","br","bl","mt","mr","mb","ml"].indexOf(d);if(-1==u)return;if(a=u>3,a){if(n.getTotalAngle()%90!=0)return;u-=4}let g=n.getCoords()[u];for(const t of f){const[a,f]=l(t),d={activeObject:n,point:g,list:[...f,new e.Point(a.left+a.width/2,a.top+a.height/2)],isScale:o,index:u},x=c(d),h=s(d);x.forEach((t=>{i.add(JSON.stringify(t))})),h.forEach((t=>{r.add(JSON.stringify(t))})),(x.length||h.length)&&(g=n.getCoords()[u])}}function y(){t.clearContext(t.contextTop)}function b(){if(a){const e=[];for(const t of i)e.push(JSON.parse(t));for(const t of r)e.push(JSON.parse(t));u(t,e)}else{for(const e of i)g(t,JSON.parse(e));for(const e of r)x(t,JSON.parse(e))}}function v(){i.clear(),r.clear(),f.clear(),t.requestRenderAll()}return t.on("object:resizing",p),t.on("object:scaling",p),t.on("object:moving",d),t.on("before:render",y),t.on("after:render",b),t.on("mouse:up",v),()=>{t.off("object:resizing",p),t.off("object:scaling",p),t.off("object:moving",d),t.off("before:render",y),t.off("after:render",b),t.off("mouse:up",v)}},t.installOriginWrapperUpdater=(t,n)=>{e.BaseFabricObject._fromObject=j(e.BaseFabricObject._fromObject,t,n),e.FabricImage.fromObject=j(e.FabricImage.fromObject,t,n),e.Group.fromObject=j(e.Group.fromObject,t,n)},t.originUpdaterWrapper=j}));
//# sourceMappingURL=fabric-extensions.min.js.map
