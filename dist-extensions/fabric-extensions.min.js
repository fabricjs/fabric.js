!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("fabric")):"function"==typeof define&&define.amd?define(["exports","fabric"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).fabricExtensions={},t.fabric)}(this,(function(t,e){"use strict";const n={margin:4,width:1,color:"rgb(255,0,0,0.9)"};function o(t,e){return Math.abs(t-e)}function i(t){var e,o;const i=n.margin,{activeObject:a,activeObjectRect:f,objectRect:l}=t,d={target:a,list:c(l),aList:c(f),margin:i/(null!==(e=null===(o=a.canvas)||void 0===o?void 0:o.getZoom())&&void 0!==e?e:1)},g=function(t){const{target:e,list:n,aList:o,margin:i}=t,c=o.map((t=>r(t,n,"x"))),a=Math.min(...c.map((t=>t.dis)));if(a>i)return[];const f=[],l=o[0].x2-o[0].x,d=o[0].y2-o[0].y;let g=!1;for(let t=0;t<c.length;t++){const i=c[t];if(a==i.dis){const r=n[i.index],c=o[i.index],u=r.x,x=c.y,h=Math.min(r.y,r.y2,x,c.y2),y=Math.max(r.y,r.y2,x,c.y2);if(f.push({x:u,y1:h,y2:y}),g)continue;g=!0,s({target:e,x:u,y:x,centerX:t-1,centerY:i.index-1,width:l,height:d,dir:"x"});const m=a*i.dir;o.forEach((t=>t.x-=m))}}return f}(d),u=function(t){const{target:e,list:n,aList:o,margin:i}=t,c=o.map((t=>r(t,n,"y"))),a=Math.min(...c.map((t=>t.dis)));if(a>i)return[];const f=[],l=o[0].x2-o[0].x,d=o[0].y2-o[0].y;let g=!1;for(let t=0;t<c.length;t++){const i=c[t];if(a==i.dis){const r=n[i.index],c=o[i.index],u=r.y,x=c.x,h=Math.min(r.x,r.x2,x,c.x2),y=Math.max(r.x,r.x2,x,c.x2);if(f.push({y:u,x1:h,x2:y}),g)continue;g=!0,s({target:e,x:x,y:u,centerX:i.index-1,centerY:t-1,width:l,height:d,dir:"y"});const m=a*i.dir;o.forEach((t=>t.y-=m))}}return f}(d);return{vLines:g,hLines:u}}function r(t,e,n){let i=1/0,r=-1,c=1;for(let s=0;s<e.length;s++){const a=o(t[n],e[s][n]);i>a&&(r=s,i=a,c=t[n]>e[s][n]?1:-1)}return{dis:i,index:r,dir:c}}function c(t){const{left:e,top:n,width:o,height:i}=t,r=e+o/2,c=n+i/2;return[{x:e,y:n,x2:e+o,y2:n+i},{x:r,y:c,x2:r,y2:c},{x:e+o,x2:e,y:n+i,y2:n}]}function s(t){const{target:n,centerX:o,centerY:i,width:r,height:c,dir:s}=t;let{x:a,y:f}=t;a-=o*r/2,f-=i*c/2,function(t,e,n){const o=t.translateToCenterPoint(e,"center","center"),i=t.translateToOriginPoint(o,t.originX,t.originY);"x"==n?t.setX(i.x):t.setY(i.y)}(n,new e.Point(a,f),s),n.setCoords()}const a=["left","center","right"],f=["top","center","bottom"];function l(t){var e,o;const i=n.margin,{activeObject:r,isScale:c,index:s,point:f,list:l}=t,{dis:d,arr:u}=g(f,l,"x");if(d>i/(null!==(e=null===(o=r.canvas)||void 0===o?void 0:o.getZoom())&&void 0!==e?e:1))return[];let x=u[u.length-1].x-f.x;const h=0==s||3==s?-1:1;x*=h;const{width:y,scaleX:m,left:p}=r,b=r._getTransformedDimensions(),v=(x+b.x)/b.x;c?r.set("scaleX",m*v):r.set("width",y*v);const O=[0,x/2*h,x*h];h<0&&O.reverse();const j=O[a.indexOf(r.originX)];return r.set("left",p+j),r.setCoords(),u.map((t=>({x:t.x,y1:t.y,y2:f.y})))}function d(t){var e,o;const i=n.margin,{activeObject:r,isScale:c,index:s,point:a,list:l}=t,{dis:d,arr:u}=g(a,l,"y");if(d>i/(null!==(e=null===(o=r.canvas)||void 0===o?void 0:o.getZoom())&&void 0!==e?e:1))return[];let x=u[u.length-1].y-a.y;const h=s<2?-1:1;x*=h;const{height:y,scaleY:m,top:p}=r,b=r._getTransformedDimensions(),v=(x+b.y)/b.y;c?r.set("scaleY",m*v):r.set("height",y*v);const O=[0,x/2*h,x*h];h<0&&O.reverse();const j=O[f.indexOf(r.originY)];return r.set("top",p+j),r.setCoords(),u.map((t=>({y:t.y,x1:t.x,x2:a.x})))}function g(t,e,n){let i=1/0,r=[];for(const c of e){const e=o(t[n],c[n]);i>e&&(r=[],i=e),i==e&&r.push(c)}return{dis:i,arr:r}}function u(t,e,o){const{width:i,color:r}=n,c=t.getSelectionContext(),s=t.viewportTransform,a=t.getZoom();c.save(),c.transform(...s),c.lineWidth=i/a,c.strokeStyle=r,c.beginPath(),c.moveTo(e.x,e.y),c.lineTo(o.x,o.y),c.stroke(),h(c,a,e),h(c,a,o),c.restore()}const x=2.4;function h(t,e,n){const o=x/e;t.save(),t.translate(n.x,n.y),t.beginPath(),t.moveTo(-o,-o),t.lineTo(o,o),t.moveTo(o,-o),t.lineTo(-o,o),t.stroke(),t.restore()}function y(t,o){!function(t,e){const{width:o,color:i}=n,r=t.getSelectionContext(),c=t.viewportTransform,s=t.getZoom();r.save(),r.transform(...c),r.lineWidth=o/s,r.strokeStyle=i;for(const t of e)h(r,s,t);r.restore()}(t,o.map((t=>{const n="y2"in t,o=n?t.x:t.x1,i=n?t.y1:t.y;return new e.Point(o,i)})))}function m(t,n){const o=n.x;u(t,new e.Point(o,n.y1),new e.Point(o,n.y2))}function p(t,n){const o=n.y;u(t,new e.Point(n.x1,o),new e.Point(n.x2,o))}function b(t,n){const o=new Set,i=t.canvas;if(!i)return o;const r=t instanceof e.ActiveSelection?t.getObjects():[t];return i.forEachObject((t=>{t.isOnScreen()&&t.visible&&(t instanceof e.Group?O(o,t,n):n&&n(t)||o.add(t))})),v(o,r),o}function v(t,n){for(const o of n)t.delete(o),o instanceof e.Group?v(t,o.getObjects()):t.delete(o)}function O(t,n,o){const i=n.getObjects();for(const n of i)n.visible&&(o&&o(n)||(n.constructor!=e.Group?t.add(n):O(t,n,o)))}const j=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"left",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"top";return async function(i){const{originX:r=n,originY:c=o}=i;delete i.originX,delete i.originY;for(var s=arguments.length,a=new Array(s>1?s-1:0),f=1;f<s;f++)a[f-1]=arguments[f];const l=await t.call(this,i,...a),d=new e.Point(l.left,l.top);return l.setPositionByOrigin(d,r,c),l}};t.initAligningGuidelines=function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;Object.assign(n,o);const c=new Set,s=new Set;let a=!1;const f=new Map,g=t=>{const n=[t.calcTransformMatrix().toString(),t.width,t.height].join(),o=f.get(n);if(o)return o;const i=t.getCoords(),r=[e.util.makeBoundingBoxFromPoints(i),i];return f.set(n,r),r};function u(t){const e=t.target;e.setCoords(),a=!1,s.clear(),c.clear();const n=b(e,r),o=e.getBoundingRect();for(const t of n){const n=g(t)[0],{vLines:r,hLines:a}=i({activeObject:e,activeObjectRect:o,objectRect:n});r.forEach((t=>{s.add(JSON.stringify(t))})),a.forEach((t=>{c.add(JSON.stringify(t))}))}}function x(t){const n=t.target;n.setCoords();const o=String(t.transform.action).startsWith("scale");s.clear(),c.clear();const i=b(n,r);let f=t.transform.corner;n.flipX&&(f=f.replace("l","r").replace("r","l")),n.flipY&&(f=f.replace("t","b").replace("b","t"));let u=["tl","tr","br","bl","mt","mr","mb","ml"].indexOf(f);if(-1==u)return;if(a=u>3,a){if(n.getTotalAngle()%90!=0)return;u-=4}let x=n.getCoords()[u];for(const t of i){const[i,r]=g(t),a={activeObject:n,point:x,list:[...r,new e.Point(i.left+i.width/2,i.top+i.height/2)],isScale:o,index:u},f=l(a),h=d(a);f.forEach((t=>{s.add(JSON.stringify(t))})),h.forEach((t=>{c.add(JSON.stringify(t))})),(f.length||h.length)&&(x=n.getCoords()[u])}}function h(){t.clearContext(t.contextTop)}function v(){if(a){const e=[];for(const t of s)e.push(JSON.parse(t));for(const t of c)e.push(JSON.parse(t));y(t,e)}else{for(const e of s)m(t,JSON.parse(e));for(const e of c)p(t,JSON.parse(e))}}function O(){s.clear(),c.clear(),f.clear(),t.requestRenderAll()}return t.on("object:resizing",x),t.on("object:scaling",x),t.on("object:moving",u),t.on("before:render",h),t.on("after:render",v),t.on("mouse:up",O),()=>{t.off("object:resizing",x),t.off("object:scaling",x),t.off("object:moving",u),t.off("before:render",h),t.off("after:render",v),t.off("mouse:up",O)}},t.installOriginWrapperUpdater=(t,n)=>{e.BaseFabricObject._fromObject=j(e.BaseFabricObject._fromObject,t,n),e.FabricImage.fromObject=j(e.FabricImage.fromObject,t,n),e.Group.fromObject=j(e.Group.fromObject,t,n)},t.originUpdaterWrapper=j}));
//# sourceMappingURL=fabric-extensions.min.js.map
