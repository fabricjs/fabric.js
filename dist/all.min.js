/* Fabric.js Copyright 2008-2012, Printio (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"0.9.14"};if(typeof exports!="undefined"){exports.fabric=fabric}if(typeof document!="undefined"&&typeof window!="undefined"){fabric.document=document;fabric.window=window}else{fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>");fabric.window=fabric.document.createWindow()}fabric.isTouchSupported="ontouchstart" in fabric.document.documentElement;fabric.isLikelyNode=typeof Buffer!=="undefined"&&typeof window==="undefined";
/*
 * Copyright (c) 2009 Simo Kinnunen.
 * Licensed under the MIT license.
 */
var Cufon=(function(){var k=function(){return k.replace.apply(null,arguments)};var u=k.DOM={ready:(function(){var z=false,B={loaded:1,complete:1};var y=[],A=function(){if(z){return}z=true;for(var C;C=y.shift();C()){}};if(fabric.document.addEventListener){fabric.document.addEventListener("DOMContentLoaded",A,false);fabric.window.addEventListener("pageshow",A,false)}if(!fabric.window.opera&&fabric.document.readyState){(function(){B[fabric.document.readyState]?A():setTimeout(arguments.callee,10)})()}if(fabric.document.readyState&&fabric.document.createStyleSheet){(function(){try{fabric.document.body.doScroll("left");A()}catch(C){setTimeout(arguments.callee,1)}})()}o(fabric.window,"load",A);return function(C){if(!arguments.length){A()}else{z?C():y.push(C)}}})()};var l=k.CSS={Size:function(z,y){this.value=parseFloat(z);this.unit=String(z).match(/[a-z%]*$/)[0]||"px";this.convert=function(A){return A/y*this.value};this.convertFrom=function(A){return A/this.value*y};this.toString=function(){return this.value+this.unit}},getStyle:function(y){return new a(y.style)},quotedList:i(function(B){var A=[],z=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g,y;while(y=z.exec(B)){A.push(y[3]||y[1])}return A}),ready:(function(){var A=false;var z=[],B=function(){A=true;for(var D;D=z.shift();D()){}};var y=Object.prototype.propertyIsEnumerable?f("style"):{length:0};var C=f("link");u.ready(function(){var G=0,F;for(var E=0,D=C.length;F=C[E],E<D;++E){if(!F.disabled&&F.rel.toLowerCase()=="stylesheet"){++G}}if(fabric.document.styleSheets.length>=y.length+G){B()}else{setTimeout(arguments.callee,10)}});return function(D){if(A){D()}else{z.push(D)}}})(),supports:function(A,z){var y=fabric.document.createElement("span").style;if(y[A]===undefined){return false}y[A]=z;return y[A]===z},textAlign:function(B,A,y,z){if(A.get("textAlign")=="right"){if(y>0){B=" "+B}}else{if(y<z-1){B+=" "}}return B},textDecoration:function(D,C){if(!C){C=this.getStyle(D)}var z={underline:null,overline:null,"line-through":null};for(var y=D;y.parentNode&&y.parentNode.nodeType==1;){var B=true;for(var A in z){if(z[A]){continue}if(C.get("textDecoration").indexOf(A)!=-1){z[A]=C.get("color")}B=false}if(B){break}C=this.getStyle(y=y.parentNode)}return z},textShadow:i(function(C){if(C=="none"){return null}var B=[],D={},y,z=0;var A=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/ig;while(y=A.exec(C)){if(y[0]==","){B.push(D);D={},z=0}else{if(y[1]){D.color=y[1]}else{D[["offX","offY","blur"][z++]]=y[2]}}}B.push(D);return B}),color:i(function(z){var y={};y.color=z.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(B,A,C){y.opacity=parseFloat(C);return"rgb("+A+")"});return y}),textTransform:function(z,y){return z[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[y.get("textTransform")]||"toString"]()}};function q(z){var y=this.face=z.face;this.glyphs=z.glyphs;this.w=z.w;this.baseSize=parseInt(y["units-per-em"],10);this.family=y["font-family"].toLowerCase();this.weight=y["font-weight"];this.style=y["font-style"]||"normal";this.viewBox=(function(){var B=y.bbox.split(/\s+/);var A={minX:parseInt(B[0],10),minY:parseInt(B[1],10),maxX:parseInt(B[2],10),maxY:parseInt(B[3],10)};A.width=A.maxX-A.minX,A.height=A.maxY-A.minY;A.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")};return A})();this.ascent=-parseInt(y.ascent,10);this.descent=-parseInt(y.descent,10);this.height=-this.ascent+this.descent}function e(){var z={},y={oblique:"italic",italic:"oblique"};this.add=function(A){(z[A.style]||(z[A.style]={}))[A.weight]=A};this.get=function(E,F){var D=z[E]||z[y[E]]||z.normal||z.italic||z.oblique;if(!D){return null}F={normal:400,bold:700}[F]||parseInt(F,10);if(D[F]){return D[F]}var B={1:1,99:0}[F%100],H=[],C,A;if(B===undefined){B=F>400}if(F==500){F=400}for(var G in D){G=parseInt(G,10);if(!C||G<C){C=G}if(!A||G>A){A=G}H.push(G)}if(F<C){F=C}if(F>A){F=A}H.sort(function(J,I){return(B?(J>F&&I>F)?J<I:J>I:(J<F&&I<F)?J>I:J<I)?-1:1});return D[H[0]]}}function p(){function A(C,D){if(C.contains){return C.contains(D)}return C.compareDocumentPosition(D)&16}function y(D){var C=D.relatedTarget;if(!C||A(this,C)){return}z(this)}function B(C){z(this)}function z(C){setTimeout(function(){k.replace(C,d.get(C).options,true)},10)}this.attach=function(C){if(C.onmouseenter===undefined){o(C,"mouseover",y);o(C,"mouseout",y)}else{o(C,"mouseenter",B);o(C,"mouseleave",B)}}}function x(){var A={},y=0;function z(B){return B.cufid||(B.cufid=++y)}this.get=function(B){var C=z(B);return A[C]||(A[C]={})}}function a(y){var A={},z={};this.get=function(B){return A[B]!=undefined?A[B]:y[B]};this.getSize=function(C,B){return z[C]||(z[C]=new l.Size(this.get(C),B))};this.extend=function(B){for(var C in B){A[C]=B[C]}return this}}function o(z,y,A){if(z.addEventListener){z.addEventListener(y,A,false)}else{if(z.attachEvent){z.attachEvent("on"+y,function(){return A.call(z,fabric.window.event)})}}}function r(z,y){var A=d.get(z);if(A.options){return z}if(y.hover&&y.hoverables[z.nodeName.toLowerCase()]){b.attach(z)}A.options=y;return z}function i(y){var z={};return function(A){if(!z.hasOwnProperty(A)){z[A]=y.apply(null,arguments)}return z[A]}}function c(D,C){if(!C){C=l.getStyle(D)}var z=l.quotedList(C.get("fontFamily").toLowerCase()),B;for(var A=0,y=z.length;A<y;++A){B=z[A];if(h[B]){return h[B].get(C.get("fontStyle"),C.get("fontWeight"))}}return null}function f(y){return fabric.document.getElementsByTagName(y)}function g(){var y={},B;for(var A=0,z=arguments.length;A<z;++A){for(B in arguments[A]){y[B]=arguments[A][B]}}return y}function m(B,J,z,K,C,A){var I=K.separate;if(I=="none"){return w[K.engine].apply(null,arguments)}var H=fabric.document.createDocumentFragment(),E;var F=J.split(n[I]),y=(I=="words");if(y&&s){if(/^\s/.test(J)){F.unshift("")}if(/\s$/.test(J)){F.push("")}}for(var G=0,D=F.length;G<D;++G){E=w[K.engine](B,y?l.textAlign(F[G],z,G,D):F[G],z,K,C,A,G<D-1);if(E){H.appendChild(E)}}return H}function j(z,G){var A,y,D,F;for(var B=r(z,G).firstChild;B;B=D){D=B.nextSibling;F=false;if(B.nodeType==1){if(!B.firstChild){continue}if(!/cufon/.test(B.className)){arguments.callee(B,G);continue}else{F=true}}if(!y){y=l.getStyle(z).extend(G)}if(!A){A=c(z,y)}if(!A){continue}if(F){w[G.engine](A,null,y,G,B,z);continue}var E=B.data;if(typeof G_vmlCanvasManager!="undefined"){E=E.replace(/\r/g,"\n")}if(E===""){continue}var C=m(A,E,y,G,B,z);if(C){B.parentNode.replaceChild(C,B)}else{B.parentNode.removeChild(B)}}}var s=" ".split(/\s+/).length==0;var d=new x();var b=new p();var v=[];var w={},h={},t={engine:null,hover:false,hoverables:{a:true},printable:true,selector:(fabric.window.Sizzle||(fabric.window.jQuery&&function(y){return jQuery(y)})||(fabric.window.dojo&&dojo.query)||(fabric.window.$$&&function(y){return $$(y)})||(fabric.window.$&&function(y){return $(y)})||(fabric.document.querySelectorAll&&function(y){return fabric.document.querySelectorAll(y)})||f),separate:"words",textShadow:"none"};var n={words:/\s+/,characters:""};k.now=function(){u.ready();return k};k.refresh=function(){var A=v.splice(0,v.length);for(var z=0,y=A.length;z<y;++z){k.replace.apply(null,A[z])}return k};k.registerEngine=function(z,y){if(!y){return k}w[z]=y;return k.set("engine",z)};k.registerFont=function(A){var y=new q(A),z=y.family;if(!h[z]){h[z]=new e()}h[z].add(y);return k.set("fontFamily",'"'+z+'"')};k.replace=function(A,z,y){z=g(t,z);if(!z.engine){return k}if(typeof z.textShadow=="string"&&z.textShadow){z.textShadow=l.textShadow(z.textShadow)}if(!y){v.push(arguments)}if(A.nodeType||typeof A=="string"){A=[A]}l.ready(function(){for(var C=0,B=A.length;C<B;++C){var D=A[C];if(typeof D=="string"){k.replace(z.selector(D),z,true)}else{j(D,z)}}});return k};k.replaceElement=function(z,y){y=g(t,y);if(typeof y.textShadow=="string"&&y.textShadow){y.textShadow=l.textShadow(y.textShadow)}return j(z,y)};k.engines=w;k.fonts=h;k.getOptions=function(){return g(t)};k.set=function(y,z){t[y]=z;return k};return k})();Cufon.registerEngine("canvas",(function(){var a=Cufon.CSS.supports("display","inline-block");var g=!a&&(fabric.document.compatMode=="BackCompat"||/frameset|transitional/i.test(fabric.document.doctype.publicId));var h=fabric.document.createElement("style");h.type="text/css";var f=fabric.document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(g?"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+(a?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}");try{h.appendChild(f)}catch(d){h.setAttribute("type","text/css");h.styleSheet.cssText=f.data}fabric.document.getElementsByTagName("head")[0].appendChild(h);function c(q,j){var o=0,n=0;var e=[],p=/([mrvxe])([^a-z]*)/g,l;generate:for(var k=0;l=p.exec(q);++k){var m=l[2].split(",");switch(l[1]){case"v":e[k]={m:"bezierCurveTo",a:[o+~~m[0],n+~~m[1],o+~~m[2],n+~~m[3],o+=~~m[4],n+=~~m[5]]};break;case"r":e[k]={m:"lineTo",a:[o+=~~m[0],n+=~~m[1]]};break;case"m":e[k]={m:"moveTo",a:[o=~~m[0],n=~~m[1]]};break;case"x":e[k]={m:"closePath",a:[]};break;case"e":break generate}j[e[k].m].apply(j,e[k].a)}return e}function b(n,m){for(var k=0,j=n.length;k<j;++k){var e=n[k];m[e.m].apply(m,e.a)}}return function(ab,E,W,A,J,ac){var n=(E===null);var H=ab.viewBox;var o=W.getSize("fontSize",ab.baseSize);var U=W.get("letterSpacing");U=(U=="normal")?0:o.convertFrom(parseInt(U,10));var I=0,V=0,T=0,C=0;var G=A.textShadow,R=[];Cufon.textOptions.shadowOffsets=[];Cufon.textOptions.shadows=null;if(G){Cufon.textOptions.shadows=G;for(var aa=0,X=G.length;aa<X;++aa){var N=G[aa];var Q=o.convertFrom(parseFloat(N.offX));var P=o.convertFrom(parseFloat(N.offY));R[aa]=[Q,P]}}var ag=Cufon.CSS.textTransform(n?J.alt:E,W).split("");var e=0,D=null;var z=0,M=1,L=[];for(var aa=0,X=ag.length;aa<X;++aa){if(ag[aa]==="\n"){M++;if(e>z){z=e}L.push(e);e=0;continue}var B=ab.glyphs[ag[aa]]||ab.missingGlyph;if(!B){continue}e+=D=Number(B.w||ab.w)+U}L.push(e);e=Math.max(z,e);var m=[];for(var aa=L.length;aa--;){m[aa]=e-L[aa]}if(D===null){return null}V+=(H.width-D);C+=H.minX;var v,p;if(n){v=J;p=J.firstChild}else{v=fabric.document.createElement("span");v.className="cufon cufon-canvas";v.alt=E;p=fabric.document.createElement("canvas");v.appendChild(p);if(A.printable){var Y=fabric.document.createElement("span");Y.className="cufon-alt";Y.appendChild(fabric.document.createTextNode(E));v.appendChild(Y)}}var ah=v.style;var O=p.style||{};var k=o.convert(H.height-I+T);var af=Math.ceil(k);var S=af/k;p.width=Math.ceil(o.convert(e+V-C)*S);p.height=af;I+=H.minY;O.top=Math.round(o.convert(I-ab.ascent))+"px";O.left=Math.round(o.convert(C))+"px";var j=Math.ceil(o.convert(e*S));var t=j+"px";var s=o.convert(ab.height);var F=(A.lineHeight-1)*o.convert(-ab.ascent/5)*(M-1);Cufon.textOptions.width=j;Cufon.textOptions.height=(s*M)+F;Cufon.textOptions.lines=M;Cufon.textOptions.totalLineHeight=F;if(a){ah.width=t;ah.height=s+"px"}else{ah.paddingLeft=t;ah.paddingBottom=(s-1)+"px"}var ad=Cufon.textOptions.context||p.getContext("2d"),K=af/H.height;Cufon.textOptions.fontAscent=ab.ascent*K;Cufon.textOptions.boundaries=null;for(var w=Cufon.textOptions.shadowOffsets,aa=R.length;aa--;){w[aa]=[R[aa][0]*K,R[aa][1]*K]}ad.save();ad.scale(K,K);ad.translate(-C-((1/K*p.width)/2)+(Cufon.fonts[ab.family].offsetLeft||0),-I-((Cufon.textOptions.height/K)/2)+(Cufon.fonts[ab.family].offsetTop||0));ad.lineWidth=ab.face["underline-thickness"];ad.save();function q(l,i){ad.strokeStyle=i;ad.beginPath();ad.moveTo(0,l);ad.lineTo(e,l);ad.stroke()}var r=Cufon.getTextDecoration(A),u=A.fontStyle==="italic";function ae(){ad.save();ad.fillStyle=A.backgroundColor;var aj=0,an=0,y=[{left:0}];if(A.textAlign==="right"){ad.translate(m[an],0);y[0].left=m[an]*K}else{if(A.textAlign==="center"){ad.translate(m[an]/2,0);y[0].left=m[an]/2*K}}for(var al=0,ak=ag.length;al<ak;++al){if(ag[al]==="\n"){an++;var am=-ab.ascent-((ab.ascent/5)*A.lineHeight);var x=y[y.length-1];var ai={left:0};x.width=aj*K;x.height=(-ab.ascent+ab.descent)*K;if(A.textAlign==="right"){ad.translate(-e,am);ad.translate(m[an],0);ai.left=m[an]*K}else{if(A.textAlign==="center"){ad.translate(-aj-(m[an-1]/2),am);ad.translate(m[an]/2,0);ai.left=m[an]/2*K}else{ad.translate(-aj,am)}}y.push(ai);aj=0;continue}var ap=ab.glyphs[ag[al]]||ab.missingGlyph;if(!ap){continue}var ao=Number(ap.w||ab.w)+U;if(A.backgroundColor){ad.save();ad.translate(0,ab.ascent);ad.fillRect(0,0,ao+10,-ab.ascent+ab.descent);ad.restore()}ad.translate(ao,0);aj+=ao;if(al==ak-1){y[y.length-1].width=aj*K;y[y.length-1].height=(-ab.ascent+ab.descent)*K}}ad.restore();Cufon.textOptions.boundaries=y}function Z(ai){ad.fillStyle=ai||Cufon.textOptions.color||W.get("color");var am=0,an=0;if(A.textAlign==="right"){ad.translate(m[an],0)}else{if(A.textAlign==="center"){ad.translate(m[an]/2,0)}}for(var ak=0,y=ag.length;ak<y;++ak){if(ag[ak]==="\n"){an++;var aj=-ab.ascent-((ab.ascent/5)*A.lineHeight);if(A.textAlign==="right"){ad.translate(-e,aj);ad.translate(m[an],0)}else{if(A.textAlign==="center"){ad.translate(-am-(m[an-1]/2),aj);ad.translate(m[an]/2,0)}else{ad.translate(-am,aj)}}am=0;continue}var al=ab.glyphs[ag[ak]]||ab.missingGlyph;if(!al){continue}var x=Number(al.w||ab.w)+U;if(r){ad.save();ad.strokeStyle=ad.fillStyle;ad.lineWidth+=ad.lineWidth;ad.beginPath();if(r.underline){ad.moveTo(0,-ab.face["underline-position"]+0.5);ad.lineTo(x,-ab.face["underline-position"]+0.5)}if(r.overline){ad.moveTo(0,ab.ascent+0.5);ad.lineTo(x,ab.ascent+0.5)}if(r["line-through"]){ad.moveTo(0,-ab.descent+0.5);ad.lineTo(x,-ab.descent+0.5)}ad.stroke();ad.restore()}if(u){ad.save();ad.transform(1,0,-0.25,1,0,0)}ad.beginPath();if(al.d){if(al.code){b(al.code,ad)}else{al.code=c("m"+al.d,ad)}}ad.fill();if(A.strokeStyle){ad.closePath();ad.save();ad.lineWidth=A.strokeWidth;ad.strokeStyle=A.strokeStyle;ad.stroke();ad.restore()}if(u){ad.restore()}ad.translate(x,0);am+=x}}ad.save();ae();if(G){for(var aa=0,X=G.length;aa<X;++aa){var N=G[aa];ad.save();ad.translate.apply(ad,R[aa]);Z(N.color);ad.restore()}}Z();ad.restore();ad.restore();ad.restore();return v}})());Cufon.registerEngine("vml",(function(){if(!fabric.document.namespaces){return}var d=fabric.document.createElement("canvas");if(d&&d.getContext&&d.getContext.apply){return}if(fabric.document.namespaces.cvml==null){fabric.document.namespaces.add("cvml","urn:schemas-microsoft-com:vml")}var b=fabric.document.createElement("cvml:shape");b.style.behavior="url(#default#VML)";if(!b.coordsize){return}b=null;fabric.document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}</style>');function c(e,f){return a(e,/(?:em|ex|%)$/i.test(f)?"1em":f)}function a(h,i){if(/px$/i.test(i)){return parseFloat(i)}var g=h.style.left,f=h.runtimeStyle.left;h.runtimeStyle.left=h.currentStyle.left;h.style.left=i;var e=h.style.pixelLeft;h.style.left=g;h.runtimeStyle.left=f;return e}return function(T,z,O,w,D,U,M){var h=(z===null);if(h){z=D.alt}var B=T.viewBox;var j=O.computedFontSize||(O.computedFontSize=new Cufon.CSS.Size(c(U,O.get("fontSize"))+"px",T.baseSize));var L=O.computedLSpacing;if(L==undefined){L=O.get("letterSpacing");O.computedLSpacing=L=(L=="normal")?0:~~j.convertFrom(a(U,L))}var t,m;if(h){t=D;m=D.firstChild}else{t=fabric.document.createElement("span");t.className="cufon cufon-vml";t.alt=z;m=fabric.document.createElement("span");m.className="cufon-vml-canvas";t.appendChild(m);if(w.printable){var R=fabric.document.createElement("span");R.className="cufon-alt";R.appendChild(fabric.document.createTextNode(z));t.appendChild(R)}if(!M){t.appendChild(fabric.document.createElement("cvml:shape"))}}var Z=t.style;var G=m.style;var f=j.convert(B.height),W=Math.ceil(f);var K=W/f;var J=B.minX,I=B.minY;G.height=W;G.top=Math.round(j.convert(I-T.ascent));G.left=Math.round(j.convert(J));Z.height=j.convert(T.height)+"px";var p=Cufon.getTextDecoration(w);var y=O.get("color");var X=Cufon.CSS.textTransform(z,O).split("");var e=0,H=0,q=null;var x,r,A=w.textShadow;for(var S=0,Q=0,P=X.length;S<P;++S){x=T.glyphs[X[S]]||T.missingGlyph;if(x){e+=q=~~(x.w||T.w)+L}}if(q===null){return null}var s=-J+e+(B.width-q);var Y=j.convert(s*K),N=Math.round(Y);var F=s+","+B.height,g;var C="r"+F+"nsnf";for(S=0;S<P;++S){x=T.glyphs[X[S]]||T.missingGlyph;if(!x){continue}if(h){r=m.childNodes[Q];if(r.firstChild){r.removeChild(r.firstChild)}}else{r=fabric.document.createElement("cvml:shape");m.appendChild(r)}r.stroked="f";r.coordsize=F;r.coordorigin=g=(J-H)+","+I;r.path=(x.d?"m"+x.d+"xe":"")+"m"+g+C;r.fillcolor=y;var V=r.style;V.width=N;V.height=W;if(A){var o=A[0],n=A[1];var v=Cufon.CSS.color(o.color),u;var E=fabric.document.createElement("cvml:shadow");E.on="t";E.color=v.color;E.offset=o.offX+","+o.offY;if(n){u=Cufon.CSS.color(n.color);E.type="double";E.color2=u.color;E.offset2=n.offX+","+n.offY}E.opacity=v.opacity||(u&&u.opacity)||1;r.appendChild(E)}H+=~~(x.w||T.w)+L;++Q}Z.width=Math.max(Math.ceil(j.convert(e*K)),0);return t}})());Cufon.getTextDecoration=function(a){return{underline:a.textDecoration==="underline",overline:a.textDecoration==="overline","line-through":a.textDecoration==="line-through"}};if(typeof exports!="undefined"){exports.Cufon=Cufon}var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());fabric.log=function(){};fabric.warn=function(){};if(typeof console!=="undefined"){if(typeof console.log!=="undefined"&&console.log.apply){fabric.log=function(){return console.log.apply(console,arguments)}}if(typeof console.warn!=="undefined"&&console.warn.apply){fabric.warn=function(){return console.warn.apply(console,arguments)}}}fabric.Observable={observe:function(a,b){if(!this.__eventListeners){this.__eventListeners={}}if(arguments.length===1){for(var c in a){this.on(c,a[c])}}else{if(!this.__eventListeners[a]){this.__eventListeners[a]=[]}this.__eventListeners[a].push(b)}},stopObserving:function(a,b){if(!this.__eventListeners){this.__eventListeners={}}if(this.__eventListeners[a]){fabric.util.removeFromArray(this.__eventListeners[a],b)}},fire:function(c,d){if(!this.__eventListeners){this.__eventListeners={}}var b=this.__eventListeners[c];if(!b){return}for(var e=0,a=b.length;e<a;e++){b[e](d||{})}}};fabric.Observable.on=fabric.Observable.observe;fabric.Observable.off=fabric.Observable.stopObserving;(function(){fabric.util={};function j(o,n){var m=o.indexOf(n);if(m!==-1){o.splice(m,1)}return o}function g(n,m){return Math.floor(Math.random()*(m-n+1))+n}var h=Math.PI/180;function c(m){return m*h}function e(n,m){return parseFloat(Number(n).toFixed(m))}function l(){return false}function d(x){x||(x={});var n=+new Date(),p=x.duration||500,v=n+p,o,s=x.onChange||function(){},q=x.abort||function(){return false},t=x.easing||function(z,y,B,A){return -B*Math.cos(z/A*(Math.PI/2))+B+y},m="startValue" in x?x.startValue:0,u="endValue" in x?x.endValue:100,w=x.byValue||u-m;x.onStart&&x.onStart();(function r(){o=+new Date();var y=o>v?p:(o-n);s(t(y,m,w,p));if(o>v||q()){x.onComplete&&x.onComplete();return}k(r)})()}var f=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(m){fabric.window.setTimeout(m,1000/60)};var k=function(){return f.apply(fabric.window,arguments)};function b(n,p,o){if(n){var m=new Image();m.onload=function(){p&&p.call(o,m);m=m.onload=null};m.src=n}else{p&&p.call(o,n)}}function i(p,s){function o(t){return fabric[fabric.util.string.camelize(fabric.util.string.capitalize(t))]}function n(){if(++r===m){if(s){s(q)}}}var q=[],r=0,m=p.length;p.forEach(function(v,u){if(!v.type){return}var t=o(v.type);if(t.async){t.fromObject(v,function(w){q[u]=w;n()})}else{q[u]=t.fromObject(v);n()}})}function a(o,n,p){var m=o.length>1?new fabric.PathGroup(o,n):o[0];if(typeof p!=="undefined"){m.setSourcePath(p)}return m}fabric.util.removeFromArray=j;fabric.util.degreesToRadians=c;fabric.util.toFixed=e;fabric.util.getRandomInt=g;fabric.util.falseFunction=l;fabric.util.animate=d;fabric.util.requestAnimFrame=k;fabric.util.loadImage=b;fabric.util.enlivenObjects=i;fabric.util.groupSVGElements=a})();(function(){var d=Array.prototype.slice;if(!Array.prototype.indexOf){Array.prototype.indexOf=function(g){if(this===void 0||this===null){throw new TypeError()}var h=Object(this),e=h.length>>>0;if(e===0){return -1}var i=0;if(arguments.length>0){i=Number(arguments[1]);if(i!==i){i=0}else{if(i!==0&&i!==(1/0)&&i!==-(1/0)){i=(i>0||-1)*Math.floor(Math.abs(i))}}}if(i>=e){return -1}var f=i>=0?i:Math.max(e-Math.abs(i),0);for(;f<e;f++){if(f in h&&h[f]===g){return f}}return -1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(h,g){for(var f=0,e=this.length>>>0;f<e;f++){if(f in this){h.call(g,this[f],f,this)}}}}if(!Array.prototype.map){Array.prototype.map=function(j,h){var f=[];for(var g=0,e=this.length>>>0;g<e;g++){if(g in this){f[g]=j.call(h,this[g],g,this)}}return f}}if(!Array.prototype.every){Array.prototype.every=function(h,g){for(var f=0,e=this.length>>>0;f<e;f++){if(f in this&&!h.call(g,this[f],f,this)){return false}}return true}}if(!Array.prototype.some){Array.prototype.some=function(h,g){for(var f=0,e=this.length>>>0;f<e;f++){if(f in this&&h.call(g,this[f],f,this)){return true}}return false}}if(!Array.prototype.filter){Array.prototype.filter=function(j,h){var f=[],k;for(var g=0,e=this.length>>>0;g<e;g++){if(g in this){k=this[g];if(j.call(h,k,g,this)){f.push(k)}}}return f}}if(!Array.prototype.reduce){Array.prototype.reduce=function(g){var e=this.length>>>0,f=0,h;if(arguments.length>1){h=arguments[1]}else{do{if(f in this){h=this[f++];break}if(++f>=e){throw new TypeError()}}while(true)}for(;f<e;f++){if(f in this){h=g.call(null,h,this[f],f,this)}}return h}}function b(k,j){var g=d.call(arguments,2),f=[];for(var h=0,e=k.length;h<e;h++){f[h]=g.length?k[h][j].apply(k[h],g):k[h][j].call(k[h])}return f}function a(h,g){if(!h||h.length===0){return undefined}var f=h.length-1,e=g?h[f][g]:h[f];if(g){while(f--){if(h[f][g]>=e){e=h[f][g]}}}else{while(f--){if(h[f]>=e){e=h[f]}}}return e}function c(h,g){if(!h||h.length===0){return undefined}var f=h.length-1,e=g?h[f][g]:h[f];if(g){while(f--){if(h[f][g]<e){e=h[f][g]}}}else{while(f--){if(h[f]<e){e=h[f]}}}return e}fabric.util.array={invoke:b,min:c,max:a}})();(function(){function b(c,e){for(var d in e){c[d]=e[d]}return c}function a(c){return b({},c)}fabric.util.object={extend:b,clone:a}})();(function(){if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}}function b(d){return d.replace(/-+(.)?/g,function(e,f){return f?f.toUpperCase():""})}function c(d){return d.charAt(0).toUpperCase()+d.slice(1).toLowerCase()}function a(d){return d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}fabric.util.string={camelize:b,capitalize:c,escapeXml:a}}());(function(){var c=Array.prototype.slice,a=Function.prototype.apply,b=function(){};if(!Function.prototype.bind){Function.prototype.bind=function(d){var g=this,e=c.call(arguments,1),f;if(e.length){f=function(){return a.call(g,this instanceof b?this:d,e.concat(c.call(arguments)))}}else{f=function(){return a.call(g,this instanceof b?this:d,arguments)}}b.prototype=this.prototype;f.prototype=new b();return f}}})();(function(){var f=Array.prototype.slice,e=function(){};var c=(function(){for(var g in {toString:1}){if(g==="toString"){return false}}return true})();var b=function(g,j,h){for(var i in j){if(i in g.prototype&&typeof g.prototype[i]==="function"){g.prototype[i]=(function(k){return function(){var m=this.constructor.superclass;this.constructor.superclass=h;var l=j[k].apply(this,arguments);this.constructor.superclass=m;if(k!=="initialize"){return l}}})(i)}else{g.prototype[i]=j[i]}if(c){if(j.toString!==Object.prototype.toString){g.prototype.toString=j.toString}if(j.valueOf!==Object.prototype.valueOf){g.prototype.valueOf=j.valueOf}}}};function a(){}function d(){var k=null,j=f.call(arguments,0);if(typeof j[0]==="function"){k=j.shift()}function g(){this.initialize.apply(this,arguments)}g.superclass=k;g.subclasses=[];if(k){a.prototype=k.prototype;g.prototype=new a();k.subclasses.push(g)}for(var h=0,l=j.length;h<l;h++){b(g,j[h],k)}if(!g.prototype.initialize){g.prototype.initialize=e}g.prototype.constructor=g;return g}fabric.util.createClass=d})();(function(){function g(r){var v=Array.prototype.slice.call(arguments,1),u,s,q=v.length;for(s=0;s<q;s++){u=typeof r[v[s]];if(!(/^(?:function|object|unknown)$/).test(u)){return false}}return true}var d=(function(){if(typeof fabric.document.documentElement.uniqueID!=="undefined"){return function(r){return r.uniqueID}}var q=0;return function(r){return r.__uniqueID||(r.__uniqueID="uniqueID__"+q++)}})();var e,c;(function(){var q={};e=function(r){return q[r]};c=function(s,r){q[s]=r}})();function h(q,r){return{handler:r,wrappedHandler:k(q,r)}}function k(q,r){return function(s){r.call(e(q),s||fabric.window.event)}}function i(r,q){return function(v){if(f[r]&&f[r][q]){var t=f[r][q];for(var u=0,s=t.length;u<s;u++){t[u].call(this,v||fabric.window.event)}}}}var n=(g(fabric.document.documentElement,"addEventListener","removeEventListener")&&g(fabric.window,"addEventListener","removeEventListener")),l=(g(fabric.document.documentElement,"attachEvent","detachEvent")&&g(fabric.window,"attachEvent","detachEvent")),m={},f={},b,j;if(n){b=function(r,q,s){r.addEventListener(q,s,false)};j=function(r,q,s){r.removeEventListener(q,s,false)}}else{if(l){b=function(s,q,t){var r=d(s);c(r,s);if(!m[r]){m[r]={}}if(!m[r][q]){m[r][q]=[]}var u=h(r,t);m[r][q].push(u);s.attachEvent("on"+q,u.wrappedHandler)};j=function(u,r,v){var t=d(u),w;if(m[t]&&m[t][r]){for(var s=0,q=m[t][r].length;s<q;s++){w=m[t][r][s];if(w&&w.handler===v){u.detachEvent("on"+r,w.wrappedHandler);m[t][r][s]=null}}}}}else{b=function(s,q,t){var r=d(s);if(!f[r]){f[r]={}}if(!f[r][q]){f[r][q]=[];var u=s["on"+q];if(u){f[r][q].push(u)}s["on"+q]=i(r,q)}f[r][q].push(t)};j=function(v,s,w){var u=d(v);if(f[u]&&f[u][s]){var r=f[u][s];for(var t=0,q=r.length;t<q;t++){if(r[t]===w){r.splice(t,1)}}}}}}fabric.util.addListener=b;fabric.util.removeListener=j;function p(q){return{x:a(q),y:o(q)}}var a=function(s){var r=fabric.document.documentElement,q=fabric.document.body||{scrollLeft:0};return s.pageX||((typeof s.clientX!=="unknown"?s.clientX:0)+(r.scrollLeft||q.scrollLeft)-(r.clientLeft||0))};var o=function(s){var r=fabric.document.documentElement,q=fabric.document.body||{scrollTop:0};return s.pageY||((typeof s.clientY!=="unknown"?s.clientY:0)+(r.scrollTop||q.scrollTop)-(r.clientTop||0))};if(fabric.isTouchSupported){a=function(q){return q.touches&&q.touches[0]&&q.touches[0].pageX||q.clientX};o=function(q){return q.touches&&q.touches[0]&&q.touches[0].pageY||q.clientY}}fabric.util.getPointer=p;fabric.util.object.extend(fabric.util,fabric.Observable)})();(function(){function d(g,i){var k=g.style;if(!k){return g}if(typeof i==="string"){g.style.cssText+=";"+i;return i.indexOf("opacity")>-1?b(g,i.match(/opacity:\s*(\d?\.?\d*)/)[1]):g}for(var j in i){if(j==="opacity"){b(g,i[j])}else{var h=(j==="float"||j==="cssFloat")?(typeof k.styleFloat==="undefined"?"cssFloat":"styleFloat"):j;k[h]=i[j]}}return g}var f=fabric.document.createElement("div"),e=typeof f.style.opacity==="string",a=typeof f.style.filter==="string",c=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,b=function(g){return g};if(e){b=function(g,h){g.style.opacity=h;return g}}else{if(a){b=function(g,h){var i=g.style;if(g.currentStyle&&!g.currentStyle.hasLayout){i.zoom=1}if(c.test(i.filter)){h=h>=0.9999?"":("alpha(opacity="+(h*100)+")");i.filter=i.filter.replace(c,h)}else{i.filter+=" alpha(opacity="+(h*100)+")"}return g}}}fabric.util.setStyle=d})();(function(){var h=Array.prototype.slice;function g(j){return typeof j==="string"?fabric.document.getElementById(j):j}var b=function(j){return h.call(j,0)};var i;try{i=b(fabric.document.childNodes) instanceof Array}catch(a){}if(!i){b=function(k){var j=new Array(k.length),l=k.length;while(l--){j[l]=k[l]}return j}}function c(k,j){var l=fabric.document.createElement(k);for(var m in j){if(m==="class"){l.className=j[m]}else{if(m==="for"){l.htmlFor=j[m]}else{l.setAttribute(m,j[m])}}}return l}function f(j,k){if((" "+j.className+" ").indexOf(" "+k+" ")===-1){j.className+=(j.className?" ":"")+k}}function e(k,l,j){if(typeof l==="string"){l=c(l,j)}if(k.parentNode){k.parentNode.replaceChild(l,k)}l.appendChild(k);return l}function d(k){var j=0,l=0;do{j+=k.offsetTop||0;l+=k.offsetLeft||0;k=k.offsetParent}while(k);return({left:l,top:j})}(function(){var k=fabric.document.documentElement.style;var l="userSelect" in k?"userSelect":"MozUserSelect" in k?"MozUserSelect":"WebkitUserSelect" in k?"WebkitUserSelect":"KhtmlUserSelect" in k?"KhtmlUserSelect":"";function m(n){if(typeof n.onselectstart!=="undefined"){n.onselectstart=fabric.util.falseFunction}if(l){n.style[l]="none"}else{if(typeof n.unselectable==="string"){n.unselectable="on"}}return n}function j(n){if(typeof n.onselectstart!=="undefined"){n.onselectstart=null}if(l){n.style[l]=""}else{if(typeof n.unselectable==="string"){n.unselectable=""}}return n}fabric.util.makeElementUnselectable=m;fabric.util.makeElementSelectable=j})();(function(){function j(k,o){var m=fabric.document.getElementsByTagName("head")[0],l=fabric.document.createElement("script"),n=true;l.type="text/javascript";l.setAttribute("runat","server");l.onload=l.onreadystatechange=function(p){if(n){if(typeof this.readyState==="string"&&this.readyState!=="loaded"&&this.readyState!=="complete"){return}n=false;o(p||fabric.window.event);l=l.onload=l.onreadystatechange=null}};l.src=k;m.appendChild(l)}fabric.util.getScript=j})();fabric.util.getById=g;fabric.util.toArray=b;fabric.util.makeElement=c;fabric.util.addClass=f;fabric.util.wrapElement=e;fabric.util.getElementOffset=d})();(function(){function d(e,f){return e+(/\?/.test(e)?"&":"?")+f}var c=(function(){var h=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest()}];for(var e=h.length;e--;){try{var g=h[e]();if(g){return h[e]}}catch(f){}}})();function a(){}function b(g,f){f||(f={});var j=f.method?f.method.toUpperCase():"GET",h=f.onComplete||function(){},i=c(),e;i.onreadystatechange=function(){if(i.readyState===4){h(i);i.onreadystatechange=a}};if(j==="GET"){e=null;if(typeof f.parameters==="string"){g=d(g,f.parameters)}}i.open(j,g,true);if(j==="POST"||j==="PUT"){i.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}i.send(e);return i}fabric.util.request=b})();(function(){function d(F,E,H,G){return H*(F/=G)*F+E}function l(F,E,H,G){return -H*(F/=G)*(F-2)+E}function r(F,E,H,G){F/=(G/2);if(F<1){return H/2*F*F+E}return -H/2*((--F)*(F-2)-1)+E}function B(F,E,H,G){return H*(F/=G)*F*F+E}function q(F,E,H,G){return H*((F=F/G-1)*F*F+1)+E}function u(F,E,H,G){F/=G/2;if(F<1){return H/2*F*F*F+E}return H/2*((F-=2)*F*F+2)+E}function t(F,E,H,G){return H*(F/=G)*F*F*F+E}function g(F,E,H,G){return -H*((F=F/G-1)*F*F*F-1)+E}function k(F,E,H,G){F/=G/2;if(F<1){return H/2*F*F*F*F+E}return -H/2*((F-=2)*F*F*F-2)+E}function y(F,E,H,G){return H*(F/=G)*F*F*F*F+E}function j(F,E,H,G){return H*((F=F/G-1)*F*F*F*F+1)+E}function n(F,E,H,G){F/=G/2;if(F<1){return H/2*F*F*F*F*F+E}return H/2*((F-=2)*F*F*F*F+2)+E}function f(F,E,H,G){return -H*Math.cos(F/G*(Math.PI/2))+H+E}function o(F,E,H,G){return H*Math.sin(F/G*(Math.PI/2))+E}function v(F,E,H,G){return -H/2*(Math.cos(Math.PI*F/G)-1)+E}function D(F,E,H,G){return(F===0)?E:H*Math.pow(2,10*(F/G-1))+E}function c(F,E,H,G){return(F===G)?E+H:H*(-Math.pow(2,-10*F/G)+1)+E}function i(F,E,H,G){if(F===0){return E}if(F===G){return E+H}F/=G/2;if(F<1){return H/2*Math.pow(2,10*(F-1))+E}return H/2*(-Math.pow(2,-10*--F)+2)+E}function h(F,E,H,G){return -H*(Math.sqrt(1-(F/=G)*F)-1)+E}function p(F,E,H,G){return H*Math.sqrt(1-(F=F/G-1)*F)+E}function x(F,E,H,G){F/=G/2;if(F<1){return -H/2*(Math.sqrt(1-F*F)-1)+E}return H/2*(Math.sqrt(1-(F-=2)*F)+1)+E}function s(G,E,K,J){var H=1.70158;var I=0;var F=K;if(G===0){return E}G/=J;if(G===1){return E+K}if(!I){I=J*0.3}if(F<Math.abs(K)){F=K;H=I/4}else{H=I/(2*Math.PI)*Math.asin(K/F)}return -(F*Math.pow(2,10*(G-=1))*Math.sin((G*J-H)*(2*Math.PI)/I))+E}function z(G,E,K,J){var H=1.70158;var I=0;var F=K;if(G===0){return E}G/=J;if(G===1){return E+K}if(!I){I=J*0.3}if(F<Math.abs(K)){F=K;H=I/4}else{H=I/(2*Math.PI)*Math.asin(K/F)}return F*Math.pow(2,-10*G)*Math.sin((G*J-H)*(2*Math.PI)/I)+K+E}function a(G,E,K,J){var H=1.70158;var I=0;var F=K;if(G===0){return E}G/=J/2;if(G===2){return E+K}if(!I){I=J*(0.3*1.5)}if(F<Math.abs(K)){F=K;H=I/4}else{H=I/(2*Math.PI)*Math.asin(K/F)}if(G<1){return -0.5*(F*Math.pow(2,10*(G-=1))*Math.sin((G*J-H)*(2*Math.PI)/I))+E}return F*Math.pow(2,-10*(G-=1))*Math.sin((G*J-H)*(2*Math.PI)/I)*0.5+K+E}function m(F,E,I,H,G){if(G===undefined){G=1.70158}return I*(F/=H)*F*((G+1)*F-G)+E}function w(F,E,I,H,G){if(G===undefined){G=1.70158}return I*((F=F/H-1)*F*((G+1)*F+G)+1)+E}function A(F,E,I,H,G){if(G===undefined){G=1.70158}F/=H/2;if(F<1){return I/2*(F*F*(((G*=(1.525))+1)*F-G))+E}return I/2*((F-=2)*F*(((G*=(1.525))+1)*F+G)+2)+E}function e(F,E,H,G){return H-b(G-F,0,H,G)+E}function b(F,E,H,G){if((F/=G)<(1/2.75)){return H*(7.5625*F*F)+E}else{if(F<(2/2.75)){return H*(7.5625*(F-=(1.5/2.75))*F+0.75)+E}else{if(F<(2.5/2.75)){return H*(7.5625*(F-=(2.25/2.75))*F+0.9375)+E}else{return H*(7.5625*(F-=(2.625/2.75))*F+0.984375)+E}}}}function C(F,E,H,G){if(F<G/2){return e(F*2,0,H,G)*0.5+E}return b(F*2-G,0,H,G)*0.5+H*0.5+E}fabric.util.ease={easeInQuad:d,easeOutQuad:l,easeInOutQuad:r,easeInCubic:B,easeOutCubic:q,easeInOutCubic:u,easeInQuart:t,easeOutQuart:g,easeInOutQuart:k,easeInQuint:y,easeOutQuint:j,easeInOutQuint:n,easeInSine:f,easeOutSine:o,easeInOutSine:v,easeInExpo:D,easeOutExpo:c,easeInOutExpo:i,easeInCirc:h,easeOutCirc:p,easeInOutCirc:x,easeInElastic:s,easeOutElastic:z,easeInOutElastic:a,easeInBack:m,easeOutBack:w,easeInOutBack:A,easeInBounce:e,easeOutBounce:b,easeInOutBounce:C}}());(function(j){var h=j.fabric||(j.fabric={}),p=h.util.object.extend,f=h.util.string.capitalize,q=h.util.object.clone;var l={cx:"left",x:"left",cy:"top",y:"top",r:"radius","fill-opacity":"opacity","fill-rule":"fillRule","stroke-width":"strokeWidth",transform:"transformMatrix","text-decoration":"textDecoration","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle","font-family":"fontFamily"};function a(t){if(t in l){return l[t]}return t}function e(w,v){if(!w){return}var y,u,t={};if(w.parentNode&&/^g$/i.test(w.parentNode.nodeName)){t=h.parseAttributes(w.parentNode,v)}var x=v.reduce(function(A,z){y=w.getAttribute(z);u=parseFloat(y);if(y){if((z==="fill"||z==="stroke")&&y==="none"){y=""}if(z==="fill-rule"){y=(y==="evenodd")?"destination-over":y}if(z==="transform"){y=h.parseTransformAttribute(y)}z=a(z);A[z]=isNaN(u)?y:u}return A},{});x=p(x,p(o(w),h.parseStyleAttribute(w)));return p(t,x)}h.parseTransformAttribute=(function(){function t(M,N){var O=N[0];M[0]=Math.cos(O);M[1]=Math.sin(O);M[2]=-Math.sin(O);M[3]=Math.cos(O)}function y(O,P){var N=P[0],M=(P.length===2)?P[1]:P[0];O[0]=N;O[3]=M}function J(M,N){M[2]=N[0]}function v(M,N){M[1]=N[0]}function G(M,N){M[4]=N[0];if(N.length===2){M[5]=N[1]}}var A=[1,0,0,1,0,0],u="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",K="(?:\\s+,?\\s*|,\\s*)",B="(?:(skewX)\\s*\\(\\s*("+u+")\\s*\\))",z="(?:(skewY)\\s*\\(\\s*("+u+")\\s*\\))",I="(?:(rotate)\\s*\\(\\s*("+u+")(?:"+K+"("+u+")"+K+"("+u+"))?\\s*\\))",L="(?:(scale)\\s*\\(\\s*("+u+")(?:"+K+"("+u+"))?\\s*\\))",E="(?:(translate)\\s*\\(\\s*("+u+")(?:"+K+"("+u+"))?\\s*\\))",H="(?:(matrix)\\s*\\(\\s*("+u+")"+K+"("+u+")"+K+"("+u+")"+K+"("+u+")"+K+"("+u+")"+K+"("+u+")\\s*\\))",F="(?:"+H+"|"+E+"|"+L+"|"+I+"|"+B+"|"+z+")",C="(?:"+F+"(?:"+K+F+")*)",w="^\\s*(?:"+C+"?)\\s*$",D=new RegExp(w),x=new RegExp(F);return function(N){var M=A.concat();if(!N||(N&&!D.test(N))){return M}N.replace(x,function(R){var O=new RegExp(F).exec(R).filter(function(S){return(S!==""&&S!=null)}),P=O[1],Q=O.slice(2).map(parseFloat);switch(P){case"translate":G(M,Q);break;case"rotate":t(M,Q);break;case"scale":y(M,Q);break;case"skewX":J(M,Q);break;case"skewY":v(M,Q);break;case"matrix":M=Q;break}});return M}})();function s(w){if(!w){return null}w=w.trim();var y=w.indexOf(",")>-1;w=w.split(/\s+/);var u=[],v,t;if(y){v=0;t=w.length;for(;v<t;v++){var x=w[v].split(",");u.push({x:parseFloat(x[0]),y:parseFloat(x[1])})}}else{v=0;t=w.length;for(;v<t;v+=2){u.push({x:parseFloat(w[v]),y:parseFloat(w[v+1])})}}if(u.length%2!==0){}return u}function i(u){var t={},v=u.getAttribute("style");if(!v){return t}if(typeof v==="string"){v=v.replace(/;$/,"").split(";").forEach(function(y){var x=y.split(":");t[a(x[0].trim().toLowerCase())]=x[1].trim()})}else{for(var w in v){if(typeof v[w]==="undefined"){continue}t[a(w.toLowerCase())]=v[w]}}return t}function r(w){for(var t=w.length;t--;){var u=w[t].get("fill");if(/^url\(/.test(u)){var v=u.slice(5,u.length-1);if(h.gradientDefs[v]){w[t].set("fill",h.Gradient.fromElement(h.gradientDefs[v],w[t]))}}}}function g(u,E,F,D){var t=new Array(u.length),y=u.length;function v(){if(--y===0){t=t.filter(function(G){return G!=null});r(t);E(t)}}for(var A=0,w,z=u.length;A<z;A++){w=u[A];var C=h[f(w.tagName)];if(C&&C.fromElement){try{if(C.async){C.fromElement(w,(function(G,H){return function(I){D&&D(H,I);t.splice(G,0,I);v()}})(A),F)}else{var x=C.fromElement(w,F);D&&D(w,x);t.splice(A,0,x);v()}}catch(B){h.log(B.message||B)}}else{v()}}}function d(y){var w=y.getElementsByTagName("style"),u={},z;for(var v=0,t=w.length;v<t;v++){var x=w[0].textContent;x=x.replace(/\/\*[\s\S]*?\*\//g,"");z=x.match(/[^{]*\{[\s\S]*?\}/g);z=z.map(function(A){return A.trim()});z.forEach(function(F){var D=F.match(/([\s\S]*?)\s*\{([^}]*)\}/);F=D[1];var A=D[2].trim(),H=A.replace(/;$/,"").split(/\s*;\s*/);if(!u[F]){u[F]={}}for(var C=0,E=H.length;C<E;C++){var B=H[C].split(/\s*:\s*/),I=B[0],G=B[1];u[F][I]=G}})}return u}function o(u){var A=u.nodeName,v=u.getAttribute("class"),z=u.getAttribute("id"),w={};for(var y in h.cssRules){var t=(v&&new RegExp("^\\."+v).test(y))||(z&&new RegExp("^#"+z).test(y))||(new RegExp("^"+A).test(y));if(t){for(var x in h.cssRules[y]){w[x]=h.cssRules[y][x]}}}return w}h.parseSVGDocument=(function(){var t=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/;var u="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)";var v=new RegExp("^\\s*("+u+"+)\\s*,?\\s*("+u+"+)\\s*,?\\s*("+u+"+)\\s*,?\\s*("+u+"+)\\s*$");function w(x,y){while(x&&(x=x.parentNode)){if(y.test(x.nodeName)){return true}}return false}return function(K,M,J){if(!K){return}var B=new Date(),F=h.util.toArray(K.getElementsByTagName("*"));if(F.length===0){F=K.selectNodes("//*[name(.)!='svg']");var H=[];for(var G=0,I=F.length;G<I;G++){H[G]=F[G]}F=H}var x=F.filter(function(O){return t.test(O.tagName)&&!w(O,/^(?:pattern|defs)$/)});if(!x||(x&&!x.length)){return}var y=K.getAttribute("viewBox"),D=K.getAttribute("width"),A=K.getAttribute("height"),z=null,L=null,E,C;if(y&&(y=y.match(v))){E=parseInt(y[1],10);C=parseInt(y[2],10);z=parseInt(y[3],10);L=parseInt(y[4],10)}z=D?parseFloat(D):z;L=A?parseFloat(A):L;var N={width:z,height:L};h.gradientDefs=h.getGradientDefs(K);h.cssRules=d(K);h.parseElements(x,function(O){h.documentParsingTime=new Date()-B;if(M){M(O,N)}},q(N),J)}})();var k={has:function(t,u){u(false)},get:function(){},set:function(){}};function c(u,w,t){u=u.replace(/^\n\s*/,"").trim();k.has(u,function(x){if(x){k.get(u,function(z){var y=b(z);w(y.objects,y.options)})}else{new h.util.request(u,{method:"get",onComplete:v})}});function v(y){var x=y.responseXML;if(!x.documentElement&&h.window.ActiveXObject&&y.responseText){x=new ActiveXObject("Microsoft.XMLDOM");x.async="false";x.loadXML(y.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}if(!x.documentElement){return}h.parseSVGDocument(x.documentElement,function(A,z){k.set(u,{objects:h.util.array.invoke(A,"toObject"),options:z});w(A,z)},t)}}function b(v){var u=v.objects,t=v.options;u=u.map(function(w){return h[f(w.type)].fromObject(w)});return({objects:u,options:t})}function n(u,x,t){u=u.trim();var v;if(typeof DOMParser!=="undefined"){var w=new DOMParser();if(w&&w.parseFromString){v=w.parseFromString(u,"text/xml")}}else{if(h.window.ActiveXObject){v=new ActiveXObject("Microsoft.XMLDOM");v.async="false";v.loadXML(u.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}}h.parseSVGDocument(v.documentElement,function(z,y){x(z,y)},t)}function m(w){var u="";for(var v=0,t=w.length;v<t;v++){if(w[v].type!=="text"||!w[v].path){continue}u+=["@font-face {","font-family: ",w[v].fontFamily,"; ","src: url('",w[v].path,"')","}"].join("")}if(u){u=["<defs>",'<style type="text/css">',"<![CDATA[",u,"]]>","</style>","</defs>"].join("")}return u}p(h,{parseAttributes:e,parseElements:g,parseStyleAttribute:i,parsePointsAttribute:s,getCSSRules:d,loadSVGFromURL:c,loadSVGFromString:n,createSVGFontFacesMarkup:m})})(typeof exports!=="undefined"?exports:this);(function(){function c(h){var g=h.getAttribute("style");if(g){var k=g.split(/\s*;\s*/);if(k[k.length-1]===""){k.pop()}for(var f=k.length;f--;){var e=k[f].split(/\s*:\s*/),d=e[0].trim(),j=e[1].trim();if(d==="stop-color"){return j}}}}fabric.Gradient=fabric.util.createClass({initialize:function(d){d||(d={});this.x1=d.x1||0;this.y1=d.y1||0;this.x2=d.x2||0;this.y2=d.y2||0;this.colorStops=d.colorStops},toObject:function(){return{x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2,colorStops:this.colorStops}},toLiveGradient:function(e){var g=e.createLinearGradient(this.x1,this.y1,this.x2||e.canvas.width,this.y2);for(var d in this.colorStops){var f=this.colorStops[d];g.addColorStop(parseFloat(d),f)}return g}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(g,d){var k=g.getElementsByTagName("stop"),j,e={},h={x1:g.getAttribute("x1")||0,y1:g.getAttribute("y1")||0,x2:g.getAttribute("x2")||"100%",y2:g.getAttribute("y2")||0};for(var f=k.length;f--;){g=k[f];j=g.getAttribute("offset");j=parseFloat(j)/(/%$/.test(j)?100:1);e[j]=c(g)||g.getAttribute("stop-color")}a(d,h);return new fabric.Gradient({x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,colorStops:e})},forObject:function(e,d){d||(d={});a(e,d);return new fabric.Gradient(d)}});function a(f,e){for(var g in e){if(typeof e[g]==="string"&&/^\d+%$/.test(e[g])){var d=parseFloat(e[g],10);if(g==="x1"||g==="x2"){e[g]=f.width*d/100}else{if(g==="y1"||g==="y2"){e[g]=f.height*d/100}}}if(g==="x1"||g==="x2"){e[g]-=f.width/2}else{if(g==="y1"||g==="y2"){e[g]-=f.height/2}}}}function b(j){var f=j.getElementsByTagName("linearGradient"),d=j.getElementsByTagName("radialGradient"),g,e,h={};e=f.length;for(;e--;){g=f[e];h[g.getAttribute("id")]=g}e=d.length;for(;e--;){g=d[e];h[g.getAttribute("id")]=g}return h}fabric.getGradientDefs=b})();(function(b){var c=b.fabric||(b.fabric={});if(c.Point){c.warn("fabric.Point is already defined");return}c.Point=a;function a(d,e){if(arguments.length>0){this.init(d,e)}}a.prototype={constructor:a,init:function(d,e){this.x=d;this.y=e},add:function(d){return new a(this.x+d.x,this.y+d.y)},addEquals:function(d){this.x+=d.x;this.y+=d.y;return this},scalarAdd:function(d){return new a(this.x+d,this.y+d)},scalarAddEquals:function(d){this.x+=d;this.y+=d;return this},subtract:function(d){return new a(this.x-d.x,this.y-d.y)},subtractEquals:function(d){this.x-=d.x;this.y-=d.y;return this},scalarSubtract:function(d){return new a(this.x-d,this.y-d)},scalarSubtractEquals:function(d){this.x-=d;this.y-=d;return this},multiply:function(d){return new a(this.x*d,this.y*d)},multiplyEquals:function(d){this.x*=d;this.y*=d;return this},divide:function(d){return new a(this.x/d,this.y/d)},divideEquals:function(d){this.x/=d;this.y/=d;return this},eq:function(d){return(this.x===d.x&&this.y===d.y)},lt:function(d){return(this.x<d.x&&this.y<d.y)},lte:function(d){return(this.x<=d.x&&this.y<=d.y)},gt:function(d){return(this.x>d.x&&this.y>d.y)},gte:function(d){return(this.x>=d.x&&this.y>=d.y)},lerp:function(e,d){return new a(this.x+(e.x-this.x)*d,this.y+(e.y-this.y)*d)},distanceFrom:function(f){var e=this.x-f.x,d=this.y-f.y;return Math.sqrt(e*e+d*d)},min:function(d){return new a(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new a(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},setXY:function(d,e){this.x=d;this.y=e},setFromPoint:function(d){this.x=d.x;this.y=d.y},swap:function(e){var d=this.x,f=this.y;this.x=e.x;this.y=e.y;e.x=d;e.y=f}}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Intersection){b.warn("fabric.Intersection is already defined");return}function c(d){if(arguments.length>0){this.init(d)}}b.Intersection=c;b.Intersection.prototype={init:function(d){this.status=d;this.points=[]},appendPoint:function(d){this.points.push(d)},appendPoints:function(d){this.points=this.points.concat(d)}};b.Intersection.intersectLineLine=function(h,f,l,k){var m,i=(k.x-l.x)*(h.y-l.y)-(k.y-l.y)*(h.x-l.x),j=(f.x-h.x)*(h.y-l.y)-(f.y-h.y)*(h.x-l.x),g=(k.y-l.y)*(f.x-h.x)-(k.x-l.x)*(f.y-h.y);if(g!==0){var e=i/g,d=j/g;if(0<=e&&e<=1&&0<=d&&d<=1){m=new c("Intersection");m.points.push(new b.Point(h.x+e*(f.x-h.x),h.y+e*(f.y-h.y)))}else{m=new c("No Intersection")}}else{if(i===0||j===0){m=new c("Coincident")}else{m=new c("Parallel")}}return m};b.Intersection.intersectLinePolygon=function(e,d,l){var m=new c("No Intersection"),f=l.length;for(var h=0;h<f;h++){var k=l[h],j=l[(h+1)%f],g=c.intersectLineLine(e,d,k,j);m.appendPoints(g.points)}if(m.points.length>0){m.status="Intersection"}return m};b.Intersection.intersectPolygonPolygon=function(j,h){var f=new c("No Intersection"),l=j.length;for(var k=0;k<l;k++){var g=j[k],e=j[(k+1)%l],d=c.intersectLinePolygon(g,e,h);f.appendPoints(d.points)}if(f.points.length>0){f.status="Intersection"}return f};b.Intersection.intersectPolygonRectangle=function(n,e,d){var g=e.min(d),m=e.max(d),f=new b.Point(m.x,g.y),l=new b.Point(g.x,m.y),k=c.intersectLinePolygon(g,f,n),j=c.intersectLinePolygon(f,m,n),i=c.intersectLinePolygon(m,l,n),h=c.intersectLinePolygon(l,g,n),o=new c("No Intersection");o.appendPoints(k.points);o.appendPoints(j.points);o.appendPoints(i.points);o.appendPoints(h.points);if(o.points.length>0){o.status="Intersection"}return o}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Color){b.warn("fabric.Color is already defined.");return}function c(d){if(!d){this.setSource([0,0,0,1])}else{this._tryParsingColor(d)}}b.Color=c;b.Color.prototype={_tryParsingColor:function(d){var e=c.sourceFromHex(d);if(!e){e=c.sourceFromRgb(d)}if(e){this.setSource(e)}},getSource:function(){return this._source},setSource:function(d){this._source=d},toRgb:function(){var d=this.getSource();return"rgb("+d[0]+","+d[1]+","+d[2]+")"},toRgba:function(){var d=this.getSource();return"rgba("+d[0]+","+d[1]+","+d[2]+","+d[3]+")"},toHex:function(){var h=this.getSource();var f=h[0].toString(16);f=(f.length===1)?("0"+f):f;var e=h[1].toString(16);e=(e.length===1)?("0"+e):e;var d=h[2].toString(16);d=(d.length===1)?("0"+d):d;return f.toUpperCase()+e.toUpperCase()+d.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(e){var d=this.getSource();d[3]=e;this.setSource(d);return this},toGrayscale:function(){var f=this.getSource(),e=parseInt((f[0]*0.3+f[1]*0.59+f[2]*0.11).toFixed(0),10),d=f[3];this.setSource([e,e,e,d]);return this},toBlackWhite:function(d){var g=this.getSource(),f=(g[0]*0.3+g[1]*0.59+g[2]*0.11).toFixed(0),e=g[3];d=d||127;f=(Number(f)<Number(d))?0:255;this.setSource([f,f,f,e]);return this},overlayWith:function(k){if(!(k instanceof c)){k=new c(k)}var d=[],j=this.getAlpha(),g=0.5,h=this.getSource(),e=k.getSource();for(var f=0;f<3;f++){d.push(Math.round((h[f]*(1-g))+(e[f]*g)))}d[3]=j;this.setSource(d);return this}};b.Color.reRGBa=/^rgba?\((\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*(\d+(?:\.\d+)?))?\)$/;b.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;b.Color.fromRgb=function(d){return c.fromSource(c.sourceFromRgb(d))};b.Color.sourceFromRgb=function(d){var e=d.match(c.reRGBa);if(e){return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10),e[4]?parseFloat(e[4]):1]}};b.Color.fromRgba=c.fromRgb;b.Color.fromHex=function(d){return c.fromSource(c.sourceFromHex(d))};b.Color.sourceFromHex=function(f){if(f.match(c.reHex)){var j=f.slice(f.indexOf("#")+1),e=(j.length===3),i=e?(j.charAt(0)+j.charAt(0)):j.substring(0,2),h=e?(j.charAt(1)+j.charAt(1)):j.substring(2,4),d=e?(j.charAt(2)+j.charAt(2)):j.substring(4,6);return[parseInt(i,16),parseInt(h,16),parseInt(d,16),1]}};b.Color.fromSource=function(d){var e=new c();e.setSource(d);return e}})(typeof exports!=="undefined"?exports:this);(function(){if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var e=fabric.util.object.extend,c=fabric.util.getElementOffset,d=fabric.util.removeFromArray,b=fabric.util.removeListener,a=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=function(g,f){f||(f={});this._initStatic(g,f);fabric.StaticCanvas.activeInstance=this};e(fabric.StaticCanvas.prototype,fabric.Observable);e(fabric.StaticCanvas.prototype,{backgroundColor:"rgba(0, 0, 0, 0)",backgroundImage:"",backgroundImageOpacity:1,backgroundImageStretch:true,includeDefaultValues:true,stateful:true,renderOnAddition:true,clipTo:null,controlsAboveOverlay:false,onBeforeScaleRotate:function(){},onFpsUpdate:null,_initStatic:function(g,f){this._objects=[];this._createLowerCanvas(g);this._initOptions(f);if(f.overlayImage){this.setOverlayImage(f.overlayImage,this.renderAll.bind(this))}if(f.backgroundImage){this.setBackgroundImage(f.backgroundImage,this.renderAll.bind(this))}this.calcOffset()},calcOffset:function(){this._offset=c(this.lowerCanvasEl);return this},setOverlayImage:function(f,g){fabric.util.loadImage(f,function(h){this.overlayImage=h;g&&g()},this);return this},setBackgroundImage:function(g,h,f){return fabric.util.loadImage(g,function(i){this.backgroundImage=i;if(f&&("backgroundImageOpacity" in f)){this.backgroundImageOpacity=f.backgroundImageOpacity}if(f&&("backgroundImageStretch" in f)){this.backgroundImageStretch=f.backgroundImageStretch}h&&h()},this)},_createCanvasElement:function(){var f=fabric.document.createElement("canvas");if(!f.style){f.style={}}if(!f){throw a}this._initCanvasElement(f);return f},_initCanvasElement:function(f){if(typeof f.getContext==="undefined"&&typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement){G_vmlCanvasManager.initElement(f)}if(typeof f.getContext==="undefined"){throw a}},_initOptions:function(f){for(var g in f){this[g]=f[g]}this.width=parseInt(this.lowerCanvasEl.width,10)||0;this.height=parseInt(this.lowerCanvasEl.height,10)||0;if(!this.lowerCanvasEl.style){return}this.lowerCanvasEl.style.width=this.width+"px";this.lowerCanvasEl.style.height=this.height+"px"},_createLowerCanvas:function(f){this.lowerCanvasEl=fabric.util.getById(f)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");if(this.interactive){this._applyCanvasStyle(this.lowerCanvasEl)}this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(f){return this._setDimension("width",f)},setHeight:function(f){return this._setDimension("height",f)},setDimensions:function(f){for(var g in f){this._setDimension(g,f[g])}return this},_setDimension:function(g,f){this.lowerCanvasEl[g]=f;this.lowerCanvasEl.style[g]=f+"px";if(this.upperCanvasEl){this.upperCanvasEl[g]=f;this.upperCanvasEl.style[g]=f+"px"}if(this.wrapperEl){this.wrapperEl.style[g]=f+"px"}this[g]=f;this.calcOffset();this.renderAll();return this},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(g,h){if(!h){return}if(this.controlsAboveOverlay){var f=h.hasBorders,i=h.hasCorners;h.hasBorders=h.hasCorners=false;h.render(g);h.hasBorders=f;h.hasCorners=i}else{h.render(g)}},add:function(){this._objects.push.apply(this._objects,arguments);for(var f=arguments.length;f--;){this._initObject(arguments[f])}this.renderOnAddition&&this.renderAll();return this},_initObject:function(f){this.stateful&&f.setupState();f.setCoords();f.canvas=this;this.fire("object:added",{target:f});f.fire("added")},insertAt:function(g,f,h){if(h){this._objects[f]=g}else{this._objects.splice(f,0,g)}this._initObject(g);this.renderOnAddition&&this.renderAll();return this},getObjects:function(){return this._objects},clearContext:function(f){f.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.clearContext(this.contextContainer);if(this.contextTop){this.clearContext(this.contextTop)}this.renderAll();return this},renderAll:function(g){var h=this[(g===true&&this.interactive)?"contextTop":"contextContainer"];if(this.contextTop){this.clearContext(this.contextTop)}if(g===false||(typeof g==="undefined")){this.clearContext(h)}var l=this.getActiveGroup(),k=new Date();if(this.clipTo){this._clipCanvas(h)}h.fillStyle=this.backgroundColor;h.fillRect(0,0,this.width,this.height);if(typeof this.backgroundImage==="object"){this._drawBackroundImage(h)}for(var j=0,m=this._objects.length;j<m;++j){if(!l||(l&&this._objects[j]&&!l.contains(this._objects[j]))){this._draw(h,this._objects[j])}}if(this.clipTo){h.restore()}if(l){this._draw(this.contextTop,l)}if(this.overlayImage){this.contextContainer.drawImage(this.overlayImage,0,0)}if(this.controlsAboveOverlay){this.drawControls(this.contextContainer)}if(this.onFpsUpdate){var f=new Date()-k;this.onFpsUpdate(~~(1000/f))}this.fire("after:render");return this},_clipCanvas:function(f){f.save();f.beginPath();this.clipTo(f);f.clip()},_drawBackroundImage:function(f){f.save();f.globalAlpha=this.backgroundImageOpacity;if(this.backgroundImageStretch){f.drawImage(this.backgroundImage,0,0,this.width,this.height)}else{f.drawImage(this.backgroundImage,0,0)}f.restore()},renderTop:function(){this.clearContext(this.contextTop||this.contextContainer);if(this.overlayImage){this.contextContainer.drawImage(this.overlayImage,0,0)}if(this.selection&&this._groupSelector){this._drawSelection()}var f=this.getActiveGroup();if(f){f.render(this.contextTop)}this.fire("after:render");return this},drawControls:function(g){var j=this.getActiveGroup();if(j){g.save();fabric.Group.prototype.transform.call(j,g);j.drawBorders(g).drawCorners(g);g.restore()}else{for(var h=0,f=this._objects.length;h<f;++h){if(!this._objects[h].active){continue}g.save();fabric.Object.prototype.transform.call(this._objects[h],g);this._objects[h].drawBorders(g).drawCorners(g);g.restore()}}},toDataURL:function(h,i){var f=this.upperCanvasEl||this.lowerCanvasEl;this.renderAll(true);var g=(fabric.StaticCanvas.supports("toDataURLWithQuality"))?f.toDataURL("image/"+h,i):f.toDataURL("image/"+h);this.renderAll();return g},toDataURLWithMultiplier:function(k,n,l){var m=this.getWidth(),o=this.getHeight(),i=m*n,j=o*n,f=this.getActiveObject(),h=this.getActiveGroup();this.setWidth(i).setHeight(j);this.contextTop.scale(n,n);if(h){this._tempRemoveBordersCornersFromGroup(h)}else{if(f){this.deactivateAll()}}this.width=m;this.height=o;this.renderAll(true);var g=this.toDataURL(k,l);this.contextTop.scale(1/n,1/n);this.setWidth(m).setHeight(o);if(h){this._restoreBordersCornersOnGroup(h)}else{if(f){this.setActiveObject(f)}}this.renderAll();return g},_tempRemoveBordersCornersFromGroup:function(f){f.origHideCorners=f.hideCorners;f.origBorderColor=f.borderColor;f.hideCorners=true;f.borderColor="rgba(0,0,0,0)";f.forEachObject(function(g){g.origBorderColor=g.borderColor;g.borderColor="rgba(0,0,0,0)"})},_restoreBordersCornersOnGroup:function(f){f.hideCorners=f.origHideCorners;f.borderColor=f.origBorderColor;f.forEachObject(function(g){g.borderColor=g.origBorderColor;delete g.origBorderColor})},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(f){f.set("left",this.getCenter().left);this.renderAll();return this},centerObjectV:function(f){f.set("top",this.getCenter().top);this.renderAll();return this},centerObject:function(f){return this.centerObjectH(f).centerObjectV(f)},toDatalessJSON:function(){return this.toDatalessObject()},toObject:function(){return this._toObjectMethod("toObject")},toDatalessObject:function(){return this._toObjectMethod("toDatalessObject")},_toObjectMethod:function(f){var g={objects:this._objects.map(function(h){var i;if(!this.includeDefaultValues){i=h.includeDefaultValues;h.includeDefaultValues=false}var j=h[f]();if(!this.includeDefaultValues){h.includeDefaultValues=i}return j},this),background:this.backgroundColor};if(this.backgroundImage){g.backgroundImage=this.backgroundImage.src;g.backgroundImageOpacity=this.backgroundImageOpacity;g.backgroundImageStretch=this.backgroundImageStretch}return g},toSVG:function(){var g=['<?xml version="1.0" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" ','"http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">',"<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',this.width,'" ','height="',this.height,'" ','xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>",fabric.createSVGFontFacesMarkup(this.getObjects())];if(this.backgroundImage){g.push('<image x="0" y="0" ','width="',this.width,'" height="',this.height,'" preserveAspectRatio="',(this.backgroundImageStretch?"none":"defer"),'" xlink:href="',this.backgroundImage.src,'" style="opacity:',this.backgroundImageOpacity,'"></image>')}for(var h=0,j=this.getObjects(),f=j.length;h<f;h++){g.push(j[h].toSVG())}g.push("</svg>");return g.join("")},isEmpty:function(){return this._objects.length===0},remove:function(f){d(this._objects,f);if(this.getActiveObject()===f){this.fire("before:selection:cleared",{target:f});this.discardActiveObject();this.fire("selection:cleared")}this.renderAll();return f},sendToBack:function(f){d(this._objects,f);this._objects.unshift(f);return this.renderAll()},bringToFront:function(f){d(this._objects,f);this._objects.push(f);return this.renderAll()},sendBackwards:function(h){var g=this._objects.indexOf(h),f=g;if(g!==0){for(var j=g-1;j>=0;--j){if(h.intersectsWithObject(this._objects[j])||h.isContainedWithinObject(this._objects[j])){f=j;break}}d(this._objects,h);this._objects.splice(f,0,h)}return this.renderAll()},bringForward:function(j){var m=this.getObjects(),g=m.indexOf(j),f=g;if(g!==m.length-1){for(var k=g+1,h=this._objects.length;k<h;++k){if(j.intersectsWithObject(m[k])||j.isContainedWithinObject(this._objects[k])){f=k;break}}d(m,j);m.splice(f,0,j)}this.renderAll()},item:function(f){return this.getObjects()[f]},complexity:function(){return this.getObjects().reduce(function(f,g){f+=g.complexity?g.complexity():0;return f},0)},forEachObject:function(j,g){var h=this.getObjects(),f=h.length;while(f--){j.call(g,h[f],f,h)}return this},dispose:function(){this.clear();if(this.interactive){b(this.upperCanvasEl,"mousedown",this._onMouseDown);b(this.upperCanvasEl,"mousemove",this._onMouseMove);b(fabric.window,"resize",this._onResize)}return this},_resizeImageToFit:function(h){var g=h.width||h.offsetWidth,f=this.getWidth()/g;if(g){h.width=g*f}}});fabric.StaticCanvas.prototype.toString=function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"};e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(k){var h=k.getContext("2d"),f=h.getImageData(0,0,k.width,k.height),o=f.data,l=f.width,q=f.height,p,g,n,m;for(n=0;n<l;n++){for(m=0;m<q;m++){p=(n*4)*q+(m*4);g=(o[p]+o[p+1]+o[p+2])/3;o[p]=g;o[p+1]=g;o[p+2]=g}}h.putImageData(f,0,0)},supports:function(g){var h=fabric.document.createElement("canvas");if(typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(h)}if(!h||!h.getContext){return null}var f=h.getContext("2d");if(!f){return null}switch(g){case"getImageData":return typeof f.getImageData!=="undefined";case"toDataURL":return typeof h.toDataURL!=="undefined";case"toDataURLWithQuality":try{h.toDataURL("image/jpeg",0);return true}catch(i){}return false;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject})();(function(){var j=fabric.util.object.extend,q=fabric.util.getPointer,b=fabric.util.addListener,g=fabric.util.removeListener,m={tr:"ne-resize",br:"se-resize",bl:"sw-resize",tl:"nw-resize",ml:"w-resize",mt:"n-resize",mr:"e-resize",mb:"s-resize"},d=fabric.util.array.min,h=fabric.util.array.max,n=Math.sqrt,i=Math.pow,o=Math.atan2,p=Math.abs,f=Math.min,l=Math.max,a=0.5;fabric.Canvas=function(s,r){r||(r={});this._initStatic(s,r);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this};function k(){}k.prototype=fabric.StaticCanvas.prototype;fabric.Canvas.prototype=new k();var e={interactive:true,selection:true,selectionColor:"rgba(100, 100, 255, 0.3)",selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,freeDrawingColor:"rgb(0, 0, 0)",freeDrawingLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:false,targetFindTolerance:0,_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._freeDrawingXPoints=[];this._freeDrawingYPoints=[];this._initWrapperElement();this._createUpperCanvas();this._initEvents();this.calcOffset()},_initEvents:function(){var r=this;this._onMouseDown=function(s){r.__onMouseDown(s);b(fabric.document,"mouseup",r._onMouseUp);fabric.isTouchSupported&&b(fabric.document,"touchend",r._onMouseUp);b(fabric.document,"mousemove",r._onMouseMove);fabric.isTouchSupported&&b(fabric.document,"touchmove",r._onMouseMove);g(r.upperCanvasEl,"mousemove",r._onMouseMove);fabric.isTouchSupported&&g(r.upperCanvasEl,"touchmove",r._onMouseMove)};this._onMouseUp=function(s){r.__onMouseUp(s);g(fabric.document,"mouseup",r._onMouseUp);fabric.isTouchSupported&&g(fabric.document,"touchend",r._onMouseUp);g(fabric.document,"mousemove",r._onMouseMove);fabric.isTouchSupported&&g(fabric.document,"touchmove",r._onMouseMove);b(r.upperCanvasEl,"mousemove",r._onMouseMove);fabric.isTouchSupported&&b(r.upperCanvasEl,"touchmove",r._onMouseMove)};this._onMouseMove=function(s){s.preventDefault&&s.preventDefault();r.__onMouseMove(s)};this._onResize=function(){r.calcOffset()};b(fabric.window,"resize",this._onResize);if(fabric.isTouchSupported){b(this.upperCanvasEl,"touchstart",this._onMouseDown);b(this.upperCanvasEl,"touchmove",this._onMouseMove)}else{b(this.upperCanvasEl,"mousedown",this._onMouseDown);b(this.upperCanvasEl,"mousemove",this._onMouseMove)}},__onMouseUp:function(v){var u;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._finalizeDrawingPath();this.fire("mouse:up",{e:v});return}if(this._currentTransform){var r=this._currentTransform;u=r.target;if(u._scaling){u._scaling=false}var s=this._objects.length;while(s--){this._objects[s].setCoords()}if(this.stateful&&u.hasStateChanged()){u.isMoving=false;this.fire("object:modified",{target:u});u.fire("modified")}}this._currentTransform=null;if(this._groupSelector){this._findSelectedObjects(v)}var t=this.getActiveGroup();if(t){t.setObjectsCoords();t.set("isMoving",false);this._setCursor(this.defaultCursor)}this._groupSelector=null;this.renderAll();this._setCursorFromEvent(v,u);this._setCursor("");var w=this;setTimeout(function(){w._setCursorFromEvent(v,u)},50);this.fire("mouse:up",{target:u,e:v});u&&u.fire("mouseup",{e:v})},__onMouseDown:function(w){var r="which" in w?w.which===1:w.button===1;if(!r&&!fabric.isTouchSupported){return}if(this.isDrawingMode){this._prepareForDrawing(w);this._captureDrawingPath(w);this.fire("mouse:down",{e:w});return}if(this._currentTransform){return}var v=this.findTarget(w),x=this.getPointer(w),t=this.getActiveGroup(),u;if(this._shouldClearSelection(w)){this._groupSelector={ex:x.x,ey:x.y,top:0,left:0};this.deactivateAllWithDispatch()}else{this.stateful&&v.saveState();if((u=v._findTargetCorner(w,this._offset))){this.onBeforeScaleRotate(v)}this._setupCurrentTransform(w,v);var s=w.shiftKey&&(t||this.getActiveObject())&&this.selection;if(s){this._handleGroupLogic(w,v)}else{if(v!==this.getActiveGroup()){this.deactivateAll()}this.setActiveObject(v,w)}}this.renderAll();this.fire("mouse:down",{target:v,e:w});v&&v.fire("mousedown",{e:w})},__onMouseMove:function(w){var v;if(this.isDrawingMode){if(this._isCurrentlyDrawing){this._captureDrawingPath(w)}this.fire("mouse:move",{e:w});return}var s=this._groupSelector,z;if(s!==null){z=q(w);s.left=z.x-this._offset.left-s.ex;s.top=z.y-this._offset.top-s.ey;this.renderTop()}else{if(!this._currentTransform){var u=this.upperCanvasEl.style;v=this.findTarget(w);if(!v){for(var t=this._objects.length;t--;){if(this._objects[t]&&!this._objects[t].active){this._objects[t].setActive(false)}}u.cursor=this.defaultCursor}else{this._setCursorFromEvent(w,v);if(v.isActive()){v.setCornersVisibility&&v.setCornersVisibility(true)}}}else{z=q(w);var r=z.x,A=z.y;this._currentTransform.target.isMoving=true;if(this._currentTransform.action==="rotate"){if(!w.shiftKey){this._rotateObject(r,A);this.fire("object:rotating",{target:this._currentTransform.target});this._currentTransform.target.fire("rotating")}if(!this._currentTransform.target.hasRotatingPoint){this._scaleObject(r,A);this.fire("object:scaling",{target:this._currentTransform.target});this._currentTransform.target.fire("scaling")}}else{if(this._currentTransform.action==="scale"){this._scaleObject(r,A);this.fire("object:scaling",{target:this._currentTransform.target});this._currentTransform.target.fire("scaling")}else{if(this._currentTransform.action==="scaleX"){this._scaleObject(r,A,"x");this.fire("object:scaling",{target:this._currentTransform.target});this._currentTransform.target.fire("scaling")}else{if(this._currentTransform.action==="scaleY"){this._scaleObject(r,A,"y");this.fire("object:scaling",{target:this._currentTransform.target});this._currentTransform.target.fire("scaling")}else{this._translateObject(r,A);this.fire("object:moving",{target:this._currentTransform.target});this._setCursor(this.moveCursor);this._currentTransform.target.fire("moving")}}}}this.renderAll()}}this.fire("mouse:move",{target:v,e:w});v&&v.fire("mousemove",{e:w})},containsPoint:function(w,v){var z=this.getPointer(w),u=this._normalizePointer(v,z),r=u.x,A=u.y;var s=v._getImageLines(v.oCoords),t=v._findCrossPoints(r,A,s);if((t&&t%2===1)||v._findTargetCorner(w,this._offset)){return true}return false},_normalizePointer:function(s,v){var u=this.getActiveGroup(),r=v.x,w=v.y;var t=(u&&s.type!=="group"&&u.contains(s));if(t){r-=u.left;w-=u.top}return{x:r,y:w}},_isTargetTransparent:function(z,B,A){var w=this.contextCache;var s=z.hasBorders,t=z.transparentCorners;z.hasBorders=z.transparentCorners=false;this._draw(w,z);z.hasBorders=s;z.transparentCorners=t;if(this.targetFindTolerance>0){if(B>this.targetFindTolerance){B-=this.targetFindTolerance}else{B=0}if(A>this.targetFindTolerance){A-=this.targetFindTolerance}else{A=0}}var v=true;var r=w.getImageData(B,A,(this.targetFindTolerance*2)||1,(this.targetFindTolerance*2)||1);for(var u=3;u<r.data.length;u+=4){var C=r.data[u];v=C<=0;if(v===false){break}}r=null;this.clearContext(w);return v},_shouldClearSelection:function(t){var s=this.findTarget(t),r=this.getActiveGroup();return(!s||(s&&r&&!r.contains(s)&&r!==s&&!t.shiftKey))},_setupCurrentTransform:function(u,t){var s="drag",r,v=q(u);if((r=t._findTargetCorner(u,this._offset))){s=(r==="ml"||r==="mr")?"scaleX":(r==="mt"||r==="mb")?"scaleY":r==="mtr"?"rotate":(t.hasRotatingPoint)?"scale":"rotate"}this._currentTransform={target:t,action:s,scaleX:t.scaleX,scaleY:t.scaleY,offsetX:v.x-t.left,offsetY:v.y-t.top,ex:v.x,ey:v.y,left:t.left,top:t.top,theta:t._theta,width:t.width*t.scaleX};this._currentTransform.original={left:t.left,top:t.top}},_handleGroupLogic:function(u,t){if(t===this.getActiveGroup()){t=this.findTarget(u,true);if(!t||t.isType("group")){return}}var r=this.getActiveGroup();if(r){if(r.contains(t)){r.removeWithUpdate(t);t.setActive(false);if(r.size()===1){this.discardActiveGroup()}}else{r.addWithUpdate(t)}this.fire("selection:created",{target:r,e:u});r.setActive(true)}else{if(this._activeObject){if(t!==this._activeObject){var s=new fabric.Group([this._activeObject,t]);this.setActiveGroup(s);r=this.getActiveGroup()}}t.setActive(true)}if(r){r.saveCoords()}},_prepareForDrawing:function(r){this._isCurrentlyDrawing=true;this.discardActiveObject().renderAll();var s=this.getPointer(r);this._freeDrawingXPoints.length=this._freeDrawingYPoints.length=0;this._freeDrawingXPoints.push(s.x);this._freeDrawingYPoints.push(s.y);this.contextTop.beginPath();this.contextTop.moveTo(s.x,s.y);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=this.contextTop.lineJoin="round"},_captureDrawingPath:function(r){var s=this.getPointer(r);this._freeDrawingXPoints.push(s.x);this._freeDrawingYPoints.push(s.y);this.contextTop.lineTo(s.x,s.y);this.contextTop.stroke()},_finalizeDrawingPath:function(){this.contextTop.closePath();this._isCurrentlyDrawing=false;var w=d(this._freeDrawingXPoints),v=d(this._freeDrawingYPoints),s=h(this._freeDrawingXPoints),r=h(this._freeDrawingYPoints),A=[],t=this._freeDrawingXPoints,z=this._freeDrawingYPoints;A.push("M ",t[0]-w," ",z[0]-v," ");for(var x=1,y=t.length;x<y;x++){A.push("L ",t[x]-w," ",z[x]-v," ")}A=A.join("");if(A==="M 0 0 L 0 0 "){this.renderAll();return}var u=new fabric.Path(A);u.fill=null;u.stroke=this.freeDrawingColor;u.strokeWidth=this.freeDrawingLineWidth;this.add(u);u.set("left",w+(s-w)/2).set("top",v+(r-v)/2).setCoords();this.renderAll();this.fire("path:created",{path:u})},_translateObject:function(r,t){var s=this._currentTransform.target;s.lockMovementX||s.set("left",r-this._currentTransform.offsetX);s.lockMovementY||s.set("top",t-this._currentTransform.offsetY)},_scaleObject:function(r,B,z){var s=this._currentTransform,A=this._offset,w=s.target;if(w.lockScalingX&&w.lockScalingY){return}var v=n(i(s.ey-s.top-A.top,2)+i(s.ex-s.left-A.left,2)),u=n(i(B-s.top-A.top,2)+i(r-s.left-A.left,2));w._scaling=true;if(!z){w.lockScalingX||w.set("scaleX",s.scaleX*u/v);w.lockScalingY||w.set("scaleY",s.scaleY*u/v)}else{if(z==="x"&&!w.lockUniScaling){w.lockScalingX||w.set("scaleX",s.scaleX*u/v)}else{if(z==="y"&&!w.lockUniScaling){w.lockScalingY||w.set("scaleY",s.scaleY*u/v)}}}},_rotateObject:function(r,z){var s=this._currentTransform,v=this._offset;if(s.target.lockRotation){return}var u=o(s.ey-s.top-v.top,s.ex-s.left-v.left),w=o(z-s.top-v.top,r-s.left-v.left);s.target._theta=(w-u)+s.theta},_setCursor:function(r){this.upperCanvasEl.style.cursor=r},_setCursorFromEvent:function(w,v){var t=this.upperCanvasEl.style;if(!v){t.cursor=this.defaultCursor;return false}else{var r=this.getActiveGroup();var u=!!v._findTargetCorner&&(!r||!r.contains(v))&&v._findTargetCorner(w,this._offset);if(!u){t.cursor=this.hoverCursor}else{if(u in m){t.cursor=m[u]}else{if(u==="mtr"&&v.hasRotatingPoint){t.cursor=this.rotationCursor}else{t.cursor=this.defaultCursor;return false}}}}return true},_drawSelection:function(){var r=this._groupSelector,v=r.left,u=r.top,t=p(v),s=p(u);this.contextTop.fillStyle=this.selectionColor;this.contextTop.fillRect(r.ex-((v>0)?0:-v),r.ey-((u>0)?0:-u),t,s);this.contextTop.lineWidth=this.selectionLineWidth;this.contextTop.strokeStyle=this.selectionBorderColor;this.contextTop.strokeRect(r.ex+a-((v>0)?0:t),r.ey+a-((u>0)?0:s),t,s)},_findSelectedObjects:function(v){var B=[],s=this._groupSelector.ex,A=this._groupSelector.ey,r=s+this._groupSelector.left,y=A+this._groupSelector.top,x,w=new fabric.Point(f(s,r),f(A,y)),z=new fabric.Point(l(s,r),l(A,y));for(var t=0,u=this._objects.length;t<u;++t){x=this._objects[t];if(!x){continue}if(x.intersectsWithRect(w,z)||x.isContainedWithinRect(w,z)){if(this.selection&&x.selectable){x.setActive(true);B.push(x)}}}if(B.length===1){this.setActiveObject(B[0],v)}else{if(B.length>1){B=new fabric.Group(B);this.setActiveGroup(B);B.saveCoords();this.fire("selection:created",{target:B})}}this.renderAll()},findTarget:function(z,u){var A,r=this.getPointer(z);var t=this.getActiveGroup();if(t&&!u&&this.containsPoint(z,t)){A=t;return A}var s=[];for(var w=this._objects.length;w--;){if(this._objects[w]&&this.containsPoint(z,this._objects[w])){if(this.perPixelTargetFind||this._objects[w].perPixelTargetFind){s[s.length]=this._objects[w]}else{A=this._objects[w];this.relatedTarget=A;break}}}for(var v=0,y=s.length;v<y;v++){r=this.getPointer(z);var x=this._isTargetTransparent(s[v],r.x,r.y);if(!x){A=s[v];this.relatedTarget=A;break}}if(A&&A.selectable){return A}},getPointer:function(r){var s=q(r);return{x:s.x-this._offset.left,y:s.y-this._offset.top}},_createUpperCanvas:function(){this.upperCanvasEl=this._createCanvasElement();this.upperCanvasEl.className="upper-canvas";this.wrapperEl.appendChild(this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(s){var t=this.getWidth()||s.width,r=this.getHeight()||s.height;fabric.util.setStyle(s,{position:"absolute",width:t+"px",height:r+"px",left:0,top:0});s.width=t;s.height=r;fabric.util.makeElementUnselectable(s)},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},setActiveObject:function(r,s){if(this._activeObject){this._activeObject.setActive(false)}this._activeObject=r;r.setActive(true);this.renderAll();this.fire("object:selected",{target:r,e:s});r.fire("selected",{e:s});return this},getActiveObject:function(){return this._activeObject},discardActiveObject:function(){if(this._activeObject){this._activeObject.setActive(false)}this._activeObject=null;return this},setActiveGroup:function(r){this._activeGroup=r;r&&r.setActive(true);return this},getActiveGroup:function(){return this._activeGroup},discardActiveGroup:function(){var r=this.getActiveGroup();if(r){r.destroy()}return this.setActiveGroup(null)},deactivateAll:function(){var s=this.getObjects(),t=0,r=s.length;for(;t<r;t++){s[t].setActive(false)}this.discardActiveGroup();this.discardActiveObject();return this},deactivateAllWithDispatch:function(){var r=this.getActiveGroup()||this.getActiveObject();if(r){this.fire("before:selection:cleared",{target:r})}this.deactivateAll();if(r){this.fire("selection:cleared")}return this}};fabric.Canvas.prototype.toString=fabric.StaticCanvas.prototype.toString;j(fabric.Canvas.prototype,e);for(var c in fabric.StaticCanvas){if(c!=="prototype"){fabric.Canvas[c]=fabric.StaticCanvas[c]}}if(fabric.isTouchSupported){fabric.Canvas.prototype._setCursorFromEvent=function(){}}fabric.Element=fabric.Canvas})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(g){b.set("left",g);f.renderAll();a()},onComplete:function(){b.setCoords();e()}});return this},fxCenterObjectV:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(g){b.set("top",g);f.renderAll();a()},onComplete:function(){b.setCoords();e()}});return this},fxRemove:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){b.setActive(false)},onChange:function(g){b.set("opacity",g);f.renderAll();a()},onComplete:function(){f.remove(b);e()}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(a,c){if(!a){return}var b=(typeof a==="string")?JSON.parse(a):a;if(!b||(b&&!b.objects)){return}this.clear();this.backgroundColor=b.background;this._enlivenDatalessObjects(b.objects,c)},_enlivenDatalessObjects:function(c,i){function h(j,e){g.insertAt(j,e,true);j.setCoords();if(++f===a){i&&i()}}function b(o,m){var j=o.paths?"paths":"path";var n=o[j];delete o[j];if(typeof n!=="string"){if(o.type==="image"){fabric[fabric.util.string.capitalize(o.type)].fromObject(o,function(p){h(p,m)})}else{var e=fabric[fabric.util.string.camelize(fabric.util.string.capitalize(o.type))];if(!e||!e.fromObject){return}if(n){o[j]=n}h(e.fromObject(o),m)}}else{if(o.type==="image"){fabric.util.loadImage(n,function(q){var p=new fabric.Image(q);p.setSourcePath(n);fabric.util.object.extend(p,o);p.setAngle(o.angle);h(p,m)})}else{if(o.type==="text"){if(o.useNative){h(fabric.Text.fromObject(o),m)}else{o.path=n;var l=fabric.Text.fromObject(o);var k=function(){if(Object.prototype.toString.call(fabric.window.opera)==="[object Opera]"){setTimeout(function(){h(l,m)},500)}else{h(l,m)}};fabric.util.getScript(n,k)}}else{fabric.loadSVGFromURL(n,function(q){var p=fabric.util.groupSVGElements(q,o,n);if(!(p instanceof fabric.PathGroup)){fabric.util.object.extend(p,o);if(typeof o.angle!=="undefined"){p.setAngle(o.angle)}}h(p,m)})}}}}var g=this,f=0,a=c.length;if(a===0&&i){i()}try{c.forEach(b,this)}catch(d){fabric.log(d.message)}},loadFromJSON:function(a,d){if(!a){return}var b=JSON.parse(a);if(!b||(b&&!b.objects)){return}this.clear();var c=this;this._enlivenObjects(b.objects,function(){c.backgroundColor=b.background;if(b.backgroundImage){c.setBackgroundImage(b.backgroundImage,function(){c.backgroundImageOpacity=b.backgroundImageOpacity;c.backgroundImageStretch=b.backgroundImageStretch;c.renderAll();d&&d()})}else{d&&d()}});return this},_enlivenObjects:function(a,c){var b=this;fabric.util.enlivenObjects(a,function(d){d.forEach(function(f,e){b.insertAt(f,e,true)});c&&c()})},_toDataURL:function(a,b){this.clone(function(c){b(c.toDataURL(a))})},_toDataURLWithMultiplier:function(a,c,b){this.clone(function(d){b(d.toDataURLWithMultiplier(a,c))})},clone:function(b){var a=JSON.stringify(this);this.cloneWithoutData(function(c){c.loadFromJSON(a,function(){b&&b(c)})})},cloneWithoutData:function(c){var a=fabric.document.createElement("canvas");a.width=this.getWidth();a.height=this.getHeight();var b=new fabric.Canvas(a);b.clipTo=this.clipTo;if(this.backgroundImage){b.setBackgroundImage(this.backgroundImage.src,function(){b.renderAll();c&&c(b)});b.backgroundImageOpacity=this.backgroundImageOpacity;b.backgroundImageStretch=this.backgroundImageStretch}else{c&&c(b)}}});(function(a){var d=a.fabric||(a.fabric={}),l=d.util.object.extend,c=d.util.toFixed,k=d.util.string.capitalize,o=d.util.getPointer,b=d.util.degreesToRadians,n=Array.prototype.slice;if(d.Object){return}d.Object=d.util.createClass({type:"object",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,cornersize:12,transparentCorners:true,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",fill:"rgb(0,0,0)",fillRule:"source-over",overlayFill:null,stroke:null,strokeWidth:1,strokeDashArray:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,selectable:true,hasControls:true,hasBorders:true,hasRotatingPoint:false,rotatingPointOffset:40,_theta:0,perPixelTargetFind:false,includeDefaultValues:true,stateProperties:("top left width height scaleX scaleY flipX flipY theta angle opacity cornersize fill overlayFill stroke strokeWidth strokeDashArray fillRule borderScaleFactor transformMatrix selectable").split(" "),callSuper:function(i){var p=this.constructor.superclass.prototype[i];return(arguments.length>1)?p.apply(this,n.call(arguments,1)):p.call(this)},initialize:function(i){if(i){this.setOptions(i)}},_initGradient:function(i){if(i.fill&&typeof i.fill==="object"&&!(i.fill instanceof d.Gradient)){this.set("fill",new d.Gradient(i.fill))}},setOptions:function(p){var q=this.stateProperties.length,r;while(q--){r=this.stateProperties[q];if(r in p){this.set(r,p[r])}}this._initGradient(p)},transform:function(i){i.globalAlpha=this.opacity;i.translate(this.left,this.top);i.rotate(this._theta);i.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(){var p=d.Object.NUM_FRACTION_DIGITS;var i={type:this.type,left:c(this.left,p),top:c(this.top,p),width:c(this.width,p),height:c(this.height,p),fill:(this.fill&&this.fill.toObject)?this.fill.toObject():this.fill,overlayFill:this.overlayFill,stroke:this.stroke,strokeWidth:this.strokeWidth,strokeDashArray:this.strokeDashArray,scaleX:c(this.scaleX,p),scaleY:c(this.scaleY,p),angle:c(this.getAngle(),p),flipX:this.flipX,flipY:this.flipY,opacity:c(this.opacity,p),selectable:this.selectable,hasControls:this.hasControls,hasBorders:this.hasBorders,hasRotatingPoint:this.hasRotatingPoint,transparentCorners:this.transparentCorners,perPixelTargetFind:this.perPixelTargetFind};if(!this.includeDefaultValues){i=this._removeDefaultValues(i)}return i},toDatalessObject:function(){return this.toObject()},getSvgStyles:function(){return["stroke: ",(this.stroke?this.stroke:"none"),"; ","stroke-width: ",(this.strokeWidth?this.strokeWidth:"0"),"; ","stroke-dasharray: ",(this.strokeDashArray?this.strokeDashArray.join(" "):"; "),"fill: ",(this.fill?this.fill:"none"),"; ","opacity: ",(this.opacity?this.opacity:"1"),";"].join("")},getSvgTransform:function(){var i=this.getAngle();return["translate(",c(this.left,2)," ",c(this.top,2),")",i!==0?(" rotate("+c(i,2)+")"):"",(this.scaleX===1&&this.scaleY===1)?"":(" scale("+c(this.scaleX,2)+" "+c(this.scaleY,2)+")")].join("")},_removeDefaultValues:function(p){var i=d.Object.prototype.options;if(i){this.stateProperties.forEach(function(q){if(p[q]===i[q]){delete p[q]}})}return p},isActive:function(){return !!this.active},setActive:function(i){this.active=!!i;return this},toString:function(){return"#<fabric."+k(this.type)+">"},set:function(i,p){if(typeof i==="object"){for(var q in i){this._set(q,i[q])}}else{if(typeof p==="function"){this._set(i,p(this.get(i)))}else{this._set(i,p)}}return this},_set:function(i,p){var q=(i==="scaleX"||i==="scaleY")&&p<d.Object.MIN_SCALE_LIMIT;if(q){p=d.Object.MIN_SCALE_LIMIT}if(i==="angle"){this.setAngle(p)}else{this[i]=p}},toggle:function(p){var i=this.get(p);if(typeof i==="boolean"){this.set(p,!i)}return this},setSourcePath:function(i){this.sourcePath=i;return this},get:function(i){return(i==="angle")?this.getAngle():this[i]},render:function(p,q){if(this.width===0||this.height===0){return}p.save();var i=this.transformMatrix;if(i&&!this.group){p.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])}if(!q){this.transform(p)}if(this.stroke||this.strokeDashArray){p.lineWidth=this.strokeWidth;p.strokeStyle=this.stroke}if(this.overlayFill){p.fillStyle=this.overlayFill}else{if(this.fill){p.fillStyle=this.fill.toLiveGradient?this.fill.toLiveGradient(p):this.fill}}if(i&&this.group){p.translate(-this.group.width/2,-this.group.height/2);p.transform(i[0],i[1],i[2],i[3],i[4],i[5])}this._render(p,q);if(this.active&&!q){this.drawBorders(p);this.drawCorners(p)}p.restore()},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},scale:function(i){this.scaleX=i;this.scaleY=i;this.setCoords();return this},scaleToWidth:function(p){var i=this.getBoundingRectWidth()/this.getWidth();return this.scale(p/this.width/i)},scaleToHeight:function(p){var i=this.getBoundingRectHeight()/this.getHeight();return this.scale(p/this.height/i)},setOpacity:function(i){this.set("opacity",i);return this},getAngle:function(){return this._theta*180/Math.PI},setAngle:function(i){this._theta=i/180*Math.PI;this.angle=i;return this},setCoords:function(){var y=this.strokeWidth>1?this.strokeWidth:0,A=this.padding;this.currentWidth=(this.width+y)*this.scaleX+A*2;this.currentHeight=(this.height+y)*this.scaleY+A*2;this._hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));this._angle=Math.atan(this.currentHeight/this.currentWidth);var v=Math.cos(this._angle+this._theta)*this._hypotenuse,u=Math.sin(this._angle+this._theta)*this._hypotenuse,q=this._theta,z=Math.sin(q),x=Math.cos(q);var D={x:this.left-v,y:this.top-u};var w={x:D.x+(this.currentWidth*x),y:D.y+(this.currentWidth*z)};var C={x:w.x-(this.currentHeight*z),y:w.y+(this.currentHeight*x)};var r={x:D.x-(this.currentHeight*z),y:D.y+(this.currentHeight*x)};var t={x:D.x-(this.currentHeight/2*z),y:D.y+(this.currentHeight/2*x)};var i={x:D.x+(this.currentWidth/2*x),y:D.y+(this.currentWidth/2*z)};var p={x:w.x-(this.currentHeight/2*z),y:w.y+(this.currentHeight/2*x)};var B={x:r.x+(this.currentWidth/2*x),y:r.y+(this.currentWidth/2*z)};var s={x:D.x+(this.currentWidth/2*x),y:D.y+(this.currentWidth/2*z)};this.oCoords={tl:D,tr:w,br:C,bl:r,ml:t,mt:i,mr:p,mb:B,mtr:s};this._setCornerCoords();return this},getBoundingRectWidth:function(){this.oCoords||this.setCoords();var p=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x];var i=d.util.array.min(p);var q=d.util.array.max(p);return Math.abs(i-q)},getBoundingRectHeight:function(){this.oCoords||this.setCoords();var i=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y];var q=d.util.array.min(i);var p=d.util.array.max(i);return Math.abs(q-p)},drawBorders:function(y){if(!this.hasBorders){return}var r=d.Object.MIN_SCALE_LIMIT,t=this.padding,i=t*2,s=this.strokeWidth>1?this.strokeWidth:0;y.save();y.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;y.strokeStyle=this.borderColor;var x=1/(this.scaleX<r?r:this.scaleX),u=1/(this.scaleY<r?r:this.scaleY);y.lineWidth=1/this.borderScaleFactor;y.scale(x,u);var v=this.getWidth(),q=this.getHeight();y.strokeRect(~~(-(v/2)-t-s/2*this.scaleX)+0.5,~~(-(q/2)-t-s/2*this.scaleY)+0.5,~~(v+i+s*this.scaleX),~~(q+i+s*this.scaleY));if(this.hasRotatingPoint&&!this.lockRotation&&this.hasControls){var p=(this.flipY?q+(s*this.scaleY)+(t*2):-q-(s*this.scaleY)-(t*2))/2;y.beginPath();y.moveTo(0,p);y.lineTo(0,p+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset));y.closePath();y.stroke()}y.restore();return this},_renderDashedStroke:function(q){if(1&this.strokeDashArray.length){this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray)}var s=0,p=-this.width/2,w=-this.height/2,v=this,u=this.padding,t=this.strokeDashArray.length;q.save();q.beginPath();function r(B,y){var x=0,z=0,i=(y?v.height:v.width)+u*2;while(x<i){var A=v.strokeDashArray[s++];x+=A;if(x>i){z=x-i}if(B){p+=(A*B)-(z*B||0)}else{w+=(A*y)-(z*y||0)}q[1&s?"moveTo":"lineTo"](p,w);if(s>=t){s=0}}}r(1,0);r(0,1);r(-1,0);r(0,-1);q.stroke();q.closePath();q.restore()},drawCorners:function(A){if(!this.hasControls){return}var w=this.cornersize,q=w/2,i=this.strokeWidth/2,p=-(this.width/2),u=-(this.height/2),G,B,y=w/this.scaleX,v=w/this.scaleY,D=this.padding/this.scaleX,C=this.padding/this.scaleY,E=q/this.scaleY,F=q/this.scaleX,s=(q-w)/this.scaleX,r=(q-w)/this.scaleY,x=this.height,z=this.width,t=this.transparentCorners?"strokeRect":"fillRect";A.save();A.lineWidth=1/Math.max(this.scaleX,this.scaleY);A.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;A.strokeStyle=A.fillStyle=this.cornerColor;G=p-F-i-D;B=u-E-i-C;A.clearRect(G,B,y,v);A[t](G,B,y,v);G=p+z-F+i+D;B=u-E-i-C;A.clearRect(G,B,y,v);A[t](G,B,y,v);G=p-F-i-D;B=u+x+r+i+C;A.clearRect(G,B,y,v);A[t](G,B,y,v);G=p+z+s+i+D;B=u+x+r+i+C;A.clearRect(G,B,y,v);A[t](G,B,y,v);if(!this.lockUniScaling){G=p+z/2-F;B=u-E-i-C;A.clearRect(G,B,y,v);A[t](G,B,y,v);G=p+z/2-F;B=u+x+r+i+C;A.clearRect(G,B,y,v);A[t](G,B,y,v);G=p+z+s+i+D;B=u+x/2-E;A.clearRect(G,B,y,v);A[t](G,B,y,v);G=p-F-i-D;B=u+x/2-E;A.clearRect(G,B,y,v);A[t](G,B,y,v)}if(this.hasRotatingPoint){G=p+z/2-F;B=this.flipY?(u+x+(this.rotatingPointOffset/this.scaleY)-v/2+i+C):(u-(this.rotatingPointOffset/this.scaleY)-v/2-i-C);A.clearRect(G,B,y,v);A[t](G,B,y,v)}A.restore();return this},clone:function(i){if(this.constructor.fromObject){return this.constructor.fromObject(this.toObject(),i)}return new d.Object(this.toObject())},cloneAsImage:function(r){if(d.Image){var p=new Image();p.onload=function(){if(r){r(new d.Image(p),q)}p=p.onload=null};var q={angle:this.get("angle"),flipX:this.get("flipX"),flipY:this.get("flipY")};this.set("angle",0).set("flipX",false).set("flipY",false);this.toDataURL(function(i){p.src=i})}return this},toDataURL:function(r){var p=d.document.createElement("canvas");if(!p.getContext&&typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(p)}p.width=this.getBoundingRectWidth();p.height=this.getBoundingRectHeight();d.util.wrapElement(p,"div");var i=new d.Canvas(p);i.backgroundColor="transparent";i.renderAll();if(this.constructor.async){this.clone(q)}else{q(this.clone())}function q(t){t.left=p.width/2;t.top=p.height/2;t.setActive(false);i.add(t);var s=i.toDataURL("png");i.dispose();i=t=null;r&&r(s)}},hasStateChanged:function(){return this.stateProperties.some(function(i){return this[i]!==this.originalState[i]},this)},saveState:function(){this.stateProperties.forEach(function(i){this.originalState[i]=this.get(i)},this);return this},setupState:function(){this.originalState={};this.saveState()},intersectsWithRect:function(q,s){var v=this.oCoords,i=new d.Point(v.tl.x,v.tl.y),r=new d.Point(v.tr.x,v.tr.y),u=new d.Point(v.bl.x,v.bl.y),p=new d.Point(v.br.x,v.br.y);var t=d.Intersection.intersectPolygonRectangle([i,r,p,u],q,s);return(t.status==="Intersection")},intersectsWithObject:function(i){function p(t){return{tl:new d.Point(t.tl.x,t.tl.y),tr:new d.Point(t.tr.x,t.tr.y),bl:new d.Point(t.bl.x,t.bl.y),br:new d.Point(t.br.x,t.br.y)}}var q=p(this.oCoords),s=p(i.oCoords);var r=d.Intersection.intersectPolygonPolygon([q.tl,q.tr,q.br,q.bl],[s.tl,s.tr,s.br,s.bl]);return(r.status==="Intersection")},isContainedWithinObject:function(i){return this.isContainedWithinRect(i.oCoords.tl,i.oCoords.br)},isContainedWithinRect:function(p,r){var t=this.oCoords,i=new d.Point(t.tl.x,t.tl.y),q=new d.Point(t.tr.x,t.tr.y),s=new d.Point(t.bl.x,t.bl.y);return i.x>p.x&&q.x<r.x&&i.y>p.y&&s.y<r.y},isType:function(i){return this.type===i},_findTargetCorner:function(u,w){if(!this.hasControls||!this.active){return false}var v=o(u),t=v.x-w.left,q=v.y-w.top,s,p;for(var r in this.oCoords){if(r==="mtr"&&!this.hasRotatingPoint){continue}if(this.lockUniScaling&&(r==="mt"||r==="mr"||r==="mb"||r==="ml")){continue}p=this._getImageLines(this.oCoords[r].corner,r);s=this._findCrossPoints(t,q,p);if(s%2===1&&s!==0){this.__corner=r;return r}}return false},_findCrossPoints:function(v,u,i){var y,x,q,p,w,t,s=0,r;for(var z in i){r=i[z];if((r.o.y<u)&&(r.d.y<u)){continue}if((r.o.y>=u)&&(r.d.y>=u)){continue}if((r.o.x===r.d.x)&&(r.o.x>=v)){w=r.o.x;t=u}else{y=0;x=(r.d.y-r.o.y)/(r.d.x-r.o.x);q=u-y*v;p=r.o.y-x*r.o.x;w=-(q-p)/(y-x);t=q+y*w}if(w>=v){s+=1}if(s===2){break}}return s},_getImageLines:function(i){return{topline:{o:i.tl,d:i.tr},rightline:{o:i.tr,d:i.br},bottomline:{o:i.br,d:i.bl},leftline:{o:i.bl,d:i.tl}}},_setCornerCoords:function(){var t=this.oCoords,p=b(45-this.getAngle()),r=Math.sqrt(2*Math.pow(this.cornersize,2))/2,i=r*Math.cos(p),q=r*Math.sin(p),u=Math.sin(this._theta),s=Math.cos(this._theta);t.tl.corner={tl:{x:t.tl.x-q,y:t.tl.y-i},tr:{x:t.tl.x+i,y:t.tl.y-q},bl:{x:t.tl.x-i,y:t.tl.y+q},br:{x:t.tl.x+q,y:t.tl.y+i}};t.tr.corner={tl:{x:t.tr.x-q,y:t.tr.y-i},tr:{x:t.tr.x+i,y:t.tr.y-q},br:{x:t.tr.x+q,y:t.tr.y+i},bl:{x:t.tr.x-i,y:t.tr.y+q}};t.bl.corner={tl:{x:t.bl.x-q,y:t.bl.y-i},bl:{x:t.bl.x-i,y:t.bl.y+q},br:{x:t.bl.x+q,y:t.bl.y+i},tr:{x:t.bl.x+i,y:t.bl.y-q}};t.br.corner={tr:{x:t.br.x+i,y:t.br.y-q},bl:{x:t.br.x-i,y:t.br.y+q},br:{x:t.br.x+q,y:t.br.y+i},tl:{x:t.br.x-q,y:t.br.y-i}};t.ml.corner={tl:{x:t.ml.x-q,y:t.ml.y-i},tr:{x:t.ml.x+i,y:t.ml.y-q},bl:{x:t.ml.x-i,y:t.ml.y+q},br:{x:t.ml.x+q,y:t.ml.y+i}};t.mt.corner={tl:{x:t.mt.x-q,y:t.mt.y-i},tr:{x:t.mt.x+i,y:t.mt.y-q},bl:{x:t.mt.x-i,y:t.mt.y+q},br:{x:t.mt.x+q,y:t.mt.y+i}};t.mr.corner={tl:{x:t.mr.x-q,y:t.mr.y-i},tr:{x:t.mr.x+i,y:t.mr.y-q},bl:{x:t.mr.x-i,y:t.mr.y+q},br:{x:t.mr.x+q,y:t.mr.y+i}};t.mb.corner={tl:{x:t.mb.x-q,y:t.mb.y-i},tr:{x:t.mb.x+i,y:t.mb.y-q},bl:{x:t.mb.x-i,y:t.mb.y+q},br:{x:t.mb.x+q,y:t.mb.y+i}};t.mtr.corner={tl:{x:t.mtr.x-q+(u*this.rotatingPointOffset),y:t.mtr.y-i-(s*this.rotatingPointOffset)},tr:{x:t.mtr.x+i+(u*this.rotatingPointOffset),y:t.mtr.y-q-(s*this.rotatingPointOffset)},bl:{x:t.mtr.x-i+(u*this.rotatingPointOffset),y:t.mtr.y+q-(s*this.rotatingPointOffset)},br:{x:t.mtr.x+q+(u*this.rotatingPointOffset),y:t.mtr.y+i-(s*this.rotatingPointOffset)}}},toGrayscale:function(){var i=this.get("fill");if(i){this.set("overlayFill",new d.Color(i).toGrayscale().toRgb())}return this},complexity:function(){return 0},toJSON:function(){return this.toObject()},setGradientFill:function(i){this.set("fill",d.Gradient.forObject(this,i))},animate:function(){if(arguments[0]&&typeof arguments[0]==="object"){for(var i in arguments[0]){this._animate(i,arguments[0][i],arguments[1])}}else{this._animate.apply(this,arguments)}return this},_animate:function(p,r,i){var q=this;i||(i={});if(!("from" in i)){i.from=this.get(p)}if(/[+\-]/.test((r+"").charAt(0))){r=this.get(p)+parseFloat(r)}d.util.animate({startValue:i.from,endValue:r,byValue:i.by,easing:i.easing,duration:i.duration,onChange:function(s){q.set(p,s);i.onChange&&i.onChange()},onComplete:function(){q.setCoords();i.onComplete&&i.onComplete()}})},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){return this.centerH().centerV()},remove:function(){return this.canvas.remove(this)},sendToBack:function(){this.canvas.sendToBack(this);return this},bringToFront:function(){this.canvas.bringToFront(this);return this},sendBackwards:function(){this.canvas.sendBackwards(this);return this},bringForward:function(){this.canvas.bringForward(this);return this}});d.Object.prototype.rotate=d.Object.prototype.setAngle;var j=d.Object.prototype;for(var g=j.stateProperties.length;g--;){var h=j.stateProperties[g],e=h.charAt(0).toUpperCase()+h.slice(1),f="set"+e,m="get"+e;if(!j[m]){j[m]=(function(i){return new Function('return this.get("'+i+'")')})(h)}if(!j[f]){j[f]=(function(i){return new Function("value",'return this.set("'+i+'", value)')})(h)}}l(d.Object.prototype,d.Observable);l(d.Object,{NUM_FRACTION_DIGITS:2,MIN_SCALE_LIMIT:0.1})})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),d=c.util.object.extend,a={x1:1,x2:1,y1:1,y2:1};if(c.Line){c.warn("fabric.Line is already defined");return}c.Line=c.util.createClass(c.Object,{type:"line",initialize:function(f,e){if(!f){f=[0,0,0,0]}this.callSuper("initialize",e);this.set("x1",f[0]);this.set("y1",f[1]);this.set("x2",f[2]);this.set("y2",f[3]);this._setWidthHeight(e)},_setWidthHeight:function(e){e||(e={});this.set("width",(this.x2-this.x1)||1);this.set("height",(this.y2-this.y1)||1);this.set("left","left" in e?e.left:(this.x1+this.width/2));this.set("top","top" in e?e.top:(this.y1+this.height/2))},_set:function(e,f){this[e]=f;if(e in a){this._setWidthHeight()}return this},_render:function(e){e.beginPath();if(this.group){e.translate(-this.group.width/2+this.left,-this.group.height/2+this.top)}e.moveTo(this.width===1?0:(-this.width/2),this.height===1?0:(-this.height/2));e.lineTo(this.width===1?0:(this.width/2),this.height===1?0:(this.height/2));e.lineWidth=this.strokeWidth;var f=e.strokeStyle;e.strokeStyle=e.fillStyle;e.stroke();e.strokeStyle=f},complexity:function(){return 1},toObject:function(){return d(this.callSuper("toObject"),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(){return["<line ",'x1="',this.get("x1"),'" ','y1="',this.get("y1"),'" ','x2="',this.get("x2"),'" ','y2="',this.get("y2"),'" ','style="',this.getSvgStyles(),'" ',"/>"].join("")}});c.Line.ATTRIBUTE_NAMES="x1 y1 x2 y2 stroke stroke-width transform".split(" ");c.Line.fromElement=function(f,e){var h=c.parseAttributes(f,c.Line.ATTRIBUTE_NAMES);var g=[h.x1||0,h.y1||0,h.x2||0,h.y2||0];return new c.Line(g,d(h,e))};c.Line.fromObject=function(e){var f=[e.x1,e.y1,e.x2,e.y2];return new c.Line(f,e)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),d=Math.PI*2,e=b.util.object.extend;if(b.Circle){b.warn("fabric.Circle is already defined.");return}b.Circle=b.util.createClass(b.Object,{type:"circle",initialize:function(f){f=f||{};this.set("radius",f.radius||0);this.callSuper("initialize",f);var g=this.get("radius")*2;this.set("width",g).set("height",g)},toObject:function(){return e(this.callSuper("toObject"),{radius:this.get("radius")})},toSVG:function(){return('<circle cx="0" cy="0" r="'+this.radius+'" style="'+this.getSvgStyles()+'" transform="'+this.getSvgTransform()+'" />')},_render:function(f,g){f.beginPath();f.globalAlpha*=this.opacity;f.arc(g?this.left:0,g?this.top:0,this.radius,0,d,false);f.closePath();if(this.fill){f.fill()}if(this.stroke){f.stroke()}},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(f){this.radius=f;this.set("width",f*2).set("height",f*2)},complexity:function(){return 1}});b.Circle.ATTRIBUTE_NAMES="cx cy r fill fill-opacity opacity stroke stroke-width transform".split(" ");b.Circle.fromElement=function(g,f){f||(f={});var h=b.parseAttributes(g,b.Circle.ATTRIBUTE_NAMES);if(!c(h)){throw new Error("value of `r` attribute is required and can not be negative")}if("left" in h){h.left-=(f.width/2)||0}if("top" in h){h.top-=(f.height/2)||0}return new b.Circle(e(h,f))};function c(f){return(("radius" in f)&&(f.radius>0))}b.Circle.fromObject=function(f){return new b.Circle(f)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Triangle){b.warn("fabric.Triangle is already defined");return}b.Triangle=b.util.createClass(b.Object,{type:"triangle",initialize:function(c){c=c||{};this.callSuper("initialize",c);this.set("width",c.width||100).set("height",c.height||100)},_render:function(c){var d=this.width/2,e=this.height/2;c.beginPath();c.moveTo(-d,e);c.lineTo(0,-e);c.lineTo(d,e);c.closePath();if(this.fill){c.fill()}if(this.stroke){c.stroke()}},complexity:function(){return 1},toSVG:function(){var c=this.width/2,d=this.height/2;var e=[-c+" "+d,"0 "+-d,c+" "+d].join(",");return'<polygon points="'+e+'" style="'+this.getSvgStyles()+'" transform="'+this.getSvgTransform()+'" />'}});b.Triangle.fromObject=function(c){return new b.Triangle(c)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=Math.PI*2,d=b.util.object.extend;if(b.Ellipse){b.warn("fabric.Ellipse is already defined.");return}b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",initialize:function(e){e=e||{};this.callSuper("initialize",e);this.set("rx",e.rx||0);this.set("ry",e.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(){return d(this.callSuper("toObject"),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(){return["<ellipse ",'rx="',this.get("rx"),'" ','ry="',this.get("ry"),'" ','style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',"/>"].join("")},render:function(e,f){if(this.rx===0||this.ry===0){return}return this.callSuper("render",e,f)},_render:function(e,f){e.beginPath();e.save();e.globalAlpha*=this.opacity;if(this.transformMatrix&&this.group){e.translate(this.cx,this.cy)}e.transform(1,0,0,this.ry/this.rx,0,0);e.arc(f?this.left:0,f?this.top:0,this.rx,0,c,false);if(this.stroke){e.stroke()}if(this.fill){e.fill()}e.restore()},complexity:function(){return 1}});b.Ellipse.ATTRIBUTE_NAMES="cx cy rx ry fill fill-opacity opacity stroke stroke-width transform".split(" ");b.Ellipse.fromElement=function(g,f){f||(f={});var i=b.parseAttributes(g,b.Ellipse.ATTRIBUTE_NAMES);var e=i.left;var j=i.top;if("left" in i){i.left-=(f.width/2)||0}if("top" in i){i.top-=(f.height/2)||0}var h=new b.Ellipse(d(i,f));h.cx=e||0;h.cy=j||0;return h};b.Ellipse.fromObject=function(e){return new b.Ellipse(e)}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={});if(c.Rect){console.warn("fabric.Rect is already defined");return}c.Rect=c.util.createClass(c.Object,{type:"rect",rx:0,ry:0,initialize:function(d){this._initStateProperties();this.callSuper("initialize",d);this._initRxRy()},_initStateProperties:function(){this.stateProperties=this.stateProperties.concat(["rx","ry"])},_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx}else{if(this.ry&&!this.rx){this.rx=this.ry}}},_render:function(f){var j=this.rx||0,i=this.ry||0,d=-this.width/2,k=-this.height/2,e=this.width,g=this.height;f.beginPath();f.globalAlpha*=this.opacity;if(this.transformMatrix&&this.group){f.translate(this.width/2+this.x,this.height/2+this.y)}if(!this.transformMatrix&&this.group){f.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y)}f.moveTo(d+j,k);f.lineTo(d+e-j,k);f.quadraticCurveTo(d+e,k,d+e,k+i,d+e,k+i);f.lineTo(d+e,k+g-i);f.quadraticCurveTo(d+e,k+g,d+e-j,k+g,d+e-j,k+g);f.lineTo(d+j,k+g);f.quadraticCurveTo(d,k+g,d,k+g-i,d,k+g-i);f.lineTo(d,k+i);f.quadraticCurveTo(d,k,d+j,k,d+j,k);f.closePath();if(this.fill){f.fill()}if(this.strokeDashArray){this._renderDashedStroke(f)}else{if(this.stroke){f.stroke()}}},_normalizeLeftTopProperties:function(d){if(d.left){this.set("left",d.left+this.getWidth()/2)}this.set("x",d.left||0);if(d.top){this.set("top",d.top+this.getHeight()/2)}this.set("y",d.top||0);return this},complexity:function(){return 1},toObject:function(){return c.util.object.extend(this.callSuper("toObject"),{rx:this.get("rx")||0,ry:this.get("ry")||0})},toSVG:function(){return'<rect x="'+(-1*this.width/2)+'" y="'+(-1*this.height/2)+'" rx="'+this.get("rx")+'" ry="'+this.get("ry")+'" width="'+this.width+'" height="'+this.height+'" style="'+this.getSvgStyles()+'" transform="'+this.getSvgTransform()+'" />'}});c.Rect.ATTRIBUTE_NAMES="x y width height rx ry fill fill-opacity opacity stroke stroke-width transform".split(" ");function a(d){d.left=d.left||0;d.top=d.top||0;return d}c.Rect.fromElement=function(e,d){if(!e){return null}var g=c.parseAttributes(e,c.Rect.ATTRIBUTE_NAMES);g=a(g);var f=new c.Rect(c.util.object.extend((d?c.util.object.clone(d):{}),g));f._normalizeLeftTopProperties(g);return f};c.Rect.fromObject=function(d){return new c.Rect(d)}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.util.toFixed;if(c.Polyline){c.warn("fabric.Polyline is already defined");return}c.Polyline=c.util.createClass(c.Object,{type:"polyline",initialize:function(e,d){d=d||{};this.set("points",e);this.callSuper("initialize",d);this._calcDimensions()},_calcDimensions:function(){return c.Polygon.prototype._calcDimensions.call(this)},toObject:function(){return c.Polygon.prototype.toObject.call(this)},toSVG:function(){var f=[];for(var e=0,d=this.points.length;e<d;e++){f.push(a(this.points[e].x,2),",",a(this.points[e].y,2)," ")}return["<polyline ",'points="',f.join(""),'" ','style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',"/>"].join("")},_render:function(f){var e;f.beginPath();f.moveTo(this.points[0].x,this.points[0].y);for(var g=0,d=this.points.length;g<d;g++){e=this.points[g];f.lineTo(e.x,e.y)}if(this.fill){f.fill()}if(this.stroke){f.stroke()}},complexity:function(){return this.get("points").length}});c.Polyline.ATTRIBUTE_NAMES="fill fill-opacity opacity stroke stroke-width transform".split(" ");c.Polyline.fromElement=function(g,e){if(!g){return null}e||(e={});var h=c.parsePointsAttribute(g.getAttribute("points")),j=c.parseAttributes(g,c.Polyline.ATTRIBUTE_NAMES);for(var f=0,d=h.length;f<d;f++){h[f].x-=(e.width/2)||0;h[f].y-=(e.height/2)||0}return new c.Polyline(h,c.util.object.extend(j,e))};c.Polyline.fromObject=function(d){var e=d.points;return new c.Polyline(e,d)}})(typeof exports!=="undefined"?exports:this);(function(d){var e=d.fabric||(d.fabric={}),f=e.util.object.extend,c=e.util.array.min,b=e.util.array.max,a=e.util.toFixed;if(e.Polygon){e.warn("fabric.Polygon is already defined");return}e.Polygon=e.util.createClass(e.Object,{type:"polygon",initialize:function(h,g){g=g||{};this.points=h;this.callSuper("initialize",g);this._calcDimensions()},_calcDimensions:function(){var h=this.points,g=c(h,"x"),k=c(h,"y"),j=b(h,"x"),i=b(h,"y");this.width=(j-g)||1;this.height=(i-k)||1;this.minX=g;this.minY=k},toObject:function(){return f(this.callSuper("toObject"),{points:this.points.concat()})},toSVG:function(){var j=[];for(var h=0,g=this.points.length;h<g;h++){j.push(a(this.points[h].x,2),",",a(this.points[h].y,2)," ")}return["<polygon ",'points="',j.join(""),'" ','style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',"/>"].join("")},_render:function(j){var h;j.beginPath();j.moveTo(this.points[0].x,this.points[0].y);for(var k=0,g=this.points.length;k<g;k++){h=this.points[k];j.lineTo(h.x,h.y)}if(this.fill){j.fill()}if(this.stroke){j.closePath();j.stroke()}},complexity:function(){return this.points.length}});e.Polygon.ATTRIBUTE_NAMES="fill fill-opacity opacity stroke stroke-width transform".split(" ");e.Polygon.fromElement=function(k,h){if(!k){return null}h||(h={});var l=e.parsePointsAttribute(k.getAttribute("points")),m=e.parseAttributes(k,e.Polygon.ATTRIBUTE_NAMES);for(var j=0,g=l.length;j<g;j++){l[j].x-=(h.width/2)||0;l[j].y-=(h.height/2)||0}return new e.Polygon(l,f(m,h))};e.Polygon.fromObject=function(g){return new e.Polygon(g.points,g)}})(typeof exports!=="undefined"?exports:this);(function(a){var l={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};function k(F,B,z,A){var s=A[0];var q=A[1];var t=A[2];var D=A[3];var E=A[4];var w=A[5];var v=A[6];var r=i(w,v,s,q,D,E,t,B,z);for(var u=0;u<r.length;u++){var C=f.apply(this,r[u]);F.bezierCurveTo.apply(F,C)}}var b={},p={},o=Array.prototype.join,j;function i(T,S,O,N,J,P,G,M,L){j=o.call(arguments);if(b[j]){return b[j]}var r=G*(Math.PI/180);var W=Math.sin(r);var aa=Math.cos(r);O=Math.abs(O);N=Math.abs(N);var A=aa*(M-T)*0.5+W*(L-S)*0.5;var z=aa*(L-S)*0.5-W*(M-T)*0.5;var E=(A*A)/(O*O)+(z*z)/(N*N);if(E>1){E=Math.sqrt(E);O*=E;N*=E}var R=aa/O;var Q=W/O;var D=(-W)/N;var C=(aa)/N;var H=R*M+Q*L;var q=D*M+C*L;var F=R*T+Q*S;var ab=D*T+C*S;var Z=(F-H)*(F-H)+(ab-q)*(ab-q);var U=1/Z-0.25;if(U<0){U=0}var w=Math.sqrt(U);if(P===J){w=-w}var V=0.5*(H+F)-w*(ab-q);var K=0.5*(q+ab)+w*(F-H);var v=Math.atan2(q-K,H-V);var u=Math.atan2(ab-K,F-V);var Y=u-v;if(Y<0&&P===1){Y+=2*Math.PI}else{if(Y>0&&P===0){Y-=2*Math.PI}}var B=Math.ceil(Math.abs(Y/(Math.PI*0.5+0.001)));var I=[];for(var X=0;X<B;X++){var t=v+X*Y/B;var s=v+(X+1)*Y/B;I[X]=[V,K,t,s,O,N,W,aa]}return(b[j]=I)}function f(w,s,E,C,y,x,u,D){j=o.call(arguments);if(p[j]){return p[j]}var K=D*y;var J=-u*x;var A=u*y;var z=D*x;var F=0.5*(C-E);var B=(8/3)*Math.sin(F*0.5)*Math.sin(F*0.5)/Math.sin(F);var I=w+Math.cos(E)-B*Math.sin(E);var v=s+Math.sin(E)+B*Math.cos(E);var G=w+Math.cos(C);var q=s+Math.sin(C);var H=G+B*Math.sin(C);var r=q-B*Math.cos(C);return(p[j]=[K*I+J*v,A*I+z*v,K*H+J*r,A*H+z*r,K*G+J*q,A*G+z*q])}"use strict";var d=a.fabric||(a.fabric={}),e=d.util.array.min,h=d.util.array.max,g=d.util.object.extend,c=Object.prototype.toString;if(d.Path){d.warn("fabric.Path is already defined");return}if(!d.Object){d.warn("fabric.Path requires fabric.Object");return}function n(q){if(q[0]==="H"){return q[1]}return q[q.length-2]}function m(q){if(q[0]==="V"){return q[1]}return q[q.length-1]}d.Path=d.util.createClass(d.Object,{type:"path",initialize:function(s,r){r=r||{};this.setOptions(r);if(!s){throw new Error("`path` argument is required")}var q=c.call(s)==="[object Array]";this.path=q?s:s.match&&s.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(!this.path){return}if(!q){this._initializeFromString(r)}if(r.sourcePath){this.setSourcePath(r.sourcePath)}},_initializeFromString:function(r){var q="width" in r,s="height" in r;this.path=this._parsePath();if(!q||!s){g(this,this._parseDimensions());if(q){this.width=r.width}if(s){this.height=r.height}}},_render:function(G){var C,A=null,E=0,D=0,q=0,H=0,z,w,s,r,u=-(this.width/2),F=-(this.height/2);for(var v=0,B=this.path.length;v<B;++v){C=this.path[v];switch(C[0]){case"l":E+=C[1];D+=C[2];G.lineTo(E+u,D+F);break;case"L":E=C[1];D=C[2];G.lineTo(E+u,D+F);break;case"h":E+=C[1];G.lineTo(E+u,D+F);break;case"H":E=C[1];G.lineTo(E+u,D+F);break;case"v":D+=C[1];G.lineTo(E+u,D+F);break;case"V":D=C[1];G.lineTo(E+u,D+F);break;case"m":E+=C[1];D+=C[2];G.moveTo(E+u,D+F);break;case"M":E=C[1];D=C[2];G.moveTo(E+u,D+F);break;case"c":z=E+C[5];w=D+C[6];q=E+C[3];H=D+C[4];G.bezierCurveTo(E+C[1]+u,D+C[2]+F,q+u,H+F,z+u,w+F);E=z;D=w;break;case"C":E=C[5];D=C[6];q=C[3];H=C[4];G.bezierCurveTo(C[1]+u,C[2]+F,q+u,H+F,E+u,D+F);break;case"s":z=E+C[3];w=D+C[4];q=2*E-q;H=2*D-H;G.bezierCurveTo(q+u,H+F,E+C[1]+u,D+C[2]+F,z+u,w+F);q=E+C[1];H=D+C[2];E=z;D=w;break;case"S":z=C[3];w=C[4];q=2*E-q;H=2*D-H;G.bezierCurveTo(q+u,H+F,C[1]+u,C[2]+F,z+u,w+F);E=z;D=w;q=C[1];H=C[2];break;case"q":z=E+C[3];w=D+C[4];q=E+C[1];H=D+C[2];G.quadraticCurveTo(q+u,H+F,z+u,w+F);E=z;D=w;break;case"Q":z=C[3];w=C[4];G.quadraticCurveTo(C[1]+u,C[2]+F,z+u,w+F);E=z;D=w;q=C[1];H=C[2];break;case"t":z=E+C[1];w=D+C[2];if(A[0].match(/[QqTt]/)===null){q=E;H=D}else{if(A[0]==="t"){q=2*E-s;H=2*D-r}else{if(A[0]==="q"){q=2*E-q;H=2*D-H}}}s=q;r=H;G.quadraticCurveTo(q+u,H+F,z+u,w+F);E=z;D=w;q=E+C[1];H=D+C[2];break;case"T":z=C[1];w=C[2];q=2*E-q;H=2*D-H;G.quadraticCurveTo(q+u,H+F,z+u,w+F);E=z;D=w;break;case"a":k(G,E+u,D+F,[C[1],C[2],C[3],C[4],C[5],C[6]+E+u,C[7]+D+F]);E+=C[6];D+=C[7];break;case"A":k(G,E+u,D+F,[C[1],C[2],C[3],C[4],C[5],C[6]+u,C[7]+F]);E=C[6];D=C[7];break;case"z":case"Z":G.closePath();break}A=C}},render:function(r,s){r.save();var q=this.transformMatrix;if(q){r.transform(q[0],q[1],q[2],q[3],q[4],q[5])}if(!s){this.transform(r)}if(this.overlayFill){r.fillStyle=this.overlayFill}else{if(this.fill){r.fillStyle=this.fill.toLiveGradient?this.fill.toLiveGradient(r):this.fill}}if(this.stroke){r.strokeStyle=this.stroke}r.beginPath();this._render(r);if(this.fill){r.fill()}if(this.stroke){r.strokeStyle=this.stroke;r.lineWidth=this.strokeWidth;r.lineCap=r.lineJoin="round";r.stroke()}if(!s&&this.active){this.drawBorders(r);this.hideCorners||this.drawCorners(r)}r.restore()},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(){var q=g(this.callSuper("toObject"),{path:this.path});if(this.sourcePath){q.sourcePath=this.sourcePath}if(this.transformMatrix){q.transformMatrix=this.transformMatrix}return q},toDatalessObject:function(){var q=this.toObject();if(this.sourcePath){q.path=this.sourcePath}delete q.sourcePath;return q},toSVG:function(){var t=[];for(var r=0,q=this.path.length;r<q;r++){t.push(this.path[r].join(" "))}var s=t.join(" ");return['<g transform="',this.getSvgTransform(),'">',"<path ",'width="',this.width,'" height="',this.height,'" ','d="',s,'" ','style="',this.getSvgStyles(),'" ','transform="translate(',(-this.width/2)," ",(-this.height/2),')" />',"</g>"].join("")},complexity:function(){return this.path.length},_parsePath:function(){var C=[],z,v,y;for(var u=0,q,w=this.path.length;u<w;u++){z=this.path[u];v=z.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);q=[z.charAt(0)];for(var t=0,A=v.length;t<A;t++){y=parseFloat(v[t]);if(!isNaN(y)){q.push(y)}}var s=q[0].toLowerCase(),B=l[s];if(q.length-1>B){for(var r=1,x=q.length;r<x;r+=B){C.push([q[0]].concat(q.slice(r,r+B)))}}else{C.push(q)}}return C},_parseDimensions:function(){var z=[],v=[],A,w,B=false,D,C;this.path.forEach(function(y,x){if(y[0]!=="H"){A=(x===0)?n(y):n(this.path[x-1])}if(y[0]!=="V"){w=(x===0)?m(y):m(this.path[x-1])}if(y[0]===y[0].toLowerCase()){B=true}D=B?A+n(y):y[0]==="V"?A:n(y);C=B?w+m(y):y[0]==="H"?w:m(y);var E=parseInt(D,10);if(!isNaN(E)){z.push(E)}E=parseInt(C,10);if(!isNaN(E)){v.push(E)}},this);var s=e(z),r=e(v),u=0,t=0;var q={top:r-t,left:s-u,bottom:h(v)-t,right:h(z)-u};q.width=q.right-q.left;q.height=q.bottom-q.top;return q}});d.Path.fromObject=function(q){return new d.Path(q.path,q)};d.Path.ATTRIBUTE_NAMES="d fill fill-opacity opacity fill-rule stroke stroke-width transform".split(" ");d.Path.fromElement=function(r,q){var s=d.parseAttributes(r,d.Path.ATTRIBUTE_NAMES);return new d.Path(s.d,g(s,q))}})(typeof exports!=="undefined"?exports:this);(function(f){var g=f.fabric||(f.fabric={}),h=g.util.object.extend,b=g.util.array.invoke,e=g.Object.prototype.toObject,a=g.util.string.camelize,c=g.util.string.capitalize;if(g.PathGroup){g.warn("fabric.PathGroup is already defined");return}g.PathGroup=g.util.createClass(g.Path,{type:"path-group",fill:"",forceFillOverwrite:false,initialize:function(l,j){j=j||{};this.paths=l||[];for(var k=this.paths.length;k--;){this.paths[k].group=this}this.setOptions(j);this.setCoords();if(j.sourcePath){this.setSourcePath(j.sourcePath)}},render:function(n){n.save();var j=this.transformMatrix;if(j){n.transform(j[0],j[1],j[2],j[3],j[4],j[5])}this.transform(n);for(var o=0,k=this.paths.length;o<k;++o){this.paths[o].render(n,true)}if(this.active){this.drawBorders(n);this.hideCorners||this.drawCorners(n)}n.restore()},_set:function(l,k){if((l==="fill"||l==="overlayFill")&&k&&this.isSameColor()){var j=this.paths.length;while(j--){this.paths[j]._set(l,k)}}return this.callSuper("_set",l,k)},toObject:function(){return h(e.call(this),{paths:b(this.getObjects(),"toObject"),sourcePath:this.sourcePath})},toDatalessObject:function(){var i=this.toObject();if(this.sourcePath){i.paths=this.sourcePath}return i},toSVG:function(){var m=this.getObjects();var k=["<g ",'width="',this.width,'" ','height="',this.height,'" ','style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"];for(var l=0,j=m.length;l<j;l++){k.push(m[l].toSVG())}k.push("</g>");return k.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var i=this.getObjects()[0].get("fill");return this.getObjects().every(function(j){return j.get("fill")===i})},complexity:function(){return this.paths.reduce(function(i,j){return i+((j&&j.complexity)?j.complexity():0)},0)},toGrayscale:function(){var j=this.paths.length;while(j--){this.paths[j].toGrayscale()}return this},getObjects:function(){return this.paths}});function d(m){for(var l=0,j=m.length;l<j;l++){if(!(m[l] instanceof g.Object)){var k=a(c(m[l].type));m[l]=g[k].fromObject(m[l])}}return m}g.PathGroup.fromObject=function(i){var j=d(i.paths);return new g.PathGroup(j,i)}})(typeof exports!=="undefined"?exports:this);(function(d){var e=d.fabric||(d.fabric={}),g=e.util.object.extend,c=e.util.array.min,a=e.util.array.max,b=e.util.array.invoke,f=e.util.removeFromArray;if(e.Group){return}e.Group=e.util.createClass(e.Object,{type:"group",initialize:function(i,h){this.objects=i||[];this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();if(h){g(this,h)}this._setOpacityIfSame();this.setCoords(true);this.saveCoords()},_updateObjectsCoords:function(){var i=this.left,h=this.top;this.forEachObject(function(j){var k=j.get("left"),l=j.get("top");j.set("originalLeft",k);j.set("originalTop",l);j.set("left",k-i);j.set("top",l-h);j.setCoords();j.hideCorners=true},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this.objects},addWithUpdate:function(h){this._restoreObjectsState();this.objects.push(h);this._calcBounds();this._updateObjectsCoords();return this},removeWithUpdate:function(h){this._restoreObjectsState();f(this.objects,h);h.setActive(false);this._calcBounds();this._updateObjectsCoords();return this},add:function(h){this.objects.push(h);return this},remove:function(h){f(this.objects,h);return this},size:function(){return this.getObjects().length},_set:function(j,k){if(j==="fill"||j==="opacity"){var h=this.objects.length;this[j]=k;while(h--){this.objects[h].set(j,k)}}else{this[j]=k}},contains:function(h){return this.objects.indexOf(h)>-1},toObject:function(){return g(this.callSuper("toObject"),{objects:b(this.objects,"toObject")})},render:function(j,o){j.save();this.transform(j);var n=Math.max(this.scaleX,this.scaleY);for(var l=0,h=this.objects.length;l<h;l++){var k=this.objects[l];var m=k.borderScaleFactor;k.borderScaleFactor=n;k.render(j);k.borderScaleFactor=m}if(!o&&this.active){this.drawBorders(j);this.hideCorners||this.drawCorners(j)}j.restore();this.setCoords()},item:function(h){return this.getObjects()[h]},complexity:function(){return this.getObjects().reduce(function(i,h){i+=(typeof h.complexity==="function")?h.complexity():0;return i},0)},_restoreObjectsState:function(){this.objects.forEach(this._restoreObjectState,this);return this},_restoreObjectState:function(j){var k=this.get("left"),l=this.get("top"),h=this.getAngle()*(Math.PI/180),i=Math.cos(h)*j.get("top")+Math.sin(h)*j.get("left"),m=-Math.sin(h)*j.get("top")+Math.cos(h)*j.get("left");j.setAngle(j.getAngle()+this.getAngle());j.set("left",k+m*this.get("scaleX"));j.set("top",l+i*this.get("scaleY"));j.set("scaleX",j.get("scaleX")*this.get("scaleX"));j.set("scaleY",j.get("scaleY")*this.get("scaleY"));j.setCoords();j.hideCorners=false;j.setActive(false);j.setCoords();return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(h){h.setCoords()});return this},activateAllObjects:function(){this.forEachObject(function(h){h.setActive()});return this},forEachObject:e.StaticCanvas.prototype.forEachObject,_setOpacityIfSame:function(){var j=this.getObjects(),i=j[0]?j[0].get("opacity"):1;var h=j.every(function(k){return k.get("opacity")===i});if(h){this.opacity=i}},_calcBounds:function(){var s=[],q=[],p,n,k,h,m,l,u,r=0,t=this.objects.length;for(;r<t;++r){m=this.objects[r];m.setCoords();for(var j in m.oCoords){s.push(m.oCoords[j].x);q.push(m.oCoords[j].y)}}p=c(s);k=a(s);n=c(q);h=a(q);l=(k-p)||0;u=(h-n)||0;this.width=l;this.height=u;this.left=(p+l/2)||0;this.top=(n+u/2)||0},containsPoint:function(i){var l=this.get("width")/2,h=this.get("height")/2,k=this.get("left"),j=this.get("top");return k-l<i.x&&k+l>i.x&&j-h<i.y&&j+h>i.y},toGrayscale:function(){var h=this.objects.length;while(h--){this.objects[h].toGrayscale()}},toSVG:function(){var k=[];for(var j=0,h=this.objects.length;j<h;j++){k.push(this.objects[j].toSVG())}return('<g transform="'+this.getSvgTransform()+'">'+k.join("")+"</g>")}});e.Group.fromObject=function(h,i){e.util.enlivenObjects(h.objects,function(j){delete h.objects;i&&i(new e.Group(j,h))})};e.Group.async=true})(typeof exports!=="undefined"?exports:this);(function(a){var b=fabric.util.object.extend;if(!a.fabric){a.fabric={}}if(a.fabric.Image){fabric.warn("fabric.Image is already defined.");return}if(!fabric.Object){fabric.warn("fabric.Object is required for fabric.Image initialization");return}fabric.Image=fabric.util.createClass(fabric.Object,{active:false,bordervisibility:false,cornervisibility:false,type:"image",initialize:function(d,c){c||(c={});this.callSuper("initialize",c);this._initElement(d);this._originalImage=this.getElement();this._initConfig(c);this.filters=[];if(c.filters){this.filters=c.filters;this.applyFilters()}},getElement:function(){return this._element},setElement:function(c){this._element=c;this._initConfig();return this},getOriginalSize:function(){var c=this.getElement();return{width:c.width,height:c.height}},setBorderVisibility:function(){this._resetWidthHeight();this._adjustWidthHeightToBorders();this.setCoords()},setCornersVisibility:function(c){this.cornervisibility=!!c},render:function(d,e){d.save();var c=this.transformMatrix;this._resetWidthHeight();if(this.group){d.translate(-this.group.width/2+this.width/2,-this.group.height/2+this.height/2)}if(c){d.transform(c[0],c[1],c[2],c[3],c[4],c[5])}if(!e){this.transform(d)}this._render(d);if(this.active&&!e){this.drawBorders(d);this.hideCorners||this.drawCorners(d)}d.restore()},toObject:function(){return b(this.callSuper("toObject"),{src:this._originalImage.src||this._originalImage._src,filters:this.filters.concat()})},toSVG:function(){return'<g transform="'+this.getSvgTransform()+'"><image xlink:href="'+this.getSvgSrc()+'" style="'+this.getSvgStyles()+'" transform="translate('+(-this.width/2)+" "+(-this.height/2)+')" width="'+this.width+'" height="'+this.height+'"/></g>'},getSrc:function(){return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(c){this.constructor.fromObject(this.toObject(),c)},applyFilters:function(i){if(this.filters.length===0){this.setElement(this._originalImage);i&&i();return}var c=typeof Buffer!=="undefined"&&typeof window==="undefined",g=this._originalImage,e=fabric.document.createElement("canvas"),f=c?new (require("canvas").Image)():fabric.document.createElement("img"),h=this;if(!e.getContext&&typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(e)}e.width=g.width;e.height=g.height;e.getContext("2d").drawImage(g,0,0,g.width,g.height);this.filters.forEach(function(j){j&&j.applyTo(e)});f.onload=function(){h._element=f;i&&i();f.onload=e=g=null};f.width=g.width;f.height=g.height;if(c){var d=e.toDataURL("image/png").replace(/data:image\/png;base64,/,"");f.src=new Buffer(d,"base64");h._element=f;i&&i()}else{f.src=e.toDataURL("image/png")}return this},_render:function(c){c.drawImage(this.getElement(),-this.width/2,-this.height/2,this.width,this.height)},_adjustWidthHeightToBorders:function(c){if(c){this.currentBorder=this.borderwidth;this.width+=(2*this.currentBorder);this.height+=(2*this.currentBorder)}else{this.currentBorder=0}},_resetWidthHeight:function(){var c=this.getElement();this.set("width",c.width);this.set("height",c.height)},_initElement:function(c){this.setElement(fabric.util.getById(c));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(c){c||(c={});this.setOptions(c);this._setBorder();this._setWidthHeight(c)},_initFilters:function(c){if(c.filters&&c.filters.length){this.filters=c.filters.map(function(d){return d&&fabric.Image.filters[d.type].fromObject(d)})}},_setBorder:function(){if(this.bordervisibility){this.currentBorder=this.borderwidth}else{this.currentBorder=0}},_setWidthHeight:function(c){var d=2*this.currentBorder;this.width="width" in c?c.width:((this.getElement().width||0)+d);this.height="height" in c?c.height:((this.getElement().height||0)+d)},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(d,f){var c=fabric.document.createElement("img"),e=d.src;if(d.width){c.width=d.width}if(d.height){c.height=d.height}c.onload=function(){fabric.Image.prototype._initFilters.call(d,d);var g=new fabric.Image(c,d);f&&f(g);c=c.onload=null};c.src=e};fabric.Image.fromURL=function(d,f,e){var c=fabric.document.createElement("img");c.onload=function(){if(f){f(new fabric.Image(c,e))}c=c.onload=null};c.src=d};fabric.Image.ATTRIBUTE_NAMES="x y width height fill fill-opacity opacity stroke stroke-width transform xlink:href".split(" ");fabric.Image.fromElement=function(d,f,c){c||(c={});var e=fabric.parseAttributes(d,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(e["xlink:href"],f,b(e,c))};fabric.Image.async=true})(typeof exports!=="undefined"?exports:this);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.get("angle");if(a>-225&&a<=-135){return -180}else{if(a>-135&&a<=-45){return -90}else{if(a>-45&&a<=45){return 0}else{if(a>45&&a<=135){return 90}else{if(a>135&&a<=225){return 180}else{if(a>225&&a<=315){return 270}else{if(a>315){return 360}}}}}}}return 0},straighten:function(){var a=this._getAngleValueForStraighten();this.setAngle(a);return this},fxStraighten:function(b){b=b||{};var c=function(){},d=b.onComplete||c,a=b.onChange||c,e=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(f){e.setAngle(f);a()},onComplete:function(){e.setCoords();d()},onStart:function(){e.setActive(false)}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(a){a.straighten();this.renderAll();return this},fxStraightenObject:function(a){a.fxStraighten({onChange:this.renderAll.bind(this)});return this}});fabric.Image.filters={};fabric.Image.filters.Grayscale=fabric.util.createClass({type:"Grayscale",applyTo:function(d){var c=d.getContext("2d"),a=c.getImageData(0,0,d.width,d.height),h=a.data,e=a.width,l=a.height,k,b,g,f;for(g=0;g<e;g++){for(f=0;f<l;f++){k=(g*4)*l+(f*4);b=(h[k]+h[k+1]+h[k+2])/3;h[k]=b;h[k+1]=b;h[k+2]=b}}c.putImageData(a,0,0)},toJSON:function(){return{type:this.type}}});fabric.Image.filters.Grayscale.fromObject=function(){return new fabric.Image.filters.Grayscale()};fabric.Image.filters.RemoveWhite=fabric.util.createClass({type:"RemoveWhite",initialize:function(a){a||(a={});this.threshold=a.threshold||30;this.distance=a.distance||20},applyTo:function(f){var e=f.getContext("2d"),c=e.getImageData(0,0,f.width,f.height),k=c.data,l=this.threshold,d=this.distance,h=255-l,p=Math.abs,a,m,o;for(var j=0,n=k.length;j<n;j+=4){a=k[j];m=k[j+1];o=k[j+2];if(a>h&&m>h&&o>h&&p(a-m)<d&&p(a-o)<d&&p(m-o)<d){k[j+3]=1}}e.putImageData(c,0,0)},toJSON:function(){return{type:this.type,threshold:this.threshold,distance:this.distance}}});fabric.Image.filters.RemoveWhite.fromObject=function(a){return new fabric.Image.filters.RemoveWhite(a)};fabric.Image.filters.Invert=fabric.util.createClass({type:"Invert",applyTo:function(d){var c=d.getContext("2d"),f=c.getImageData(0,0,d.width,d.height),e=f.data,a=e.length,b;for(b=0;b<a;b+=4){e[b]=255-e[b];e[b+1]=255-e[b+1];e[b+2]=255-e[b+2]}c.putImageData(f,0,0)},toJSON:function(){return{type:this.type}}});fabric.Image.filters.Invert.fromObject=function(){return new fabric.Image.filters.Invert()};fabric.Image.filters.Sepia=fabric.util.createClass({type:"Sepia",applyTo:function(d){var c=d.getContext("2d"),g=c.getImageData(0,0,d.width,d.height),e=g.data,a=e.length,b,f;for(b=0;b<a;b+=4){f=0.3*e[b]+0.59*e[b+1]+0.11*e[b+2];e[b]=f+100;e[b+1]=f+50;e[b+2]=f+255}c.putImageData(g,0,0)},toJSON:function(){return{type:this.type}}});fabric.Image.filters.Sepia.fromObject=function(){return new fabric.Image.filters.Sepia()};fabric.Image.filters.Sepia2=fabric.util.createClass({type:"Sepia2",applyTo:function(e){var d=e.getContext("2d"),a=d.getImageData(0,0,e.width,e.height),h=a.data,f=h.length,j,c,k,l;for(j=0;j<f;j+=4){c=h[j];k=h[j+1];l=h[j+2];h[j]=(c*0.393+k*0.769+l*0.189)/1.351;h[j+1]=(c*0.349+k*0.686+l*0.168)/1.203;h[j+2]=(c*0.272+k*0.534+l*0.131)/2.14}d.putImageData(a,0,0)},toJSON:function(){return{type:this.type}}});fabric.Image.filters.Sepia2.fromObject=function(){return new fabric.Image.filters.Sepia2()};fabric.Image.filters.Brightness=fabric.util.createClass({type:"Brightness",initialize:function(a){a||(a={});this.brightness=a.brightness||100},applyTo:function(d){var c=d.getContext("2d"),g=c.getImageData(0,0,d.width,d.height),e=g.data,f=this.brightness;for(var b=0,a=e.length;b<a;b+=4){e[b]+=f;e[b+1]+=f;e[b+2]+=f}c.putImageData(g,0,0)},toJSON:function(){return{type:this.type,brightness:this.brightness}}});fabric.Image.filters.Brightness.fromObject=function(a){return new fabric.Image.filters.Brightness(a)};fabric.Image.filters.Noise=fabric.util.createClass({type:"Noise",initialize:function(a){a||(a={});this.noise=a.noise||100},applyTo:function(e){var d=e.getContext("2d"),h=d.getImageData(0,0,e.width,e.height),g=h.data,b=this.noise,f;for(var c=0,a=g.length;c<a;c+=4){f=(0.5-Math.random())*b;g[c]+=f;g[c+1]+=f;g[c+2]+=f}d.putImageData(h,0,0)},toJSON:function(){return{type:this.type,noise:this.noise}}});fabric.Image.filters.Noise.fromObject=function(a){return new fabric.Image.filters.Noise(a)};fabric.Image.filters.GradientTransparency=fabric.util.createClass({type:"GradientTransparency",initialize:function(a){a||(a={});this.threshold=a.threshold||100},applyTo:function(e){var d=e.getContext("2d"),h=d.getImageData(0,0,e.width,e.height),g=h.data,b=this.threshold,f=g.length;for(var c=0,a=g.length;c<a;c+=4){g[c+3]=b+255*(f-c)/f}d.putImageData(h,0,0)},toJSON:function(){return{type:this.type,threshold:this.threshold}}});fabric.Image.filters.GradientTransparency.fromObject=function(a){return new fabric.Image.filters.GradientTransparency(a)};fabric.Image.filters.Tint=fabric.util.createClass({type:"Tint",initialize:function(a){a||(a={});this.color=a.color||0},applyTo:function(e){var d=e.getContext("2d"),b=d.getImageData(0,0,e.width,e.height),h=b.data,f=h.length,j,m;var l=parseInt(this.color,10).toString(16);var k=parseInt("0x"+l.substr(0,2),16);var c=parseInt("0x"+l.substr(2,2),16);var g=parseInt("0x"+l.substr(4,2),16);for(j=0;j<f;j+=4){m=h[j+3];if(m>0){h[j]=k;h[j+1]=c;h[j+2]=g}}d.putImageData(b,0,0)},toJSON:function(){return{type:this.type,color:this.color}}});fabric.Image.filters.Tint.fromObject=function(a){return new fabric.Image.filters.Tint(a)};(function(b){var c=b.fabric||(b.fabric={}),e=c.util.object.extend,d=c.util.object.clone,a=c.util.toFixed;if(c.Text){c.warn("fabric.Text is already defined");return}if(!c.Object){c.warn("fabric.Text requires fabric.Object");return}c.Text=c.util.createClass(c.Object,{fontSize:40,fontWeight:100,fontFamily:"Times New Roman",textDecoration:"",textShadow:"",textAlign:"left",fontStyle:"",lineHeight:1.3,strokeStyle:"",strokeWidth:1,backgroundColor:"",path:null,type:"text",useNative:true,initialize:function(g,f){this._initStateProperties();this.text=g;this.setOptions(f||{});this._theta=this.angle*Math.PI/180;this._initDimensions();this.setCoords()},_initDimensions:function(){var f=c.document.createElement("canvas");if(!f.getContext&&typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(f)}this._render(f.getContext("2d"))},_initStateProperties:function(){this.stateProperties=this.stateProperties.concat();this.stateProperties.push("fontFamily","fontWeight","fontSize","path","text","textDecoration","textShadow","textAlign","fontStyle","lineHeight","strokeStyle","strokeWidth","backgroundColor","useNative");c.util.removeFromArray(this.stateProperties,"width")},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(f){if(typeof Cufon==="undefined"||this.useNative===true){this._renderViaNative(f)}else{this._renderViaCufon(f)}},_renderViaCufon:function(f){var h=Cufon.textOptions||(Cufon.textOptions={});h.left=this.left;h.top=this.top;h.context=f;h.color=this.fill;var g=this._initDummyElementForCufon();this.transform(f);Cufon.replaceElement(g,{engine:"canvas",separate:"none",fontFamily:this.fontFamily,fontWeight:this.fontWeight,textDecoration:this.textDecoration,textShadow:this.textShadow,textAlign:this.textAlign,fontStyle:this.fontStyle,lineHeight:this.lineHeight,strokeStyle:this.strokeStyle,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor});this.width=h.width;this.height=h.height;this._totalLineHeight=h.totalLineHeight;this._fontAscent=h.fontAscent;this._boundaries=h.boundaries;this._shadowOffsets=h.shadowOffsets;this._shadows=h.shadows||[];g=null;this.setCoords()},_renderViaNative:function(f){this.transform(f);this._setTextStyles(f);var g=this.text.split(/\r?\n/);this.width=this._getTextWidth(f,g);this.height=this._getTextHeight(f,g);this._renderTextBackground(f,g);if(this.textAlign!=="left"){f.save();f.translate(this.textAlign==="center"?(this.width/2):this.width,0)}this._setTextShadow(f);this._renderTextFill(f,g);this.textShadow&&f.restore();this._renderTextStroke(f,g);if(this.textAlign!=="left"){f.restore()}this._renderTextDecoration(f,g);this._setBoundaries(f,g);this._totalLineHeight=0;this.setCoords()},_setBoundaries:function(h,k){this._boundaries=[];for(var j=0,g=k.length;j<g;j++){var f=h.measureText(k[j]).width;var l=this._getLineLeftOffset(f);this._boundaries.push({height:this.fontSize,width:f,left:l})}},_setTextStyles:function(f){f.fillStyle=this.fill;f.strokeStyle=this.strokeStyle;f.lineWidth=this.strokeWidth;f.textBaseline="top";f.textAlign=this.textAlign;f.font=this._getFontDeclaration()},_getTextHeight:function(f,g){return this.fontSize*g.length*this.lineHeight},_getTextWidth:function(g,j){var k=g.measureText(j[0]).width;for(var h=1,f=j.length;h<f;h++){var l=g.measureText(j[h]).width;if(l>k){k=l}}return k},_setTextShadow:function(f){if(this.textShadow){var j=/\s+(-?\d+)(?:px)?\s+(-?\d+)(?:px)?\s+(\d+)(?:px)?\s*/;var g=this.textShadow;var i=j.exec(this.textShadow);var h=g.replace(j,"");f.save();f.shadowColor=h;f.shadowOffsetX=parseInt(i[1],10);f.shadowOffsetY=parseInt(i[2],10);f.shadowBlur=parseInt(i[3],10);this._shadows=[{blur:f.shadowBlur,color:f.shadowColor,offX:f.shadowOffsetX,offY:f.shadowOffsetY}];this._shadowOffsets=[[parseInt(f.shadowOffsetX,10),parseInt(f.shadowOffsetY,10)]]}},_renderTextFill:function(g,j){this._boundaries=[];for(var h=0,f=j.length;h<f;h++){g.fillText(j[h],-this.width/2,(-this.height/2)+(h*this.fontSize*this.lineHeight))}},_renderTextStroke:function(g,j){if(this.strokeStyle){for(var h=0,f=j.length;h<f;h++){g.strokeText(j[h],-this.width/2,(-this.height/2)+(h*this.fontSize*this.lineHeight))}}},_renderTextBackground:function(h,k){if(this.backgroundColor){h.save();h.fillStyle=this.backgroundColor;for(var j=0,g=k.length;j<g;j++){var f=h.measureText(k[j]).width;var l=this._getLineLeftOffset(f);h.fillRect((-this.width/2)+l,(-this.height/2)+(j*this.fontSize*this.lineHeight),f,this.fontSize)}h.restore()}},_getLineLeftOffset:function(f){if(this.textAlign==="center"){return(this.width-f)/2}if(this.textAlign==="right"){return this.width-f}return 0},_renderTextDecoration:function(g,h){var i=this._getTextHeight(g,h)/2;var j=this;function f(o){for(var m=0,l=h.length;m<l;m++){var k=g.measureText(h[m]).width;var n=j._getLineLeftOffset(k);g.fillRect((-j.width/2)+n,(o+(m*j.fontSize*j.lineHeight))-i,k,1)}}if(this.textDecoration.indexOf("underline")>-1){f(this.fontSize)}if(this.textDecoration.indexOf("line-through")>-1){f(this.fontSize/2)}if(this.textDecoration.indexOf("overline")>-1){f(0)}},_getFontDeclaration:function(){return[this.fontStyle,this.fontWeight,this.fontSize+"px",(c.isLikelyNode?('"'+this.fontFamily+'"'):this.fontFamily)].join(" ")},_initDummyElementForCufon:function(){var g=c.document.createElement("pre"),f=c.document.createElement("div");f.appendChild(g);if(typeof G_vmlCanvasManager==="undefined"){g.innerHTML=this.text}else{g.innerText=this.text.replace(/\r?\n/gi,"\r")}g.style.fontSize=this.fontSize+"px";g.style.letterSpacing="normal";return g},render:function(f,g){f.save();this._render(f);if(!g&&this.active){this.drawBorders(f);this.hideCorners||this.drawCorners(f)}f.restore()},toObject:function(){return e(this.callSuper("toObject"),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textShadow:this.textShadow,textAlign:this.textAlign,path:this.path,strokeStyle:this.strokeStyle,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor,useNative:this.useNative})},toSVG:function(){var i=this.text.split(/\r?\n/),j=this.useNative?this.fontSize*this.lineHeight:(-this._fontAscent-((this._fontAscent/5)*this.lineHeight)),g=-(this.width/2),f=this.useNative?this.fontSize-1:(this.height/2)-(i.length*this.fontSize)-this._totalLineHeight,h=this._getSVGTextAndBg(j,g,i),k=this._getSVGShadows(j,i);f+=(this._fontAscent?((this._fontAscent/5)*this.lineHeight):0);return['<g transform="',this.getSvgTransform(),'">',h.textBgRects.join(""),"<text ",(this.fontFamily?"font-family=\"'"+this.fontFamily+"'\" ":""),(this.fontSize?'font-size="'+this.fontSize+'" ':""),(this.fontStyle?'font-style="'+this.fontStyle+'" ':""),(this.fontWeight?'font-weight="'+this.fontWeight+'" ':""),(this.textDecoration?'text-decoration="'+this.textDecoration+'" ':""),'style="',this.getSvgStyles(),'" ','transform="translate(',a(g,2)," ",a(f,2),')">',k.join(""),h.textSpans.join(""),"</text>","</g>"].join("")},_getSVGShadows:function(h,n){var o=[],k,l,p,g,f=1;if(!this._shadows||!this._boundaries){return o}for(k=0,p=this._shadows.length;k<p;k++){for(l=0,g=n.length;l<g;l++){if(n[l]!==""){var m=(this._boundaries&&this._boundaries[l])?this._boundaries[l].left:0;o.push('<tspan x="',a((m+f)+this._shadowOffsets[k][0],2),((l===0||this.useNative)?'" y':'" dy'),'="',a(this.useNative?((h*l)-this.height/2+this._shadowOffsets[k][1]):(h+(l===0?this._shadowOffsets[k][1]:0)),2),'" ',this._getFillAttributes(this._shadows[k].color),">",c.util.string.escapeXml(n[l]),"</tspan>");f=1}else{f++}}}return o},_getSVGTextAndBg:function(j,h,n){var g=[],k=[],l,m,o,f=1;for(l=0,o=n.length;l<o;l++){if(n[l]!==""){m=(this._boundaries&&this._boundaries[l])?a(this._boundaries[l].left,2):0;g.push('<tspan x="',m,'" ',(l===0||this.useNative?"y":"dy"),'="',a(this.useNative?((j*l)-this.height/2):(j*f),2),'" ',this._getFillAttributes(this.fill),">",c.util.string.escapeXml(n[l]),"</tspan>");f=1}else{f++}if(!this.backgroundColor||!this._boundaries){continue}k.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(h+this._boundaries[l].left,2),'" y="',a((j*l)-this.height/2,2),'" width="',a(this._boundaries[l].width,2),'" height="',a(this._boundaries[l].height,2),'"></rect>')}return{textSpans:g,textBgRects:k}},_getFillAttributes:function(f){var g=f?new c.Color(f):"";if(!g||!g.getSource()||g.getAlpha()===1){return'fill="'+f+'"'}return'opacity="'+g.getAlpha()+'" fill="'+g.setAlpha(1).toRgb()+'"'},setColor:function(f){this.set("fill",f);return this},setFontsize:function(f){this.set("fontSize",f);this._initDimensions();this.setCoords();return this},getText:function(){return this.text},setText:function(f){this.set("text",f);this._initDimensions();this.setCoords();return this},_set:function(f,g){if(f==="fontFamily"&&this.path){this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+g+"$3")}this.callSuper("_set",f,g)}});c.Text.ATTRIBUTE_NAMES=("x y fill fill-opacity opacity stroke stroke-width transform font-family font-style font-weight font-size text-decoration").split(" ");c.Text.fromObject=function(f){return new c.Text(f.text,d(f))};c.Text.fromElement=function(g,f){if(!g){return null}var h=c.parseAttributes(g,c.Text.ATTRIBUTE_NAMES);f=c.util.object.extend((f?c.util.object.clone(f):{}),h);var i=new c.Text(g.textContent,f);return i}})(typeof exports!=="undefined"?exports:this);(function(){if(typeof document!=="undefined"&&typeof window!=="undefined"){return}var DOMParser=new require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),Canvas=require("canvas"),Image=require("canvas").Image;function request(url,encoding,callback){var oURL=URL.parse(url),client=HTTP.createClient(oURL.port,oURL.hostname),req=client.request("GET",oURL.pathname,{host:oURL.hostname});client.addListener("error",function(err){if(err.errno===process.ECONNREFUSED){fabric.log("ECONNREFUSED: connection refused to "+client.host+":"+client.port)}else{fabric.log(err.message)}});req.end();req.on("response",function(response){var body="";if(encoding){response.setEncoding(encoding)}response.on("end",function(){callback(body)});response.on("data",function(chunk){if(response.statusCode===200){body+=chunk}})})}fabric.util.loadImage=function(url,callback){request(url,"binary",function(body){var img=new Image();img.src=new Buffer(body,"binary");img._src=url;callback(img)})};fabric.loadSVGFromURL=function(url,callback){url=url.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();request(url,"",function(body){fabric.loadSVGFromString(body,callback)})};fabric.loadSVGFromString=function(string,callback){var doc=new DOMParser().parseFromString(string);fabric.parseSVGDocument(doc.documentElement,function(results,options){callback(results,options)})};fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body);callback&&callback()})};fabric.Image.fromObject=function(object,callback){fabric.util.loadImage(object.src,function(img){var oImg=new fabric.Image(img);oImg._initConfig(object);oImg._initFilters(object);callback(oImg)})};fabric.createCanvasForNode=function(width,height){var canvasEl=fabric.document.createElement("canvas"),nodeCanvas=new Canvas(width||600,height||600);canvasEl.style={};canvasEl.width=nodeCanvas.width;canvasEl.height=nodeCanvas.height;var FabricCanvas=fabric.Canvas||fabric.StaticCanvas;var fabricCanvas=new FabricCanvas(canvasEl);fabricCanvas.contextContainer=nodeCanvas.getContext("2d");fabricCanvas.nodeCanvas=nodeCanvas;return fabricCanvas};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(width){origSetWidth.call(this);this.nodeCanvas.width=width;return this};if(fabric.Canvas){fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth}var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(height){origSetHeight.call(this);this.nodeCanvas.height=height;return this};if(fabric.Canvas){fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight}})();