/* Fabric.js Copyright 2010, Bitsonnet (Juriy Zaytsev, Maxim Chernyak) */
if(typeof console=="undefined"){var console={log:function(){},warn:function(){}}}var fabric=fabric||{version:0.1};if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());(function(m){var f=this.fabric||(this.fabric={}),h=Array.prototype.slice,g=Function.prototype.apply;f.util={};(function(){function z(C,B){var A=C.indexOf(B);if(A!==-1){C.splice(A,1)}return C}function x(B,A){return Math.floor(Math.random()*(A-B+1))+B}var v=Math.PI/180;function w(A){return A*v}function u(B,A){return parseFloat(Number(B).toFixed(A))}function y(){return false}f.util.removeFromArray=z;f.util.degreesToRadians=w;f.util.toFixed=u;f.util.getRandomInt=x;f.util.falseFunction=y})();if(!Array.prototype.indexOf){Array.prototype.indexOf=function(v,w){var u=this.length>>>0;w=Number(w)||0;w=Math[w<0?"ceil":"floor"](w);if(w<0){w+=u}for(;w<u;w++){if(w in this&&this[w]===v){return w}}return -1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(x,w){for(var v=0,u=this.length>>>0;v<u;v++){if(v in this){x.call(w,this[v],v,this)}}}}if(!Array.prototype.map){Array.prototype.map=function(y,x){var v=[];for(var w=0,u=this.length>>>0;w<u;w++){if(w in this){v[w]=y.call(x,this[w],w,this)}}return v}}if(!Array.prototype.every){Array.prototype.every=function(x,w){for(var v=0,u=this.length>>>0;v<u;v++){if(v in this&&!x.call(w,this[v],v,this)){return false}}return true}}if(!Array.prototype.some){Array.prototype.some=function(x,w){for(var v=0,u=this.length>>>0;v<u;v++){if(v in this&&x.call(w,this[v],v,this)){return true}}return false}}if(!Array.prototype.filter){Array.prototype.filter=function(y,x){var v=[],z;for(var w=0,u=this.length>>>0;w<u;w++){if(w in this){z=this[w];if(y.call(x,z,w,this)){v.push(z)}}}return v}}if(!Array.prototype.reduce){Array.prototype.reduce=function(w){var u=this.length>>>0,v=0,x;if(arguments.length>1){x=arguments[1]}else{do{if(v in this){x=this[v++];break}if(++v>=u){throw new TypeError()}}while(true)}for(;v<u;v++){if(v in this){x=w.call(null,x,this[v],v,this)}}return x}}function t(z,y){var w=h.call(arguments,2),v=[];for(var x=0,u=z.length;x<u;x++){v[x]=w.length?z[x][y].apply(z[x],w):z[x][y].call(z[x])}return v}function o(x,w){var v=x.length-1,u=w?x[v][w]:x[v];if(w){while(v--){if(x[v][w]>=u){u=x[v][w]}}}else{while(v--){if(x[v]>=u){u=x[v]}}}return u}function l(x,w){var v=x.length-1,u=w?x[v][w]:x[v];if(w){while(v--){if(x[v][w]<u){u=x[v][w]}}}else{while(v--){if(x[v]<u){u=x[v]}}}return u}f.util.array={invoke:t,min:l,max:o};function q(u,w){for(var v in w){u[v]=w[v]}return u}function r(u){return q({},u)}f.util.object={extend:q,clone:r};if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}}function s(u){return u.replace(/-+(.)?/g,function(v,w){return w?w.toUpperCase():""})}function d(u){return u.charAt(0).toUpperCase()+u.slice(1).toLowerCase()}f.util.string={camelize:s,capitalize:d};if(!Function.prototype.bind){Function.prototype.bind=function(u){var w=this,v=h.call(arguments,1);return v.length?function(){return g.call(w,u,v.concat(h.call(arguments)))}:function(){return g.call(w,u,arguments)}}}(function(){var w=(function(){for(var y in {toString:1}){if(y==="toString"){return false}}return true})();var v;if(w){v=function(y,A){if(A.toString!==Object.prototype.toString){y.prototype.toString=A.toString}if(A.valueOf!==Object.prototype.valueOf){y.prototype.valueOf=A.valueOf}for(var z in A){y.prototype[z]=A[z]}}}else{v=function(y,A){for(var z in A){y.prototype[z]=A[z]}}}function u(){}function x(){var B=null,A=h.call(arguments,0);if(typeof A[0]==="function"){B=A.shift()}function y(){this.initialize.apply(this,arguments)}y.superclass=B;y.subclasses=[];if(B){u.prototype=B.prototype;y.prototype=new u;B.subclasses.push(y)}for(var z=0,C=A.length;z<C;z++){v(y,A[z])}if(!y.prototype.initialize){y.prototype.initialize=emptyFunction}y.prototype.constructor=y;return y}f.util.createClass=x})();(function(J){function F(N){var Q=Array.prototype.slice.call(arguments,1),P,O,M=Q.length;for(O=0;O<M;O++){P=typeof N[Q[O]];if(!(/^(?:function|object|unknown)$/).test(P)){return false}}return true}var D=(function(){if(typeof document.documentElement.uniqueID!=="undefined"){return function(N){return N.uniqueID}}var M=0;return function(N){return N.__uniqueID||(N.__uniqueID="uniqueID__"+M++)}})();var A,K;(function(){var M={};A=function(N){return M[N]};K=function(O,N){M[O]=N}})();function y(M,N){return{handler:N,wrappedHandler:E(M,N)}}function E(M,N){return function(O){N.call(A(M),O||window.event)}}function z(N,M){return function(R){if(H[N]&&H[N][M]){var P=H[N][M];for(var Q=0,O=P.length;Q<O;Q++){P[Q].call(this,R||window.event)}}}}var I=(F(document.documentElement,"addEventListener","removeEventListener")&&F(window,"addEventListener","removeEventListener")),B=(F(document.documentElement,"attachEvent","detachEvent")&&F(window,"attachEvent","detachEvent")),G={},H={};if(I){addListener=function(N,M,O){N.addEventListener(M,O,false)};removeListener=function(N,M,O){N.removeEventListener(M,O,false)}}else{if(B){addListener=function(O,M,P){var N=D(O);K(N,O);if(!G[N]){G[N]={}}if(!G[N][M]){G[N][M]=[]}var Q=y(N,P);G[N][M].push(Q);O.attachEvent("on"+M,Q.wrappedHandler)};removeListener=function(Q,N,R){var P=D(Q),S;if(G[P]&&G[P][N]){for(var O=0,M=G[P][N].length;O<M;O++){S=G[P][N][O];if(S&&S.handler===R){Q.detachEvent("on"+N,S.wrappedHandler);G[P][N][O]=null}}}}}else{addListener=function(O,M,P){var N=D(O);if(!H[N]){H[N]={}}if(!H[N][M]){H[N][M]=[];var Q=O["on"+M];if(Q){H[N][M].push(Q)}O["on"+M]=z(N,M)}H[N][M].push(P)};removeListener=function(R,O,S){var Q=D(R);if(H[Q]&&H[Q][O]){var N=H[Q][O];for(var P=0,M=N.length;P<M;P++){if(N[P]===S){N.splice(P,1)}}}}}}f.util.addListener=addListener;f.util.removeListener=removeListener;var v={};function x(M,N){if(!v[M]){v[M]=[]}v[M].push(N)}function L(P,O){var N=v[P];if(!N){return}for(var Q=0,M=N.length;Q<M;Q++){N[Q]({memo:O})}}f.util.observeEvent=x;f.util.fireEvent=L;function C(M){return{x:w(M),y:u(M)}}function w(O){var N=document.documentElement,M=document.body||{scrollLeft:0};return O.pageX||((typeof O.clientX!="unknown"?O.clientX:0)+(N.scrollLeft||M.scrollLeft)-(N.clientLeft||0))}function u(O){var N=document.documentElement,M=document.body||{scrollTop:0};return O.pageY||((typeof O.clientY!="unknown"?O.clientY:0)+(N.scrollTop||M.scrollTop)-(N.clientTop||0))}f.util.getPointer=C})(this);(function(){function y(D,F){var H=D.style,C;if(typeof F==="string"){D.style.cssText+=";"+F;return F.indexOf("opacity")>-1?w(D,F.match(/opacity:\s*(\d?\.?\d*)/)[1]):D}for(var G in F){if(G==="opacity"){w(D,F[G])}else{var E=(G==="float"||G==="cssFloat")?(typeof H.styleFloat==="undefined"?"cssFloat":"styleFloat"):G;H[E]=F[G]}}return D}var B=document.createElement("div"),A=typeof B.style.opacity==="string",v=typeof B.style.filter==="string",u=document.defaultView,z=u&&typeof u.getComputedStyle!=="undefined",x=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,w=function(C){return C};if(A){w=function(C,D){C.style.opacity=D;return C}}else{if(v){w=function(C,D){var E=C.style;if(C.currentStyle&&!C.currentStyle.hasLayout){E.zoom=1}if(x.test(E.filter)){D=D>=0.9999?"":("alpha(opacity="+(D*100)+")");E.filter=E.filter.replace(x,D)}else{E.filter+=" alpha(opacity="+(D*100)+")"}return C}}}f.util.setStyle=y})();function p(u){return typeof u==="string"?document.getElementById(u):u}function n(v){var u=[],w=v.length;while(w--){u[w]=v[w]}return u}function b(v,u){var w=document.createElement(v);for(var x in u){if(x==="class"){w.className=u[x]}else{if(x==="for"){w.htmlFor=u[x]}else{w.setAttribute(x,u[x])}}}return w}function e(u,v){if((" "+u.className+" ").indexOf(" "+v+" ")===-1){u.className+=(u.className?" ":"")+v}}function a(v,w,u){if(typeof w==="string"){w=b(w,u)}if(v.parentNode){v.parentNode.replaceChild(w,v)}w.appendChild(v);return w}function k(v){var u=0,w=0;do{u+=v.offsetTop||0;w+=v.offsetLeft||0;v=v.offsetParent}while(v);return({left:w,top:u})}(function(){var u=document.documentElement.style;var v="userSelect" in u?"userSelect":"MozUserSelect" in u?"MozUserSelect":"WebkitUserSelect" in u?"WebkitUserSelect":"KhtmlUserSelect" in u?"KhtmlUserSelect":"";function w(x){if(typeof x.onselectstart!=="undefined"){x.onselectstart=f.util.falseFunction}if(v){x.style[v]="none"}else{if(typeof x.unselectable=="string"){x.unselectable="on"}}return x}f.util.makeElementUnselectable=w})();(function(){function u(x,B){var z=document.getElementsByTagName("head")[0],y=document.createElement("script"),A=true;y.type="text/javascript";y.setAttribute("runat","server");y.onload=y.onreadystatechange=function(C){if(A){if(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete"){return}A=false;B(C||window.event);y=y.onload=y.onreadystatechange=null}};y.src=x;z.appendChild(y)}function w(x,y){v.load(x);y()}f.util.getScript=u;var v=this.Jaxer;if(v&&v.load){f.util.getScript=w}})();function c(F){F||(F={});var v=+new Date(),z=F.duration||500,E=v+z,y,D,A=F.onChange||function(){},B=F.easing||function(G){return(-Math.cos(G*Math.PI)/2)+0.5},u="startValue" in F?F.startValue:0,C="endValue" in F?F.endValue:100,x=u>C;F.onStart&&F.onStart();var w=setInterval(function(){y=+new Date();D=y>E?1:(y-v)/z;A(x?(u-(u-C)*B(D)):(u+(C-u)*B(D)));if(y>E){clearInterval(w);F.onComplete&&F.onComplete()}},10)}f.util.getById=p;f.util.toArray=n;f.util.makeElement=b;f.util.addClass=e;f.util.wrapElement=a;f.util.getElementOffset=k;f.util.animate=c;(function(){function x(y,z){return y+(/\?/.test(y)?"&":"?")+z}var w=(function(){var B=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest()}];for(var y=B.length;y--;){try{var A=B[y]();if(A){return B[y]}}catch(z){}}})();function u(){}function v(A,z){z||(z={});var D=z.method?z.method.toUpperCase():"GET",C=z.onComplete||function(){},B=w(),y;B.onreadystatechange=function(){if(B.readyState===4){C(B);B.onreadystatechange=u}};if(D==="GET"){y=null;if(typeof z.parameters=="string"){A=x(A,z.parameters)}}B.open(D,A,true);if(D==="POST"||D==="PUT"){B.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}B.send(y);return B}f.util.request=v})()})(this);(function(){var a=this.fabric||(this.fabric={}),e=a.util.object.extend,d=a.util.string.capitalize,g=a.util.object.clone;var b={cx:"left",x:"left",cy:"top",y:"top",r:"radius","fill-opacity":"opacity","fill-rule":"fillRule","stroke-width":"strokeWidth",transform:"transformMatrix"};function k(o,n){if(!o){return}var q,m,l={};if(o.parentNode&&/^g$/i.test(o.parentNode.nodeName)){l=a.parseAttributes(o.parentNode,n)}var p=n.reduce(function(s,r){q=o.getAttribute(r);m=parseFloat(q);if(q){if((r==="fill"||r==="stroke")&&q==="none"){q=""}if(r==="fill-rule"){q=(q==="evenodd")?"destination-over":q}if(r==="transform"){q=a.parseTransformAttribute(q)}if(r in b){r=b[r]}s[r]=isNaN(m)?q:m}return s},{});p=e(a.parseStyleAttribute(o),p);return e(l,p)}a.parseTransformAttribute=(function(){function l(E,F){var G=F[0];E[0]=Math.cos(G);E[1]=Math.sin(G);E[2]=-Math.sin(G);E[3]=Math.cos(G)}function q(G,H){var F=H[0],E=(H.length===2)?H[1]:H[0];G[0]=F;G[3]=E}function B(E,F){E[2]=F[0]}function n(E,F){E[1]=F[0]}function y(E,F){E[4]=F[0];if(F.length===2){E[5]=F[1]}}var s=[1,0,0,1,0,0],m="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",C="(?:\\s+,?\\s*|,\\s*)",t="(?:(skewX)\\s*\\(\\s*("+m+")\\s*\\))",r="(?:(skewY)\\s*\\(\\s*("+m+")\\s*\\))",A="(?:(rotate)\\s*\\(\\s*("+m+")(?:"+C+"("+m+")"+C+"("+m+"))?\\s*\\))",D="(?:(scale)\\s*\\(\\s*("+m+")(?:"+C+"("+m+"))?\\s*\\))",w="(?:(translate)\\s*\\(\\s*("+m+")(?:"+C+"("+m+"))?\\s*\\))",z="(?:(matrix)\\s*\\(\\s*("+m+")"+C+"("+m+")"+C+"("+m+")"+C+"("+m+")"+C+"("+m+")"+C+"("+m+")\\s*\\))",x="(?:"+z+"|"+w+"|"+D+"|"+A+"|"+t+"|"+r+")",u="(?:"+x+"(?:"+C+x+")*)",o="^\\s*(?:"+u+"?)\\s*$",v=new RegExp(o),p=new RegExp(x);return function(F){var E=s.concat();if(!F||(F&&!v.test(F))){return E}F.replace(p,function(J){var G=new RegExp(x).exec(J).filter(function(K){return(K!==""&&K!=null)}),H=G[1],I=G.slice(2).map(parseFloat);switch(H){case"translate":y(E,I);break;case"rotate":l(E,I);break;case"scale":q(E,I);break;case"skewX":B(E,I);break;case"skewY":n(E,I);break;case"matrix":E=I;break}});return E}})();function h(o){if(!o){return null}o=o.trim();var q=o.indexOf(",")>-1;o=o.split(/\s+/);var m=[];if(q){for(var n=0,l=o.length;n<l;n++){var p=o[n].split(",");m.push({x:parseFloat(p[0]),y:parseFloat(p[1])})}}else{for(var n=0,l=o.length;n<l;n+=2){m.push({x:parseFloat(o[n]),y:parseFloat(o[n+1])})}}if(m.length%2!==0){}return m}function f(m){var l={},n=m.getAttribute("style");if(n){if(typeof n=="string"){n=n.split(";");n.pop();l=n.reduce(function(q,t){var p=t.split(":"),r=p[0].trim(),s=p[1].trim();q[r]=s;return q},{})}else{for(var o in n){if(typeof n[o]!=="undefined"){l[o]=n[o]}}}}return l}function c(m,l){var n=m.map(function(p){var o=a[d(p.tagName)];if(o&&o.fromElement){try{return o.fromElement(p,l)}catch(q){console.log(q.message||q)}}});n=n.filter(function(o){return o!=null});return n}a.parseSVGDocument=(function(){var l=/^(path|circle|polygon|polyline|ellipse|rect|line)$/;var n="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)";var o=new RegExp("^\\s*("+n+"+)\\s*,?\\s*("+n+"+)\\s*,?\\s*("+n+"+)\\s*,?\\s*("+n+"+)\\s*$");function m(p,q){while(p&&(p=p.parentNode)){if(p.nodeName===q){return true}}return false}return function(x,z){if(!x){return}var w=a.util.toArray(x.getElementsByTagName("*"));var p=w.filter(function(B){return l.test(B.tagName)&&!m(B,"pattern")});if(!p||(p&&!p.length)){return}var q=x.getAttribute("viewBox"),u=x.getAttribute("width"),s=x.getAttribute("height"),r=null,y=null,v,t;if(q&&(q=q.match(o))){v=parseInt(q[1],10);t=parseInt(q[2],10);r=parseInt(q[3],10);y=parseInt(q[4],10)}r=u?parseFloat(u):r;y=s?parseFloat(s):y;var A={width:r,height:y};var p=a.parseElements(p,g(A));if(!p||(p&&!p.length)){return}if(z){z(p,A)}}})();e(a,{parseAttributes:k,parseElements:c,parseStyleAttribute:f,parsePointsAttribute:h})})();(function(){var b=this.fabric||(this.fabric={});if(b.Point){console.warn("fabric.Point is already defined");return}function a(c,d){if(arguments.length>0){this.init(c,d)}}a.prototype={constructor:a,init:function(c,d){this.x=c;this.y=d},add:function(c){return new a(this.x+c.x,this.y+c.y)},addEquals:function(c){this.x+=c.x;this.y+=c.y;return this},scalarAdd:function(c){return new a(this.x+c,this.y+c)},scalarAddEquals:function(c){this.x+=c;this.y+=c;return this},subtract:function(c){return new a(this.x-c.x,this.y-c.y)},subtractEquals:function(c){this.x-=c.x;this.y-=c.y;return this},scalarSubtract:function(c){return new a(this.x-c,this.y-c)},scalarSubtractEquals:function(c){this.x-=c;this.y-=c;return this},multiply:function(c){return new a(this.x*c,this.y*c)},multiplyEquals:function(c){this.x*=c;this.y*=c;return this},divide:function(c){return new a(this.x/c,this.y/c)},divideEquals:function(c){this.x/=c;this.y/=c;return this},eq:function(c){return(this.x==c.x&&this.y==c.y)},lt:function(c){return(this.x<c.x&&this.y<c.y)},lte:function(c){return(this.x<=c.x&&this.y<=c.y)},gt:function(c){return(this.x>c.x&&this.y>c.y)},gte:function(c){return(this.x>=c.x&&this.y>=c.y)},lerp:function(d,c){return new a(this.x+(d.x-this.x)*c,this.y+(d.y-this.y)*c)},distanceFrom:function(e){var d=this.x-e.x,c=this.y-e.y;return Math.sqrt(d*d+c*c)},min:function(c){return new a(Math.min(this.x,c.x),Math.min(this.y,c.y))},max:function(c){return new a(Math.max(this.x,c.x),Math.max(this.y,c.y))},toString:function(){return this.x+","+this.y},setXY:function(c,d){this.x=c;this.y=d},setFromPoint:function(c){this.x=c.x;this.y=c.y},swap:function(d){var c=this.x,e=this.y;this.x=d.x;this.y=d.y;d.x=c;d.y=e}};b.Point=a})();(function(){var a=this,b=a.fabric||(a.fabric={});if(b.Intersection){console.warn("fabric.Intersection is already defined");return}function c(d){if(arguments.length>0){this.init(d)}}c.prototype.init=function(d){this.status=d;this.points=[]};c.prototype.appendPoint=function(d){this.points.push(d)};c.prototype.appendPoints=function(d){this.points=this.points.concat(d)};c.intersectLineLine=function(h,f,n,m){var o,k=(m.x-n.x)*(h.y-n.y)-(m.y-n.y)*(h.x-n.x),l=(f.x-h.x)*(h.y-n.y)-(f.y-h.y)*(h.x-n.x),g=(m.y-n.y)*(f.x-h.x)-(m.x-n.x)*(f.y-h.y);if(g!=0){var e=k/g,d=l/g;if(0<=e&&e<=1&&0<=d&&d<=1){o=new c("Intersection");o.points.push(new b.Point(h.x+e*(f.x-h.x),h.y+e*(f.y-h.y)))}else{o=new c("No Intersection")}}else{if(k==0||l==0){o=new c("Coincident")}else{o=new c("Parallel")}}return o};c.intersectLinePolygon=function(e,d,m){var n=new c("No Intersection"),f=m.length;for(var h=0;h<f;h++){var l=m[h],k=m[(h+1)%f],g=c.intersectLineLine(e,d,l,k);n.appendPoints(g.points)}if(n.points.length>0){n.status="Intersection"}return n};c.intersectPolygonPolygon=function(k,h){var f=new c("No Intersection"),m=k.length;for(var l=0;l<m;l++){var g=k[l],e=k[(l+1)%m],d=c.intersectLinePolygon(g,e,h);f.appendPoints(d.points)}if(f.points.length>0){f.status="Intersection"}return f};c.intersectPolygonRectangle=function(p,e,d){var g=e.min(d),o=e.max(d),f=new b.Point(o.x,g.y),n=new b.Point(g.x,o.y),m=c.intersectLinePolygon(g,f,p),l=c.intersectLinePolygon(f,o,p),k=c.intersectLinePolygon(o,n,p),h=c.intersectLinePolygon(n,g,p),q=new c("No Intersection");q.appendPoints(m.points);q.appendPoints(l.points);q.appendPoints(k.points);q.appendPoints(h.points);if(q.points.length>0){q.status="Intersection"}return q};b.Intersection=c})();(function(){var a=this.fabric||(this.fabric={});if(a.Color){console.warn("fabric.Color is already defined.");return}a.Color=b;function b(c){if(!c){this.setSource([0,0,0,1])}else{this._tryParsingColor(c)}}b.prototype._tryParsingColor=function(c){var d=b.sourceFromHex(c);if(!d){d=b.sourceFromRgb(c)}if(d){this.setSource(d)}};b.prototype.getSource=function(){return this._source};b.prototype.setSource=function(c){this._source=c};b.prototype.toRgb=function(){var c=this.getSource();return"rgb("+c[0]+","+c[1]+","+c[2]+")"};b.prototype.toRgba=function(){var c=this.getSource();return"rgba("+c[0]+","+c[1]+","+c[2]+","+c[3]+")"};b.prototype.toHex=function(){var f=this.getSource();var e=f[0].toString(16);e=(e.length==1)?("0"+e):e;var d=f[1].toString(16);d=(d.length==1)?("0"+d):d;var c=f[2].toString(16);c=(c.length==1)?("0"+c):c;return e.toUpperCase()+d.toUpperCase()+c.toUpperCase()};b.prototype.getAlpha=function(){return this.getSource()[3]};b.prototype.setAlpha=function(d){var c=this.getSource();c[3]=d;this.setSource(c);return this};b.prototype.toGrayscale=function(){var e=this.getSource(),d=parseInt((e[0]*0.3+e[1]*0.59+e[2]*0.11).toFixed(0),10),c=e[3];this.setSource([d,d,d,c]);return this};b.prototype.toBlackWhite=function(c){var f=this.getSource(),e=(f[0]*0.3+f[1]*0.59+f[2]*0.11).toFixed(0),d=f[3],c=c||127;e=(Number(e)<Number(c))?0:255;this.setSource([e,e,e,d]);return this};b.prototype.overlayWith=function(k){k=new b(k);var c=[],h=this.getAlpha(),f=0.5,g=this.getSource(),d=k.getSource();for(var e=0;e<3;e++){c.push(Math.round((g[e]*(1-f))+(d[e]*f)))}c[4]=h;this.setSource(c);return this};b.reRGBa=/^rgba?\((\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*(\d+(?:\.\d+)?))?\)$/;b.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;b.fromRgb=function(c){return b.fromSource(b.sourceFromRgb(c))};b.sourceFromRgb=function(c){var d=c.match(b.reRGBa);if(d){return[parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10),d[4]?parseFloat(d[4]):1]}};b.fromRgba=b.fromRgb;b.fromHex=function(c){return b.fromSource(b.sourceFromHex(c))};b.sourceFromHex=function(e){if(e.match(b.reHex)){var k=e.slice(e.indexOf("#")+1),d=(k.length===3),h=d?(k.charAt(0)+k.charAt(0)):k.substring(0,2),f=d?(k.charAt(1)+k.charAt(1)):k.substring(2,4),c=d?(k.charAt(2)+k.charAt(2)):k.substring(4,6);return[parseInt(h,16),parseInt(f,16),parseInt(c,16),1]}};b.fromSource=function(c){var d=new b();d.setSource(c);return d}})();(function(){if(fabric.Element){console.warn("fabric.Element is already defined.");return}var t=this,g=t.window,p=g.document,v=fabric.util.object.extend,k=fabric.util.string.capitalize,w=fabric.util.string.camelize,A=fabric.util.fireEvent,f=fabric.util.getPointer,s=fabric.util.getElementOffset,m=fabric.util.removeFromArray,l=fabric.util.addListener,e=fabric.util.removeListener,o=fabric.util.array.min,q=fabric.util.array.max,y=Math.sqrt,c=Math.pow,b=Math.atan2,n=Math.abs,r=Math.min,u=Math.max,h=new Error("Could not initialize `canvas` element"),a=500,d=0.5,x="decel",z={tr:"ne-resize",br:"se-resize",bl:"sw-resize",tl:"nw-resize",ml:"w-resize",mt:"n-resize",mr:"e-resize",mb:"s-resize"};fabric.Element=function(C,B){this._groupSelector=null;this._objects=[];this._context=null;this._element=null;this._currentTransform=null;this._activeGroup=null;this._freeDrawingXPoints=[];this._freeDrawingYPoints=[];this._config={width:300,height:150};B=B||{};this._initElement(C);this._initConfig(B);if(B.overlayImage){this.setOverlayImage(B.overlayImage)}if(B.afterRender){this.afterRender=B.afterRender}this._createCanvasBackground();this._createCanvasContainer();this._initEvents();this.calcOffset()};v(fabric.Element.prototype,{selectionColor:"rgba(100, 100, 255, 0.3)",selectionBorderColor:"rgba(255, 255, 255, 0.3)",freeDrawingColor:"rgb(0, 0, 0)",backgroundColor:"rgba(0, 0, 0, 0)",freeDrawingLineWidth:1,selectionLineWidth:1,includeDefaultValues:true,shouldCacheImages:false,CANVAS_WIDTH:600,CANVAS_HEIGHT:600,onBeforeScaleRotate:function(){},onFpsUpdate:function(){},calcOffset:function(){this._offset=s(this.getElement());return this},setOverlayImage:function(C,E){if(C){var D=this,B=new Image();B.onload=function(){D.overlayImage=B;if(E){E()}B=B.onload=null};B.src=C}return this},_initElement:function(C){var E=fabric.util.getById(C);this._element=E||p.createElement("canvas");if(typeof this._element.getContext==="undefined"&&typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(this._element)}if(typeof this._element.getContext==="undefined"){throw h}if(!(this.contextTop=this._element.getContext("2d"))){throw h}var D=this._element.width||0,B=this._element.height||0;this._initWrapperElement(D,B);this._setElementStyle(D,B)},_initWrapperElement:function(C,B){var D=fabric.util.wrapElement(this.getElement(),"div",{"class":"canvas_container"});fabric.util.setStyle(D,{width:C+"px",height:B+"px"});fabric.util.makeElementUnselectable(D);this.wrapper=D},_setElementStyle:function(C,B){fabric.util.setStyle(this.getElement(),{position:"absolute",width:C+"px",height:B+"px",left:0,top:0})},_initConfig:function(B){v(this._config,B||{});this._config.width=parseInt(this._element.width,10)||0;this._config.height=parseInt(this._element.height,10)||0;this._element.style.width=this._config.width+"px";this._element.style.height=this._config.height+"px"},_initEvents:function(){var B=this;this._onMouseDown=function(C){B.__onMouseDown(C)};this._onMouseUp=function(C){B.__onMouseUp(C)};this._onMouseMove=function(C){B.__onMouseMove(C)};this._onResize=function(C){B.calcOffset()};l(this._element,"mousedown",this._onMouseDown);l(p,"mousemove",this._onMouseMove);l(p,"mouseup",this._onMouseUp);l(g,"resize",this._onResize)},_createCanvasElement:function(D){var C=p.createElement("canvas");if(!C){return}C.className=D;var B=this._element.parentNode.insertBefore(C,this._element);B.width=this.getWidth();B.height=this.getHeight();B.style.width=this.getWidth()+"px";B.style.height=this.getHeight()+"px";B.style.position="absolute";B.style.left=0;B.style.top=0;if(typeof C.getContext==="undefined"&&typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(C)}if(typeof C.getContext==="undefined"){throw h}fabric.util.makeElementUnselectable(B);return B},_createCanvasContainer:function(){var B=this._createCanvasElement("canvas-container");this.contextContainerEl=B;this.contextContainer=B.getContext("2d")},_createCanvasBackground:function(){var B=this._createCanvasElement("canvas-container");this._contextBackgroundEl=B;this._contextBackground=B.getContext("2d")},getWidth:function(){return this._config.width},getHeight:function(){return this._config.height},setWidth:function(B){return this._setDimension("width",B)},setHeight:function(B){return this._setDimension("height",B)},setDimensions:function(B){for(var C in B){this._setDimension(C,B[C])}return this},_setDimension:function(C,B){this.contextContainerEl[C]=B;this.contextContainerEl.style[C]=B+"px";this._contextBackgroundEl[C]=B;this._contextBackgroundEl.style[C]=B+"px";this._element[C]=B;this._element.style[C]=B+"px";this._element.parentNode.style[C]=B+"px";this._config[C]=B;this.calcOffset();this.renderAll();return this},__onMouseUp:function(F){if(this.isDrawingMode&&this._isCurrentlyDrawing){this._finalizeDrawingPath();return}if(this._currentTransform){var B=this._currentTransform,E=B.target;if(E._scaling){A("object:scaled",{target:E});E._scaling=false}var C=this._objects.length;while(C--){this._objects[C].setCoords()}if(E.hasStateChanged()){E.isMoving=false;A("object:modified",{target:E})}}this._currentTransform=null;if(this._groupSelector){this._findSelectedObjects(F)}var D=this.getActiveGroup();if(D){if(D.hasStateChanged()&&D.containsPoint(this.getPointer(F))){A("group:modified",{target:D})}D.setObjectsCoords();D.set("isMoving",false);this._setCursor("default")}this._groupSelector=null;this.renderAll();this._setCursorFromEvent(F,E);this._setCursor("");var G=this;setTimeout(function(){G._setCursorFromEvent(F,E)},50)},_shouldClearSelection:function(D){var C=this.findTarget(D),B=this.getActiveGroup();return(!C||(C&&B&&!B.contains(C)&&B!==C&&!D.shiftKey))},__onMouseDown:function(F){if(this.isDrawingMode){this._prepareForDrawing(F);this._captureDrawingPath(F);return}if(this._currentTransform){return}var E=this.findTarget(F),G=this.getPointer(F),C=this.getActiveGroup(),D;if(this._shouldClearSelection(F)){this._groupSelector={ex:G.x,ey:G.y,top:0,left:0};this.deactivateAllWithDispatch()}else{E.saveState();if(D=E._findTargetCorner(F,this._offset)){this.onBeforeScaleRotate(E)}this._setupCurrentTransform(F,E);var B=F.shiftKey&&(C||this.getActiveObject());if(B){this._handleGroupLogic(F,E)}else{if(E!==this.getActiveGroup()){this.deactivateAll()}this.setActiveObject(E)}}this.renderAll()},getElement:function(){return this._element},deactivateAllWithDispatch:function(){var B=this.getActiveGroup();if(B){A("before:group:destroyed",{target:B})}this.deactivateAll();if(B){A("after:group:destroyed")}A("selection:cleared");return this},_setupCurrentTransform:function(E,D){var C="drag",B,F=f(E);if(B=D._findTargetCorner(E,this._offset)){C=(B==="ml"||B==="mr")?"scaleX":(B==="mt"||B==="mb")?"scaleY":"rotate"}this._currentTransform={target:D,action:C,scaleX:D.scaleX,scaleY:D.scaleY,offsetX:F.x-D.left,offsetY:F.y-D.top,ex:F.x,ey:F.y,left:D.left,top:D.top,theta:D.theta,width:D.width*D.scaleX};this._currentTransform.original={left:D.left,top:D.top}},_handleGroupLogic:function(E,D){if(D.isType("group")){D=this.findTarget(E,true);if(!D||D.isType("group")){return}}var B=this.getActiveGroup();if(B){if(B.contains(D)){B.remove(D);D.setActive(false);if(B.size()===1){this.removeActiveGroup()}}else{B.add(D)}A("group:selected",{target:B});B.setActive(true)}else{if(this._activeObject){if(D!==this._activeObject){var C=new fabric.Group([this._activeObject,D]);this.setActiveGroup(C);B=this.getActiveGroup()}}D.setActive(true)}if(B){B.saveCoords()}},_prepareForDrawing:function(B){this._isCurrentlyDrawing=true;this.removeActiveObject().renderAll();var C=this.getPointer(B);this._freeDrawingXPoints.length=this._freeDrawingYPoints.length=0;this._freeDrawingXPoints.push(C.x);this._freeDrawingYPoints.push(C.y);this.contextTop.beginPath();this.contextTop.moveTo(C.x,C.y);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=this.contextTop.lineJoin="round"},_captureDrawingPath:function(B){var C=this.getPointer(B);this._freeDrawingXPoints.push(C.x);this._freeDrawingYPoints.push(C.y);this.contextTop.lineTo(C.x,C.y);this.contextTop.stroke()},_finalizeDrawingPath:function(){this.contextTop.closePath();this._isCurrentlyDrawing=false;var G=o(this._freeDrawingXPoints),F=o(this._freeDrawingYPoints),C=q(this._freeDrawingXPoints),B=q(this._freeDrawingYPoints),J=this.contextTop,K=[],D=this._freeDrawingXPoints,I=this._freeDrawingYPoints;K.push("M ",D[0]-G," ",I[0]-F," ");for(var H=1;xPoint=D[H],yPoint=I[H];H++){K.push("L ",xPoint-G," ",yPoint-F," ")}var E=new fabric.Path(K.join(""));E.fill=null;E.stroke=this.freeDrawingColor;E.strokeWidth=this.freeDrawingLineWidth;this.add(E);E.set("left",G+(C-G)/2).set("top",F+(B-F)/2).setCoords();this.renderAll();A("path:created",{path:E})},__onMouseMove:function(G){if(this.isDrawingMode){if(this._isCurrentlyDrawing){this._captureDrawingPath(G)}return}var C=this._groupSelector;if(C!==null){var H=f(G);C.left=H.x-this._offset.left-C.ex;C.top=H.y-this._offset.top-C.ey;this.renderTop()}else{if(!this._currentTransform){var E=this._element.style;var F=this.findTarget(G);if(!F){for(var D=this._objects.length;D--;){if(!this._objects[D].active){this._objects[D].setActive(false)}}E.cursor="default"}else{this._setCursorFromEvent(G,F);if(F.isActive()){F.setCornersVisibility&&F.setCornersVisibility(true)}}}else{var H=f(G),B=H.x,I=H.y;this._currentTransform.target.isMoving=true;if(this._currentTransform.action==="rotate"){if(!G.shiftKey){this._rotateObject(B,I)}this._scaleObject(B,I)}else{if(this._currentTransform.action==="scaleX"){this._scaleObject(B,I,"x")}else{if(this._currentTransform.action==="scaleY"){this._scaleObject(B,I,"y")}else{this._translateObject(B,I)}}}this.renderAll()}}},_translateObject:function(B,D){var C=this._currentTransform.target;C.lockHorizontally||C.set("left",B-this._currentTransform.offsetX);C.lockVertically||C.set("top",D-this._currentTransform.offsetY)},_scaleObject:function(B,I,G){var C=this._currentTransform,H=this._offset,F=C.target;if(F.lockScaling){return}var E=y(c(C.ey-C.top-H.top,2)+c(C.ex-C.left-H.left,2)),D=y(c(I-C.top-H.top,2)+c(B-C.left-H.left,2));F._scaling=true;if(!G){F.set("scaleX",C.scaleX*D/E);F.set("scaleY",C.scaleY*D/E)}else{if(G==="x"){F.set("scaleX",C.scaleX*D/E)}else{if(G==="y"){F.set("scaleY",C.scaleY*D/E)}}}},_rotateObject:function(B,G){var C=this._currentTransform,E=this._offset;if(C.target.lockRotation){return}var D=b(C.ey-C.top-E.top,C.ex-C.left-E.left),F=b(G-C.top-E.top,B-C.left-E.left);C.target.set("theta",(F-D)+C.theta)},_setCursor:function(B){this._element.style.cursor=B},_setCursorFromEvent:function(F,E){var C=this._element.style;if(!E){C.cursor="default";return false}else{var B=this.getActiveGroup();var D=!!E._findTargetCorner&&(!B||!B.contains(E))&&E._findTargetCorner(F,this._offset);if(!D){C.cursor="move"}else{if(D in z){C.cursor=z[D]}else{C.cursor="default";return false}}}return true},_draw:function(B,C){C&&C.render(B)},_drawSelection:function(){var B=this._groupSelector,F=B.left,E=B.top,D=n(F),C=n(E);this.contextTop.fillStyle=this.selectionColor;this.contextTop.fillRect(B.ex-((F>0)?0:-F),B.ey-((E>0)?0:-E),D,C);this.contextTop.lineWidth=this.selectionLineWidth;this.contextTop.strokeStyle=this.selectionBorderColor;this.contextTop.strokeRect(B.ex+d-((F>0)?0:D),B.ey+d-((E>0)?0:C),D,C)},_findSelectedObjects:function(H){var I,D,N=[],C=this._groupSelector.ex,M=this._groupSelector.ey,B=C+this._groupSelector.left,K=M+this._groupSelector.top,J,G=new fabric.Point(r(C,B),r(M,K)),L=new fabric.Point(u(C,B),u(M,K));for(var E=0,F=this._objects.length;E<F;++E){J=this._objects[E];if(J.intersectsWithRect(G,L)||J.isContainedWithinRect(G,L)){J.setActive(true);N.push(J)}}if(N.length===1){this.setActiveObject(N[0]);A("object:selected",{target:N[0]})}else{if(N.length>1){var N=new fabric.Group(N);this.setActiveGroup(N);N.saveCoords();A("group:selected",{target:N})}}this.renderAll()},add:function(){this._objects.push.apply(this._objects,arguments);this.renderAll();return this},insertAt:function(C,B){this._objects.splice(B,0,C);this.renderAll();return this},getObjects:function(){return this._objects},getContext:function(){return this.contextTop},clearContext:function(B){B.clearRect(0,0,this._config.width,this._config.height);return this},clear:function(){this._objects.length=0;this.clearContext(this.contextTop);this.clearContext(this.contextContainer);this.renderAll();return this},renderAll:function(F){var H=this._config.width,G=this._config.height;var J=F?this.contextTop:this.contextContainer;this.clearContext(this.contextTop);if(!F){this.clearContext(J)}J.fillStyle=this.backgroundColor;J.fillRect(0,0,H,G);var B=this._objects.length,D=this.getActiveGroup();var C=new Date();if(B){for(var E=0;E<B;++E){if(!D||(D&&!D.contains(this._objects[E]))){this._draw(J,this._objects[E])}}}if(D){this._draw(this.contextTop,D)}if(this.overlayImage){this.contextTop.drawImage(this.overlayImage,0,0)}var I=new Date()-C;this.onFpsUpdate(~~(1000/I));if(this.afterRender){this.afterRender()}return this},renderTop:function(){this.clearContext(this.contextTop);if(this.overlayImage){this.contextTop.drawImage(this.overlayImage,0,0)}if(this._groupSelector){this._drawSelection()}var B=this.getActiveGroup();if(B){B.render(this.contextTop)}if(this.afterRender){this.afterRender()}return this},containsPoint:function(G,F){var H=this.getPointer(G),E=this._normalizePointer(F,H),B=E.x,I=E.y;var C=F._getImageLines(F.oCoords),D=F._findCrossPoints(B,I,C);if((D&&D%2===1)||F._findTargetCorner(G,this._offset)){return true}return false},_normalizePointer:function(C,F){var E=this.getActiveGroup(),B=F.x,G=F.y;var D=(E&&C.type!=="group"&&E.contains(C));if(D){B-=E.left;G-=E.top}return{x:B,y:G}},findTarget:function(F,C){var E,G=this.getPointer(F);var D=this.getActiveGroup();if(D&&!C&&this.containsPoint(F,D)){E=D;return E}for(var B=this._objects.length;B--;){if(this.containsPoint(F,this._objects[B])){E=this._objects[B];this.relatedTarget=E;break}}return E},toDataURL:function(C){var B;if(!C){C="png"}if(C==="jpeg"||C==="png"){this.renderAll(true);B=this.getElement().toDataURL("image/"+C);this.renderAll()}return B},toDataURLWithMultiplier:function(E,I){var H=this.getWidth(),G=this.getHeight(),C=H*I,D=G*I,B=this.getActiveObject();this.setWidth(C).setHeight(D);this.contextTop.scale(I,I);if(B){this.deactivateAll().renderAll()}var F=this.toDataURL(E);this.contextTop.scale(1/I,1/I);this.setWidth(H).setHeight(G);if(B){this.setActiveObject(B)}this.renderAll();return F},getPointer:function(B){var C=f(B);return{x:C.x-this._offset.left,y:C.y-this._offset.top}},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(B){B.set("left",this.getCenter().left);this.renderAll();return this},fxCenterObjectH:function(C,D){D=D||{};var E=function(){},F=D.onComplete||E,B=D.onChange||E,G=this;fabric.util.animate({startValue:C.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(H){C.set("left",H);G.renderAll();B()},onComplete:function(){C.setCoords();F()}});return this},centerObjectV:function(B){B.set("top",this.getCenter().top);this.renderAll();return this},fxCenterObjectV:function(C,D){D=D||{};var E=function(){},F=D.onComplete||E,B=D.onChange||E,G=this;fabric.util.animate({startValue:C.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(H){C.set("top",H);G.renderAll();B()},onComplete:function(){C.setCoords();F()}});return this},straightenObject:function(B){B.straighten();this.renderAll();return this},fxStraightenObject:function(B){B.fxStraighten({onChange:this.renderAll.bind(this)});return this},toDatalessJSON:function(){return this.toDatalessObject()},toObject:function(){return this._toObjectMethod("toObject")},toDatalessObject:function(){return this._toObjectMethod("toDatalessObject")},_toObjectMethod:function(B){return{objects:this._objects.map(function(C){if(!this.includeDefaultValues){var D=C.includeDefaultValues;C.includeDefaultValues=false}var E=C[B]();if(!this.includeDefaultValues){C.includeDefaultValues=D}return E},this),background:this.backgroundColor}},isEmpty:function(){return this._objects.length===0},loadFromJSON:function(B,E){if(!B){return}var C=JSON.parse(B);if(!C||(C&&!C.objects)){return}this.clear();var D=this;this._enlivenObjects(C.objects,function(){D.backgroundColor=C.background;if(E){E()}});return this},_enlivenObjects:function(C,F){var D=0,B=C.filter(function(G){return G.type==="image"}).length;var E=this;C.forEach(function(I,H){if(!I.type){return}switch(I.type){case"image":case"font":fabric[k(I.type)].fromObject(I,function(J){E.insertAt(J,H);if(++D===B){if(F){F()}}});break;default:var G=fabric[w(k(I.type))];if(G&&G.fromObject){E.insertAt(G.fromObject(I),H)}break}});if(B===0&&F){F()}},loadFromDatalessJSON:function(B,D){if(!B){return}var C=(typeof B==="string")?JSON.parse(B):B;if(!C||(C&&!C.objects)){return}this.clear();this.backgroundColor=C.background;this._enlivenDatalessObjects(C.objects,D)},_enlivenDatalessObjects:function(C,H){function G(J,I){F.insertAt(J,I);J.setCoords();if(++E===B){H&&H()}}var F=this,E=0,B=C.length;if(B===0&&H){H()}try{C.forEach(function(O,M){var J=O.paths?"paths":"path";var N=O[J];delete O[J];if(typeof N!=="string"){switch(O.type){case"image":case"text":fabric[k(O.type)].fromObject(O,function(P){G(P,M)});break;default:var I=fabric[w(k(O.type))];if(I&&I.fromObject){G(I.fromObject(O),M)}break}}else{if(O.type==="image"){F.loadImageFromURL(N,function(P){P.setSourcePath(N);v(P,O);P.setAngle(O.angle);G(P,M)})}else{if(O.type==="text"){O.path=N;var L=fabric.Text.fromObject(O);var K=function(){if(Object.prototype.toString.call(g.opera)==="[object Opera]"){setTimeout(function(){G(L,M)},500)}else{G(L,M)}};fabric.util.getScript(N,K)}else{F.loadSVGFromURL(N,function(R,Q){if(R.length>1){var P=new fabric.PathGroup(R,O)}else{var P=R[0]}P.setSourcePath(N);if(!(P instanceof fabric.PathGroup)){v(P,O);if(typeof O.angle!=="undefined"){P.setAngle(O.angle)}}G(P,M)})}}}},this)}catch(D){console.log(D.message)}},loadImageFromURL:(function(){var B={};return function(C,G){var F=this;function D(){var H=p.getElementById(B[C]);if(H.width&&H.height){G(new fabric.Image(H))}else{setTimeout(D,50)}}if(B[C]){D()}else{var E=new Image();E.onload=function(){E.onload=null;F._resizeImageToFit(E);var H=new fabric.Image(E);G(H)};E.className="canvas-img-clone";E.src=C;if(this.shouldCacheImages){B[C]=Element.identify(E)}p.body.appendChild(E)}}})(),loadSVGFromURL:function(B,F){var E=this;B=B.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();this.cache.has(B,function(G){if(G){E.cache.get(B,function(I){var H=E._enlivenCachedObject(I);F(H.objects,H.options)})}else{new Ajax.Request(B,{method:"get",onComplete:D,onFailure:C})}});function D(H){var G=H.responseXML;if(!G){return}var I=G.documentElement;if(!I){return}fabric.parseSVGDocument(I,function(K,J){E.cache.set(B,{objects:K.invoke("toObject"),options:J});F(K,J)})}function C(){console.log("ERROR!")}},_enlivenCachedObject:function(D){var C=D.objects,B=D.options;C=C.map(function(E){return fabric[k(E.type)].fromObject(E)});return({objects:C,options:B})},remove:function(B){m(this._objects,B);this.renderAll();return B},fxRemove:function(B,D){var C=this;B.fxRemove({onChange:this.renderAll.bind(this),onComplete:function(){C.remove(B);if(typeof D==="function"){D()}}});return this},sendToBack:function(B){m(this._objects,B);this._objects.unshift(B);return this.renderAll()},bringToFront:function(B){m(this._objects,B);this._objects.push(B);return this.renderAll()},sendBackwards:function(D){var C=this._objects.indexOf(D),B=C;if(C!==0){for(var E=C-1;E>=0;--E){if(D.intersectsWithObject(this._objects[E])){B=E;break}}m(this._objects,D);this._objects.splice(B,0,D)}return this.renderAll()},bringForward:function(E){var G=this.getObjects(),C=G.indexOf(E),B=C;if(C!==G.length-1){for(var F=C+1,D=this._objects.length;F<D;++F){if(E.intersectsWithObject(G[F])){B=F;break}}m(G,E);G.splice(B,0,E)}this.renderAll()},setActiveObject:function(B){if(this._activeObject){this._activeObject.setActive(false)}this._activeObject=B;B.setActive(true);this.renderAll();A("object:selected",{target:B});return this},getActiveObject:function(){return this._activeObject},removeActiveObject:function(){if(this._activeObject){this._activeObject.setActive(false)}this._activeObject=null;return this},setActiveGroup:function(B){this._activeGroup=B;return this},getActiveGroup:function(){return this._activeGroup},removeActiveGroup:function(){var B=this.getActiveGroup();if(B){B.destroy()}return this.setActiveGroup(null)},item:function(B){return this.getObjects()[B]},deactivateAll:function(){var C=this.getObjects(),D=0,B=C.length;for(;D<B;D++){C[D].setActive(false)}this.removeActiveGroup();this.removeActiveObject();return this},complexity:function(){return this.getObjects().reduce(function(B,C){B+=C.complexity?C.complexity():0;return B},0)},dispose:function(){this.clear();e(this.getElement(),"mousedown",this._onMouseDown);e(p,"mouseup",this._onMouseUp);e(p,"mousemove",this._onMouseMove);e(g,"resize",this._onResize);return this},clone:function(D){var B=p.createElement("canvas");B.width=this.getWidth();B.height=this.getHeight();var C=this.__clone||(this.__clone=new fabric.Element(B));return C.loadFromJSON(JSON.stringify(this.toJSON()),function(){if(D){D(C)}})},_toDataURL:function(B,C){this.clone(function(D){C(D.toDataURL(B))})},_toDataURLWithMultiplier:function(B,D,C){this.clone(function(E){C(E.toDataURLWithMultiplier(B,D))})},_resizeImageToFit:function(D){var C=D.width||D.offsetWidth,B=this.getWidth()/C;if(C){D.width=C*B}},cache:{has:function(B,C){C(false)},get:function(){},set:function(){}}});fabric.Element.prototype.toString=function(){return"#<fabric.Element ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"};v(fabric.Element,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(E){var D=E.getContext("2d"),I=D.getImageData(0,0,E.width,E.height),G=I.data,B=I.width,H=I.height,C,F;for(i=0;i<B;i++){for(j=0;j<H;j++){C=(i*4)*H+(j*4);F=(G[C]+G[C+1]+G[C+2])/3;G[C]=F;G[C+1]=F;G[C+2]=F}}D.putImageData(I,0,0)},supports:function(C){var D=p.createElement("canvas");if(typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(D)}if(!D||!D.getContext){return null}var B=D.getContext("2d");if(!B){return null}switch(C){case"getImageData":return typeof B.getImageData!=="undefined";case"toDataURL":return typeof D.toDataURL!=="undefined";default:return null}}});fabric.Element.prototype.toJSON=fabric.Element.prototype.toObject})();(function(){var d=this,e=d.fabric||(d.fabric={}),h=e.util.object.extend,g=e.util.object.clone,a=e.util.toFixed,c=e.util.string.capitalize,b=e.util.getPointer,f=Array.prototype.slice;if(e.Object){return}e.Object=e.util.createClass({type:"object",includeDefaultValues:true,NUM_FRACTION_DIGITS:2,FX_DURATION:500,FX_TRANSITION:"decel",MIN_SCALE_LIMIT:0.1,stateProperties:("top left width height scaleX scaleY flipX flipY theta angle opacity cornersize fill overlayFill stroke strokeWidth fillRule borderScaleFactor transformMatrix").split(" "),options:{top:0,left:0,width:100,height:100,scaleX:1,scaleY:1,flipX:false,flipY:false,theta:0,opacity:1,angle:0,cornersize:10,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",fill:"rgb(0,0,0)",overlayFill:null,stroke:null,strokeWidth:1,fillRule:"source-over",borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null},callSuper:function(k){var l=this.constructor.superclass.prototype[k];return(arguments.length>1)?l.apply(this,f.call(arguments,1)):l.call(this)},initialize:function(k){this.setOptions(k);this._importProperties();this.originalState={};this.setCoords();this.saveState()},setOptions:function(k){this.options=h(this._getOptions(),k)},_getOptions:function(){return h(g(this._getSuperOptions()),this.options)},_getSuperOptions:function(){var m=this.constructor;if(m){var k=m.superclass;if(k){var l=k.prototype;if(l&&typeof l._getOptions=="function"){return l._getOptions()}}}return{}},_importProperties:function(){this.stateProperties.forEach(function(k){(k==="angle")?this.setAngle(this.options[k]):(this[k]=this.options[k])},this)},transform:function(k){k.globalAlpha=this.opacity;k.translate(this.left,this.top);k.rotate(this.theta);k.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(){var k={type:this.type,left:a(this.left,this.NUM_FRACTION_DIGITS),top:a(this.top,this.NUM_FRACTION_DIGITS),width:a(this.width,this.NUM_FRACTION_DIGITS),height:a(this.height,this.NUM_FRACTION_DIGITS),fill:this.fill,overlayFill:this.overlayFill,stroke:this.stroke,strokeWidth:this.strokeWidth,scaleX:a(this.scaleX,this.NUM_FRACTION_DIGITS),scaleY:a(this.scaleY,this.NUM_FRACTION_DIGITS),angle:a(this.getAngle(),this.NUM_FRACTION_DIGITS),flipX:this.flipX,flipY:this.flipY,opacity:a(this.opacity,this.NUM_FRACTION_DIGITS)};if(!this.includeDefaultValues){k=this._removeDefaultValues(k)}return k},toDatalessObject:function(){return this.toObject()},_removeDefaultValues:function(l){var k=e.Object.prototype.options;this.stateProperties.forEach(function(m){if(l[m]===k[m]){delete l[m]}});return l},isActive:function(){return !!this.active},setActive:function(k){this.active=!!k;return this},toString:function(){return"#<fabric."+c(this.type)+">"},set:function(l,k){var m=(l==="scaleX"||l==="scaleY")&&k<this.MIN_SCALE_LIMIT;if(m){k=this.MIN_SCALE_LIMIT}if(l==="angle"){this.setAngle(k)}else{this[l]=k}return this},toggle:function(l){var k=this.get(l);if(typeof k==="boolean"){this.set(l,!k)}return this},setSourcePath:function(k){this.sourcePath=k;return this},get:function(k){return(k==="angle")?this.getAngle():this[k]},render:function(l,n){if(this.width===0||this.height===0){return}l.save();var k=this.transformMatrix;if(k){l.setTransform(k[0],k[1],k[2],k[3],k[4],k[5])}if(!n){this.transform(l)}if(this.stroke){l.lineWidth=this.strokeWidth;l.strokeStyle=this.stroke}if(this.overlayFill){l.fillStyle=this.overlayFill}else{if(this.fill){l.fillStyle=this.fill}}this._render(l,n);if(this.active&&!n){this.drawBorders(l);this.hideCorners||this.drawCorners(l)}l.restore()},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},scale:function(k){this.scaleX=k;this.scaleY=k;return this},scaleToWidth:function(k){return this.scale(k/this.width)},scaleToHeight:function(k){return this.scale(k/this.height)},setOpacity:function(k){this.set("opacity",k);return this},getAngle:function(){return this.theta*180/Math.PI},setAngle:function(k){this.theta=k/180*Math.PI;this.angle=k;return this},setCoords:function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this._hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));this._angle=Math.atan(this.currentHeight/this.currentWidth);var q=Math.cos(this._angle+this.theta)*this._hypotenuse,p=Math.sin(this._angle+this.theta)*this._hypotenuse,m=this.theta,t=Math.sin(m),r=Math.cos(m);var w={x:this.left-q,y:this.top-p};var s={x:w.x+(this.currentWidth*r),y:w.y+(this.currentWidth*t)};var v={x:s.x-(this.currentHeight*t),y:s.y+(this.currentHeight*r)};var n={x:w.x-(this.currentHeight*t),y:w.y+(this.currentHeight*r)};var o={x:w.x-(this.currentHeight/2*t),y:w.y+(this.currentHeight/2*r)};var k={x:w.x+(this.currentWidth/2*r),y:w.y+(this.currentWidth/2*t)};var l={x:s.x-(this.currentHeight/2*t),y:s.y+(this.currentHeight/2*r)};var u={x:n.x+(this.currentWidth/2*r),y:n.y+(this.currentWidth/2*t)};this.oCoords={tl:w,tr:s,br:v,bl:n,ml:o,mt:k,mr:l,mb:u};this._setCornerCoords();return this},drawBorders:function(l){var s=this.options,r=s.padding,n=r*2;l.save();l.globalAlpha=this.isMoving?s.borderOpacityWhenMoving:1;l.strokeStyle=s.borderColor;var p=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX),m=1/(this.scaleY<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);l.lineWidth=1/this.borderScaleFactor;l.scale(p,m);var k=this.getWidth(),q=this.getHeight();l.strokeRect(~~(-(k/2)-r)+0.5,~~(-(q/2)-r)+0.5,~~(k+n),~~(q+n));l.restore();return this},drawCorners:function(v){var x=this.options.cornersize,t=x/2,s=this.options.padding,m=-(this.width/2),r=-(this.height/2),w,u,l=x/this.scaleX,k=x/this.scaleY,n=(s+t)/this.scaleY,o=(s+t)/this.scaleX,q=(s+t-x)/this.scaleX,p=(s+t-x)/this.scaleY;v.save();v.globalAlpha=this.isMoving?this.options.borderOpacityWhenMoving:1;v.fillStyle=this.options.cornerColor;w=m-o;u=r-n;v.fillRect(w,u,l,k);w=m+this.width-o;u=r-n;v.fillRect(w,u,l,k);w=m-o;u=r+this.height+p;v.fillRect(w,u,l,k);w=m+this.width+q;u=r+this.height+p;v.fillRect(w,u,l,k);w=m+this.width/2-o;u=r-n;v.fillRect(w,u,l,k);w=m+this.width/2-o;u=r+this.height+p;v.fillRect(w,u,l,k);w=m+this.width+q;u=r+this.height/2-n;v.fillRect(w,u,l,k);w=m-o;u=r+this.height/2-n;v.fillRect(w,u,l,k);v.restore();return this},clone:function(k){if(this.constructor.fromObject){return this.constructor.fromObject(this.toObject(),k)}return new e.Object(this.toObject())},cloneAsImage:function(m){if(e.Image){var k=new Image();k.onload=function(){if(m){m(new e.Image(k),l)}k=k.onload=null};var l={angle:this.get("angle"),flipX:this.get("flipX"),flipY:this.get("flipY")};this.set("angle",0).set("flipX",false).set("flipY",false);k.src=this.toDataURL()}return this},toDataURL:function(){var l=document.createElement("canvas");l.width=this.getWidth();l.height=this.getHeight();e.util.wrapElement(l,"div");var k=new e.Element(l);k.backgroundColor="transparent";k.renderAll();var n=this.clone();n.left=l.width/2;n.top=l.height/2;n.setActive(false);k.add(n);var m=k.toDataURL("png");k.dispose();k=n=null;return m},hasStateChanged:function(){return this.stateProperties.some(function(k){return this[k]!==this.originalState[k]},this)},saveState:function(){this.stateProperties.forEach(function(k){this.originalState[k]=this.get(k)},this);return this},intersectsWithRect:function(m,o){var r=this.oCoords,k=new e.Point(r.tl.x,r.tl.y),n=new e.Point(r.tr.x,r.tr.y),q=new e.Point(r.bl.x,r.bl.y),l=new e.Point(r.br.x,r.br.y);var p=e.Intersection.intersectPolygonRectangle([k,n,l,q],m,o);return(p.status==="Intersection")},intersectsWithObject:function(k){function l(p){return{tl:new e.Point(p.tl.x,p.tl.y),tr:new e.Point(p.tr.x,p.tr.y),bl:new e.Point(p.bl.x,p.bl.y),br:new e.Point(p.br.x,p.br.y)}}var m=l(this.oCoords),o=l(k.oCoords);var n=e.Intersection.intersectPolygonPolygon([m.tl,m.tr,m.br,m.bl],[o.tl,o.tr,o.br,o.bl]);return(n.status==="Intersection")},isContainedWithinRect:function(m,o){var q=this.oCoords,k=new e.Point(q.tl.x,q.tl.y),n=new e.Point(q.tr.x,q.tr.y),p=new e.Point(q.bl.x,q.bl.y),l=new e.Point(q.br.x,q.br.y);return k.x>m.x&&n.x<o.x&&k.y>m.y&&p.y<o.y},isType:function(k){return this.type===k},_findTargetCorner:function(p,r){var q=b(p),o=q.x-r.left,l=q.y-r.top,n,k;for(var m in this.oCoords){k=this._getImageLines(this.oCoords[m].corner,m);n=this._findCrossPoints(o,l,k);if(n%2==1&&n!=0){this.__corner=m;return m}}return false},_findCrossPoints:function(r,q,k){var u,t,m,l,s,p,o=0,n;for(var v in k){n=k[v];if((n.o.y<q)&&(n.d.y<q)){continue}if((n.o.y>=q)&&(n.d.y>=q)){continue}if((n.o.x==n.d.x)&&(n.o.x>=r)){s=n.o.x;p=q}else{u=0;t=(n.d.y-n.o.y)/(n.d.x-n.o.x);m=q-u*r;l=n.o.y-t*n.o.x;s=-(m-l)/(u-t);p=m+u*s}if(s>=r){o+=1}if(o==2){break}}return o},_getImageLines:function(l,k){return{topline:{o:l.tl,d:l.tr},rightline:{o:l.tr,d:l.br},bottomline:{o:l.br,d:l.bl},leftline:{o:l.bl,d:l.tl}}},_setCornerCoords:function(){var r=this.oCoords,o=this.theta,n=this.cornersize*Math.cos(o),m=this.cornersize*Math.sin(o),p=this.cornersize/2,l=p-m,k=p,q;r.tl.x-=l;r.tl.y-=k;r.tl.corner={tl:{x:r.tl.x,y:r.tl.y},tr:{x:r.tl.x+n,y:r.tl.y+m},bl:{x:r.tl.x-m,y:r.tl.y+n}};r.tl.corner.br={x:r.tl.corner.tr.x-m,y:r.tl.corner.tr.y+n};r.tl.x+=l;r.tl.y+=k;r.tr.x+=p;r.tr.y-=p;r.tr.corner={tl:{x:r.tr.x-n,y:r.tr.y-m},tr:{x:r.tr.x,y:r.tr.y},br:{x:r.tr.x-m,y:r.tr.y+n}};r.tr.corner.bl={x:r.tr.corner.tl.x-m,y:r.tr.corner.tl.y+n};r.tr.x-=p;r.tr.y+=p;r.bl.x-=p;r.bl.y+=p;r.bl.corner={tl:{x:r.bl.x+m,y:r.bl.y-n},bl:{x:r.bl.x,y:r.bl.y},br:{x:r.bl.x+n,y:r.bl.y+m}};r.bl.corner.tr={x:r.bl.corner.br.x+m,y:r.bl.corner.br.y-n};r.bl.x+=p;r.bl.y-=p;r.br.x+=p;r.br.y+=p;r.br.corner={tr:{x:r.br.x+m,y:r.br.y-n},bl:{x:r.br.x-n,y:r.br.y-m},br:{x:r.br.x,y:r.br.y}};r.br.corner.tl={x:r.br.corner.bl.x+m,y:r.br.corner.bl.y-n};r.br.x-=p;r.br.y-=p;r.ml.x-=p;r.ml.y-=p;r.ml.corner={tl:{x:r.ml.x,y:r.ml.y},tr:{x:r.ml.x+n,y:r.ml.y+m},bl:{x:r.ml.x-m,y:r.ml.y+n}};r.ml.corner.br={x:r.ml.corner.tr.x-m,y:r.ml.corner.tr.y+n};r.ml.x+=p;r.ml.y+=p;r.mt.x-=p;r.mt.y-=p;r.mt.corner={tl:{x:r.mt.x,y:r.mt.y},tr:{x:r.mt.x+n,y:r.mt.y+m},bl:{x:r.mt.x-m,y:r.mt.y+n}};r.mt.corner.br={x:r.mt.corner.tr.x-m,y:r.mt.corner.tr.y+n};r.mt.x+=p;r.mt.y+=p;r.mr.x-=p;r.mr.y-=p;r.mr.corner={tl:{x:r.mr.x,y:r.mr.y},tr:{x:r.mr.x+n,y:r.mr.y+m},bl:{x:r.mr.x-m,y:r.mr.y+n}};r.mr.corner.br={x:r.mr.corner.tr.x-m,y:r.mr.corner.tr.y+n};r.mr.x+=p;r.mr.y+=p;r.mb.x-=p;r.mb.y-=p;r.mb.corner={tl:{x:r.mb.x,y:r.mb.y},tr:{x:r.mb.x+n,y:r.mb.y+m},bl:{x:r.mb.x-m,y:r.mb.y+n}};r.mb.corner.br={x:r.mb.corner.tr.x-m,y:r.mb.corner.tr.y+n};r.mb.x+=p;r.mb.y+=p;q=r.mb.corner;q.tl.x-=p;q.tl.y-=p;q.tr.x-=p;q.tr.y-=p;q.br.x-=p;q.br.y-=p;q.bl.x-=p;q.bl.y-=p},toGrayscale:function(){var k=this.get("fill");if(k){this.set("overlayFill",new e.Color(k).toGrayscale().toRgb())}return this},complexity:function(){return 0},getCenter:function(){return{x:this.get("left")+this.width/2,y:this.get("top")+this.height/2}},straighten:function(){var k=this._getAngleValueForStraighten();this.setAngle(k);return this},fxStraighten:function(l){l=l||{};var m=function(){},n=l.onComplete||m,k=l.onChange||m,o=this;e.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(p){o.setAngle(p);k()},onComplete:function(){o.setCoords();n()},onStart:function(){o.setActive(false)}});return this},fxRemove:function(l){l||(l={});var m=function(){},n=l.onComplete||m,k=l.onChange||m,o=this;e.util.animate({startValue:this.get("opacity"),endValue:0,duration:this.FX_DURATION,onChange:function(p){o.set("opacity",p);k()},onComplete:n,onStart:function(){o.setActive(false)}});return this},_getAngleValueForStraighten:function(){var k=this.get("angle");if(k>-225&&k<=-135){return -180}else{if(k>-135&&k<=-45){return -90}else{if(k>-45&&k<=45){return 0}else{if(k>45&&k<=135){return 90}else{if(k>135&&k<=225){return 180}else{if(k>225&&k<=315){return 270}else{if(k>315){return 360}}}}}}}return 0},toJSON:function(){return this.toObject()}});e.Object.prototype.rotate=e.Object.prototype.setAngle})();(function(){var a=this.fabric||(this.fabric={}),b=a.util.object.extend;if(a.Line){return}a.Line=a.util.createClass(a.Object,{type:"line",initialize:function(d,c){if(!d){d=[0,0,0,0]}this.callSuper("initialize",c);this.set("x1",d[0]);this.set("y1",d[1]);this.set("x2",d[2]);this.set("y2",d[3]);this.set("width",this.x2-this.x1);this.set("height",this.y2-this.y1);this.set("left",this.x1+this.width/2);this.set("top",this.y1+this.height/2)},_render:function(c){c.beginPath();c.moveTo(-this.width/2,-this.height/2);c.lineTo(this.width/2,this.height/2);var d=c.strokeStyle;c.strokeStyle=c.fillStyle;c.stroke();c.strokeStyle=d},complexity:function(){return 1},toObject:function(){return b(this.callSuper("toObject"),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})}});a.Element.ATTRIBUTE_NAMES="x1 y1 x2 y2 stroke stroke-width transform".split(" ");a.Line.fromElement=function(d,c){var f=a.parseAttributes(d,a.Element.ATTRIBUTE_NAMES);var e=[f.x1||0,f.y1||0,f.x2||0,f.y2||0];return new a.Line(e,b(f,c))};a.Line.fromObject=function(c){var d=[c.x1,c.y1,c.x2,c.y2];return new a.Line(d,c)}})();(function(){var a=this.fabric||(this.fabric={}),c=Math.PI*2,d=a.util.object.extend;if(a.Circle){console.warn("fabric.Circle is already defined.");return}a.Circle=a.util.createClass(a.Object,{type:"circle",initialize:function(e){e=e||{};this.set("radius",e.radius||0);this.callSuper("initialize",e);var f=this.get("radius")*2*this.get("scaleX");this.set("width",f).set("height",f)},toObject:function(){return d(this.callSuper("toObject"),{radius:this.get("radius")})},_render:function(e,f){e.beginPath();e.arc(f?this.left:0,f?this.top:0,this.radius,0,c,false);e.closePath();if(this.fill){e.fill()}if(this.stroke){e.stroke()}},complexity:function(){return 1}});a.Circle.ATTRIBUTE_NAMES="cx cy r fill fill-opacity stroke stroke-width transform".split(" ");a.Circle.fromElement=function(f,e){e||(e={});var g=a.parseAttributes(f,a.Circle.ATTRIBUTE_NAMES);if(!b(g)){throw Error("value of `r` attribute is required and can not be negative")}if("left" in g){g.left-=(e.width/2)||0}if("top" in g){g.top-=(e.height/2)||0}return new a.Circle(d(g,e))};function b(e){return(("radius" in e)&&(e.radius>0))}a.Circle.fromObject=function(e){return new a.Circle(e)}})();(function(){var a=this.fabric||(this.fabric={});if(a.Triangle){return}a.Triangle=a.util.createClass(a.Object,{type:"triangle",initialize:function(b){b=b||{};this.callSuper("initialize",b);this.set("width",b.width||100).set("height",b.height||100)},_render:function(b){var c=this.width/2,d=this.height/2;b.beginPath();b.moveTo(-c,d);b.lineTo(0,-d);b.lineTo(c,d);b.closePath();if(this.fill){b.fill()}if(this.stroke){b.stroke()}},complexity:function(){return 1}});a.Triangle.fromObject=function(b){return new a.Triangle(b)}})();(function(){var a=this.fabric||(this.fabric={}),b=Math.PI*2,c=a.util.object.extend;if(a.Ellipse){console.warn("fabric.Ellipse is already defined.");return}a.Ellipse=a.util.createClass(a.Object,{type:"ellipse",initialize:function(d){d=d||{};this.callSuper("initialize",d);this.set("rx",d.rx||0);this.set("ry",d.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(){return c(this.callSuper("toObject"),{rx:this.get("rx"),ry:this.get("ry")})},render:function(d,e){if(this.rx===0||this.ry===0){return}return this.callSuper("render",d,e)},_render:function(d,e){d.beginPath();d.save();d.transform(1,0,0,this.ry/this.rx,0,0);d.arc(e?this.left:0,e?this.top:0,this.rx,0,b,false);d.restore();if(this.stroke){d.stroke()}if(this.fill){d.fill()}},complexity:function(){return 1}});a.Ellipse.ATTRIBUTE_NAMES="cx cy rx ry fill fill-opacity stroke stroke-width transform".split(" ");a.Ellipse.fromElement=function(e,d){d||(d={});var f=a.parseAttributes(e,a.Ellipse.ATTRIBUTE_NAMES);if("left" in f){f.left-=(d.width/2)||0}if("top" in f){f.top-=(d.height/2)||0}return new a.Ellipse(c(f,d))};a.Ellipse.fromObject=function(d){return new a.Ellipse(d)}})();(function(){var b=this.fabric||(this.fabric={});if(b.Rect){return}b.Rect=b.util.createClass(b.Object,{type:"rect",options:{rx:0,ry:0},initialize:function(c){this.callSuper("initialize",c);this._initRxRy()},_initRxRy:function(){if(this.options.rx&&!this.options.ry){this.options.ry=this.options.rx}else{if(this.options.ry&&!this.options.rx){this.options.rx=this.options.ry}}},_render:function(e){var k=this.options.rx||0,g=this.options.ry||0,c=-this.width/2,l=-this.height/2,d=this.width,f=this.height;e.beginPath();e.moveTo(c+k,l);e.lineTo(c+d-k,l);e.bezierCurveTo(c+d,l,c+d,l+g,c+d,l+g);e.lineTo(c+d,l+f-g);e.bezierCurveTo(c+d,l+f,c+d-k,l+f,c+d-k,l+f);e.lineTo(c+k,l+f);e.bezierCurveTo(c,l+f,c,l+f-g,c,l+f-g);e.lineTo(c,l+g);e.bezierCurveTo(c,l,c+k,l,c+k,l);e.closePath();if(this.fill){e.fill()}if(this.stroke){e.stroke()}},_normalizeLeftTopProperties:function(c){if(c.left){this.set("left",c.left+this.getWidth()/2)}if(c.top){this.set("top",c.top+this.getHeight()/2)}return this},complexity:function(){return 1}});b.Rect.ATTRIBUTE_NAMES="x y width height rx ry fill fill-opacity stroke stroke-width transform".split(" ");function a(c){c.left=c.left||0;c.top=c.top||0;return c}b.Rect.fromElement=function(d,c){if(!d){return null}var f=b.parseAttributes(d,b.Rect.ATTRIBUTE_NAMES);f=a(f);var e=new b.Rect(b.util.object.extend(c||{},f));e._normalizeLeftTopProperties(f);return e};b.Rect.fromObject=function(c){return new b.Rect(c)}})();(function(){var b=this.fabric||(this.fabric={});if(b.Polyline){console.warn("fabric.Polyline is already defined");return}b.Polyline=b.util.createClass(b.Object,{type:"polyline",initialize:function(d,c){c=c||{};this.set("points",d);this.callSuper("initialize",c);this._calcDimensions()},_calcDimensions:function(){return b.Polygon.prototype._calcDimensions.call(this)},toObject:function(){return b.Polygon.prototype.toObject.call(this)},_render:function(e){var d;e.beginPath();for(var f=0,c=this.points.length;f<c;f++){d=this.points[f];e.lineTo(d.x,d.y)}if(this.fill){e.fill()}if(this.stroke){e.stroke()}},complexity:function(){return this.get("points").length}});var a="fill fill-opacity stroke stroke-width transform".split(" ");b.Polyline.fromElement=function(f,d){if(!f){return null}d||(d={});var g=b.parsePointsAttribute(f.getAttribute("points")),h=b.parseAttributes(f,a);for(var e=0,c=g.length;e<c;e++){g[e].x-=(d.width/2)||0;g[e].y-=(d.height/2)||0}return new b.Polyline(g,b.util.object.extend(h,d))};b.Polyline.fromObject=function(c){var d=c.points;return new b.Polyline(d,c)}})();(function(){var e=this.fabric||(this.fabric={}),f=e.util.object.extend,d=e.util.array.min,a=e.util.array.max;if(e.Polygon){console.warn("fabric.Polygon is already defined");return}function c(g){return g.x}function b(g){return g.y}e.Polygon=e.util.createClass(e.Object,{type:"polygon",initialize:function(h,g){g=g||{};this.points=h;this.callSuper("initialize",g);this._calcDimensions()},_calcDimensions:function(){var h=this.points,g=d(h,"x"),m=d(h,"y"),l=a(h,"x"),k=a(h,"y");this.width=l-g;this.height=k-m;this.minX=g;this.minY=m},toObject:function(){return f(this.callSuper("toObject"),{points:this.points.concat()})},_render:function(k){var h;k.beginPath();for(var l=0,g=this.points.length;l<g;l++){h=this.points[l];k.lineTo(h.x,h.y)}if(this.fill){k.fill()}if(this.stroke){k.closePath();k.stroke()}},complexity:function(){return this.points.length}});e.Polygon.ATTRIBUTE_NAMES="fill fill-opacity stroke stroke-width transform".split(" ");e.Polygon.fromElement=function(l,h){if(!l){return null}h||(h={});var m=e.parsePointsAttribute(l.getAttribute("points")),n=e.parseAttributes(l,e.Polygon.ATTRIBUTE_NAMES);for(var k=0,g=m.length;k<g;k++){m[k].x-=(h.width/2)||0;m[k].y-=(h.height/2)||0}return new e.Polygon(m,f(n,h))};e.Polygon.fromObject=function(g){return new e.Polygon(g.points,g)}})();(function(){var d=this.fabric||(this.fabric={}),c=d.util.array.min,b=d.util.array.max,e=d.util.object.extend;if(d.Path){console.warn("fabric.Path is already defined");return}if(!d.Object){console.warn("fabric.Path requires fabric.Object");return}d.Path=d.util.createClass(d.Object,{type:"path",initialize:function(h,g){g=g||{};this.setOptions(g);this._importProperties();this.originalState={};if(!h){throw Error("`path` argument is required")}var f=Object.prototype.toString.call(h)==="[object Array]";this.path=f?h:h.match&&h.match(/[a-zA-Z][^a-zA-Z]*/g);if(!this.path){return}if(!f){this._initializeFromArray(g)}this.setCoords();if(g.sourcePath){this.setSourcePath(g.sourcePath)}},_initializeFromArray:function(g){var f="width" in g,h="height" in g;this.path=this._parsePath();if(!f||!h){e(this,this._parseDimensions());if(f){this.width=this.options.width}if(h){this.height=this.options.height}}},_render:function(s){var o,q=0,p=0,f=0,u=0,m,k,g=-(this.width/2),r=-(this.height/2);for(var h=0,n=this.path.length;h<n;++h){o=this.path[h];switch(o[0]){case"l":q+=o[1];p+=o[2];s.lineTo(q+g,p+r);break;case"L":q=o[1];p=o[2];s.lineTo(q+g,p+r);break;case"h":q+=o[1];s.lineTo(q+g,p+r);break;case"H":q=o[1];s.lineTo(q+g,p+r);break;case"v":p+=o[1];s.lineTo(q+g,p+r);break;case"V":p=o[1];s.lineTo(q+g,p+r);break;case"m":q+=o[1];p+=o[2];s.moveTo(q+g,p+r);break;case"M":q=o[1];p=o[2];s.moveTo(q+g,p+r);break;case"c":m=q+o[5];k=p+o[6];f=q+o[3];u=p+o[4];s.bezierCurveTo(q+o[1]+g,p+o[2]+r,f+g,u+r,m+g,k+r);q=m;p=k;break;case"C":q=o[5];p=o[6];f=o[3];u=o[4];s.bezierCurveTo(o[1]+g,o[2]+r,f+g,u+r,q+g,p+r);break;case"s":m=q+o[3];k=p+o[4];f=2*q-f;u=2*p-u;s.bezierCurveTo(f+g,u+r,q+o[1]+g,p+o[2]+r,m+g,k+r);q=m;p=k;break;case"S":m=o[3];k=o[4];f=2*q-f;u=2*p-u;s.bezierCurveTo(f+g,u+r,o[1]+g,o[2]+r,m+g,k+r);q=m;p=k;break;case"q":q+=o[3];p+=o[4];s.quadraticCurveTo(o[1]+g,o[2]+r,q+g,p+r);break;case"Q":q=o[3];p=o[4];f=o[1];u=o[2];s.quadraticCurveTo(f+g,u+r,q+g,p+r);break;case"T":m=q;k=p;q=o[1];p=o[2];f=-f+2*m;u=-u+2*k;s.quadraticCurveTo(f+g,u+r,q+g,p+r);break;case"a":break;case"A":break;case"z":case"Z":s.closePath();break}}},render:function(g,h){g.save();var f=this.transformMatrix;if(f){g.transform(f[0],f[1],f[2],f[3],f[4],f[5])}if(!h){this.transform(g)}if(this.overlayFill){g.fillStyle=this.overlayFill}else{if(this.fill){g.fillStyle=this.fill}}if(this.stroke){g.strokeStyle=this.stroke}g.beginPath();this._render(g);if(this.fill){g.fill()}if(this.stroke){g.strokeStyle=this.stroke;g.lineWidth=this.strokeWidth;g.lineCap=g.lineJoin="round";g.stroke()}if(!h&&this.active){this.drawBorders(g);this.hideCorners||this.drawCorners(g)}g.restore()},toString:function(){return"#<fabric.Path ("+this.complexity()+"): "+JSON.stringify({top:this.top,left:this.left})+">"},toObject:function(){var f=e(this.callSuper("toObject"),{path:this.path});if(this.sourcePath){f.sourcePath=this.sourcePath}if(this.transformMatrix){f.transformMatrix=this.transformMatrix}return f},toDatalessObject:function(){var f=this.toObject();if(this.sourcePath){f.path=this.sourcePath}delete f.sourcePath;return f},complexity:function(){return this.path.length},set:function(g,f){return this.callSuper("set",g,f)},_parsePath:function(){var g=[],k,l;for(var h=0,f=this.path.length;h<f;h++){k=this.path[h];l=k.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);g.push([k.charAt(0)].concat(l.map(parseFloat)))}return g},_parseDimensions:function(){var n=[],l=[],p,m,q=false,s,r;function u(o){if(o[0]==="H"){return o[1]}return o[o.length-2]}function t(o){if(o[0]==="V"){return o[1]}return o[o.length-1]}this.path.forEach(function(v,o){if(v[0]!=="H"){p=(o===0)?u(v):u(this.path[o-1])}if(v[0]!=="V"){m=(o===0)?t(v):t(this.path[o-1])}if(v[0]===v[0].toLowerCase()){q=true}s=q?p+u(v):v[0]==="V"?p:u(v);r=q?m+t(v):v[0]==="H"?m:t(v);var w=parseInt(s,10);if(!isNaN(w)){n.push(w)}w=parseInt(r,10);if(!isNaN(w)){l.push(w)}},this);var h=c(n),g=c(l),k=deltaY=0;var f={top:g-deltaY,left:h-k,bottom:b(l)-deltaY,right:b(n)-k};f.width=f.right-f.left;f.height=f.bottom-f.top;return f}});d.Path.fromObject=function(f){return new d.Path(f.path,f)};var a=d.Path.ATTRIBUTE_NAMES="d fill fill-opacity fill-rule stroke stroke-width transform".split(" ");d.Path.fromElement=function(g,f){var h=d.parseAttributes(g,a),k=h.d;delete h.d;return new d.Path(k,e(h,f))}})();(function(){var f=this.fabric||(this.fabric={}),h=f.util.object.extend,b=f.util.array.invoke,g=f.Object.prototype.set,e=f.Object.prototype.toObject,a=f.util.string.camelize,c=f.util.string.capitalize;if(f.PathGroup){console.warn("fabric.PathGroup is already defined");return}f.PathGroup=f.util.createClass(f.Path,{type:"path-group",forceFillOverwrite:false,initialize:function(l,k){k=k||{};this.originalState={};this.paths=l;this.setOptions(k);this.initProperties();this.setCoords();if(k.sourcePath){this.setSourcePath(k.sourcePath)}},initProperties:function(){this.stateProperties.forEach(function(k){if(k==="fill"){this.set(k,this.options[k])}else{if(k==="angle"){this.setAngle(this.options[k])}else{this[k]=this.options[k]}}},this)},render:function(o){if(this.stub){o.save();this.transform(o);this.stub.render(o,false);if(this.active){this.drawBorders(o);this.drawCorners(o)}o.restore()}else{o.save();var k=this.transformMatrix;if(k){o.transform(k[0],k[1],k[2],k[3],k[4],k[5])}this.transform(o);for(var p=0,n=this.paths.length;p<n;++p){this.paths[p].render(o,true)}if(this.active){this.drawBorders(o);this.hideCorners||this.drawCorners(o)}o.restore()}},set:function(m,l){if((m==="fill"||m==="overlayFill")&&this.isSameColor()){this[m]=l;var k=this.paths.length;while(k--){this.paths[k].set(m,l)}}else{g.call(this,m,l)}return this},toObject:function(){return h(e.call(this),{paths:b(this.getObjects(),"clone"),sourcePath:this.sourcePath})},toDatalessObject:function(){var k=this.toObject();if(this.sourcePath){k.paths=this.sourcePath}return k},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var k=this.getObjects()[0].get("fill");return this.getObjects().every(function(l){return l.get("fill")===k})},complexity:function(){return this.paths.reduce(function(k,l){return k+((l&&l.complexity)?l.complexity():0)},0)},toGrayscale:function(){var k=this.paths.length;while(k--){this.paths[k].toGrayscale()}return this},getObjects:function(){return this.paths}});function d(n){for(var m=0,k=n.length;m<k;m++){if(!(n[m] instanceof f.Object)){var l=a(c(n[m].type));n[m]=f[l].fromObject(n[m])}}return n}f.PathGroup.fromObject=function(k){var l=d(k.paths);return new f.PathGroup(l,k)}})();(function(){var d=this.fabric||(this.fabric={}),f=d.util.object.extend,c=d.util.array.min,a=d.util.array.max,b=d.util.array.invoke,e=d.util.removeFromArray;if(d.Group){return}d.Group=d.util.createClass(d.Object,{type:"group",initialize:function(h,g){this.objects=h||[];this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();if(g){f(this,g)}this._setOpacityIfSame();this.setCoords(true);this.saveCoords();this.activateAllObjects()},_updateObjectsCoords:function(){var h=this.left,g=this.top;this.forEachObject(function(k){var l=k.get("left"),m=k.get("top");k.set("originalLeft",l);k.set("originalTop",m);k.set("left",l-h);k.set("top",m-g);k.setCoords();k.hideCorners=true},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this.objects},add:function(g){this._restoreObjectsState();this.objects.push(g);g.setActive(true);this._calcBounds();this._updateObjectsCoords();return this},remove:function(g){this._restoreObjectsState();e(this.objects,g);g.setActive(false);this._calcBounds();this._updateObjectsCoords();return this},size:function(){return this.getObjects().length},set:function(g,k){if(typeof k=="function"){this.set(g,k(this[g]))}else{if(g==="fill"||g==="opacity"){var h=this.objects.length;this[g]=k;while(h--){this.objects[h].set(g,k)}}else{this[g]=k}}return this},contains:function(g){return this.objects.indexOf(g)>-1},toObject:function(){return f(this.callSuper("toObject"),{objects:b(this.objects,"clone")})},render:function(h){h.save();this.transform(h);var n=Math.max(this.scaleX,this.scaleY);for(var l=0,g=this.objects.length,k;k=this.objects[l];l++){var m=k.borderScaleFactor;k.borderScaleFactor=n;k.render(h);k.borderScaleFactor=m}this.hideBorders||this.drawBorders(h);this.hideCorners||this.drawCorners(h);h.restore();this.setCoords()},item:function(g){return this.getObjects()[g]},complexity:function(){return this.getObjects().reduce(function(h,g){h+=(typeof g.complexity=="function")?g.complexity():0;return h},0)},_restoreObjectsState:function(){this.objects.forEach(this._restoreObjectState,this);return this},_restoreObjectState:function(k){var m=this.get("left"),n=this.get("top"),g=this.getAngle()*(Math.PI/180),l=k.get("originalLeft"),o=k.get("originalTop"),h=Math.cos(g)*k.get("top")+Math.sin(g)*k.get("left"),p=-Math.sin(g)*k.get("top")+Math.cos(g)*k.get("left");k.setAngle(k.getAngle()+this.getAngle());k.set("left",m+p*this.get("scaleX"));k.set("top",n+h*this.get("scaleY"));k.set("scaleX",k.get("scaleX")*this.get("scaleX"));k.set("scaleY",k.get("scaleY")*this.get("scaleY"));k.setCoords();k.hideCorners=false;k.setActive(false);k.setCoords();return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(g){g.setCoords()});return this},activateAllObjects:function(){return this.setActive(true)},setActive:function(g){this.forEachObject(function(h){h.setActive(g)});return this},forEachObject:function(l,h){var k=this.getObjects(),g=k.length;while(g--){l.call(h,k[g],g,k)}return this},_setOpacityIfSame:function(){var k=this.getObjects(),h=k[0]?k[0].get("opacity"):1;var g=k.every(function(l){return l.get("opacity")===h});if(g){this.opacity=h}},_calcBounds:function(){var s=[],q=[],p,n,k,g,m,l,u,r=0,t=this.objects.length;for(;r<t;++r){m=this.objects[r];m.setCoords();for(var h in m.oCoords){s.push(m.oCoords[h].x);q.push(m.oCoords[h].y)}}p=c(s);k=a(s);n=c(q);g=a(q);l=k-p;u=g-n;this.width=l;this.height=u;this.left=p+l/2;this.top=n+u/2},containsPoint:function(h){var m=this.get("width")/2,g=this.get("height")/2,l=this.get("left"),k=this.get("top");return l-m<h.x&&l+m>h.x&&k-g<h.y&&k+g>h.y},toGrayscale:function(){var g=this.objects.length;while(g--){this.objects[g].toGrayscale()}}});d.Group.fromObject=function(g){return new d.Group(g.objects,g)}})();(function(){var a=this.fabric||(this.fabric={}),c=a.util.object.extend,b=a.util.object.clone;if(a.Text){console.warn("fabric.Text is already defined");return}if(!a.Object){console.warn("fabric.Text requires fabric.Object");return}a.Text=a.util.createClass(a.Object,{options:{top:10,left:10,fontsize:20,fontweight:100,fontfamily:"Modernist_One_400",path:null},type:"text",initialize:function(e,d){this.originalState={};this.initStateProperties();this.text=e;this.setOptions(d);c(this,this.options);this.theta=this.angle*(Math.PI/180);this.width=this.getWidth();this.setCoords()},initStateProperties:function(){var d;if((d=this.constructor)&&(d=d.superclass)&&(d=d.prototype)&&(d=d.stateProperties)&&d.clone){this.stateProperties=d.clone();this.stateProperties.push("fontfamily","fontweight","path")}},toString:function(){return"#<fabric.Text ("+this.complexity()+"): "+JSON.stringify({text:this.text,fontfamily:this.fontfamily})+">"},_render:function(d){var f=Cufon.textOptions||(Cufon.textOptions={});f.left=this.left;f.top=this.top;f.context=d;f.color=this.fill;var e=this._initDummyElement();this.transform(d);Cufon.replaceElement(e,{separate:"none",fontFamily:this.fontfamily});this.width=f.width;this.height=f.height},_initDummyElement:function(){var d=document.createElement("div");d.innerHTML=this.text;d.style.fontSize="40px";d.style.fontWeight="400";d.style.fontStyle="normal";d.style.letterSpacing="normal";d.style.color="#000000";d.style.fontWeight="600";d.style.fontFamily="Verdana";return d},render:function(d){d.save();this._render(d);if(this.active){this.drawBorders(d);this.drawCorners(d)}d.restore()},toObject:function(){return c(this.callSuper("toObject"),{text:this.text,fontsize:this.fontsize,fontweight:this.fontweight,fontfamily:this.fontfamily,path:this.path})},setColor:function(d){this.set("fill",d);return this},setFontsize:function(d){this.set("fontsize",d);this.setCoords();return this},getText:function(){return this.text},setText:function(d){this.set("text",d);this.setCoords();return this},set:function(d,e){this[d]=e;if(d==="fontfamily"){this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+e+"$3")}return this}});a.Text.fromObject=function(d){return new a.Text(d.text,b(d))};a.Text.fromElement=function(d){}})();(function(){var a=this,b=fabric.util.object.extend;if(!a.fabric){a.fabric={}}if(a.fabric.Image){console.warn("fabric.Image is already defined.");return}if(!fabric.Object){console.warn("fabric.Object is required for fabric.Image initialization");return}fabric.Image=fabric.util.createClass(fabric.Object,{maxwidth:null,maxheight:null,active:false,bordervisibility:false,cornervisibility:false,type:"image",__isGrayscaled:false,initialize:function(d,c){this.callSuper("initialize",c);this._initElement(d);this._initConfig(c||{})},getElement:function(){return this._element},setElement:function(c){this._element=c;return this},getNormalizedSize:function(d,c,e){if(e&&c&&(d.width>d.height&&(d.width/d.height)<(c/e))){normalizedWidth=~~((d.width*e)/d.height);normalizedHeight=e}else{if(e&&((d.height==d.width)||(d.height>d.width)||(d.height>e))){normalizedWidth=~~((d.width*e)/d.height);normalizedHeight=e}else{if(c&&(c<d.width)){normalizedHeight=~~((d.height*c)/d.width);normalizedWidth=c}else{normalizedWidth=d.width;normalizedHeight=d.height}}}return{width:normalizedWidth,height:normalizedHeight}},getOriginalSize:function(){var c=this.getElement();return{width:c.width,height:c.height}},setBorderVisibility:function(c){this._resetWidthHeight();this._adjustWidthHeightToBorders(c);this.setCoords()},setCornersVisibility:function(c){this.cornervisibility=!!c},render:function(c,d){c.save();if(!d){this.transform(c)}this._render(c);if(this.active&&!d){this.drawBorders(c);this.hideCorners||this.drawCorners(c)}c.restore()},toObject:function(){return b(this.callSuper("toObject"),{src:this.getSrc()})},getSrc:function(){return this.getElement().src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(c){this.constructor.fromObject(this.toObject(),c)},toGrayscale:function(g){if(this.__isGrayscaled){return}var e=this.getElement(),c=document.createElement("canvas"),d=document.createElement("img"),f=this;c.width=e.width;c.height=e.height;c.getContext("2d").drawImage(e,0,0);fabric.Element.toGrayscale(c);d.onload=function(){f.setElement(d);g&&g();d.onload=c=e=imageData=null};d.width=e.width;d.height=e.height;d.src=c.toDataURL("image/png");this.__isGrayscaled=true;return this},_render:function(d){var c=this.getOriginalSize();d.drawImage(this.getElement(),-c.width/2,-c.height/2,c.width,c.height)},_adjustWidthHeightToBorders:function(c){if(c){this.currentBorder=this.borderwidth;this.width+=(2*this.currentBorder);this.height+=(2*this.currentBorder)}else{this.currentBorder=0}},_resetWidthHeight:function(){var c=this.getElement();this.set("width",c.width);this.set("height",c.height)},_initElement:function(c){this.setElement(fabric.util.getById(c));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(c){this.setOptions(c);this._setBorder();this._setWidthHeight(c)},_setBorder:function(){if(this.bordervisibility){this.currentBorder=this.borderwidth}else{this.currentBorder=0}},_setWidthHeight:function(c){var d=2*this.currentBorder;this.width=(this.getElement().width||0)+d;this.height=(this.getElement().height||0)+d},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.fromObject=function(d,f){var c=document.createElement("img"),e=d.src;if(d.width){c.width=d.width}if(d.height){c.height=d.height}c.onload=function(){if(f){f(new fabric.Image(c,d))}c=c.onload=null};c.src=e};fabric.Image.fromURL=function(d,f,e){var c=document.createElement("img");c.onload=function(){if(f){f(new fabric.Image(c,e))}c=c.onload=null};c.src=d}})();