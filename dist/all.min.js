/*! Fabric.js Copyright 2008-2013, Printio (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"1.2.10"};if(typeof exports!=="undefined"){exports.fabric=fabric}if(typeof document!=="undefined"&&typeof window!=="undefined"){fabric.document=document;fabric.window=window}else{fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>");fabric.window=fabric.document.createWindow()}fabric.isTouchSupported="ontouchstart" in fabric.document.documentElement;fabric.isLikelyNode=typeof Buffer!=="undefined"&&typeof window==="undefined";
/*!
 * Copyright (c) 2009 Simo Kinnunen.
 * Licensed under the MIT license.
 */
var Cufon=(function(){var k=function(){return k.replace.apply(null,arguments)};var u=k.DOM={ready:(function(){var z=false,B={loaded:1,complete:1};var y=[],A=function(){if(z){return}z=true;for(var C;C=y.shift();C()){}};if(fabric.document.addEventListener){fabric.document.addEventListener("DOMContentLoaded",A,false);fabric.window.addEventListener("pageshow",A,false)}if(!fabric.window.opera&&fabric.document.readyState){(function(){B[fabric.document.readyState]?A():setTimeout(arguments.callee,10)})()}if(fabric.document.readyState&&fabric.document.createStyleSheet){(function(){try{fabric.document.body.doScroll("left");A()}catch(C){setTimeout(arguments.callee,1)}})()}o(fabric.window,"load",A);return function(C){if(!arguments.length){A()}else{z?C():y.push(C)}}})()};var l=k.CSS={Size:function(z,y){this.value=parseFloat(z);this.unit=String(z).match(/[a-z%]*$/)[0]||"px";this.convert=function(A){return A/y*this.value};this.convertFrom=function(A){return A/this.value*y};this.toString=function(){return this.value+this.unit}},getStyle:function(y){return new a(y.style)},quotedList:i(function(B){var A=[],z=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g,y;while(y=z.exec(B)){A.push(y[3]||y[1])}return A}),ready:(function(){var A=false;var z=[],B=function(){A=true;for(var D;D=z.shift();D()){}};var y=Object.prototype.propertyIsEnumerable?f("style"):{length:0};var C=f("link");u.ready(function(){var G=0,F;for(var E=0,D=C.length;F=C[E],E<D;++E){if(!F.disabled&&F.rel.toLowerCase()=="stylesheet"){++G}}if(fabric.document.styleSheets.length>=y.length+G){B()}else{setTimeout(arguments.callee,10)}});return function(D){if(A){D()}else{z.push(D)}}})(),supports:function(A,z){var y=fabric.document.createElement("span").style;if(y[A]===undefined){return false}y[A]=z;return y[A]===z},textAlign:function(B,A,y,z){if(A.get("textAlign")=="right"){if(y>0){B=" "+B}}else{if(y<z-1){B+=" "}}return B},textDecoration:function(D,C){if(!C){C=this.getStyle(D)}var z={underline:null,overline:null,"line-through":null};for(var y=D;y.parentNode&&y.parentNode.nodeType==1;){var B=true;for(var A in z){if(z[A]){continue}if(C.get("textDecoration").indexOf(A)!=-1){z[A]=C.get("color")}B=false}if(B){break}C=this.getStyle(y=y.parentNode)}return z},textShadow:i(function(C){if(C=="none"){return null}var B=[],D={},y,z=0;var A=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/ig;while(y=A.exec(C)){if(y[0]==","){B.push(D);D={},z=0}else{if(y[1]){D.color=y[1]}else{D[["offX","offY","blur"][z++]]=y[2]}}}B.push(D);return B}),color:i(function(z){var y={};y.color=z.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(B,A,C){y.opacity=parseFloat(C);return"rgb("+A+")"});return y}),textTransform:function(z,y){return z[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[y.get("textTransform")]||"toString"]()}};function q(z){var y=this.face=z.face;this.glyphs=z.glyphs;this.w=z.w;this.baseSize=parseInt(y["units-per-em"],10);this.family=y["font-family"].toLowerCase();this.weight=y["font-weight"];this.style=y["font-style"]||"normal";this.viewBox=(function(){var B=y.bbox.split(/\s+/);var A={minX:parseInt(B[0],10),minY:parseInt(B[1],10),maxX:parseInt(B[2],10),maxY:parseInt(B[3],10)};A.width=A.maxX-A.minX,A.height=A.maxY-A.minY;A.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")};return A})();this.ascent=-parseInt(y.ascent,10);this.descent=-parseInt(y.descent,10);this.height=-this.ascent+this.descent}function e(){var z={},y={oblique:"italic",italic:"oblique"};this.add=function(A){(z[A.style]||(z[A.style]={}))[A.weight]=A};this.get=function(E,F){var D=z[E]||z[y[E]]||z.normal||z.italic||z.oblique;if(!D){return null}F={normal:400,bold:700}[F]||parseInt(F,10);if(D[F]){return D[F]}var B={1:1,99:0}[F%100],H=[],C,A;if(B===undefined){B=F>400}if(F==500){F=400}for(var G in D){G=parseInt(G,10);if(!C||G<C){C=G}if(!A||G>A){A=G}H.push(G)}if(F<C){F=C}if(F>A){F=A}H.sort(function(J,I){return(B?(J>F&&I>F)?J<I:J>I:(J<F&&I<F)?J>I:J<I)?-1:1});return D[H[0]]}}function p(){function A(C,D){if(C.contains){return C.contains(D)}return C.compareDocumentPosition(D)&16}function y(D){var C=D.relatedTarget;if(!C||A(this,C)){return}z(this)}function B(C){z(this)}function z(C){setTimeout(function(){k.replace(C,d.get(C).options,true)},10)}this.attach=function(C){if(C.onmouseenter===undefined){o(C,"mouseover",y);o(C,"mouseout",y)}else{o(C,"mouseenter",B);o(C,"mouseleave",B)}}}function x(){var A={},y=0;function z(B){return B.cufid||(B.cufid=++y)}this.get=function(B){var C=z(B);return A[C]||(A[C]={})}}function a(y){var A={},z={};this.get=function(B){return A[B]!=undefined?A[B]:y[B]};this.getSize=function(C,B){return z[C]||(z[C]=new l.Size(this.get(C),B))};this.extend=function(B){for(var C in B){A[C]=B[C]}return this}}function o(z,y,A){if(z.addEventListener){z.addEventListener(y,A,false)}else{if(z.attachEvent){z.attachEvent("on"+y,function(){return A.call(z,fabric.window.event)})}}}function r(z,y){var A=d.get(z);if(A.options){return z}if(y.hover&&y.hoverables[z.nodeName.toLowerCase()]){b.attach(z)}A.options=y;return z}function i(y){var z={};return function(A){if(!z.hasOwnProperty(A)){z[A]=y.apply(null,arguments)}return z[A]}}function c(D,C){if(!C){C=l.getStyle(D)}var z=l.quotedList(C.get("fontFamily").toLowerCase()),B;for(var A=0,y=z.length;A<y;++A){B=z[A];if(h[B]){return h[B].get(C.get("fontStyle"),C.get("fontWeight"))}}return null}function f(y){return fabric.document.getElementsByTagName(y)}function g(){var y={},B;for(var A=0,z=arguments.length;A<z;++A){for(B in arguments[A]){y[B]=arguments[A][B]}}return y}function m(B,J,z,K,C,A){var I=K.separate;if(I=="none"){return w[K.engine].apply(null,arguments)}var H=fabric.document.createDocumentFragment(),E;var F=J.split(n[I]),y=(I=="words");if(y&&s){if(/^\s/.test(J)){F.unshift("")}if(/\s$/.test(J)){F.push("")}}for(var G=0,D=F.length;G<D;++G){E=w[K.engine](B,y?l.textAlign(F[G],z,G,D):F[G],z,K,C,A,G<D-1);if(E){H.appendChild(E)}}return H}function j(z,G){var A,y,D,F;for(var B=r(z,G).firstChild;B;B=D){D=B.nextSibling;F=false;if(B.nodeType==1){if(!B.firstChild){continue}if(!/cufon/.test(B.className)){arguments.callee(B,G);continue}else{F=true}}if(!y){y=l.getStyle(z).extend(G)}if(!A){A=c(z,y)}if(!A){continue}if(F){w[G.engine](A,null,y,G,B,z);continue}var E=B.data;if(typeof G_vmlCanvasManager!="undefined"){E=E.replace(/\r/g,"\n")}if(E===""){continue}var C=m(A,E,y,G,B,z);if(C){B.parentNode.replaceChild(C,B)}else{B.parentNode.removeChild(B)}}}var s=" ".split(/\s+/).length==0;var d=new x();var b=new p();var v=[];var w={},h={},t={engine:null,hover:false,hoverables:{a:true},printable:true,selector:(fabric.window.Sizzle||(fabric.window.jQuery&&function(y){return jQuery(y)})||(fabric.window.dojo&&dojo.query)||(fabric.window.$$&&function(y){return $$(y)})||(fabric.window.$&&function(y){return $(y)})||(fabric.document.querySelectorAll&&function(y){return fabric.document.querySelectorAll(y)})||f),separate:"words",textShadow:"none"};var n={words:/\s+/,characters:""};k.now=function(){u.ready();return k};k.refresh=function(){var A=v.splice(0,v.length);for(var z=0,y=A.length;z<y;++z){k.replace.apply(null,A[z])}return k};k.registerEngine=function(z,y){if(!y){return k}w[z]=y;return k.set("engine",z)};k.registerFont=function(A){var y=new q(A),z=y.family;if(!h[z]){h[z]=new e()}h[z].add(y);return k.set("fontFamily",'"'+z+'"')};k.replace=function(A,z,y){z=g(t,z);if(!z.engine){return k}if(typeof z.textShadow=="string"&&z.textShadow){z.textShadow=l.textShadow(z.textShadow)}if(!y){v.push(arguments)}if(A.nodeType||typeof A=="string"){A=[A]}l.ready(function(){for(var C=0,B=A.length;C<B;++C){var D=A[C];if(typeof D=="string"){k.replace(z.selector(D),z,true)}else{j(D,z)}}});return k};k.replaceElement=function(z,y){y=g(t,y);if(typeof y.textShadow=="string"&&y.textShadow){y.textShadow=l.textShadow(y.textShadow)}return j(z,y)};k.engines=w;k.fonts=h;k.getOptions=function(){return g(t)};k.set=function(y,z){t[y]=z;return k};return k})();Cufon.registerEngine("canvas",(function(){var a=Cufon.CSS.supports("display","inline-block");var g=!a&&(fabric.document.compatMode=="BackCompat"||/frameset|transitional/i.test(fabric.document.doctype.publicId));var h=fabric.document.createElement("style");h.type="text/css";var f=fabric.document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(g?"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+(a?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}");try{h.appendChild(f)}catch(d){h.setAttribute("type","text/css");h.styleSheet.cssText=f.data}fabric.document.getElementsByTagName("head")[0].appendChild(h);function c(q,j){var o=0,n=0;var e=[],p=/([mrvxe])([^a-z]*)/g,l;generate:for(var k=0;l=p.exec(q);++k){var m=l[2].split(",");switch(l[1]){case"v":e[k]={m:"bezierCurveTo",a:[o+~~m[0],n+~~m[1],o+~~m[2],n+~~m[3],o+=~~m[4],n+=~~m[5]]};break;case"r":e[k]={m:"lineTo",a:[o+=~~m[0],n+=~~m[1]]};break;case"m":e[k]={m:"moveTo",a:[o=~~m[0],n=~~m[1]]};break;case"x":e[k]={m:"closePath",a:[]};break;case"e":break generate}j[e[k].m].apply(j,e[k].a)}return e}function b(n,m){for(var k=0,j=n.length;k<j;++k){var e=n[k];m[e.m].apply(m,e.a)}}return function(ab,E,W,A,J,ac){var n=(E===null);var H=ab.viewBox;var o=W.getSize("fontSize",ab.baseSize);var U=W.get("letterSpacing");U=(U=="normal")?0:o.convertFrom(parseInt(U,10));var I=0,V=0,T=0,C=0;var G=A.textShadow,R=[];Cufon.textOptions.shadowOffsets=[];Cufon.textOptions.shadows=null;if(G){Cufon.textOptions.shadows=G;for(var aa=0,X=G.length;aa<X;++aa){var N=G[aa];var Q=o.convertFrom(parseFloat(N.offX));var P=o.convertFrom(parseFloat(N.offY));R[aa]=[Q,P]}}var ag=Cufon.CSS.textTransform(n?J.alt:E,W).split("");var e=0,D=null;var z=0,M=1,L=[];for(var aa=0,X=ag.length;aa<X;++aa){if(ag[aa]==="\n"){M++;if(e>z){z=e}L.push(e);e=0;continue}var B=ab.glyphs[ag[aa]]||ab.missingGlyph;if(!B){continue}e+=D=Number(B.w||ab.w)+U}L.push(e);e=Math.max(z,e);var m=[];for(var aa=L.length;aa--;){m[aa]=e-L[aa]}if(D===null){return null}V+=(H.width-D);C+=H.minX;var v,p;if(n){v=J;p=J.firstChild}else{v=fabric.document.createElement("span");v.className="cufon cufon-canvas";v.alt=E;p=fabric.document.createElement("canvas");v.appendChild(p);if(A.printable){var Y=fabric.document.createElement("span");Y.className="cufon-alt";Y.appendChild(fabric.document.createTextNode(E));v.appendChild(Y)}}var ah=v.style;var O=p.style||{};var k=o.convert(H.height-I+T);var af=Math.ceil(k);var S=af/k;p.width=Math.ceil(o.convert(e+V-C)*S);p.height=af;I+=H.minY;O.top=Math.round(o.convert(I-ab.ascent))+"px";O.left=Math.round(o.convert(C))+"px";var j=Math.ceil(o.convert(e*S));var t=j+"px";var s=o.convert(ab.height);var F=(A.lineHeight-1)*o.convert(-ab.ascent/5)*(M-1);Cufon.textOptions.width=j;Cufon.textOptions.height=(s*M)+F;Cufon.textOptions.lines=M;Cufon.textOptions.totalLineHeight=F;if(a){ah.width=t;ah.height=s+"px"}else{ah.paddingLeft=t;ah.paddingBottom=(s-1)+"px"}var ad=Cufon.textOptions.context||p.getContext("2d"),K=af/H.height;Cufon.textOptions.fontAscent=ab.ascent*K;Cufon.textOptions.boundaries=null;for(var w=Cufon.textOptions.shadowOffsets,aa=R.length;aa--;){w[aa]=[R[aa][0]*K,R[aa][1]*K]}ad.save();ad.scale(K,K);ad.translate(-C-((1/K*p.width)/2)+(Cufon.fonts[ab.family].offsetLeft||0),-I-((Cufon.textOptions.height/K)/2)+(Cufon.fonts[ab.family].offsetTop||0));ad.lineWidth=ab.face["underline-thickness"];ad.save();function q(l,i){ad.strokeStyle=i;ad.beginPath();ad.moveTo(0,l);ad.lineTo(e,l);ad.stroke()}var r=Cufon.getTextDecoration(A),u=A.fontStyle==="italic";function ae(){ad.save();var aj=0,an=0,y=[{left:0}];if(A.backgroundColor){ad.save();ad.fillStyle=A.backgroundColor;ad.translate(0,ab.ascent);ad.fillRect(0,0,e+10,(-ab.ascent+ab.descent)*M);ad.restore()}if(A.textAlign==="right"){ad.translate(m[an],0);y[0].left=m[an]*K}else{if(A.textAlign==="center"){ad.translate(m[an]/2,0);y[0].left=m[an]/2*K}}for(var al=0,ak=ag.length;al<ak;++al){if(ag[al]==="\n"){an++;var am=-ab.ascent-((ab.ascent/5)*A.lineHeight);var x=y[y.length-1];var ai={left:0};x.width=aj*K;x.height=(-ab.ascent+ab.descent)*K;if(A.textAlign==="right"){ad.translate(-e,am);ad.translate(m[an],0);ai.left=m[an]*K}else{if(A.textAlign==="center"){ad.translate(-aj-(m[an-1]/2),am);ad.translate(m[an]/2,0);ai.left=m[an]/2*K}else{ad.translate(-aj,am)}}y.push(ai);aj=0;continue}var ap=ab.glyphs[ag[al]]||ab.missingGlyph;if(!ap){continue}var ao=Number(ap.w||ab.w)+U;if(A.textBackgroundColor){ad.save();ad.fillStyle=A.textBackgroundColor;ad.translate(0,ab.ascent);ad.fillRect(0,0,ao+10,-ab.ascent+ab.descent);ad.restore()}ad.translate(ao,0);aj+=ao;if(al==ak-1){y[y.length-1].width=aj*K;y[y.length-1].height=(-ab.ascent+ab.descent)*K}}ad.restore();Cufon.textOptions.boundaries=y}function Z(ai){ad.fillStyle=ai||Cufon.textOptions.color||W.get("color");var am=0,an=0;if(A.textAlign==="right"){ad.translate(m[an],0)}else{if(A.textAlign==="center"){ad.translate(m[an]/2,0)}}for(var ak=0,y=ag.length;ak<y;++ak){if(ag[ak]==="\n"){an++;var aj=-ab.ascent-((ab.ascent/5)*A.lineHeight);if(A.textAlign==="right"){ad.translate(-e,aj);ad.translate(m[an],0)}else{if(A.textAlign==="center"){ad.translate(-am-(m[an-1]/2),aj);ad.translate(m[an]/2,0)}else{ad.translate(-am,aj)}}am=0;continue}var al=ab.glyphs[ag[ak]]||ab.missingGlyph;if(!al){continue}var x=Number(al.w||ab.w)+U;if(r){ad.save();ad.strokeStyle=ad.fillStyle;ad.lineWidth+=ad.lineWidth;ad.beginPath();if(r.underline){ad.moveTo(0,-ab.face["underline-position"]+0.5);ad.lineTo(x,-ab.face["underline-position"]+0.5)}if(r.overline){ad.moveTo(0,ab.ascent+0.5);ad.lineTo(x,ab.ascent+0.5)}if(r["line-through"]){ad.moveTo(0,-ab.descent+0.5);ad.lineTo(x,-ab.descent+0.5)}ad.stroke();ad.restore()}if(u){ad.save();ad.transform(1,0,-0.25,1,0,0)}ad.beginPath();if(al.d){if(al.code){b(al.code,ad)}else{al.code=c("m"+al.d,ad)}}ad.fill();if(A.strokeStyle){ad.closePath();ad.save();ad.lineWidth=A.strokeWidth;ad.strokeStyle=A.strokeStyle;ad.stroke();ad.restore()}if(u){ad.restore()}ad.translate(x,0);am+=x}}ad.save();ae();if(G){for(var aa=0,X=G.length;aa<X;++aa){var N=G[aa];ad.save();ad.translate.apply(ad,R[aa]);Z(N.color);ad.restore()}}Z();ad.restore();ad.restore();ad.restore();return v}})());Cufon.registerEngine("vml",(function(){if(!fabric.document.namespaces){return}var d=fabric.document.createElement("canvas");if(d&&d.getContext&&d.getContext.apply){return}if(fabric.document.namespaces.cvml==null){fabric.document.namespaces.add("cvml","urn:schemas-microsoft-com:vml")}var b=fabric.document.createElement("cvml:shape");b.style.behavior="url(#default#VML)";if(!b.coordsize){return}b=null;fabric.document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}</style>');function c(e,f){return a(e,/(?:em|ex|%)$/i.test(f)?"1em":f)}function a(h,i){if(/px$/i.test(i)){return parseFloat(i)}var g=h.style.left,f=h.runtimeStyle.left;h.runtimeStyle.left=h.currentStyle.left;h.style.left=i;var e=h.style.pixelLeft;h.style.left=g;h.runtimeStyle.left=f;return e}return function(T,z,O,w,D,U,M){var h=(z===null);if(h){z=D.alt}var B=T.viewBox;var j=O.computedFontSize||(O.computedFontSize=new Cufon.CSS.Size(c(U,O.get("fontSize"))+"px",T.baseSize));var L=O.computedLSpacing;if(L==undefined){L=O.get("letterSpacing");O.computedLSpacing=L=(L=="normal")?0:~~j.convertFrom(a(U,L))}var t,m;if(h){t=D;m=D.firstChild}else{t=fabric.document.createElement("span");t.className="cufon cufon-vml";t.alt=z;m=fabric.document.createElement("span");m.className="cufon-vml-canvas";t.appendChild(m);if(w.printable){var R=fabric.document.createElement("span");R.className="cufon-alt";R.appendChild(fabric.document.createTextNode(z));t.appendChild(R)}if(!M){t.appendChild(fabric.document.createElement("cvml:shape"))}}var Z=t.style;var G=m.style;var f=j.convert(B.height),W=Math.ceil(f);var K=W/f;var J=B.minX,I=B.minY;G.height=W;G.top=Math.round(j.convert(I-T.ascent));G.left=Math.round(j.convert(J));Z.height=j.convert(T.height)+"px";var p=Cufon.getTextDecoration(w);var y=O.get("color");var X=Cufon.CSS.textTransform(z,O).split("");var e=0,H=0,q=null;var x,r,A=w.textShadow;for(var S=0,Q=0,P=X.length;S<P;++S){x=T.glyphs[X[S]]||T.missingGlyph;if(x){e+=q=~~(x.w||T.w)+L}}if(q===null){return null}var s=-J+e+(B.width-q);var Y=j.convert(s*K),N=Math.round(Y);var F=s+","+B.height,g;var C="r"+F+"nsnf";for(S=0;S<P;++S){x=T.glyphs[X[S]]||T.missingGlyph;if(!x){continue}if(h){r=m.childNodes[Q];if(r.firstChild){r.removeChild(r.firstChild)}}else{r=fabric.document.createElement("cvml:shape");m.appendChild(r)}r.stroked="f";r.coordsize=F;r.coordorigin=g=(J-H)+","+I;r.path=(x.d?"m"+x.d+"xe":"")+"m"+g+C;r.fillcolor=y;var V=r.style;V.width=N;V.height=W;if(A){var o=A[0],n=A[1];var v=Cufon.CSS.color(o.color),u;var E=fabric.document.createElement("cvml:shadow");E.on="t";E.color=v.color;E.offset=o.offX+","+o.offY;if(n){u=Cufon.CSS.color(n.color);E.type="double";E.color2=u.color;E.offset2=n.offX+","+n.offY}E.opacity=v.opacity||(u&&u.opacity)||1;r.appendChild(E)}H+=~~(x.w||T.w)+L;++Q}Z.width=Math.max(Math.ceil(j.convert(e*K)),0);return t}})());Cufon.getTextDecoration=function(a){return{underline:a.textDecoration==="underline",overline:a.textDecoration==="overline","line-through":a.textDecoration==="line-through"}};if(typeof exports!="undefined"){exports.Cufon=Cufon}var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());if(typeof(Event)==="undefined"){var Event={}}if(typeof(eventjs)==="undefined"){var eventjs=Event}Event=(function(i){i.modifyEventListener=false;i.modifySelectors=false;i.add=function(o,m,n,l){return f(o,m,n,l,"add")};i.remove=function(o,m,n,l){return f(o,m,n,l,"remove")};i.stop=function(l){if(l.stopPropagation){l.stopPropagation()}l.cancelBubble=true;l.bubble=0};i.prevent=function(l){if(l.preventDefault){l.preventDefault()}l.returnValue=false};i.cancel=function(l){i.stop(l);i.prevent(l)};i.supports=function(n,m){if(typeof(n)==="string"){m=n;n=window}m="on"+m;if(m in n){return true}if(!n.setAttribute){n=document.createElement("div")}if(n.setAttribute&&n.removeAttribute){n.setAttribute(m,"");var l=typeof n[m]==="function";if(typeof n[m]!=="undefined"){n[m]=null}n.removeAttribute(m);return l}};var g=function(n){if(!n||typeof(n)!=="object"){return n}var l=new n.constructor();for(var m in n){if(!n[m]||typeof(n[m])!=="object"){l[m]=n[m]}else{l[m]=g(n[m])}}return l};var f=function(D,m,n,C,s,y){C=C||{};if(typeof(D)==="string"&&m==="ready"){var o=(new Date()).getTime();var q=C.timeout;var w=C.interval||1000/60;var z=window.setInterval(function(){if((new Date()).getTime()-o>q){window.clearInterval(z)}if(document.querySelector(D)){window.clearInterval(z);n()}},w);return}if(typeof(D)==="string"){D=document.querySelectorAll(D);if(D.length===0){return d("Missing target on listener!")}if(D.length===1){D=D[0]}}var x;var l={};if(D.length>0){for(var r=0,v=D.length;r<v;r++){x=f(D[r],m,n,g(C),s);if(x){l[r]=x}}return j(l)}if(m.indexOf&&m.indexOf(" ")!==-1){m=m.split(" ")}if(m.indexOf&&m.indexOf(",")!==-1){m=m.split(",")}if(typeof(m)!=="string"){if(typeof(m.length)==="number"){for(var p=0,t=m.length;p<t;p++){x=f(D,m[p],n,g(C),s);if(x){l[m[p]]=x}}}else{for(var E in m){if(typeof(m[E])==="function"){x=f(D,E,m[E],g(C),s)}else{x=f(D,E,m[E].listener,g(m[E]),s)}if(x){l[E]=x}}}return j(l)}if(typeof(n)!=="function"){return d("Listener is not a function!")}var B=C.useCapture||false;var u=c(m)+e(D)+"."+e(n)+"."+(B?1:0);if(i.Gesture&&i.Gesture._gestureHandlers[m]){if(s==="remove"){if(!h[u]){return}h[u].remove();delete h[u]}else{if(s==="add"){if(h[u]){return h[u]}if(C.useCall&&!i.modifyEventListener){var A=n;n=function(H,F){for(var G in F){H[G]=F[G]}return A.call(D,H)}}C.gesture=m;C.target=D;C.listener=n;C.fromOverwrite=y;h[u]=i.proxy[m](C)}}}else{m=c(m);if(s==="remove"){if(!h[u]){return}D[b](m,n,B);delete h[u]}else{if(s==="add"){if(h[u]){return h[u]}D[k](m,n,B);h[u]={type:m,target:D,listener:n,remove:function(){i.remove(D,m,n,C)}}}}}return h[u]};var j=function(l){return{remove:function(){for(var m in l){l[m].remove()}},add:function(){for(var m in l){l[m].add()}}}};var d=function(l){if(typeof(console)==="undefined"){return}if(typeof(console.error)==="undefined"){return}console.error(l)};var c=(function(){var l={};return function(m){if(!i.pointerType){if(window.navigator.msPointerEnabled){i.pointerType="mspointer";l={mousedown:"MSPointerDown",mousemove:"MSPointerMove",mouseup:"MSPointerUp"}}else{if(i.supports("touchstart")){i.pointerType="touch";l={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"}}else{i.pointerType="mouse"}}}if(l[m]){m=l[m]}if(!document.addEventListener){return"on"+m}else{return m}}})();var h={};var a=0;var e=function(l){if(l===window){return"#window"}if(l===document){return"#document"}if(!l){return d("Missing target on listener!")}if(!l.uniqueID){l.uniqueID="id"+a++}return l.uniqueID};var k=document.addEventListener?"addEventListener":"attachEvent";var b=document.removeEventListener?"removeEventListener":"detachEvent";i.createPointerEvent=function(m,r,l){var p=r.gesture;var q=r.target;var s=m.changedTouches||i.proxy.getCoords(m);if(s.length){var t=s[0];r.pointers=l?[]:s;r.pageX=t.pageX;r.pageY=t.pageY;r.x=r.pageX;r.y=r.pageY}var o=document.createEvent("Event");o.initEvent(p,true,true);o.originalEvent=m;for(var n in r){if(n==="target"){continue}o[n]=r[n]}q.dispatchEvent(o)};if(i.modifyEventListener&&window.HTMLElement){(function(){var l=function(n){var m=function(o){var q=o+"EventListener";var p=n[q];n[q]=function(t,u,r){if(i.Gesture&&i.Gesture._gestureHandlers[t]){var s=r;if(typeof(r)==="object"){s.useCall=true}else{s={useCall:true,useCapture:r}}f(this,t,u,s,o,true);p.call(this,t,u,r)}else{p.call(this,c(t),u,r)}}};m("add");m("remove")};if(navigator.userAgent.match(/Firefox/)){l(HTMLDivElement.prototype);l(HTMLCanvasElement.prototype)}else{l(HTMLElement.prototype)}l(document);l(window)})()}if(i.modifySelectors){(function(){var l=NodeList.prototype;l.removeEventListener=function(o,q,m){for(var r=0,p=this.length;r<p;r++){this[r].removeEventListener(o,q,m)}};l.addEventListener=function(o,q,m){for(var r=0,p=this.length;r<p;r++){this[r].addEventListener(o,q,m)}}})()}return i})(Event);if(typeof(Event)==="undefined"){var Event={}}if(typeof(Event.proxy)==="undefined"){Event.proxy={}}Event.proxy=(function(a){a.pointerSetup=function(d,c){d.doc=d.target.ownerDocument||d.target;d.minFingers=d.minFingers||d.fingers||1;d.maxFingers=d.maxFingers||d.fingers||Infinity;d.position=d.position||"relative";delete d.fingers;c=c||{};c.gesture=d.gesture;c.target=d.target;c.pointerType=Event.pointerType;if(Event.modifyEventListener&&d.fromOverwrite){d.listener=Event.createPointerEvent}var b=0;var e=c.gesture.indexOf("pointer")===0&&Event.modifyEventListener?"pointer":"mouse";c.listener=d.listener;c.proxy=function(f){c.defaultListener=d.listener;d.listener=f;f(d.event,c)};c.remove=function(){if(d.onPointerDown){Event.remove(d.target,e+"down",d.onPointerDown)}if(d.onPointerMove){Event.remove(d.doc,e+"move",d.onPointerMove)}if(d.onPointerUp){Event.remove(d.doc,e+"up",d.onPointerUp)}};c.resume=function(f){if(d.onPointerMove&&(!f||f.move)){Event.add(d.doc,e+"move",d.onPointerMove)}if(d.onPointerUp&&(!f||f.move)){Event.add(d.doc,e+"up",d.onPointerUp)}d.fingers=b};c.pause=function(f){b=d.fingers;if(d.onPointerMove&&(!f||f.move)){Event.remove(d.doc,e+"move",d.onPointerMove)}if(d.onPointerUp&&(!f||f.up)){Event.remove(d.doc,e+"up",d.onPointerUp)}d.fingers=0};return c};a.pointerStart=function(c,o,m){var h=function(u,q){var s=m.bbox;var r=f[q]={};switch(m.position){case"absolute":r.offsetX=0;r.offsetY=0;break;case"difference":r.offsetX=u.pageX;r.offsetY=u.pageY;break;case"move":r.offsetX=u.pageX-s.x1;r.offsetY=u.pageY-s.y1;break;default:r.offsetX=s.x1;r.offsetY=s.y1;break}if(m.position==="relative"){var i=(u.pageX+s.scrollLeft-r.offsetX)*s.scaleX;var t=(u.pageY+s.scrollTop-r.offsetY)*s.scaleY}else{var i=(u.pageX-r.offsetX);var t=(u.pageY-r.offsetY)}r.rotation=0;r.scale=1;r.startTime=r.moveTime=(new Date).getTime();r.move={x:i,y:t};r.start={x:i,y:t};m.fingers++};m.event=c;if(o.defaultListener){m.listener=o.defaultListener;delete o.defaultListener}var p=!m.fingers;var f=m.tracker;var l=c.changedTouches||a.getCoords(c);var e=l.length;for(var k=0;k<e;k++){var j=l[k];var d=j.identifier||Infinity;if(m.fingers){if(m.fingers>=m.maxFingers){var b=[];for(var d in m.tracker){b.push(d)}o.identifier=b.join(",");return p}var g=0;for(var n in f){if(f[n].up){delete f[n];h(j,d);m.cancel=true;break}g++}if(f[d]){continue}h(j,d)}else{f=m.tracker={};o.bbox=m.bbox=a.getBoundingBox(m.target);m.fingers=0;m.cancel=false;h(j,d)}}var b=[];for(var d in m.tracker){b.push(d)}o.identifier=b.join(",");return p};a.pointerEnd=function(c,n,l,g){var k=c.touches||[];var f=k.length;var m={};for(var j=0;j<f;j++){var h=k[j];var d=h.identifier;m[d||Infinity]=true}for(var d in l.tracker){var e=l.tracker[d];if(m[d]||e.up){continue}if(g){g({pageX:e.pageX,pageY:e.pageY,changedTouches:[{pageX:e.pageX,pageY:e.pageY,identifier:d==="Infinity"?Infinity:d}]},"up")}e.up=true;l.fingers--}if(l.fingers!==0){return false}var b=[];l.gestureFingers=0;for(var d in l.tracker){l.gestureFingers++;b.push(d)}n.identifier=b.join(",");return true};a.getCoords=function(b){if(typeof(b.pageX)!=="undefined"){a.getCoords=function(c){return Array({type:"mouse",x:c.pageX,y:c.pageY,pageX:c.pageX,pageY:c.pageY,identifier:Infinity})}}else{a.getCoords=function(c){c=c||window.event;return Array({type:"mouse",x:c.clientX+document.documentElement.scrollLeft,y:c.clientY+document.documentElement.scrollTop,pageX:c.clientX+document.documentElement.scrollLeft,pageY:c.clientY+document.documentElement.scrollTop,identifier:Infinity})}}return a.getCoords(b)};a.getCoord=function(d){if("ontouchstart" in window){var c=0;var b=0;a.getCoord=function(e){var f=e.changedTouches;if(f.length){return{x:c=f[0].pageX,y:b=f[0].pageY}}else{return{x:c,y:b}}}}else{if(typeof(d.pageX)!=="undefined"&&typeof(d.pageY)!=="undefined"){a.getCoord=function(e){return{x:e.pageX,y:e.pageY}}}else{a.getCoord=function(e){e=e||window.event;return{x:e.clientX+document.documentElement.scrollLeft,y:e.clientY+document.documentElement.scrollTop}}}}return a.getCoord(d)};a.getBoundingBox=function(d){if(d===window||d===document){d=document.body}var c={x1:0,y1:0,x2:0,y2:0,scrollLeft:0,scrollTop:0};if(d===document.body){c.height=window.innerHeight;c.width=window.innerWidth}else{c.height=d.offsetHeight;c.width=d.offsetWidth}c.scaleX=d.width/c.width||1;c.scaleY=d.height/c.height||1;var b=d;while(b!==null){c.x1+=b.offsetLeft;c.y1+=b.offsetTop;b=b.offsetParent}var b=d.parentNode;while(b!==null){if(b===document.body){break}if(b.scrollTop===undefined){break}c.scrollLeft+=b.scrollLeft;c.scrollTop+=b.scrollTop;b=b.parentNode}c.x2=c.x1+c.width;c.y2=c.y1+c.height;return c};(function(){var b=navigator.userAgent.toLowerCase();var d=b.indexOf("macintosh")!==-1;if(d&&b.indexOf("khtml")!==-1){var c={91:true,93:true}}else{if(d&&b.indexOf("firefox")!==-1){var c={224:true}}else{var c={17:true}}}a.isMetaKey=function(e){return !!c[e.keyCode]};a.metaTracker=function(e){if(c[e.keyCode]){a.metaKey=e.type==="keydown"}}})();return a})(Event.proxy);if(typeof(Event)==="undefined"){var Event={}}if(typeof(Event.proxy)==="undefined"){Event.proxy={}}Event.proxy=(function(a){a.click=function(c){c.maxFingers=c.maxFingers||c.fingers||1;var d;c.onPointerDown=function(e){if(a.pointerStart(e,b,c)){Event.add(c.doc,"mousemove",c.onPointerMove).listener(e);Event.add(c.doc,"mouseup",c.onPointerUp)}};c.onPointerMove=function(e){d=e};c.onPointerUp=function(g){if(a.pointerEnd(g,b,c)){Event.remove(c.doc,"mousemove",c.onPointerMove);Event.remove(c.doc,"mouseup",c.onPointerUp);if(d.cancelBubble&&++d.bubble>1){return}var e=d.changedTouches||a.getCoords(d);var j=e[0];var i=c.bbox;var k=a.getBoundingBox(c.target);if(c.position==="relative"){var h=(j.pageX+i.scrollLeft-i.x1)*i.scaleX;var f=(j.pageY+i.scrollTop-i.y1)*i.scaleY}else{var h=(j.pageX-i.x1);var f=(j.pageY-i.y1)}if(h>0&&h<i.width&&f>0&&f<i.height&&i.scrollTop===k.scrollTop){c.listener(d,b)}}};var b=a.pointerSetup(c);b.state="click";Event.add(c.target,"mousedown",c.onPointerDown);return b};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.click=a.click;return a})(Event.proxy);if(typeof(Event)==="undefined"){var Event={}}if(typeof(Event.proxy)==="undefined"){Event.proxy={}}Event.proxy=(function(a){a.dbltap=a.dblclick=function(f){f.maxFingers=f.maxFingers||f.fingers||1;var e=700;var i,h,g;var d,c;f.onPointerDown=function(k){var j=k.changedTouches||a.getCoords(k);if(i&&!h){c=j[0];h=(new Date).getTime()-i}else{d=j[0];i=(new Date).getTime();h=0;clearTimeout(g);g=setTimeout(function(){i=0},e)}if(a.pointerStart(k,b,f)){Event.add(f.doc,"mousemove",f.onPointerMove).listener(k);Event.add(f.doc,"mouseup",f.onPointerUp)}};f.onPointerMove=function(l){if(i&&!h){var j=l.changedTouches||a.getCoords(l);c=j[0]}var n=f.bbox;if(f.position==="relative"){var m=(c.pageX+n.scrollLeft-n.x1)*n.scaleX;var k=(c.pageY+n.scrollTop-n.y1)*n.scaleY}else{var m=(c.pageX-n.x1);var k=(c.pageY-n.y1)}if(!(m>0&&m<n.width&&k>0&&k<n.height&&Math.abs(c.pageX-d.pageX)<=25&&Math.abs(c.pageY-d.pageY)<=25)){Event.remove(f.doc,"mousemove",f.onPointerMove);clearTimeout(g);i=h=0}};f.onPointerUp=function(j){if(a.pointerEnd(j,b,f)){Event.remove(f.doc,"mousemove",f.onPointerMove);Event.remove(f.doc,"mouseup",f.onPointerUp)}if(i&&h){if(h<=e&&!(j.cancelBubble&&++j.bubble>1)){b.state=f.gesture;f.listener(j,b)}clearTimeout(g);i=h=0}};var b=a.pointerSetup(f);b.state="dblclick";Event.add(f.target,"mousedown",f.onPointerDown);return b};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.dbltap=a.dbltap;Event.Gesture._gestureHandlers.dblclick=a.dblclick;return a})(Event.proxy);if(typeof(Event)==="undefined"){var Event={}}if(typeof(Event.proxy)==="undefined"){Event.proxy={}}Event.proxy=(function(a){a.dragElement=function(c,b){a.drag({event:b,target:c,position:"move",listener:function(e,d){c.style.left=d.x+"px";c.style.top=d.y+"px";Event.prevent(e)}})};a.drag=function(c){c.gesture="drag";c.onPointerDown=function(d){if(a.pointerStart(d,b,c)){if(!c.monitor){Event.add(c.doc,"mousemove",c.onPointerMove);Event.add(c.doc,"mouseup",c.onPointerUp)}}c.onPointerMove(d,"down")};c.onPointerMove=function(e,d){if(!c.tracker){return c.onPointerDown(e)}var l=c.bbox;var j=e.changedTouches||a.getCoords(e);var f=j.length;for(var h=0;h<f;h++){var g=j[h];var k=g.identifier||Infinity;var m=c.tracker[k];if(!m){continue}m.pageX=g.pageX;m.pageY=g.pageY;b.state=d||"move";b.identifier=k;b.start=m.start;b.fingers=c.fingers;if(c.position==="relative"){b.x=(m.pageX+l.scrollLeft-m.offsetX)*l.scaleX;b.y=(m.pageY+l.scrollTop-m.offsetY)*l.scaleY}else{b.x=(m.pageX-m.offsetX);b.y=(m.pageY-m.offsetY)}c.listener(e,b)}};c.onPointerUp=function(d){if(a.pointerEnd(d,b,c,c.onPointerMove)){if(!c.monitor){Event.remove(c.doc,"mousemove",c.onPointerMove);Event.remove(c.doc,"mouseup",c.onPointerUp)}}};var b=a.pointerSetup(c);if(c.event){c.onPointerDown(c.event)}else{Event.add(c.target,"mousedown",c.onPointerDown);if(c.monitor){Event.add(c.doc,"mousemove",c.onPointerMove);Event.add(c.doc,"mouseup",c.onPointerUp)}}return b};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.drag=a.drag;return a})(Event.proxy);if(typeof(Event)==="undefined"){var Event={}}if(typeof(Event.proxy)==="undefined"){Event.proxy={}}Event.proxy=(function(a){var b=Math.PI/180;a.gesture=function(d){d.minFingers=d.minFingers||d.fingers||2;d.onPointerDown=function(h){var f=d.fingers;if(a.pointerStart(h,c,d)){Event.add(d.doc,"mousemove",d.onPointerMove);Event.add(d.doc,"mouseup",d.onPointerUp)}if(d.fingers===d.minFingers&&f!==d.fingers){c.fingers=d.minFingers;c.scale=1;c.rotation=0;c.state="start";var e="";for(var g in d.tracker){e+=g}c.identifier=parseInt(e);d.listener(h,c)}};d.onPointerMove=function(t,k){var e=d.bbox;var v=d.tracker;var o=t.changedTouches||a.getCoords(t);var g=o.length;for(var w=0;w<g;w++){var l=o[w];var h=l.identifier||Infinity;var q=v[h];if(!q){continue}if(d.position==="relative"){q.move.x=(l.pageX+e.scrollLeft-e.x1)*e.scaleX;q.move.y=(l.pageY+e.scrollTop-e.y1)*e.scaleY}else{q.move.x=(l.pageX-e.x1);q.move.y=(l.pageY-e.y1)}}if(d.fingers<d.minFingers){return}var o=[];var y=0;var s=0;var r=0;var p=0;var g=0;for(var h in v){var l=v[h];if(l.up){continue}r+=l.move.x;p+=l.move.y;g++}r/=g;p/=g;for(var h in v){var l=v[h];if(l.up){continue}var j=l.start;if(!j.distance){var n=j.x-r;var m=j.y-p;j.distance=Math.sqrt(n*n+m*m);j.angle=Math.atan2(n,m)/b}var n=l.move.x-r;var m=l.move.y-p;var f=Math.sqrt(n*n+m*m);y+=f/j.distance;var x=Math.atan2(n,m)/b;var u=(j.angle-x+360)%360-180;l.DEG2=l.DEG1;l.DEG1=u>0?u:-u;if(typeof(l.DEG2)!=="undefined"){if(u>0){l.rotation+=l.DEG1-l.DEG2}else{l.rotation-=l.DEG1-l.DEG2}s+=l.rotation}o.push(l.move)}c.touches=o;c.fingers=d.fingers;c.scale=y/d.fingers;c.rotation=s/d.fingers;c.state="change";d.listener(t,c)};d.onPointerUp=function(f){var e=d.fingers;if(a.pointerEnd(f,c,d)){Event.remove(d.doc,"mousemove",d.onPointerMove);Event.remove(d.doc,"mouseup",d.onPointerUp)}if(e===d.minFingers&&d.fingers<d.minFingers){c.fingers=d.fingers;c.state="end";d.listener(f,c)}};var c=a.pointerSetup(d);Event.add(d.target,"mousedown",d.onPointerDown);return c};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.gesture=a.gesture;return a})(Event.proxy);if(typeof(Event)==="undefined"){var Event={}}if(typeof(Event.proxy)==="undefined"){Event.proxy={}}Event.proxy=(function(a){a.pointerdown=a.pointermove=a.pointerup=function(d){if(d.target.isPointerEmitter){return}var b=true;d.onPointerDown=function(e){b=false;c.gesture="pointerdown";d.listener(e,c)};d.onPointerMove=function(e){c.gesture="pointermove";d.listener(e,c,b)};d.onPointerUp=function(e){b=true;c.gesture="pointerup";d.listener(e,c,true)};var c=a.pointerSetup(d);Event.add(d.target,"mousedown",d.onPointerDown);Event.add(d.target,"mousemove",d.onPointerMove);Event.add(d.doc,"mouseup",d.onPointerUp);d.target.isPointerEmitter=true;return c};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.pointerdown=a.pointerdown;Event.Gesture._gestureHandlers.pointermove=a.pointermove;Event.Gesture._gestureHandlers.pointerup=a.pointerup;return a})(Event.proxy);if(typeof(Event)==="undefined"){var Event={}}if(typeof(Event.proxy)==="undefined"){Event.proxy={}}Event.proxy=(function(a){a.shake=function(f){var k={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:f.target,listener:f.listener,remove:function(){window.removeEventListener("devicemotion",e,false)}};var d=4;var g=1000;var h=200;var b=3;var c=(new Date).getTime();var j={x:0,y:0,z:0};var i={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}};var e=function(w){var s=0.8;var m=w.accelerationIncludingGravity;j.x=s*j.x+(1-s)*m.x;j.y=s*j.y+(1-s)*m.y;j.z=s*j.z+(1-s)*m.z;k.accelerationIncludingGravity=j;k.acceleration.x=m.x-j.x;k.acceleration.y=m.y-j.y;k.acceleration.z=m.z-j.z;if(f.gesture==="devicemotion"){f.listener(w,k);return}var t="xyz";var l=(new Date).getTime();for(var q=0,p=t.length;q<p;q++){var r=t[q];var v=k.acceleration[r];var u=i[r];var z=Math.abs(v);if(l-c<g){continue}if(z>d){var y=l*v/z;var x=Math.abs(y+u.value);if(u.value&&x<h){u.value=y;u.count++;if(u.count===b){f.listener(w,k);c=l;u.value=0;u.count=0}}else{u.value=y;u.count=1}}}};if(!window.addEventListener){return}window.addEventListener("devicemotion",e,false);return k};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.shake=a.shake;return a})(Event.proxy);if(typeof(Event)==="undefined"){var Event={}}if(typeof(Event.proxy)==="undefined"){Event.proxy={}}Event.proxy=(function(a){var b=Math.PI/180;a.swipe=function(d){d.snap=d.snap||90;d.threshold=d.threshold||1;d.onPointerDown=function(e){if(a.pointerStart(e,c,d)){Event.add(d.doc,"mousemove",d.onPointerMove).listener(e);Event.add(d.doc,"mouseup",d.onPointerUp)}};d.onPointerMove=function(h){var j=h.changedTouches||a.getCoords(h);var g=j.length;for(var f=0;f<g;f++){var l=j[f];var e=l.identifier||Infinity;var k=d.tracker[e];if(!k){continue}k.move.x=l.pageX;k.move.y=l.pageY;k.moveTime=(new Date).getTime()}};d.onPointerUp=function(g){if(a.pointerEnd(g,c,d)){Event.remove(d.doc,"mousemove",d.onPointerMove);Event.remove(d.doc,"mouseup",d.onPointerUp);var q;var p;var m;var j;var i={x:0,y:0};var s=0;var r=0;var l=0;for(var h in d.tracker){var o=d.tracker[h];var n=o.move.x-o.start.x;var k=o.move.y-o.start.y;s+=o.move.x;r+=o.move.y;i.x+=o.start.x;i.y+=o.start.y;l++;var f=Math.sqrt(n*n+k*k);var e=o.moveTime-o.startTime;var j=Math.atan2(n,k)/b+180;var p=e?f/e:0;if(typeof(m)==="undefined"){m=j;q=p}else{if(Math.abs(j-m)<=20){m=(m+j)/2;q=(q+p)/2}else{return}}}if(q>d.threshold){i.x/=l;i.y/=l;c.start=i;c.x=s/l;c.y=r/l;c.angle=-((((m/d.snap+0.5)>>0)*d.snap||360)-360);c.velocity=q;c.fingers=d.gestureFingers;c.state="swipe";d.listener(g,c)}}};var c=a.pointerSetup(d);Event.add(d.target,"mousedown",d.onPointerDown);return c};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.swipe=a.swipe;return a})(Event.proxy);if(typeof(Event)==="undefined"){var Event={}}if(typeof(Event.proxy)==="undefined"){Event.proxy={}}Event.proxy=(function(a){a.tap=a.longpress=function(c){c.delay=c.delay||500;c.timeout=c.timeout||250;var e,d;c.onPointerDown=function(f){if(a.pointerStart(f,b,c)){e=(new Date).getTime();Event.add(c.doc,"mousemove",c.onPointerMove).listener(f);Event.add(c.doc,"mouseup",c.onPointerUp);if(c.gesture!=="longpress"){return}d=setTimeout(function(){if(f.cancelBubble&&++f.bubble>1){return}var g=0;for(var h in c.tracker){if(c.tracker[h].end===true){return}if(c.cancel){return}g++}b.state="start";b.fingers=g;c.listener(f,b)},c.delay)}};c.onPointerMove=function(f){var o=c.bbox;var k=f.changedTouches||a.getCoords(f);var g=k.length;for(var j=0;j<g;j++){var h=k[j];var l=h.identifier||Infinity;var p=c.tracker[l];if(!p){continue}if(c.position==="relative"){var n=(h.pageX+o.scrollLeft-o.x1)*o.scaleX;var m=(h.pageY+o.scrollTop-o.y1)*o.scaleY}else{var n=(h.pageX-o.x1);var m=(h.pageY-o.y1)}if(!(n>0&&n<o.width&&m>0&&m<o.height&&Math.abs(n-p.start.x)<=25&&Math.abs(m-p.start.y)<=25)){Event.remove(c.doc,"mousemove",c.onPointerMove);c.cancel=true;return}}};c.onPointerUp=function(f){if(a.pointerEnd(f,b,c)){clearTimeout(d);Event.remove(c.doc,"mousemove",c.onPointerMove);Event.remove(c.doc,"mouseup",c.onPointerUp);if(f.cancelBubble&&++f.bubble>1){return}if(c.gesture==="longpress"){if(b.state==="start"){b.state="end";c.listener(f,b)}return}if(c.cancel){return}if((new Date).getTime()-e>c.timeout){return}b.state="tap";b.fingers=c.gestureFingers;c.listener(f,b)}};var b=a.pointerSetup(c);Event.add(c.target,"mousedown",c.onPointerDown);return b};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.tap=a.tap;Event.Gesture._gestureHandlers.longpress=a.longpress;return a})(Event.proxy);if(typeof(Event)==="undefined"){var Event={}}if(typeof(Event.proxy)==="undefined"){Event.proxy={}}Event.proxy=(function(a){a.wheel=function(f){var c;var h=f.timeout||150;var e=0;var j={gesture:"wheel",state:"start",wheelDelta:0,target:f.target,listener:f.listener,remove:function(){f.target[d](g,b,false)}};var b=function(k){k=k||window.event;j.state=e++?"change":"start";j.wheelDelta=k.detail?k.detail*-20:k.wheelDelta;f.listener(k,j);clearTimeout(c);c=setTimeout(function(){e=0;j.state="end";j.wheelDelta=0;f.listener(k,j)},h)};var i=document.addEventListener?"addEventListener":"attachEvent";var d=document.removeEventListener?"removeEventListener":"detachEvent";var g=Event.supports("mousewheel")?"mousewheel":"DOMMouseScroll";f.target[i](g,b,false);return j};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.wheel=a.wheel;return a})(Event.proxy);fabric.log=function(){};fabric.warn=function(){};if(typeof console!=="undefined"){if(typeof console.log!=="undefined"&&console.log.apply){fabric.log=function(){return console.log.apply(console,arguments)}}if(typeof console.warn!=="undefined"&&console.warn.apply){fabric.warn=function(){return console.warn.apply(console,arguments)}}}(function(){function c(d,e){if(!this.__eventListeners){this.__eventListeners={}}if(arguments.length===1){for(var f in d){this.on(f,d[f])}}else{if(!this.__eventListeners[d]){this.__eventListeners[d]=[]}this.__eventListeners[d].push(e)}}function a(d,e){if(!this.__eventListeners){this.__eventListeners={}}if(this.__eventListeners[d]){if(e){fabric.util.removeFromArray(this.__eventListeners[d],e)}else{this.__eventListeners[d].length=0}}}function b(f,g){if(!this.__eventListeners){this.__eventListeners={}}var e=this.__eventListeners[f];if(!e){return}for(var h=0,d=e.length;h<d;h++){e[h](g||{})}}fabric.Observable={observe:c,stopObserving:a,fire:b,on:c,off:a,trigger:b}})();fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var a=arguments.length;a--;){this._onObjectAdded(arguments[a])}this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(b,a,d){var c=this.getObjects();if(d){c[a]=b}else{c.splice(a,0,b)}this._onObjectAdded(b);this.renderOnAddRemove&&this.renderAll();return this},remove:function(b){var c=this.getObjects(),a=c.indexOf(b);if(a!==-1){c.splice(a,1);this._onObjectRemoved(b)}this.renderOnAddRemove&&this.renderAll();return b},forEachObject:function(d,b){var c=this.getObjects(),a=c.length;while(a--){d.call(b,c[a],a,c)}return this},item:function(a){return this.getObjects()[a]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(a){return this.getObjects().indexOf(a)>-1},complexity:function(){return this.getObjects().reduce(function(a,b){a+=b.complexity?b.complexity():0;return a},0)},toGrayscale:function(){return this.forEachObject(function(a){a.toGrayscale()})}};(function(){var D=Math.sqrt,c=Math.atan2;fabric.util={};function p(G,F){var E=G.indexOf(F);if(E!==-1){G.splice(E,1)}return G}function g(F,E){return Math.floor(Math.random()*(E-F+1))+F}var a=Math.PI/180;function t(E){return E*a}function m(E){return E/a}function i(E,G,K){var F=Math.sin(K),I=Math.cos(K);E.subtractEquals(G);var J=E.x*I-E.y*F;var H=E.x*F+E.y*I;return new fabric.Point(J,H).addEquals(G)}function r(F,E){return parseFloat(Number(F).toFixed(E))}function o(){return false}function A(F,E){return w(E)[fabric.util.string.camelize(fabric.util.string.capitalize(F))]}function w(G){if(!G){return fabric}var I=G.split("."),E=I.length,H=fabric.window;for(var F=0;F<E;++F){H=H[I[F]]}return H}function d(F,H,G){if(F){var E=fabric.util.createImage();E.onload=function(){H&&H.call(G,E);E=E.onload=null};E.src=F}else{H&&H.call(G,F)}}function k(H,K,F){function G(){if(++J===E){if(K){K(I)}}}var I=[],J=0,E=H.length;H.forEach(function(N,M){if(!N.type){return}var L=fabric.util.getKlass(N.type,F);if(L.async){L.fromObject(N,function(P,O){if(!O){I[M]=P}G()})}else{I[M]=L.fromObject(N);G()}})}function y(G,F,H){var E;if(G.length>1){E=new fabric.PathGroup(G,F)}else{E=G[0]}if(typeof H!=="undefined"){E.setSourcePath(H)}return E}function q(I,F,H){if(H&&Object.prototype.toString.call(H)==="[object Array]"){for(var G=0,E=H.length;G<E;G++){if(H[G] in I){F[H[G]]=I[H[G]]}}}}function l(N,L,I,E,J,P){var Q=E-L,O=J-I,G=D(Q*Q+O*O),F=c(O,Q),M=P.length,H=0,K=true;N.save();N.translate(L,I);N.moveTo(0,0);N.rotate(F);L=0;while(G>L){L+=P[H++%M];if(L>G){L=G}N[K?"lineTo":"moveTo"](L,0);K=!K}N.restore()}function f(E){E||(E=fabric.document.createElement("canvas"));if(!E.getContext&&typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(E)}return E}function C(){return fabric.isLikelyNode?new (require("canvas").Image)():fabric.document.createElement("img")}function b(E){var I=E.prototype;for(var G=I.stateProperties.length;G--;){var J=I.stateProperties[G],K=J.charAt(0).toUpperCase()+J.slice(1),F="set"+K,H="get"+K;if(!I[H]){I[H]=(function(L){return new Function('return this.get("'+L+'")')})(J)}if(!I[F]){I[F]=(function(L){return new Function("value",'return this.set("'+L+'", value)')})(J)}}}function n(F,E){E.save();E.beginPath();F.clipTo(E);E.clip()}function v(H,F){var L=[[H[0],H[2],H[4]],[H[1],H[3],H[5]],[0,0,1]];var K=[[F[0],F[2],F[4]],[F[1],F[3],F[5]],[0,0,1]];var M=[];for(var E=0;E<3;E++){M[E]=[];for(var J=0;J<3;J++){var I=0;for(var G=0;G<3;G++){I+=L[E][G]*K[G][J]}M[E][J]=I}}return[M[0][0],M[1][0],M[0][1],M[1][1],M[0][2],M[1][2]]}function j(E){return(String(E).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]}function h(R,N,L,M){var G=M[0];var E=M[1];var H=M[2];var P=M[3];var Q=M[4];var K=M[5];var J=M[6];var F=x(K,J,G,E,P,Q,H,N,L);for(var I=0;I<F.length;I++){var O=z.apply(this,F[I]);R.bezierCurveTo.apply(R,O)}}var u={},s={},e=Array.prototype.join,B;function x(af,ae,aa,Z,V,ab,S,Y,X){B=e.call(arguments);if(u[B]){return u[B]}var F=S*(Math.PI/180);var ai=Math.sin(F);var am=Math.cos(F);aa=Math.abs(aa);Z=Math.abs(Z);var M=am*(Y-af)*0.5+ai*(X-ae)*0.5;var L=am*(X-ae)*0.5-ai*(Y-af)*0.5;var Q=(M*M)/(aa*aa)+(L*L)/(Z*Z);if(Q>1){Q=Math.sqrt(Q);aa*=Q;Z*=Q}var ad=am/aa;var ac=ai/aa;var P=(-ai)/Z;var O=(am)/Z;var T=ad*Y+ac*X;var E=P*Y+O*X;var R=ad*af+ac*ae;var an=P*af+O*ae;var al=(R-T)*(R-T)+(an-E)*(an-E);var ag=1/al-0.25;if(ag<0){ag=0}var K=Math.sqrt(ag);if(ab===V){K=-K}var ah=0.5*(T+R)-K*(an-E);var W=0.5*(E+an)+K*(R-T);var J=Math.atan2(E-W,T-ah);var I=Math.atan2(an-W,R-ah);var ak=I-J;if(ak<0&&ab===1){ak+=2*Math.PI}else{if(ak>0&&ab===0){ak-=2*Math.PI}}var N=Math.ceil(Math.abs(ak/(Math.PI*0.5+0.001)));var U=[];for(var aj=0;aj<N;aj++){var H=J+aj*ak/N;var G=J+(aj+1)*ak/N;U[aj]=[ah,W,H,G,aa,Z,ai,am]}u[B]=U;return U}function z(J,G,R,P,L,K,H,Q){B=e.call(arguments);if(s[B]){return s[B]}var X=Q*L;var W=-H*K;var N=H*L;var M=Q*K;var S=0.5*(P-R);var O=(8/3)*Math.sin(S*0.5)*Math.sin(S*0.5)/Math.sin(S);var V=J+Math.cos(R)-O*Math.sin(R);var I=G+Math.sin(R)+O*Math.cos(R);var T=J+Math.cos(P);var E=G+Math.sin(P);var U=T+O*Math.sin(P);var F=E-O*Math.cos(P);s[B]=[X*V+W*I,N*V+M*I,X*U+W*F,N*U+M*F,X*T+W*E,N*T+M*E];return s[B]}fabric.util.removeFromArray=p;fabric.util.degreesToRadians=t;fabric.util.radiansToDegrees=m;fabric.util.rotatePoint=i;fabric.util.toFixed=r;fabric.util.getRandomInt=g;fabric.util.falseFunction=o;fabric.util.getKlass=A;fabric.util.resolveNamespace=w;fabric.util.loadImage=d;fabric.util.enlivenObjects=k;fabric.util.groupSVGElements=y;fabric.util.populateWithProperties=q;fabric.util.drawDashedLine=l;fabric.util.createCanvasElement=f;fabric.util.createImage=C;fabric.util.createAccessors=b;fabric.util.clipContext=n;fabric.util.multiplyTransformMatrices=v;fabric.util.getFunctionBody=j;fabric.util.drawArc=h})();(function(){var d=Array.prototype.slice;if(!Array.prototype.indexOf){Array.prototype.indexOf=function(g){if(this===void 0||this===null){throw new TypeError()}var h=Object(this),e=h.length>>>0;if(e===0){return -1}var i=0;if(arguments.length>0){i=Number(arguments[1]);if(i!==i){i=0}else{if(i!==0&&i!==Number.POSITIVE_INFINITY&&i!==Number.NEGATIVE_INFINITY){i=(i>0||-1)*Math.floor(Math.abs(i))}}}if(i>=e){return -1}var f=i>=0?i:Math.max(e-Math.abs(i),0);for(;f<e;f++){if(f in h&&h[f]===g){return f}}return -1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(h,g){for(var f=0,e=this.length>>>0;f<e;f++){if(f in this){h.call(g,this[f],f,this)}}}}if(!Array.prototype.map){Array.prototype.map=function(j,h){var f=[];for(var g=0,e=this.length>>>0;g<e;g++){if(g in this){f[g]=j.call(h,this[g],g,this)}}return f}}if(!Array.prototype.every){Array.prototype.every=function(h,g){for(var f=0,e=this.length>>>0;f<e;f++){if(f in this&&!h.call(g,this[f],f,this)){return false}}return true}}if(!Array.prototype.some){Array.prototype.some=function(h,g){for(var f=0,e=this.length>>>0;f<e;f++){if(f in this&&h.call(g,this[f],f,this)){return true}}return false}}if(!Array.prototype.filter){Array.prototype.filter=function(j,h){var f=[],k;for(var g=0,e=this.length>>>0;g<e;g++){if(g in this){k=this[g];if(j.call(h,k,g,this)){f.push(k)}}}return f}}if(!Array.prototype.reduce){Array.prototype.reduce=function(g){var e=this.length>>>0,f=0,h;if(arguments.length>1){h=arguments[1]}else{do{if(f in this){h=this[f++];break}if(++f>=e){throw new TypeError()}}while(true)}for(;f<e;f++){if(f in this){h=g.call(null,h,this[f],f,this)}}return h}}function b(k,j){var g=d.call(arguments,2),f=[];for(var h=0,e=k.length;h<e;h++){f[h]=g.length?k[h][j].apply(k[h],g):k[h][j].call(k[h])}return f}function a(h,g){if(!h||h.length===0){return undefined}var f=h.length-1,e=g?h[f][g]:h[f];if(g){while(f--){if(h[f][g]>=e){e=h[f][g]}}}else{while(f--){if(h[f]>=e){e=h[f]}}}return e}function c(h,g){if(!h||h.length===0){return undefined}var f=h.length-1,e=g?h[f][g]:h[f];if(g){while(f--){if(h[f][g]<e){e=h[f][g]}}}else{while(f--){if(h[f]<e){e=h[f]}}}return e}fabric.util.array={invoke:b,min:c,max:a}})();(function(){function b(c,e){for(var d in e){c[d]=e[d]}return c}function a(c){return b({},c)}fabric.util.object={extend:b,clone:a}})();(function(){if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}}function b(d){return d.replace(/-+(.)?/g,function(e,f){return f?f.toUpperCase():""})}function c(d){return d.charAt(0).toUpperCase()+d.slice(1).toLowerCase()}function a(d){return d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}fabric.util.string={camelize:b,capitalize:c,escapeXml:a}}());(function(){var c=Array.prototype.slice,a=Function.prototype.apply,b=function(){};if(!Function.prototype.bind){Function.prototype.bind=function(d){var g=this,e=c.call(arguments,1),f;if(e.length){f=function(){return a.call(g,this instanceof b?this:d,e.concat(c.call(arguments)))}}else{f=function(){return a.call(g,this instanceof b?this:d,arguments)}}b.prototype=this.prototype;f.prototype=new b();return f}}})();(function(){var g=Array.prototype.slice,f=function(){};var d=(function(){for(var h in {toString:1}){if(h==="toString"){return false}}return true})();var c=function(h,k,i){for(var j in k){if(j in h.prototype&&typeof h.prototype[j]==="function"&&(k[j]+"").indexOf("callSuper")>-1){h.prototype[j]=(function(l){return function(){var n=this.constructor.superclass;this.constructor.superclass=i;var m=k[l].apply(this,arguments);this.constructor.superclass=n;if(l!=="initialize"){return m}}})(j)}else{h.prototype[j]=k[j]}if(d){if(k.toString!==Object.prototype.toString){h.prototype.toString=k.toString}if(k.valueOf!==Object.prototype.valueOf){h.prototype.valueOf=k.valueOf}}}};function b(){}function a(h){var i=this.constructor.superclass.prototype[h];return(arguments.length>1)?i.apply(this,g.call(arguments,1)):i.call(this)}function e(){var l=null,k=g.call(arguments,0);if(typeof k[0]==="function"){l=k.shift()}function h(){this.initialize.apply(this,arguments)}h.superclass=l;h.subclasses=[];if(l){b.prototype=l.prototype;h.prototype=new b();l.subclasses.push(h)}for(var j=0,m=k.length;j<m;j++){c(h,k[j],l)}if(!h.prototype.initialize){h.prototype.initialize=f}h.prototype.constructor=h;h.prototype.callSuper=a;return h}fabric.util.createClass=e})();(function(){function g(r){var v=Array.prototype.slice.call(arguments,1),u,s,q=v.length;for(s=0;s<q;s++){u=typeof r[v[s]];if(!(/^(?:function|object|unknown)$/).test(u)){return false}}return true}var d=(function(){var q=0;return function(r){return r.__uniqueID||(r.__uniqueID="uniqueID__"+q++)}})();var e,c;(function(){var q={};e=function(r){return q[r]};c=function(s,r){q[s]=r}})();function h(q,r){return{handler:r,wrappedHandler:k(q,r)}}function k(q,r){return function(s){r.call(e(q),s||fabric.window.event)}}function i(r,q){return function(v){if(f[r]&&f[r][q]){var t=f[r][q];for(var u=0,s=t.length;u<s;u++){t[u].call(this,v||fabric.window.event)}}}}var n=(g(fabric.document.documentElement,"addEventListener","removeEventListener")&&g(fabric.window,"addEventListener","removeEventListener")),l=(g(fabric.document.documentElement,"attachEvent","detachEvent")&&g(fabric.window,"attachEvent","detachEvent")),m={},f={},b,j;if(n){b=function(r,q,s){r.addEventListener(q,s,false)};j=function(r,q,s){r.removeEventListener(q,s,false)}}else{if(l){b=function(s,q,t){var r=d(s);c(r,s);if(!m[r]){m[r]={}}if(!m[r][q]){m[r][q]=[]}var u=h(r,t);m[r][q].push(u);s.attachEvent("on"+q,u.wrappedHandler)};j=function(u,r,v){var t=d(u),w;if(m[t]&&m[t][r]){for(var s=0,q=m[t][r].length;s<q;s++){w=m[t][r][s];if(w&&w.handler===v){u.detachEvent("on"+r,w.wrappedHandler);m[t][r][s]=null}}}}}else{b=function(s,q,t){var r=d(s);if(!f[r]){f[r]={}}if(!f[r][q]){f[r][q]=[];var u=s["on"+q];if(u){f[r][q].push(u)}s["on"+q]=i(r,q)}f[r][q].push(t)};j=function(v,s,w){var u=d(v);if(f[u]&&f[u][s]){var r=f[u][s];for(var t=0,q=r.length;t<q;t++){if(r[t]===w){r.splice(t,1)}}}}}}fabric.util.addListener=b;fabric.util.removeListener=j;function p(r,x){r||(r=fabric.window.event);var w=r.target||(typeof r.srcElement!=="unknown"?r.srcElement:null),y=fabric.document.body||{scrollLeft:0,scrollTop:0},t=fabric.document.documentElement,v=w,u=0,s=0,q;while(w&&w.parentNode&&!q){w=w.parentNode;if(w!==fabric.document&&fabric.util.getElementStyle(w,"position")==="fixed"){q=w}if(w!==fabric.document&&v!==x&&fabric.util.getElementStyle(w,"position")==="absolute"){u=0;s=0}else{if(w===fabric.document){u=y.scrollLeft||t.scrollLeft||0;s=y.scrollTop||t.scrollTop||0}else{u+=w.scrollLeft||0;s+=w.scrollTop||0}}}return{x:a(r)+u,y:o(r)+s}}var a=function(q){return(typeof q.clientX!=="unknown"?q.clientX:0)};var o=function(q){return(typeof q.clientY!=="unknown"?q.clientY:0)};if(fabric.isTouchSupported){a=function(q){if(q.type!=="touchend"){return(q.touches&&q.touches[0]?(q.touches[0].pageX-(q.touches[0].pageX-q.touches[0].clientX))||q.clientX:q.clientX)}return(q.changedTouches&&q.changedTouches[0]?(q.changedTouches[0].pageX-(q.changedTouches[0].pageX-q.changedTouches[0].clientX))||q.clientX:q.clientX)};o=function(q){if(q.type!=="touchend"){return(q.touches&&q.touches[0]?(q.touches[0].pageY-(q.touches[0].pageY-q.touches[0].clientY))||q.clientY:q.clientY)}return(q.changedTouches&&q.changedTouches[0]?(q.changedTouches[0].pageY-(q.changedTouches[0].pageY-q.changedTouches[0].clientY))||q.clientY:q.clientY)}}fabric.util.getPointer=p;fabric.util.object.extend(fabric.util,fabric.Observable)})();(function(){function d(g,i){var k=g.style;if(!k){return g}if(typeof i==="string"){g.style.cssText+=";"+i;return i.indexOf("opacity")>-1?b(g,i.match(/opacity:\s*(\d?\.?\d*)/)[1]):g}for(var j in i){if(j==="opacity"){b(g,i[j])}else{var h=(j==="float"||j==="cssFloat")?(typeof k.styleFloat==="undefined"?"cssFloat":"styleFloat"):j;k[h]=i[j]}}return g}var f=fabric.document.createElement("div"),e=typeof f.style.opacity==="string",a=typeof f.style.filter==="string",c=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,b=function(g){return g};if(e){b=function(g,h){g.style.opacity=h;return g}}else{if(a){b=function(g,h){var i=g.style;if(g.currentStyle&&!g.currentStyle.hasLayout){i.zoom=1}if(c.test(i.filter)){h=h>=0.9999?"":("alpha(opacity="+(h*100)+")");i.filter=i.filter.replace(c,h)}else{i.filter+=" alpha(opacity="+(h*100)+")"}return g}}}fabric.util.setStyle=d})();(function(){var i=Array.prototype.slice;function h(k){return typeof k==="string"?fabric.document.getElementById(k):k}var b=function(k){return i.call(k,0)};var j;try{j=b(fabric.document.childNodes) instanceof Array}catch(a){}if(!j){b=function(l){var k=new Array(l.length),m=l.length;while(m--){k[m]=l[m]}return k}}function c(l,k){var m=fabric.document.createElement(l);for(var n in k){if(n==="class"){m.className=k[n]}else{if(n==="for"){m.htmlFor=k[n]}else{m.setAttribute(n,k[n])}}}return m}function g(k,l){if((" "+k.className+" ").indexOf(" "+l+" ")===-1){k.className+=(k.className?" ":"")+l}}function f(l,m,k){if(typeof m==="string"){m=c(m,k)}if(l.parentNode){l.parentNode.replaceChild(m,l)}m.appendChild(l);return m}function e(n){var l,q,o={left:0,top:0},p=n&&n.ownerDocument,r={left:0,top:0},m={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!p){return{left:0,top:0}}for(var k in m){r[m[k]]+=parseInt(d(n,k),10)||0}l=p.documentElement;if(typeof n.getBoundingClientRect!=="undefined"){o=n.getBoundingClientRect()}if(p!=null&&p===p.window){q=p}else{q=p.nodeType===9&&(p.defaultView||p.parentWindow)}return{left:o.left+(q.pageXOffset||l.scrollLeft)-(l.clientLeft||0)+r.left,top:o.top+(q.pageYOffset||l.scrollTop)-(l.clientTop||0)+r.top}}function d(l,k){if(!l.style){l.style={}}if(fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle){return fabric.document.defaultView.getComputedStyle(l,null)[k]}else{var m=l.style[k];if(!m&&l.currentStyle){m=l.currentStyle[k]}return m}}(function(){var l=fabric.document.documentElement.style;var m="userSelect" in l?"userSelect":"MozUserSelect" in l?"MozUserSelect":"WebkitUserSelect" in l?"WebkitUserSelect":"KhtmlUserSelect" in l?"KhtmlUserSelect":"";function n(o){if(typeof o.onselectstart!=="undefined"){o.onselectstart=fabric.util.falseFunction}if(m){o.style[m]="none"}else{if(typeof o.unselectable==="string"){o.unselectable="on"}}return o}function k(o){if(typeof o.onselectstart!=="undefined"){o.onselectstart=null}if(m){o.style[m]=""}else{if(typeof o.unselectable==="string"){o.unselectable=""}}return o}fabric.util.makeElementUnselectable=n;fabric.util.makeElementSelectable=k})();(function(){function k(l,p){var n=fabric.document.getElementsByTagName("head")[0],m=fabric.document.createElement("script"),o=true;m.onload=m.onreadystatechange=function(q){if(o){if(typeof this.readyState==="string"&&this.readyState!=="loaded"&&this.readyState!=="complete"){return}o=false;p(q||fabric.window.event);m=m.onload=m.onreadystatechange=null}};m.src=l;n.appendChild(m)}fabric.util.getScript=k})();fabric.util.getById=h;fabric.util.toArray=b;fabric.util.makeElement=c;fabric.util.addClass=g;fabric.util.wrapElement=f;fabric.util.getElementOffset=e;fabric.util.getElementStyle=d})();(function(){function d(e,f){return e+(/\?/.test(e)?"&":"?")+f}var c=(function(){var h=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest()}];for(var e=h.length;e--;){try{var g=h[e]();if(g){return h[e]}}catch(f){}}})();function a(){}function b(g,f){f||(f={});var j=f.method?f.method.toUpperCase():"GET",h=f.onComplete||function(){},i=c(),e;i.onreadystatechange=function(){if(i.readyState===4){h(i);i.onreadystatechange=a}};if(j==="GET"){e=null;if(typeof f.parameters==="string"){g=d(g,f.parameters)}}i.open(j,g,true);if(j==="POST"||j==="PUT"){i.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}i.send(e);return i}fabric.util.request=b})();(function(){function a(o){o||(o={});var e=+new Date(),g=o.duration||500,m=e+g,f,j=o.onChange||function(){},h=o.abort||function(){return false},k=o.easing||function(q,p,s,r){return -s*Math.cos(q/r*(Math.PI/2))+s+p},d="startValue" in o?o.startValue:0,l="endValue" in o?o.endValue:100,n=o.byValue||l-d;o.onStart&&o.onStart();(function i(){f=+new Date();var p=f>m?g:(f-e);j(k(p,d,n,g));if(f>m||h()){o.onComplete&&o.onComplete();return}b(i)})()}var c=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(d){fabric.window.setTimeout(d,1000/60)};var b=function(){return c.apply(fabric.window,arguments)};fabric.util.animate=a;fabric.util.requestAnimFrame=b})();(function(){function d(F,E,H,G){return H*(F/=G)*F+E}function l(F,E,H,G){return -H*(F/=G)*(F-2)+E}function r(F,E,H,G){F/=(G/2);if(F<1){return H/2*F*F+E}return -H/2*((--F)*(F-2)-1)+E}function B(F,E,H,G){return H*(F/=G)*F*F+E}function q(F,E,H,G){return H*((F=F/G-1)*F*F+1)+E}function u(F,E,H,G){F/=G/2;if(F<1){return H/2*F*F*F+E}return H/2*((F-=2)*F*F+2)+E}function t(F,E,H,G){return H*(F/=G)*F*F*F+E}function g(F,E,H,G){return -H*((F=F/G-1)*F*F*F-1)+E}function k(F,E,H,G){F/=G/2;if(F<1){return H/2*F*F*F*F+E}return -H/2*((F-=2)*F*F*F-2)+E}function y(F,E,H,G){return H*(F/=G)*F*F*F*F+E}function j(F,E,H,G){return H*((F=F/G-1)*F*F*F*F+1)+E}function n(F,E,H,G){F/=G/2;if(F<1){return H/2*F*F*F*F*F+E}return H/2*((F-=2)*F*F*F*F+2)+E}function f(F,E,H,G){return -H*Math.cos(F/G*(Math.PI/2))+H+E}function o(F,E,H,G){return H*Math.sin(F/G*(Math.PI/2))+E}function v(F,E,H,G){return -H/2*(Math.cos(Math.PI*F/G)-1)+E}function D(F,E,H,G){return(F===0)?E:H*Math.pow(2,10*(F/G-1))+E}function c(F,E,H,G){return(F===G)?E+H:H*(-Math.pow(2,-10*F/G)+1)+E}function i(F,E,H,G){if(F===0){return E}if(F===G){return E+H}F/=G/2;if(F<1){return H/2*Math.pow(2,10*(F-1))+E}return H/2*(-Math.pow(2,-10*--F)+2)+E}function h(F,E,H,G){return -H*(Math.sqrt(1-(F/=G)*F)-1)+E}function p(F,E,H,G){return H*Math.sqrt(1-(F=F/G-1)*F)+E}function x(F,E,H,G){F/=G/2;if(F<1){return -H/2*(Math.sqrt(1-F*F)-1)+E}return H/2*(Math.sqrt(1-(F-=2)*F)+1)+E}function s(G,E,K,J){var H=1.70158;var I=0;var F=K;if(G===0){return E}G/=J;if(G===1){return E+K}if(!I){I=J*0.3}if(F<Math.abs(K)){F=K;H=I/4}else{H=I/(2*Math.PI)*Math.asin(K/F)}return -(F*Math.pow(2,10*(G-=1))*Math.sin((G*J-H)*(2*Math.PI)/I))+E}function z(G,E,K,J){var H=1.70158;var I=0;var F=K;if(G===0){return E}G/=J;if(G===1){return E+K}if(!I){I=J*0.3}if(F<Math.abs(K)){F=K;H=I/4}else{H=I/(2*Math.PI)*Math.asin(K/F)}return F*Math.pow(2,-10*G)*Math.sin((G*J-H)*(2*Math.PI)/I)+K+E}function a(G,E,K,J){var H=1.70158;var I=0;var F=K;if(G===0){return E}G/=J/2;if(G===2){return E+K}if(!I){I=J*(0.3*1.5)}if(F<Math.abs(K)){F=K;H=I/4}else{H=I/(2*Math.PI)*Math.asin(K/F)}if(G<1){return -0.5*(F*Math.pow(2,10*(G-=1))*Math.sin((G*J-H)*(2*Math.PI)/I))+E}return F*Math.pow(2,-10*(G-=1))*Math.sin((G*J-H)*(2*Math.PI)/I)*0.5+K+E}function m(F,E,I,H,G){if(G===undefined){G=1.70158}return I*(F/=H)*F*((G+1)*F-G)+E}function w(F,E,I,H,G){if(G===undefined){G=1.70158}return I*((F=F/H-1)*F*((G+1)*F+G)+1)+E}function A(F,E,I,H,G){if(G===undefined){G=1.70158}F/=H/2;if(F<1){return I/2*(F*F*(((G*=(1.525))+1)*F-G))+E}return I/2*((F-=2)*F*(((G*=(1.525))+1)*F+G)+2)+E}function e(F,E,H,G){return H-b(G-F,0,H,G)+E}function b(F,E,H,G){if((F/=G)<(1/2.75)){return H*(7.5625*F*F)+E}else{if(F<(2/2.75)){return H*(7.5625*(F-=(1.5/2.75))*F+0.75)+E}else{if(F<(2.5/2.75)){return H*(7.5625*(F-=(2.25/2.75))*F+0.9375)+E}else{return H*(7.5625*(F-=(2.625/2.75))*F+0.984375)+E}}}}function C(F,E,H,G){if(F<G/2){return e(F*2,0,H,G)*0.5+E}return b(F*2-G,0,H,G)*0.5+H*0.5+E}fabric.util.ease={easeInQuad:d,easeOutQuad:l,easeInOutQuad:r,easeInCubic:B,easeOutCubic:q,easeInOutCubic:u,easeInQuart:t,easeOutQuart:g,easeInOutQuart:k,easeInQuint:y,easeOutQuint:j,easeInOutQuint:n,easeInSine:f,easeOutSine:o,easeInOutSine:v,easeInExpo:D,easeOutExpo:c,easeInOutExpo:i,easeInCirc:h,easeOutCirc:p,easeInOutCirc:x,easeInElastic:s,easeOutElastic:z,easeInOutElastic:a,easeInBack:m,easeOutBack:w,easeInOutBack:A,easeInBounce:e,easeOutBounce:b,easeInOutBounce:C}}());(function(q){var o=q.fabric||(q.fabric={}),x=o.util.object.extend,k=o.util.string.capitalize,y=o.util.object.clone,n=o.util.toFixed,s=o.util.multiplyTransformMatrices;o.SHARED_ATTRIBUTES=["transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"];var t={"fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight",cx:"left",x:"left",r:"radius","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration",cy:"top",y:"top",transform:"transformMatrix"};var h={stroke:"strokeOpacity",fill:"fillOpacity"};function a(B){if(B in t){return t[B]}return B}function i(B,F,E){var C;if((B==="fill"||B==="stroke")&&F==="none"){F=""}else{if(B==="fillRule"){F=(F==="evenodd")?"destination-over":F}else{if(B==="strokeDashArray"){F=F.replace(/,/g," ").split(/\s+/)}else{if(B==="transformMatrix"){if(E&&E.transformMatrix){F=s(E.transformMatrix,o.parseTransformAttribute(F))}else{F=o.parseTransformAttribute(F)}}}}}C=Object.prototype.toString.call(F)==="[object Array]";var D=C?F.map(parseFloat):parseFloat(F);return(!C&&isNaN(D)?F:D)}function c(D){for(var B in h){if(!D[B]||typeof D[h[B]]==="undefined"){continue}if(D[B].indexOf("url(")===0){continue}var C=new o.Color(D[B]);D[B]=C.setAlpha(n(C.getAlpha()*D[h[B]],2)).toRgba();delete D[h[B]]}return D}function j(D,C){if(!D){return}var F,B={};if(D.parentNode&&/^g$/i.test(D.parentNode.nodeName)){B=o.parseAttributes(D.parentNode,C)}var E=C.reduce(function(H,G){F=D.getAttribute(G);if(F){G=a(G);F=i(G,F,B);H[G]=F}return H},{});E=x(E,x(w(D),o.parseStyleAttribute(D)));return c(x(B,E))}o.parseTransformAttribute=(function(){function B(U,V){var W=V[0];U[0]=Math.cos(W);U[1]=Math.sin(W);U[2]=-Math.sin(W);U[3]=Math.cos(W)}function G(W,X){var V=X[0],U=(X.length===2)?X[1]:X[0];W[0]=V;W[3]=U}function R(U,V){U[2]=V[0]}function D(U,V){U[1]=V[0]}function O(U,V){U[4]=V[0];if(V.length===2){U[5]=V[1]}}var I=[1,0,0,1,0,0],C="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",S="(?:\\s+,?\\s*|,\\s*)",J="(?:(skewX)\\s*\\(\\s*("+C+")\\s*\\))",H="(?:(skewY)\\s*\\(\\s*("+C+")\\s*\\))",Q="(?:(rotate)\\s*\\(\\s*("+C+")(?:"+S+"("+C+")"+S+"("+C+"))?\\s*\\))",T="(?:(scale)\\s*\\(\\s*("+C+")(?:"+S+"("+C+"))?\\s*\\))",M="(?:(translate)\\s*\\(\\s*("+C+")(?:"+S+"("+C+"))?\\s*\\))",P="(?:(matrix)\\s*\\(\\s*("+C+")"+S+"("+C+")"+S+"("+C+")"+S+"("+C+")"+S+"("+C+")"+S+"("+C+")\\s*\\))",N="(?:"+P+"|"+M+"|"+T+"|"+Q+"|"+J+"|"+H+")",K="(?:"+N+"(?:"+S+N+")*)",E="^\\s*(?:"+K+"?)\\s*$",L=new RegExp(E),F=new RegExp(N,"g");return function(X){var U=I.concat();var V=[];if(!X||(X&&!L.test(X))){return U}X.replace(F,function(ab){var Y=new RegExp(N).exec(ab).filter(function(ac){return(ac!==""&&ac!=null)}),Z=Y[1],aa=Y.slice(2).map(parseFloat);switch(Z){case"translate":O(U,aa);break;case"rotate":B(U,aa);break;case"scale":G(U,aa);break;case"skewX":R(U,aa);break;case"skewY":D(U,aa);break;case"matrix":U=aa;break}V.push(U.concat());U=I.concat()});var W=V[0];while(V.length>1){V.shift();W=o.util.multiplyTransformMatrices(W,V[0])}return W}})();function A(E){if(!E){return null}E=E.trim();var G=E.indexOf(",")>-1;E=E.split(/\s+/);var C=[],D,B;if(G){D=0;B=E.length;for(;D<B;D++){var F=E[D].split(",");C.push({x:parseFloat(F[0]),y:parseFloat(F[1])})}}else{D=0;B=E.length;for(;D<B;D+=2){C.push({x:parseFloat(E[D]),y:parseFloat(E[D+1])})}}if(C.length%2!==0){}return C}function b(H,C){var E=H.match(/(normal|italic)?\s*(normal|small-caps)?\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\s*(\d+)px(?:\/(normal|[\d\.]+))?\s+(.*)/);if(!E){return}var I=E[1];var D=E[3];var G=E[4];var F=E[5];var B=E[6];if(I){C.fontStyle=I}if(D){C.fontSize=isNaN(parseFloat(D))?D:parseFloat(D)}if(G){C.fontSize=parseFloat(G)}if(B){C.fontFamily=B}if(F){C.lineHeight=F==="normal"?1:F}}function p(D){var C={},E=D.getAttribute("style"),B,F;if(!E){return C}if(typeof E==="string"){E.replace(/;$/,"").split(";").forEach(function(H){var I=H.split(":");B=a(I[0].trim().toLowerCase());F=i(B,I[1].trim());if(B==="font"){b(F,C)}else{C[B]=F}})}else{for(var G in E){if(typeof E[G]==="undefined"){continue}B=a(G.toLowerCase());F=i(B,E[G]);if(B==="font"){b(F,C)}else{C[B]=F}}}return C}function z(E){for(var B=E.length;B--;){var C=E[B].get("fill");if(/^url\(/.test(C)){var D=C.slice(5,C.length-1);if(o.gradientDefs[D]){E[B].set("fill",o.Gradient.fromElement(o.gradientDefs[D],E[B]))}}}}function m(C,M,N,L){var B=new Array(C.length),H=C.length;function D(){if(--H===0){B=B.filter(function(O){return O!=null});z(B);M(B)}}for(var J=0,E,I=C.length;J<I;J++){E=C[J];var K=o[k(E.tagName)];if(K&&K.fromElement){try{if(K.async){K.fromElement(E,(function(O,P){return function(Q){L&&L(P,Q);B.splice(O,0,Q);D()}})(J,E),N)}else{var G=K.fromElement(E,N);L&&L(E,G);B.splice(J,0,G);D()}}catch(F){o.log(F)}}else{D()}}}function g(G){var E=G.getElementsByTagName("style"),C={},H;for(var D=0,B=E.length;D<B;D++){var F=E[0].textContent;F=F.replace(/\/\*[\s\S]*?\*\//g,"");H=F.match(/[^{]*\{[\s\S]*?\}/g);H=H.map(function(I){return I.trim()});H.forEach(function(N){var L=N.match(/([\s\S]*?)\s*\{([^}]*)\}/);N=L[1];var I=L[2].trim(),P=I.replace(/;$/,"").split(/\s*;\s*/);if(!C[N]){C[N]={}}for(var K=0,M=P.length;K<M;K++){var J=P[K].split(/\s*:\s*/),Q=J[0],O=J[1];C[N][Q]=O}})}return C}function w(C){var I=C.nodeName,D=C.getAttribute("class"),H=C.getAttribute("id"),E={};for(var G in o.cssRules){var B=(D&&new RegExp("^\\."+D).test(G))||(H&&new RegExp("^#"+H).test(G))||(new RegExp("^"+I).test(G));if(B){for(var F in o.cssRules[G]){E[F]=o.cssRules[G][F]}}}return E}o.parseSVGDocument=(function(){var B=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/;var C="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)";var D=new RegExp("^\\s*("+C+"+)\\s*,?\\s*("+C+"+)\\s*,?\\s*("+C+"+)\\s*,?\\s*("+C+"+)\\s*$");function E(F,G){while(F&&(F=F.parentNode)){if(G.test(F.nodeName)){return true}}return false}return function(S,U,R){if(!S){return}var J=new Date(),N=o.util.toArray(S.getElementsByTagName("*"));if(N.length===0){N=S.selectNodes("//*[name(.)!='svg']");var P=[];for(var O=0,Q=N.length;O<Q;O++){P[O]=N[O]}N=P}var F=N.filter(function(W){return B.test(W.tagName)&&!E(W,/^(?:pattern|defs)$/)});if(!F||(F&&!F.length)){return}var G=S.getAttribute("viewBox"),L=S.getAttribute("width"),I=S.getAttribute("height"),H=null,T=null,M,K;if(G&&(G=G.match(D))){M=parseInt(G[1],10);K=parseInt(G[2],10);H=parseInt(G[3],10);T=parseInt(G[4],10)}H=L?parseFloat(L):H;T=I?parseFloat(I):T;var V={width:H,height:T};o.gradientDefs=o.getGradientDefs(S);o.cssRules=g(S);o.parseElements(F,function(W){o.documentParsingTime=new Date()-J;if(U){U(W,V)}},y(V),R)}})();var r={has:function(B,C){C(false)},get:function(){},set:function(){}};function f(C,E,B){C=C.replace(/^\n\s*/,"").trim();r.has(C,function(F){if(F){r.get(C,function(H){var G=e(H);E(G.objects,G.options)})}else{new o.util.request(C,{method:"get",onComplete:D})}});function D(G){var F=G.responseXML;if(!F.documentElement&&o.window.ActiveXObject&&G.responseText){F=new ActiveXObject("Microsoft.XMLDOM");F.async="false";F.loadXML(G.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}if(!F.documentElement){return}o.parseSVGDocument(F.documentElement,function(I,H){r.set(C,{objects:o.util.array.invoke(I,"toObject"),options:H});E(I,H)},B)}}function e(D){var C=D.objects,B=D.options;C=C.map(function(E){return o[k(E.type)].fromObject(E)});return({objects:C,options:B})}function v(C,F,B){C=C.trim();var D;if(typeof DOMParser!=="undefined"){var E=new DOMParser();if(E&&E.parseFromString){D=E.parseFromString(C,"text/xml")}}else{if(o.window.ActiveXObject){D=new ActiveXObject("Microsoft.XMLDOM");D.async="false";D.loadXML(C.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}}o.parseSVGDocument(D.documentElement,function(H,G){F(H,G)},B)}function u(E){var C="";for(var D=0,B=E.length;D<B;D++){if(E[D].type!=="text"||!E[D].path){continue}C+=["@font-face {","font-family: ",E[D].fontFamily,"; ","src: url('",E[D].path,"')","}"].join("")}if(C){C=['<style type="text/css">',"<![CDATA[",C,"]]>","</style>"].join("")}return C}function d(C){var B="";if(C.backgroundColor&&C.backgroundColor.source){B=['<pattern x="0" y="0" id="backgroundColorPattern" ','width="',C.backgroundColor.source.width,'" height="',C.backgroundColor.source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',C.backgroundColor.source.width,'" height="',C.backgroundColor.source.height,'" xlink:href="',C.backgroundColor.source.src,'"></image></pattern>'].join("")}return B}function l(G){var D=G.getElementsByTagName("linearGradient"),B=G.getElementsByTagName("radialGradient"),E,C,F={};C=D.length;for(;C--;){E=D[C];F[E.getAttribute("id")]=E}C=B.length;for(;C--;){E=B[C];F[E.getAttribute("id")]=E}return F}x(o,{parseAttributes:j,parseElements:m,parseStyleAttribute:p,parsePointsAttribute:A,getCSSRules:g,loadSVGFromURL:f,loadSVGFromString:v,createSVGFontFacesMarkup:u,createSVGRefElementsMarkup:d,getGradientDefs:l})})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={});if(c.Point){c.warn("fabric.Point is already defined");return}c.Point=a;function a(d,e){this.x=d;this.y=e}a.prototype={constructor:a,add:function(d){return new a(this.x+d.x,this.y+d.y)},addEquals:function(d){this.x+=d.x;this.y+=d.y;return this},scalarAdd:function(d){return new a(this.x+d,this.y+d)},scalarAddEquals:function(d){this.x+=d;this.y+=d;return this},subtract:function(d){return new a(this.x-d.x,this.y-d.y)},subtractEquals:function(d){this.x-=d.x;this.y-=d.y;return this},scalarSubtract:function(d){return new a(this.x-d,this.y-d)},scalarSubtractEquals:function(d){this.x-=d;this.y-=d;return this},multiply:function(d){return new a(this.x*d,this.y*d)},multiplyEquals:function(d){this.x*=d;this.y*=d;return this},divide:function(d){return new a(this.x/d,this.y/d)},divideEquals:function(d){this.x/=d;this.y/=d;return this},eq:function(d){return(this.x===d.x&&this.y===d.y)},lt:function(d){return(this.x<d.x&&this.y<d.y)},lte:function(d){return(this.x<=d.x&&this.y<=d.y)},gt:function(d){return(this.x>d.x&&this.y>d.y)},gte:function(d){return(this.x>=d.x&&this.y>=d.y)},lerp:function(e,d){return new a(this.x+(e.x-this.x)*d,this.y+(e.y-this.y)*d)},distanceFrom:function(f){var e=this.x-f.x,d=this.y-f.y;return Math.sqrt(e*e+d*d)},midPointFrom:function(d){return new a(this.x+(d.x-this.x)/2,this.y+(d.y-this.y)/2)},min:function(d){return new a(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new a(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},setXY:function(d,e){this.x=d;this.y=e},setFromPoint:function(d){this.x=d.x;this.y=d.y},swap:function(e){var d=this.x,f=this.y;this.x=e.x;this.y=e.y;e.x=d;e.y=f}}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Intersection){b.warn("fabric.Intersection is already defined");return}function c(d){this.status=d;this.points=[]}b.Intersection=c;b.Intersection.prototype={appendPoint:function(d){this.points.push(d)},appendPoints:function(d){this.points=this.points.concat(d)}};b.Intersection.intersectLineLine=function(h,f,l,k){var m,i=(k.x-l.x)*(h.y-l.y)-(k.y-l.y)*(h.x-l.x),j=(f.x-h.x)*(h.y-l.y)-(f.y-h.y)*(h.x-l.x),g=(k.y-l.y)*(f.x-h.x)-(k.x-l.x)*(f.y-h.y);if(g!==0){var e=i/g,d=j/g;if(0<=e&&e<=1&&0<=d&&d<=1){m=new c("Intersection");m.points.push(new b.Point(h.x+e*(f.x-h.x),h.y+e*(f.y-h.y)))}else{m=new c()}}else{if(i===0||j===0){m=new c("Coincident")}else{m=new c("Parallel")}}return m};b.Intersection.intersectLinePolygon=function(e,d,l){var m=new c(),f=l.length;for(var h=0;h<f;h++){var k=l[h],j=l[(h+1)%f],g=c.intersectLineLine(e,d,k,j);m.appendPoints(g.points)}if(m.points.length>0){m.status="Intersection"}return m};b.Intersection.intersectPolygonPolygon=function(j,h){var f=new c(),l=j.length;for(var k=0;k<l;k++){var g=j[k],e=j[(k+1)%l],d=c.intersectLinePolygon(g,e,h);f.appendPoints(d.points)}if(f.points.length>0){f.status="Intersection"}return f};b.Intersection.intersectPolygonRectangle=function(n,e,d){var g=e.min(d),m=e.max(d),f=new b.Point(m.x,g.y),l=new b.Point(g.x,m.y),k=c.intersectLinePolygon(g,f,n),j=c.intersectLinePolygon(f,m,n),i=c.intersectLinePolygon(m,l,n),h=c.intersectLinePolygon(l,g,n),o=new c();o.appendPoints(k.points);o.appendPoints(j.points);o.appendPoints(i.points);o.appendPoints(h.points);if(o.points.length>0){o.status="Intersection"}return o}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={});if(c.Color){c.warn("fabric.Color is already defined.");return}function d(e){if(!e){this.setSource([0,0,0,1])}else{this._tryParsingColor(e)}}c.Color=d;c.Color.prototype={_tryParsingColor:function(e){var f;if(e in d.colorNameMap){e=d.colorNameMap[e]}f=d.sourceFromHex(e);if(!f){f=d.sourceFromRgb(e)}if(!f){f=d.sourceFromHsl(e)}if(f){this.setSource(f)}},_rgbToHsl:function(e,k,n){e/=255,k/=255,n/=255;var j,p,f,o=c.util.array.max([e,k,n]),i=c.util.array.min([e,k,n]);f=(o+i)/2;if(o===i){j=p=0}else{var m=o-i;p=f>0.5?m/(2-o-i):m/(o+i);switch(o){case e:j=(k-n)/m+(k<n?6:0);break;case k:j=(n-e)/m+2;break;case n:j=(e-k)/m+4;break}j/=6}return[Math.round(j*360),Math.round(p*100),Math.round(f*100)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var f=this.getSource(),e=this._rgbToHsl(f[0],f[1],f[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var f=this.getSource(),e=this._rgbToHsl(f[0],f[1],f[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+f[3]+")"},toHex:function(){var i=this.getSource();var h=i[0].toString(16);h=(h.length===1)?("0"+h):h;var f=i[1].toString(16);f=(f.length===1)?("0"+f):f;var e=i[2].toString(16);e=(e.length===1)?("0"+e):e;return h.toUpperCase()+f.toUpperCase()+e.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(f){var e=this.getSource();e[3]=f;this.setSource(e);return this},toGrayscale:function(){var g=this.getSource(),f=parseInt((g[0]*0.3+g[1]*0.59+g[2]*0.11).toFixed(0),10),e=g[3];this.setSource([f,f,f,e]);return this},toBlackWhite:function(e){var h=this.getSource(),g=(h[0]*0.3+h[1]*0.59+h[2]*0.11).toFixed(0),f=h[3];e=e||127;g=(Number(g)<Number(e))?0:255;this.setSource([g,g,g,f]);return this},overlayWith:function(l){if(!(l instanceof d)){l=new d(l)}var e=[],k=this.getAlpha(),h=0.5,j=this.getSource(),f=l.getSource();for(var g=0;g<3;g++){e.push(Math.round((j[g]*(1-h))+(f[g]*h)))}e[3]=k;this.setSource(e);return this}};c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;c.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;c.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"};function a(g,f,e){if(e<0){e+=1}if(e>1){e-=1}if(e<1/6){return g+(f-g)*6*e}if(e<1/2){return f}if(e<2/3){return g+(f-g)*(2/3-e)*6}return g}c.Color.fromRgb=function(e){return d.fromSource(d.sourceFromRgb(e))};c.Color.sourceFromRgb=function(f){var h=f.match(d.reRGBa);if(h){var j=parseInt(h[1],10)/(/%$/.test(h[1])?100:1)*(/%$/.test(h[1])?255:1),i=parseInt(h[2],10)/(/%$/.test(h[2])?100:1)*(/%$/.test(h[2])?255:1),e=parseInt(h[3],10)/(/%$/.test(h[3])?100:1)*(/%$/.test(h[3])?255:1);return[parseInt(j,10),parseInt(i,10),parseInt(e,10),h[4]?parseFloat(h[4]):1]}};c.Color.fromRgba=d.fromRgb;c.Color.fromHsl=function(e){return d.fromSource(d.sourceFromHsl(e))};c.Color.sourceFromHsl=function(k){var n=k.match(d.reHSLa);if(!n){return}var m=(((parseFloat(n[1])%360)+360)%360)/360,u=parseFloat(n[2])/(/%$/.test(n[2])?100:1),j=parseFloat(n[3])/(/%$/.test(n[3])?100:1),e,o,t;if(u===0){e=o=t=j}else{var f=j<=0.5?j*(u+1):j+u-j*u;var i=j*2-f;e=a(i,f,m+1/3);o=a(i,f,m);t=a(i,f,m-1/3)}return[Math.round(e*255),Math.round(o*255),Math.round(t*255),n[4]?parseFloat(n[4]):1]};c.Color.fromHsla=d.fromHsl;c.Color.fromHex=function(e){return d.fromSource(d.sourceFromHex(e))};c.Color.sourceFromHex=function(h){if(h.match(d.reHex)){var k=h.slice(h.indexOf("#")+1),f=(k.length===3),j=f?(k.charAt(0)+k.charAt(0)):k.substring(0,2),i=f?(k.charAt(1)+k.charAt(1)):k.substring(2,4),e=f?(k.charAt(2)+k.charAt(2)):k.substring(4,6);return[parseInt(j,16),parseInt(i,16),parseInt(e,16),1]}};c.Color.fromSource=function(e){var f=new d();f.setSource(e);return f}})(typeof exports!=="undefined"?exports:this);(function(){function c(e){var d=e.getAttribute("style"),g=e.getAttribute("offset"),f,k;g=parseFloat(g)/(/%$/.test(g)?100:1);if(d){var j=d.split(/\s*;\s*/);if(j[j.length-1]===""){j.pop()}for(var h=j.length;h--;){var l=j[h].split(/\s*:\s*/),n=l[0].trim(),m=l[1].trim();if(n==="stop-color"){f=m}else{if(n==="stop-opacity"){k=m}}}}if(!f){f=e.getAttribute("stop-color")||"rgb(0,0,0)"}if(!k){k=e.getAttribute("stop-opacity")}f=new fabric.Color(f).toRgb();return{offset:g,color:f,opacity:isNaN(parseFloat(k))?1:parseFloat(k)}}fabric.Gradient=fabric.util.createClass({initialize:function(d){d||(d={});var e={};this.id=fabric.Object.__uid++;this.type=d.type||"linear";e={x1:d.coords.x1||0,y1:d.coords.y1||0,x2:d.coords.x2||0,y2:d.coords.y2||0};if(this.type==="radial"){e.r1=d.coords.r1||0;e.r2=d.coords.r2||0}this.coords=e;this.gradientUnits=d.gradientUnits||"objectBoundingBox";this.colorStops=d.colorStops.slice()},addColorStop:function(e){for(var d in e){var f=new fabric.Color(e[d]);this.colorStops.push({offset:d,color:f.toRgb(),opacity:f.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toSVG:function(f,e){var h=fabric.util.object.clone(this.coords),d;this.colorStops.sort(function(j,i){return j.offset-i.offset});if(e&&this.gradientUnits==="userSpaceOnUse"){h.x1+=f.width/2;h.y1+=f.height/2;h.x2+=f.width/2;h.y2+=f.height/2}else{if(this.gradientUnits==="objectBoundingBox"){b(f,h)}}if(this.type==="linear"){d=["<linearGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" x1="',h.x1,'" y1="',h.y1,'" x2="',h.x2,'" y2="',h.y2,'">']}else{if(this.type==="radial"){d=["<radialGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" cx="',h.x2,'" cy="',h.y2,'" r="',h.r2,'" fx="',h.x1,'" fy="',h.y1,'">']}}for(var g=0;g<this.colorStops.length;g++){d.push("<stop ",'offset="',(this.colorStops[g].offset*100)+"%",'" style="stop-color:',this.colorStops[g].color,(this.colorStops[g].opacity?";stop-opacity: "+this.colorStops[g].opacity:";"),'"/>')}d.push((this.type==="linear"?"</linearGradient>":"</radialGradient>"));return d.join("")},toLive:function(e){var j;if(!this.type){return}if(this.type==="linear"){j=e.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2,this.coords.y2)}else{if(this.type==="radial"){j=e.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2)}}for(var h=0,d=this.colorStops.length;h<d;h++){var f=this.colorStops[h].color,g=this.colorStops[h].opacity,k=this.colorStops[h].offset;if(typeof g!=="undefined"){f=new fabric.Color(f).setAlpha(g).toRgba()}j.addColorStop(parseFloat(k),f)}return j}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(j,d){var l=j.getElementsByTagName("stop"),h=(j.nodeName==="linearGradient"?"linear":"radial"),f=j.getAttribute("gradientUnits")||"objectBoundingBox",e=[],k={};if(h==="linear"){k={x1:j.getAttribute("x1")||0,y1:j.getAttribute("y1")||0,x2:j.getAttribute("x2")||"100%",y2:j.getAttribute("y2")||0}}else{if(h==="radial"){k={x1:j.getAttribute("fx")||j.getAttribute("cx")||"50%",y1:j.getAttribute("fy")||j.getAttribute("cy")||"50%",r1:0,x2:j.getAttribute("cx")||"50%",y2:j.getAttribute("cy")||"50%",r2:j.getAttribute("r")||"50%"}}}for(var g=l.length;g--;){e.push(c(l[g]))}a(d,k);return new fabric.Gradient({type:h,coords:k,gradientUnits:f,colorStops:e})},forObject:function(e,d){d||(d={});a(e,d);return new fabric.Gradient(d)}});function a(f,e){for(var g in e){if(typeof e[g]==="string"&&/^\d+%$/.test(e[g])){var d=parseFloat(e[g],10);if(g==="x1"||g==="x2"||g==="r2"){e[g]=fabric.util.toFixed(f.width*d/100,2)}else{if(g==="y1"||g==="y2"){e[g]=fabric.util.toFixed(f.height*d/100,2)}}}if(g==="x1"||g==="x2"){e[g]-=fabric.util.toFixed(f.width/2,2)}else{if(g==="y1"||g==="y2"){e[g]-=fabric.util.toFixed(f.height/2,2)}}}}function b(e,d){for(var f in d){if(f==="x1"||f==="x2"){d[f]+=fabric.util.toFixed(e.width/2,2)}else{if(f==="y1"||f==="y2"){d[f]+=fabric.util.toFixed(e.height/2,2)}}if(f==="x1"||f==="x2"||f==="r2"){d[f]=fabric.util.toFixed(d[f]/e.width*100,2)+"%"}else{if(f==="y1"||f==="y2"){d[f]=fabric.util.toFixed(d[f]/e.height*100,2)+"%"}}}}})();fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(a){a||(a={});this.id=fabric.Object.__uid++;if(a.source){if(typeof a.source==="string"){if(typeof fabric.util.getFunctionBody(a.source)!=="undefined"){this.source=new Function(fabric.util.getFunctionBody(a.source))}else{var b=this;this.source=fabric.util.createImage();fabric.util.loadImage(a.source,function(c){b.source=c})}}else{this.source=a.source}}if(a.repeat){this.repeat=a.repeat}if(a.offsetX){this.offsetX=a.offsetX}if(a.offsetY){this.offsetY=a.offsetY}},toObject:function(){var a;if(typeof this.source==="function"){a=String(this.source)}else{if(typeof this.source.src==="string"){a=this.source.src}}return{source:a,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(b){var a=typeof this.source==="function"?this.source():this.source;var d=a.width/b.getWidth();var c=a.height/b.getHeight();var e="";if(a.src){e=a.src}else{if(a.toDataURL){e=a.toDataURL()}}return'<pattern id="SVGID_'+this.id+'" x="'+this.offsetX+'" y="'+this.offsetY+'" width="'+d+'" height="'+c+'"><image x="0" y="0" width="'+a.width+'" height="'+a.height+'" xlink:href="'+e+'"></image></pattern>'},toLive:function(a){var b=typeof this.source==="function"?this.source():this.source;return a.createPattern(b,this.repeat)}});fabric.Shadow=fabric.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:false,initialize:function(a){for(var b in a){this[b]=a[b]}this.id=fabric.Object.__uid++},toSVG:function(a){var b="SourceAlpha";if(a.fill===this.color||a.stroke===this.color){b="SourceGraphic"}return('<filter id="SVGID_'+this.id+'" y="-40%" height="180%"><feGaussianBlur in="'+b+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"></feGaussianBlur><feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset><feMerge><feMergeNode></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>')},toObject:function(){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY}}});(function(){if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var e=fabric.util.object.extend,c=fabric.util.getElementOffset,d=fabric.util.removeFromArray,b=fabric.util.removeListener,a=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(g,f){f||(f={});this._initStatic(g,f);fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:"",backgroundImageOpacity:1,backgroundImageStretch:true,overlayImage:"",overlayImageLeft:0,overlayImageTop:0,includeDefaultValues:true,stateful:true,renderOnAddRemove:true,clipTo:null,controlsAboveOverlay:false,allowTouchScrolling:false,onBeforeScaleRotate:function(){},_initStatic:function(g,f){this._objects=[];this._createLowerCanvas(g);this._initOptions(f);if(f.overlayImage){this.setOverlayImage(f.overlayImage,this.renderAll.bind(this))}if(f.backgroundImage){this.setBackgroundImage(f.backgroundImage,this.renderAll.bind(this))}if(f.backgroundColor){this.setBackgroundColor(f.backgroundColor,this.renderAll.bind(this))}this.calcOffset()},calcOffset:function(){this._offset=c(this.lowerCanvasEl);return this},setOverlayImage:function(g,h,f){fabric.util.loadImage(g,function(i){this.overlayImage=i;if(f&&("overlayImageLeft" in f)){this.overlayImageLeft=f.overlayImageLeft}if(f&&("overlayImageTop" in f)){this.overlayImageTop=f.overlayImageTop}h&&h()},this);return this},setBackgroundImage:function(g,h,f){fabric.util.loadImage(g,function(i){this.backgroundImage=i;if(f&&("backgroundImageOpacity" in f)){this.backgroundImageOpacity=f.backgroundImageOpacity}if(f&&("backgroundImageStretch" in f)){this.backgroundImageStretch=f.backgroundImageStretch}h&&h()},this);return this},setBackgroundColor:function(f,h){if(f.source){var g=this;fabric.util.loadImage(f.source,function(i){g.backgroundColor=new fabric.Pattern({source:i,repeat:f.repeat});h&&h()})}else{this.backgroundColor=f;h&&h()}return this},_createCanvasElement:function(){var f=fabric.document.createElement("canvas");if(!f.style){f.style={}}if(!f){throw a}this._initCanvasElement(f);return f},_initCanvasElement:function(f){fabric.util.createCanvasElement(f);if(typeof f.getContext==="undefined"){throw a}},_initOptions:function(f){for(var g in f){this[g]=f[g]}this.width=parseInt(this.lowerCanvasEl.width,10)||0;this.height=parseInt(this.lowerCanvasEl.height,10)||0;if(!this.lowerCanvasEl.style){return}this.lowerCanvasEl.style.width=this.width+"px";this.lowerCanvasEl.style.height=this.height+"px"},_createLowerCanvas:function(f){this.lowerCanvasEl=fabric.util.getById(f)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");if(this.interactive){this._applyCanvasStyle(this.lowerCanvasEl)}this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(f){return this._setDimension("width",f)},setHeight:function(f){return this._setDimension("height",f)},setDimensions:function(f){for(var g in f){this._setDimension(g,f[g])}return this},_setDimension:function(g,f){this.lowerCanvasEl[g]=f;this.lowerCanvasEl.style[g]=f+"px";if(this.upperCanvasEl){this.upperCanvasEl[g]=f;this.upperCanvasEl.style[g]=f+"px"}if(this.cacheCanvasEl){this.cacheCanvasEl[g]=f}if(this.wrapperEl){this.wrapperEl.style[g]=f+"px"}this[g]=f;this.calcOffset();this.renderAll();return this},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(g,h){if(!h){return}if(this.controlsAboveOverlay){var f=h.hasBorders,i=h.hasControls;h.hasBorders=h.hasControls=false;h.render(g);h.hasBorders=f;h.hasControls=i}else{h.render(g)}},_onObjectAdded:function(f){this.stateful&&f.setupState();f.setCoords();f.canvas=this;this.fire("object:added",{target:f});f.fire("added")},_onObjectRemoved:function(f){this.fire("object:removed",{target:f});f.fire("removed")},getObjects:function(){return this._objects},clearContext:function(f){f.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;if(this.discardActiveGroup){this.discardActiveGroup()}if(this.discardActiveObject){this.discardActiveObject()}this.clearContext(this.contextContainer);if(this.contextTop){this.clearContext(this.contextTop)}this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(f){var g=this[(f===true&&this.interactive)?"contextTop":"contextContainer"];if(this.contextTop&&this.selection&&!this._groupSelector){this.clearContext(this.contextTop)}if(!f){this.clearContext(g)}this.fire("before:render");if(this.clipTo){fabric.util.clipContext(this,g)}if(this.backgroundColor){g.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(g):this.backgroundColor;g.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height)}if(typeof this.backgroundImage==="object"){this._drawBackroundImage(g)}var j=this.getActiveGroup();for(var h=0,k=this._objects.length;h<k;++h){if(!j||(j&&this._objects[h]&&!j.contains(this._objects[h]))){this._draw(g,this._objects[h])}}if(j){var l=[];this.forEachObject(function(i){if(j.contains(i)){l.push(i)}});j._set("objects",l);this._draw(g,j)}if(this.clipTo){g.restore()}if(this.overlayImage){g.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop)}if(this.controlsAboveOverlay&&this.interactive){this.drawControls(g)}this.fire("after:render");return this},_drawBackroundImage:function(f){f.save();f.globalAlpha=this.backgroundImageOpacity;if(this.backgroundImageStretch){f.drawImage(this.backgroundImage,0,0,this.width,this.height)}else{f.drawImage(this.backgroundImage,0,0)}f.restore()},renderTop:function(){var f=this.contextTop||this.contextContainer;this.clearContext(f);if(this.selection&&this._groupSelector){this._drawSelection()}var g=this.getActiveGroup();if(g){g.render(f)}if(this.overlayImage){f.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop)}this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(f){f.set("left",this.getCenter().left);this.renderAll();return this},centerObjectV:function(f){f.set("top",this.getCenter().top);this.renderAll();return this},centerObject:function(f){return this.centerObjectH(f).centerObjectV(f)},toDatalessJSON:function(f){return this.toDatalessObject(f)},toObject:function(f){return this._toObjectMethod("toObject",f)},toDatalessObject:function(f){return this._toObjectMethod("toDatalessObject",f)},_toObjectMethod:function(f,i){var g=this.getActiveGroup();if(g){this.discardActiveGroup()}var h={objects:this.getObjects().map(function(j){var k;if(!this.includeDefaultValues){k=j.includeDefaultValues;j.includeDefaultValues=false}var l=j[f](i);if(!this.includeDefaultValues){j.includeDefaultValues=k}return l},this),background:(this.backgroundColor&&this.backgroundColor.toObject)?this.backgroundColor.toObject():this.backgroundColor};if(this.backgroundImage){h.backgroundImage=this.backgroundImage.src;h.backgroundImageOpacity=this.backgroundImageOpacity;h.backgroundImageStretch=this.backgroundImageStretch}if(this.overlayImage){h.overlayImage=this.overlayImage.src;h.overlayImageLeft=this.overlayImageLeft;h.overlayImageTop=this.overlayImageTop}fabric.util.populateWithProperties(this,h,i);if(g){this.setActiveGroup(new fabric.Group(g.getObjects()));g.forEachObject(function(j){j.set("active",true)})}return h},toSVG:function(h){h||(h={});var g=[];if(!h.suppressPreamble){g.push('<?xml version="1.0" encoding="',(h.encoding||"UTF-8"),'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')}g.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',(h.viewBox?h.viewBox.width:this.width),'" ','height="',(h.viewBox?h.viewBox.height:this.height),'" ',(this.backgroundColor&&!this.backgroundColor.source?'style="background-color: '+this.backgroundColor+'" ':null),(h.viewBox?'viewBox="'+h.viewBox.x+" "+h.viewBox.y+" "+h.viewBox.width+" "+h.viewBox.height+'" ':null),'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>");if(this.backgroundColor&&this.backgroundColor.source){g.push('<rect x="0" y="0" ','width="',(this.backgroundColor.repeat==="repeat-y"||this.backgroundColor.repeat==="no-repeat"?this.backgroundColor.source.width:this.width),'" height="',(this.backgroundColor.repeat==="repeat-x"||this.backgroundColor.repeat==="no-repeat"?this.backgroundColor.source.height:this.height),'" fill="url(#backgroundColorPattern)"',"></rect>")}if(this.backgroundImage){g.push('<image x="0" y="0" ','width="',(this.backgroundImageStretch?this.width:this.backgroundImage.width),'" height="',(this.backgroundImageStretch?this.height:this.backgroundImage.height),'" preserveAspectRatio="',(this.backgroundImageStretch?"none":"defer"),'" xlink:href="',this.backgroundImage.src,'" style="opacity:',this.backgroundImageOpacity,'"></image>')}if(this.overlayImage){g.push('<image x="',this.overlayImageLeft,'" y="',this.overlayImageTop,'" width="',this.overlayImage.width,'" height="',this.overlayImage.height,'" xlink:href="',this.overlayImage.src,'"></image>')}var k=this.getActiveGroup();if(k){this.discardActiveGroup()}for(var j=0,l=this.getObjects(),f=l.length;j<f;j++){g.push(l[j].toSVG())}if(k){this.setActiveGroup(new fabric.Group(k.getObjects()));k.forEachObject(function(i){i.set("active",true)})}g.push("</svg>");return g.join("")},remove:function(f){if(this.getActiveObject()===f){this.fire("before:selection:cleared",{target:f});this.discardActiveObject();this.fire("selection:cleared")}return fabric.Collection.remove.call(this,f)},sendToBack:function(f){d(this._objects,f);this._objects.unshift(f);return this.renderAll&&this.renderAll()},bringToFront:function(f){d(this._objects,f);this._objects.push(f);return this.renderAll&&this.renderAll()},sendBackwards:function(h,k){var f=this._objects.indexOf(h);if(f!==0){var l;if(k){l=f;for(var j=f-1;j>=0;--j){var g=h.intersectsWithObject(this._objects[j])||h.isContainedWithinObject(this._objects[j])||this._objects[j].isContainedWithinObject(h);if(g){l=j;break}}}else{l=f-1}d(this._objects,h);this._objects.splice(l,0,h);this.renderAll&&this.renderAll()}return this},bringForward:function(h,k){var f=this._objects.indexOf(h);if(f!==this._objects.length-1){var l;if(k){l=f;for(var j=f+1;j<this._objects.length;++j){var g=h.intersectsWithObject(this._objects[j])||h.isContainedWithinObject(this._objects[j])||this._objects[j].isContainedWithinObject(h);if(g){l=j;break}}}else{l=f+1}d(this._objects,h);this._objects.splice(l,0,h);this.renderAll&&this.renderAll()}return this},moveTo:function(g,f){d(this._objects,g);this._objects.splice(f,0,g);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();if(!this.interactive){return this}if(fabric.isTouchSupported){b(this.upperCanvasEl,"touchstart",this._onMouseDown);b(this.upperCanvasEl,"touchmove",this._onMouseMove);if(typeof Event!=="undefined"&&"remove" in Event){Event.remove(this.upperCanvasEl,"gesture",this._onGesture)}}else{b(this.upperCanvasEl,"mousedown",this._onMouseDown);b(this.upperCanvasEl,"mousemove",this._onMouseMove);b(fabric.window,"resize",this._onResize)}return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});e(fabric.StaticCanvas.prototype,fabric.Observable);e(fabric.StaticCanvas.prototype,fabric.Collection);e(fabric.StaticCanvas.prototype,fabric.DataURLExporter);e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(k){var h=k.getContext("2d"),f=h.getImageData(0,0,k.width,k.height),o=f.data,l=f.width,q=f.height,p,g,n,m;for(n=0;n<l;n++){for(m=0;m<q;m++){p=(n*4)*q+(m*4);g=(o[p]+o[p+1]+o[p+2])/3;o[p]=g;o[p+1]=g;o[p+2]=g}}h.putImageData(f,0,0)},supports:function(g){var h=fabric.util.createCanvasElement();if(!h||!h.getContext){return null}var f=h.getContext("2d");if(!f){return null}switch(g){case"getImageData":return typeof f.getImageData!=="undefined";case"setLineDash":return typeof f.setLineDash!=="undefined";case"toDataURL":return typeof h.toDataURL!=="undefined";case"toDataURLWithQuality":try{h.toDataURL("image/jpeg",0);return true}catch(i){}return false;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject})();fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadowBlur:0,shadowColor:"",shadowOffsetX:0,shadowOffsetY:0,strokeLineCap:"round",strokeLineJoin:"round",setBrushStyles:function(){var a=this.canvas.contextTop;a.strokeStyle=this.color;a.lineWidth=this.width;a.lineCap=this.strokeLineCap;a.lineJoin=this.strokeLineJoin},setShadowStyles:function(){if(!this.shadowColor){return}var a=this.canvas.contextTop;a.shadowBlur=this.shadowBlur;a.shadowColor=this.shadowColor;a.shadowOffsetX=this.shadowOffsetX;a.shadowOffsetY=this.shadowOffsetY},removeShadowStyles:function(){var a=this.canvas.contextTop;a.shadowColor="";a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0}});(function(){var b=fabric.util.array.min,a=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(c){this.canvas=c;this._points=[]},onMouseDown:function(c){this._prepareForDrawing(c);this._captureDrawingPath(c);this._render()},onMouseMove:function(c){this._captureDrawingPath(c);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(d){var c=new fabric.Point(d.x,d.y);this._reset();this._addPoint(c);this.canvas.contextTop.moveTo(c.x,c.y)},_addPoint:function(c){this._points.push(c)},_reset:function(){this._points.length=0;this.setBrushStyles();this.setShadowStyles()},_captureDrawingPath:function(c){var d=new fabric.Point(c.x,c.y);this._addPoint(d)},_render:function(){var d=this.canvas.contextTop;d.beginPath();var g=this._points[0];var f=this._points[1];if(this._points.length===2&&g.x===f.x&&g.y===f.y){g.x-=0.5;f.x+=0.5}d.moveTo(g.x,g.y);for(var e=1,c=this._points.length;e<c;e++){var h=g.midPointFrom(f);d.quadraticCurveTo(g.x,g.y,h.x,h.y);g=this._points[e];f=this._points[e+1]}d.lineTo(g.x,g.y);d.stroke()},_getSVGPathData:function(){this.box=this.getPathBoundingBox(this._points);return this.convertPointsToSVGPath(this._points,this.box.minx,this.box.maxx,this.box.miny,this.box.maxy)},getPathBoundingBox:function(k){var d=[],g=[],l=k[0],j=k[1],c=l;for(var e=1,f=k.length;e<f;e++){var h=l.midPointFrom(j);d.push(c.x);d.push(h.x);g.push(c.y);g.push(h.y);l=k[e];j=k[e+1];c=h}d.push(l.x);g.push(l.y);return{minx:b(d),miny:b(g),maxx:a(d),maxy:a(g)}},convertPointsToSVGPath:function(k,e,c,d){var m=[];var l=new fabric.Point(k[0].x-e,k[0].y-d);var j=new fabric.Point(k[1].x-e,k[1].y-d);m.push("M ",k[0].x-e," ",k[0].y-d," ");for(var f=1,g=k.length;f<g;f++){var h=l.midPointFrom(j);m.push("Q ",l.x," ",l.y," ",h.x," ",h.y," ");l=new fabric.Point(k[f].x-e,k[f].y-d);if((f+1)<k.length){j=new fabric.Point(k[f+1].x-e,k[f+1].y-d)}}m.push("L ",l.x," ",l.y," ");return m},createPath:function(d){var c=new fabric.Path(d);c.fill=null;c.stroke=this.color;c.strokeWidth=this.width;c.strokeLineCap=this.strokeLineCap;c.strokeLineJoin=this.strokeLineJoin;if(this.shadowColor){c.setShadow({color:this.shadowColor,blur:this.shadowBlur,offsetX:this.shadowOffsetX,offsetY:this.shadowOffsetY,affectStroke:true})}return c},_finalizeAndAddPath:function(){var c=this.canvas.contextTop;c.closePath();var g=this._getSVGPathData().join("");if(g==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.renderAll();return}var d=this.box.minx+(this.box.maxx-this.box.minx)/2;var e=this.box.miny+(this.box.maxy-this.box.miny)/2;this.canvas.contextTop.arc(d,e,3,0,Math.PI*2,false);var f=this.createPath(g);f.set({left:d,top:e});this.canvas.add(f);f.setCoords();this.canvas.clearContext(this.canvas.contextTop);this.removeShadowStyles();this.canvas.renderAll();this.canvas.fire("path:created",{path:f})}})})();fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(a){this.canvas=a;this.points=[]},drawDot:function(c){var a=this.addPoint(c);var b=this.canvas.contextTop;b.fillStyle=a.fill;b.beginPath();b.arc(a.x,a.y,a.radius,0,Math.PI*2,false);b.closePath();b.fill()},onMouseDown:function(a){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this.setShadowStyles();this.drawDot(a)},onMouseMove:function(a){this.drawDot(a)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;for(var c=0,b=this.points.length;c<b;c++){var a=this.points[c];var d=new fabric.Circle({radius:a.radius,left:a.x,top:a.y,fill:a.fill});if(this.shadowColor){d.setShadow({color:this.shadowColor,blur:this.shadowBlur,offsetX:this.shadowOffsetX,offsetY:this.shadowOffsetY})}this.canvas.add(d);this.canvas.fire("path:created",{path:d})}this.canvas.clearContext(this.canvas.contextTop);this.removeShadowStyles();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},addPoint:function(c){var d=new fabric.Point(c.x,c.y);var a=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2;var b=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();d.radius=a;d.fill=b;this.points.push(d);return d}});fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:false,initialize:function(a){this.canvas=a;this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this.setShadowStyles();this.addSprayChunk(a);this.render()},onMouseMove:function(a){this.addSprayChunk(a);this.render()},onMouseUp:function(){var g=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;for(var d=0,c=this.sprayChunks.length;d<c;d++){var f=this.sprayChunks[d];for(var b=0,a=f.length;b<a;b++){var e=new fabric.Rect({width:f[b].width,height:f[b].width,left:f[b].x+1,top:f[b].y+1,fill:this.color});if(this.shadowColor){e.setShadow({color:this.shadowColor,blur:this.shadowBlur,offsetX:this.shadowOffsetX,offsetY:this.shadowOffsetY})}this.canvas.add(e);this.canvas.fire("path:created",{path:e})}}this.canvas.clearContext(this.canvas.contextTop);this.removeShadowStyles();this.canvas.renderOnAddRemove=g;this.canvas.renderAll()},render:function(){var c=this.canvas.contextTop;c.fillStyle=this.color;c.save();for(var d=0,b=this.sprayChunkPoints.length;d<b;d++){var a=this.sprayChunkPoints[d];if(typeof a.opacity!=="undefined"){c.globalAlpha=a.opacity}c.fillRect(a.x,a.y,a.width,a.width)}c.restore()},addSprayChunk:function(f){this.sprayChunkPoints=[];var c,g,e,b=this.width/2;for(var d=0;d<this.density;d++){c=fabric.util.getRandomInt(f.x-b,f.x+b);g=fabric.util.getRandomInt(f.y-b,f.y+b);if(this.dotWidthVariance){e=fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance)}else{e=this.dotWidth}var a={x:c,y:g,width:e};if(this.randomOpacity){a.opacity=fabric.util.getRandomInt(0,100)/100}this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}});fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var d=20,b=5,c=fabric.document.createElement("canvas"),a=c.getContext("2d");c.width=c.height=d+b;a.fillStyle=this.color;a.beginPath();a.arc(d/2,d/2,d/2,0,Math.PI*2,false);a.closePath();a.fill();return c},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},setBrushStyles:function(){this.callSuper("setBrushStyles");this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(b){var a=this.callSuper("createPath",b);a.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()});return a}});(function(){var h=fabric.util.getPointer,c=fabric.util.degreesToRadians,f=fabric.util.radiansToDegrees,g=Math.atan2,i=Math.abs,d=Math.min,e=Math.max,a=0.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(k,j){j||(j={});this._initStatic(k,j);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this},uniScaleTransform:false,centerTransform:false,interactive:true,selection:true,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:false,targetFindTolerance:0,skipTargetFind:false,_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEvents();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(k){var j=this._currentTransform;j.target.set("scaleX",j.original.scaleX);j.target.set("scaleY",j.original.scaleY);j.target.set("left",j.original.left);j.target.set("top",j.original.top);if(k.altKey||this.centerTransform||j.target.centerTransform){if(j.originX!=="center"){if(j.originX==="right"){j.mouseXSign=-1}else{j.mouseXSign=1}}if(j.originY!=="center"){if(j.originY==="bottom"){j.mouseYSign=-1}else{j.mouseYSign=1}}j.originX="center";j.originY="center"}else{j.originX=j.original.originX;j.originY=j.original.originY}},containsPoint:function(l,k){var m=this.getPointer(l),j=this._normalizePointer(k,m);return(k.containsPoint(j)||k._findTargetCorner(l,this._offset))},_normalizePointer:function(k,n){var m=this.getActiveGroup(),j=n.x,o=n.y;var l=(m&&k.type!=="group"&&m.contains(k));if(l){j-=m.left;o-=m.top}return{x:j,y:o}},isTargetTransparent:function(r,t,s){var q=this.contextCache;var k=r.hasBorders,n=r.transparentCorners;r.hasBorders=r.transparentCorners=false;this._draw(q,r);r.hasBorders=k;r.transparentCorners=n;if(this.targetFindTolerance>0){if(t>this.targetFindTolerance){t-=this.targetFindTolerance}else{t=0}if(s>this.targetFindTolerance){s-=this.targetFindTolerance}else{s=0}}var p=true;var j=q.getImageData(t,s,(this.targetFindTolerance*2)||1,(this.targetFindTolerance*2)||1);for(var o=3,m=j.data.length;o<m;o+=4){var u=j.data[o];p=u<=0;if(p===false){break}}j=null;this.clearContext(q);return p},_shouldClearSelection:function(l,k){var j=this.getActiveGroup();return(!k||(k&&j&&!j.contains(k)&&j!==k&&!l.shiftKey)||(k&&!k.selectable))},_setupCurrentTransform:function(o,n){if(!n){return}var m="drag",l,p=h(o,n.canvas.upperCanvasEl);l=n._findTargetCorner(o,this._offset);if(l){m=(l==="ml"||l==="mr")?"scaleX":(l==="mt"||l==="mb")?"scaleY":l==="mtr"?"rotate":"scale"}var k="center",j="center";if(l==="ml"||l==="tl"||l==="bl"){k="right"}else{if(l==="mr"||l==="tr"||l==="br"){k="left"}}if(l==="tl"||l==="mt"||l==="tr"){j="bottom"}else{if(l==="bl"||l==="mb"||l==="br"){j="top"}}if(l==="mtr"){k="center";j="center"}this._currentTransform={target:n,action:m,scaleX:n.scaleX,scaleY:n.scaleY,offsetX:p.x-n.left,offsetY:p.y-n.top,originX:k,originY:j,ex:p.x,ey:p.y,left:n.left,top:n.top,theta:c(n.angle),width:n.width*n.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:n.left,top:n.top,scaleX:n.scaleX,scaleY:n.scaleY,originX:k,originY:j};this._resetCurrentTransform(o)},_shouldHandleGroupLogic:function(l,k){var j=this.getActiveObject();return l.shiftKey&&(this.getActiveGroup()||(j&&j!==k))&&this.selection},_handleGroupLogic:function(o,n){if(n===this.getActiveGroup()){n=this.findTarget(o,true);if(!n||n.isType("group")){return}}var j=this.getActiveGroup();if(j){if(j.contains(n)){j.removeWithUpdate(n);this._resetObjectTransform(j);n.set("active",false);if(j.size()===1){this.discardActiveGroup()}}else{j.addWithUpdate(n);this._resetObjectTransform(j)}this.fire("selection:created",{target:j,e:o});j.set("active",true)}else{if(this._activeObject){if(n!==this._activeObject){var l=this.getObjects();var k=l.indexOf(this._activeObject)<l.indexOf(n);var m=new fabric.Group(k?[n,this._activeObject]:[this._activeObject,n]);this.setActiveGroup(m);this._activeObject=null;j=this.getActiveGroup();this.fire("selection:created",{target:j,e:o})}}n.set("active",true)}if(j){j.saveCoords()}},_translateObject:function(j,l){var k=this._currentTransform.target;if(!k.get("lockMovementX")){k.set("left",j-this._currentTransform.offsetX)}if(!k.get("lockMovementY")){k.set("top",l-this._currentTransform.offsetY)}},_scaleObject:function(u,s,o){var w=this._currentTransform,k=this._offset,m=w.target;var p=m.get("lockScalingX"),n=m.get("lockScalingY");if(p&&n){return}var j=m.translateToOriginPoint(m.getCenterPoint(),w.originX,w.originY);var r=m.toLocalPoint(new fabric.Point(u-k.left,s-k.top),w.originX,w.originY);if(w.originX==="right"){r.x*=-1}else{if(w.originX==="center"){r.x*=w.mouseXSign*2;if(r.x<0){w.mouseXSign=-w.mouseXSign}}}if(w.originY==="bottom"){r.y*=-1}else{if(w.originY==="center"){r.y*=w.mouseYSign*2;if(r.y<0){w.mouseYSign=-w.mouseYSign}}}if(i(r.x)>m.padding){if(r.x<0){r.x+=m.padding}else{r.x-=m.padding}}else{r.x=0}if(i(r.y)>m.padding){if(r.y<0){r.y+=m.padding}else{r.y-=m.padding}}else{r.y=0}var z=m.scaleX,v=m.scaleY;if(o==="equally"&&!p&&!n){var q=r.y+r.x;var l=(m.height+(m.strokeWidth))*w.original.scaleY+(m.width+(m.strokeWidth))*w.original.scaleX;z=w.original.scaleX*q/l;v=w.original.scaleY*q/l;m.set("scaleX",z);m.set("scaleY",v)}else{if(!o){z=r.x/(m.width+m.strokeWidth);v=r.y/(m.height+m.strokeWidth);p||m.set("scaleX",z);n||m.set("scaleY",v)}else{if(o==="x"&&!m.get("lockUniScaling")){z=r.x/(m.width+m.strokeWidth);p||m.set("scaleX",z)}else{if(o==="y"&&!m.get("lockUniScaling")){v=r.y/(m.height+m.strokeWidth);n||m.set("scaleY",v)}}}}if(z<0){if(w.originX==="left"){w.originX="right"}else{if(w.originX==="right"){w.originX="left"}}}if(v<0){if(w.originY==="top"){w.originY="bottom"}else{if(w.originY==="bottom"){w.originY="top"}}}m.setPositionByOrigin(j,w.originX,w.originY)},_rotateObject:function(j,q){var k=this._currentTransform,n=this._offset;if(k.target.get("lockRotation")){return}var l=g(k.ey-k.top-n.top,k.ex-k.left-n.left),p=g(q-k.top-n.top,j-k.left-n.left),m=f(p-l+k.theta);if(m<0){m=360+m}k.target.angle=m},_setCursor:function(j){this.upperCanvasEl.style.cursor=j},_resetObjectTransform:function(j){j.scaleX=1;j.scaleY=1;j.setAngle(0)},_drawSelection:function(){var k=this.contextTop,j=this._groupSelector,q=j.left,p=j.top,o=i(q),m=i(p);k.fillStyle=this.selectionColor;k.fillRect(j.ex-((q>0)?0:-q),j.ey-((p>0)?0:-p),o,m);k.lineWidth=this.selectionLineWidth;k.strokeStyle=this.selectionBorderColor;if(this.selectionDashArray.length>1){var n=j.ex+a-((q>0)?0:o);var l=j.ey+a-((p>0)?0:m);k.beginPath();fabric.util.drawDashedLine(k,n,l,n+o,l,this.selectionDashArray);fabric.util.drawDashedLine(k,n,l+m-1,n+o,l+m-1,this.selectionDashArray);fabric.util.drawDashedLine(k,n,l,n,l+m,this.selectionDashArray);fabric.util.drawDashedLine(k,n+o-1,l,n+o-1,l+m,this.selectionDashArray);k.closePath();k.stroke()}else{k.strokeRect(j.ex+a-((q>0)?0:o),j.ey+a-((p>0)?0:m),o,m)}},_findSelectedObjects:function(m){var t=[],k=this._groupSelector.ex,r=this._groupSelector.ey,j=k+this._groupSelector.left,p=r+this._groupSelector.top,o,n=new fabric.Point(d(k,j),d(r,p)),q=new fabric.Point(e(k,j),e(r,p)),s=k===j&&r===p;for(var l=this._objects.length;l--;){o=this._objects[l];if(!o){continue}if(o.intersectsWithRect(n,q)||o.isContainedWithinRect(n,q)||o.containsPoint(n)||o.containsPoint(q)){if(this.selection&&o.selectable){o.set("active",true);t.push(o);if(s){break}}}}if(t.length===1){this.setActiveObject(t[0],m)}else{if(t.length>1){t=new fabric.Group(t.reverse());this.setActiveGroup(t);t.saveCoords();this.fire("selection:created",{target:t});this.renderAll()}}},findTarget:function(s,n){if(this.skipTargetFind){return}var t,k=this.getPointer(s);if(this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(s,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(s,this._offset)){t=this.lastRenderedObjectWithControlsAboveOverlay;return t}var m=this.getActiveGroup();if(m&&!n&&this.containsPoint(s,m)){t=m;return t}var l=[];for(var p=this._objects.length;p--;){if(this._objects[p]&&this._objects[p].visible&&this.containsPoint(s,this._objects[p])){if(this.perPixelTargetFind||this._objects[p].perPixelTargetFind){l[l.length]=this._objects[p]}else{t=this._objects[p];this.relatedTarget=t;break}}}for(var o=0,r=l.length;o<r;o++){k=this.getPointer(s);var q=this.isTargetTransparent(l[o],k.x,k.y);if(!q){t=l[o];this.relatedTarget=t;break}}return t},getPointer:function(j){var k=h(j,this.upperCanvasEl);return{x:k.x-this._offset.left,y:k.y-this._offset.top}},_createUpperCanvas:function(){var j=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+j);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(k){var l=this.getWidth()||k.width,j=this.getHeight()||k.height;fabric.util.setStyle(k,{position:"absolute",width:l+"px",height:j+"px",left:0,top:0});k.width=l;k.height=j;fabric.util.makeElementUnselectable(k)},_copyCanvasStyle:function(k,j){j.style.cssText=k.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},setActiveObject:function(j,k){if(this._activeObject){this._activeObject.set("active",false)}this._activeObject=j;j.set("active",true);this.renderAll();this.fire("object:selected",{target:j,e:k});j.fire("selected",{e:k});return this},getActiveObject:function(){return this._activeObject},discardActiveObject:function(){if(this._activeObject){this._activeObject.set("active",false)}this._activeObject=null;return this},setActiveGroup:function(j){this._activeGroup=j;if(j){j.canvas=this;j.set("active",true)}return this},getActiveGroup:function(){return this._activeGroup},discardActiveGroup:function(){var j=this.getActiveGroup();if(j){j.destroy()}return this.setActiveGroup(null)},deactivateAll:function(){var k=this.getObjects(),l=0,j=k.length;for(;l<j;l++){k[l].set("active",false)}this.discardActiveGroup();this.discardActiveObject();return this},deactivateAllWithDispatch:function(){var j=this.getActiveGroup()||this.getActiveObject();if(j){this.fire("before:selection:cleared",{target:j})}this.deactivateAll();if(j){this.fire("selection:cleared")}return this},drawControls:function(k){var m=this.getActiveGroup();if(m){k.save();fabric.Group.prototype.transform.call(m,k);m.drawBorders(k).drawControls(k);k.restore()}else{for(var l=0,j=this._objects.length;l<j;++l){if(!this._objects[l]||!this._objects[l].active){continue}k.save();fabric.Object.prototype.transform.call(this._objects[l],k);this._objects[l].drawBorders(k).drawControls(k);k.restore();this.lastRenderedObjectWithControlsAboveOverlay=this._objects[l]}}}});for(var b in fabric.StaticCanvas){if(b!=="prototype"){fabric.Canvas[b]=fabric.StaticCanvas[b]}}if(fabric.isTouchSupported){fabric.Canvas.prototype._setCursorFromEvent=function(){}}fabric.Element=fabric.Canvas})();(function(){var e=["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],a={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},c=fabric.util.addListener,d=fabric.util.removeListener,b=fabric.util.getPointer;fabric.util.object.extend(fabric.Canvas.prototype,{_initEvents:function(){var f=this;this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=function(h,g){f.__onTransformGesture(h,g)};c(fabric.window,"resize",this._onResize);if(fabric.isTouchSupported){c(this.upperCanvasEl,"touchstart",this._onMouseDown);c(this.upperCanvasEl,"touchmove",this._onMouseMove);if(typeof Event!=="undefined"&&"add" in Event){Event.add(this.upperCanvasEl,"gesture",this._onGesture)}}else{c(this.upperCanvasEl,"mousedown",this._onMouseDown);c(this.upperCanvasEl,"mousemove",this._onMouseMove)}},_onMouseDown:function(f){this.__onMouseDown(f);!fabric.isTouchSupported&&c(fabric.document,"mouseup",this._onMouseUp);fabric.isTouchSupported&&c(fabric.document,"touchend",this._onMouseUp);!fabric.isTouchSupported&&c(fabric.document,"mousemove",this._onMouseMove);fabric.isTouchSupported&&c(fabric.document,"touchmove",this._onMouseMove);!fabric.isTouchSupported&&d(this.upperCanvasEl,"mousemove",this._onMouseMove);fabric.isTouchSupported&&d(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseUp:function(f){this.__onMouseUp(f);!fabric.isTouchSupported&&d(fabric.document,"mouseup",this._onMouseUp);fabric.isTouchSupported&&d(fabric.document,"touchend",this._onMouseUp);!fabric.isTouchSupported&&d(fabric.document,"mousemove",this._onMouseMove);fabric.isTouchSupported&&d(fabric.document,"touchmove",this._onMouseMove);!fabric.isTouchSupported&&c(this.upperCanvasEl,"mousemove",this._onMouseMove);fabric.isTouchSupported&&c(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseMove:function(f){!this.allowTouchScrolling&&f.preventDefault&&f.preventDefault();this.__onMouseMove(f)},_onResize:function(){this.calcOffset()},__onMouseUp:function(i){var h;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._isCurrentlyDrawing=false;if(this.clipTo){this.contextTop.restore()}this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:i});return}if(this._currentTransform){var f=this._currentTransform;h=f.target;if(h._scaling){h._scaling=false}h.isMoving=false;h.setCoords();if(this.stateful&&h.hasStateChanged()){this.fire("object:modified",{target:h});h.fire("modified")}if(this._previousOriginX){this._currentTransform.target.adjustPosition(this._previousOriginX);this._previousOriginX=null}}this._currentTransform=null;if(this.selection&&this._groupSelector){this._findSelectedObjects(i)}var g=this.getActiveGroup();if(g){g.setObjectsCoords();g.set("isMoving",false);this._setCursor(this.defaultCursor)}this._groupSelector=null;this.renderAll();this._setCursorFromEvent(i,h);var j=this;setTimeout(function(){j._setCursorFromEvent(i,h)},50);this.fire("mouse:up",{target:h,e:i});h&&h.fire("mouseup",{e:i})},__onMouseDown:function(i){var j;var f="which" in i?i.which===1:i.button===1;if(!f&&!fabric.isTouchSupported){return}if(this.isDrawingMode){j=this.getPointer(i);this._isCurrentlyDrawing=true;this.discardActiveObject().renderAll();if(this.clipTo){fabric.util.clipContext(this,this.contextTop)}this.freeDrawingBrush.onMouseDown(j);this.fire("mouse:down",{e:i});return}if(this._currentTransform){return}var h=this.findTarget(i),g;j=this.getPointer(i);if(this._shouldClearSelection(i,h)){this._groupSelector={ex:j.x,ey:j.y,top:0,left:0};this.deactivateAllWithDispatch();h&&h.selectable&&this.setActiveObject(h,i)}else{if(this._shouldHandleGroupLogic(i,h)){this._handleGroupLogic(i,h);h=this.getActiveGroup()}else{this.stateful&&h.saveState();if((g=h._findTargetCorner(i,this._offset))){this.onBeforeScaleRotate(h)}if(h!==this.getActiveGroup()&&h!==this.getActiveObject()){this.deactivateAll();this.setActiveObject(h,i)}this._setupCurrentTransform(i,h)}}this.renderAll();this.fire("mouse:down",{target:h,e:i});h&&h.fire("mousedown",{e:i});if(g==="mtr"){this._previousOriginX=this._currentTransform.target.originX;this._currentTransform.target.adjustPosition("center");this._currentTransform.left=this._currentTransform.target.left;this._currentTransform.top=this._currentTransform.target.top}},__onMouseMove:function(m){var n,f;if(this.isDrawingMode){if(this._isCurrentlyDrawing){f=this.getPointer(m);this.freeDrawingBrush.onMouseMove(f)}this.upperCanvasEl.style.cursor=this.freeDrawingCursor;this.fire("mouse:move",{e:m});return}var g=this._groupSelector;if(g){f=b(m,this.upperCanvasEl);g.left=f.x-this._offset.left-g.ex;g.top=f.y-this._offset.top-g.ey;this.renderTop()}else{if(!this._currentTransform){var h=this.upperCanvasEl.style;n=this.findTarget(m);if(!n||n&&!n.selectable){for(var k=this._objects.length;k--;){if(this._objects[k]&&!this._objects[k].active){this._objects[k].set("active",false)}}h.cursor=this.defaultCursor}else{this._setCursorFromEvent(m,n)}}else{f=b(m,this.upperCanvasEl);var p=f.x,o=f.y,l=false,j=this._currentTransform;n=j.target;n.isMoving=true;if((j.action==="scale"||j.action==="scaleX"||j.action==="scaleY")&&((m.altKey&&(j.originX!=="center"||j.originY!=="center"))||(!m.altKey&&j.originX==="center"&&j.originY==="center"))){this._resetCurrentTransform(m);l=true}if(j.action==="rotate"){this._rotateObject(p,o);this.fire("object:rotating",{target:n,e:m});n.fire("rotating",{e:m})}else{if(j.action==="scale"){if((m.shiftKey||this.uniScaleTransform)&&!n.get("lockUniScaling")){j.currentAction="scale";this._scaleObject(p,o)}else{if(!l&&j.currentAction==="scale"){this._resetCurrentTransform(m)}j.currentAction="scaleEqually";this._scaleObject(p,o,"equally")}this.fire("object:scaling",{target:n,e:m});n.fire("scaling",{e:m})}else{if(j.action==="scaleX"){this._scaleObject(p,o,"x");this.fire("object:scaling",{target:n,e:m});n.fire("scaling",{e:m})}else{if(j.action==="scaleY"){this._scaleObject(p,o,"y");this.fire("object:scaling",{target:n,e:m});n.fire("scaling",{e:m})}else{this._translateObject(p,o);this.fire("object:moving",{target:n,e:m});n.fire("moving",{e:m});this._setCursor(this.moveCursor)}}}}this.renderAll()}}this.fire("mouse:move",{target:n,e:m});n&&n.fire("mousemove",{e:m})},_setCursorFromEvent:function(j,i){var g=this.upperCanvasEl.style;if(!i){g.cursor=this.defaultCursor;return false}else{var f=this.getActiveGroup();var h=i._findTargetCorner&&(!f||!f.contains(i))&&i._findTargetCorner(j,this._offset);if(!h){g.cursor=this.hoverCursor}else{if(h in a){var k=Math.round((i.getAngle()%360)/45);if(k<0){k+=8}k+=a[h];k%=8;g.cursor=e[k]}else{if(h==="mtr"&&i.hasRotatingPoint){g.cursor=this.rotationCursor}else{g.cursor=this.defaultCursor;return false}}}}return true}})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var b=a.format||"png",d=a.quality||1,c=a.multiplier||1;if(c!==1){return this.__toDataURLWithMultiplier(b,d,c)}else{return this.__toDataURL(b,d)}},__toDataURL:function(c,d){this.renderAll(true);var a=this.upperCanvasEl||this.lowerCanvasEl;var b=(fabric.StaticCanvas.supports("toDataURLWithQuality"))?a.toDataURL("image/"+c,d):a.toDataURL("image/"+c);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return b},__toDataURLWithMultiplier:function(f,g,j){var h=this.getWidth(),k=this.getHeight(),d=h*j,e=k*j,a=this.getActiveObject(),b=this.getActiveGroup(),i=this.contextTop||this.contextContainer;this.setWidth(d).setHeight(e);i.scale(j,j);if(b){this._tempRemoveBordersControlsFromGroup(b)}else{if(a&&this.deactivateAll){this.deactivateAll()}}this.width=h;this.height=k;this.renderAll(true);var c=this.__toDataURL(f,g);i.scale(1/j,1/j);this.setWidth(h).setHeight(k);if(b){this._restoreBordersControlsOnGroup(b)}else{if(a&&this.setActiveObject){this.setActiveObject(a)}}this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return c},toDataURLWithMultiplier:function(a,c,b){return this.toDataURL({format:a,multiplier:c,quality:b})},_tempRemoveBordersControlsFromGroup:function(a){a.origHasControls=a.hasControls;a.origBorderColor=a.borderColor;a.hasControls=true;a.borderColor="rgba(0,0,0,0)";a.forEachObject(function(b){b.origBorderColor=b.borderColor;b.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(a){a.hideControls=a.origHideControls;a.borderColor=a.origBorderColor;a.forEachObject(function(b){b.borderColor=b.origBorderColor;delete b.origBorderColor})}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(a,b){return this.loadFromJSON(a,b)},loadFromJSON:function(a,d){if(!a){return}var b=(typeof a==="string")?JSON.parse(a):a;this.clear();var c=this;this._enlivenObjects(b.objects,function(){c._setBgOverlayImages(b,d)});return this},_setBgOverlayImages:function(d,g){var f=this,e,c,b;var a=function(){g&&c&&b&&e&&g()};if(d.backgroundImage){this.setBackgroundImage(d.backgroundImage,function(){f.backgroundImageOpacity=d.backgroundImageOpacity;f.backgroundImageStretch=d.backgroundImageStretch;f.renderAll();c=true;a()})}else{c=true}if(d.overlayImage){this.setOverlayImage(d.overlayImage,function(){f.overlayImageLeft=d.overlayImageLeft||0;f.overlayImageTop=d.overlayImageTop||0;f.renderAll();b=true;a()})}else{b=true}if(d.background){this.setBackgroundColor(d.background,function(){f.renderAll();e=true;a()})}else{e=true}if(!d.backgroundImage&&!d.overlayImage&&!d.background){g&&g()}},_enlivenObjects:function(a,d){var c=this;if(a.length===0){d&&d()}var b=this.renderOnAddRemove;this.renderOnAddRemove=false;fabric.util.enlivenObjects(a,function(e){e.forEach(function(g,f){c.insertAt(g,f,true)});c.renderOnAddRemove=b;d&&d()})},_toDataURL:function(a,b){this.clone(function(c){b(c.toDataURL(a))})},_toDataURLWithMultiplier:function(a,c,b){this.clone(function(d){b(d.toDataURLWithMultiplier(a,c))})},clone:function(b){var a=JSON.stringify(this);this.cloneWithoutData(function(c){c.loadFromJSON(a,function(){b&&b(c)})})},cloneWithoutData:function(c){var a=fabric.document.createElement("canvas");a.width=this.getWidth();a.height=this.getHeight();var b=new fabric.Canvas(a);b.clipTo=this.clipTo;if(this.backgroundImage){b.setBackgroundImage(this.backgroundImage.src,function(){b.renderAll();c&&c(b)});b.backgroundImageOpacity=this.backgroundImageOpacity;b.backgroundImageStretch=this.backgroundImageStretch}else{c&&c(b)}}});(function(){var a=fabric.util.degreesToRadians,b=fabric.util.radiansToDegrees;fabric.util.object.extend(fabric.Canvas.prototype,{__onTransformGesture:function(f,c){if(this.isDrawingMode||f.touches.length!==2||"gesture"!==c.gesture){return}var d=this.findTarget(f);if("undefined"!==typeof d){this.onBeforeScaleRotate(d);this._rotateObjectByAngle(c.rotation);this._scaleObjectBy(c.scale)}this.fire("touch:gesture",{target:d,e:f,self:c})},_scaleObjectBy:function(d,h){var c=this._currentTransform,g=c.target;var f=g.get("lockScalingX"),e=g.get("lockScalingY");if(f&&e){return}g._scaling=true;if(!h){if(!f){g.set("scaleX",c.scaleX*d)}if(!e){g.set("scaleY",c.scaleY*d)}}else{if(h==="x"&&!g.get("lockUniScaling")){f||g.set("scaleX",c.scaleX*d)}else{if(h==="y"&&!g.get("lockUniScaling")){e||g.set("scaleY",c.scaleY*d)}}}},_rotateObjectByAngle:function(d){var c=this._currentTransform;if(c.target.get("lockRotation")){return}c.target.angle=b(a(d)+c.theta)}})})();(function(d){var e=d.fabric||(d.fabric={}),g=e.util.object.extend,a=e.util.toFixed,c=e.util.string.capitalize,b=e.util.degreesToRadians,f=e.StaticCanvas.supports("setLineDash");if(e.Object){return}e.Object=e.util.createClass({type:"object",originX:"center",originY:"center",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,cornerSize:12,transparentCorners:true,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centerTransform:false,fill:"rgb(0,0,0)",fillRule:"source-over",overlayFill:null,stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:true,visible:true,hasControls:true,hasBorders:true,hasRotatingPoint:true,rotatingPointOffset:40,perPixelTargetFind:false,includeDefaultValues:true,clipTo:null,lockMovementX:false,lockMovementY:false,lockRotation:false,lockScalingX:false,lockScalingY:false,lockUniScaling:false,stateProperties:("top left width height scaleX scaleY flipX flipY angle opacity cornerSize fill overlayFill originX originY stroke strokeWidth strokeDashArray fillRule borderScaleFactor transformMatrix selectable shadow visible").split(" "),initialize:function(h){if(h){this.setOptions(h)}},_initGradient:function(h){if(h.fill&&h.fill.colorStops&&!(h.fill instanceof e.Gradient)){this.set("fill",new e.Gradient(h.fill))}},_initPattern:function(h){if(h.fill&&h.fill.source&&!(h.fill instanceof e.Pattern)){this.set("fill",new e.Pattern(h.fill))}if(h.stroke&&h.stroke.source&&!(h.stroke instanceof e.Pattern)){this.set("stroke",new e.Pattern(h.stroke))}},_initShadow:function(h){if(h.shadow&&!(h.shadow instanceof e.Shadow)){this.setShadow(h.shadow)}},_initClipping:function(h){if(!h.clipTo||typeof h.clipTo!=="string"){return}var i=e.util.getFunctionBody(h.clipTo);if(typeof i!=="undefined"){this.clipTo=new Function("ctx",i)}},setOptions:function(h){for(var i in h){this.set(i,h[i])}this._initGradient(h);this._initPattern(h);this._initShadow(h);this._initClipping(h)},transform:function(i,j){i.globalAlpha=this.opacity;var h=j?this._getLeftTopCoords():this.getCenterPoint();i.translate(h.x,h.y);i.rotate(b(this.angle));i.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(j){var i=e.Object.NUM_FRACTION_DIGITS;var h={type:this.type,originX:this.originX,originY:this.originY,left:a(this.left,i),top:a(this.top,i),width:a(this.width,i),height:a(this.height,i),fill:(this.fill&&this.fill.toObject)?this.fill.toObject():this.fill,overlayFill:this.overlayFill,stroke:(this.stroke&&this.stroke.toObject)?this.stroke.toObject():this.stroke,strokeWidth:a(this.strokeWidth,i),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:a(this.strokeMiterLimit,i),scaleX:a(this.scaleX,i),scaleY:a(this.scaleY,i),angle:a(this.getAngle(),i),flipX:this.flipX,flipY:this.flipY,opacity:a(this.opacity,i),selectable:this.selectable,hasControls:this.hasControls,hasBorders:this.hasBorders,hasRotatingPoint:this.hasRotatingPoint,transparentCorners:this.transparentCorners,perPixelTargetFind:this.perPixelTargetFind,shadow:(this.shadow&&this.shadow.toObject)?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo)};if(!this.includeDefaultValues){h=this._removeDefaultValues(h)}e.util.populateWithProperties(this,h,j);return h},toDatalessObject:function(h){return this.toObject(h)},getSvgStyles:function(){var o=this.fill?(this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill):"none";var p=this.stroke?(this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke):"none";var n=this.strokeWidth?this.strokeWidth:"0";var m=this.strokeDashArray?this.strokeDashArray.join(" "):"";var q=this.strokeLineCap?this.strokeLineCap:"butt";var k=this.strokeLineJoin?this.strokeLineJoin:"miter";var j=this.strokeMiterLimit?this.strokeMiterLimit:"4";var l=typeof this.opacity!=="undefined"?this.opacity:"1";var h=this.visible?"":" visibility: hidden;";var i=this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",p,"; ","stroke-width: ",n,"; ","stroke-dasharray: ",m,"; ","stroke-linecap: ",q,"; ","stroke-linejoin: ",k,"; ","stroke-miterlimit: ",j,"; ","fill: ",o,"; ","opacity: ",l,";",i,h].join("")},getSvgTransform:function(){var m=this.getAngle();var i=this.getCenterPoint();var k=e.Object.NUM_FRACTION_DIGITS;var h="translate("+a(i.x,k)+" "+a(i.y,k)+")";var j=m!==0?(" rotate("+a(m,k)+")"):"";var o=(this.scaleX===1&&this.scaleY===1)?"":(" scale("+a(this.scaleX,k)+" "+a(this.scaleY,k)+")");var n=this.flipX?"matrix(-1 0 0 1 0 0) ":"";var l=this.flipY?"matrix(1 0 0 -1 0 0)":"";return[h,j,o,n,l].join("")},_createBaseSVGMarkup:function(){var h=[];if(this.fill&&this.fill.toLive){h.push(this.fill.toSVG(this,false))}if(this.stroke&&this.stroke.toLive){h.push(this.stroke.toSVG(this,false))}if(this.shadow){h.push(this.shadow.toSVG(this))}return h},_removeDefaultValues:function(i){var h=e.Object.prototype.options;if(h){this.stateProperties.forEach(function(j){if(i[j]===h[j]){delete i[j]}})}return i},toString:function(){return"#<fabric."+c(this.type)+">"},get:function(h){return this[h]},set:function(h,i){if(typeof h==="object"){for(var j in h){this._set(j,h[j])}}else{if(typeof i==="function"&&h!=="clipTo"){this._set(h,i(this.get(h)))}else{this._set(h,i)}}return this},_set:function(h,i){var j=(h==="scaleX"||h==="scaleY");if(j){i=this._constrainScale(i)}if(h==="scaleX"&&i<0){this.flipX=!this.flipX;i*=-1}else{if(h==="scaleY"&&i<0){this.flipY=!this.flipY;i*=-1}else{if(h==="width"||h==="height"){this.minScaleLimit=a(Math.min(0.1,1/Math.max(this.width,this.height)),2)}}}this[h]=i;return this},toggle:function(i){var h=this.get(i);if(typeof h==="boolean"){this.set(i,!h)}return this},setSourcePath:function(h){this.sourcePath=h;return this},render:function(i,j){if(this.width===0||this.height===0||!this.visible){return}i.save();var h=this.transformMatrix;if(h&&!this.group){i.setTransform(h[0],h[1],h[2],h[3],h[4],h[5])}if(!j){this.transform(i)}if(this.stroke){i.lineWidth=this.strokeWidth;i.lineCap=this.strokeLineCap;i.lineJoin=this.strokeLineJoin;i.miterLimit=this.strokeMiterLimit;i.strokeStyle=this.stroke.toLive?this.stroke.toLive(i):this.stroke}if(this.overlayFill){i.fillStyle=this.overlayFill}else{if(this.fill){i.fillStyle=this.fill.toLive?this.fill.toLive(i):this.fill}}if(h&&this.group){i.translate(-this.group.width/2,-this.group.height/2);i.transform(h[0],h[1],h[2],h[3],h[4],h[5])}this._setShadow(i);this.clipTo&&e.util.clipContext(this,i);this._render(i,j);this.clipTo&&i.restore();this._removeShadow(i);if(this.active&&!j){this.drawBorders(i);this.drawControls(i)}i.restore()},_setShadow:function(h){if(!this.shadow){return}h.shadowColor=this.shadow.color;h.shadowBlur=this.shadow.blur;h.shadowOffsetX=this.shadow.offsetX;h.shadowOffsetY=this.shadow.offsetY},_removeShadow:function(h){h.shadowColor="";h.shadowBlur=h.shadowOffsetX=h.shadowOffsetY=0},_renderFill:function(h){if(!this.fill){return}if(this.fill.toLive){h.save();h.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)}h.fill();if(this.fill.toLive){h.restore()}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(h)}},_renderStroke:function(h){if(!this.stroke){return}h.save();if(this.strokeDashArray){if(1&this.strokeDashArray.length){this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray)}if(f){h.setLineDash(this.strokeDashArray);this._stroke&&this._stroke(h)}else{this._renderDashedStroke&&this._renderDashedStroke(h)}h.stroke()}else{this._stroke?this._stroke(h):h.stroke()}this._removeShadow(h);h.restore()},clone:function(i,h){if(this.constructor.fromObject){return this.constructor.fromObject(this.toObject(h),i)}return new e.Object(this.toObject(h))},cloneAsImage:function(i){var h=this.toDataURL();e.util.loadImage(h,function(j){if(i){i(new e.Image(j))}});return this},toDataURL:function(i){i||(i={});var j=e.util.createCanvasElement();j.width=this.getBoundingRectWidth();j.height=this.getBoundingRectHeight();e.util.wrapElement(j,"div");var h=new e.Canvas(j);if(i.format==="jpeg"){h.backgroundColor="#fff"}var l={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set({active:false,left:j.width/2,top:j.height/2});h.add(this);var k=h.toDataURL(i);this.set(l).setCoords();h.dispose();h=null;return k},isType:function(h){return this.type===h},toGrayscale:function(){var h=this.get("fill");if(h){this.set("overlayFill",new e.Color(h).toGrayscale().toRgb())}return this},complexity:function(){return 0},toJSON:function(h){return this.toObject(h)},setGradient:function(k,j){j||(j={});var l={colorStops:[]};l.type=j.type||(j.r1||j.r2?"radial":"linear");l.coords={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2};if(j.r1||j.r2){l.coords.r1=j.r1;l.coords.r2=j.r2}for(var h in j.colorStops){var i=new e.Color(j.colorStops[h]);l.colorStops.push({offset:h,color:i.toRgb(),opacity:i.getAlpha()})}this.set(k,e.Gradient.forObject(this,l))},setPatternFill:function(h){return this.set("fill",new e.Pattern(h))},setShadow:function(h){return this.set("shadow",new e.Shadow(h))},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){return this.centerH().centerV()},remove:function(){return this.canvas.remove(this)},sendToBack:function(){if(this.group){e.StaticCanvas.prototype.sendToBack.call(this.group,this)}else{this.canvas.sendToBack(this)}return this},bringToFront:function(){if(this.group){e.StaticCanvas.prototype.bringToFront.call(this.group,this)}else{this.canvas.bringToFront(this)}return this},sendBackwards:function(h){if(this.group){e.StaticCanvas.prototype.sendBackwards.call(this.group,this,h)}else{this.canvas.sendBackwards(this,h)}return this},bringForward:function(h){if(this.group){e.StaticCanvas.prototype.bringForward.call(this.group,this,h)}else{this.canvas.bringForward(this,h)}return this},moveTo:function(h){if(this.group){e.StaticCanvas.prototype.moveTo.call(this.group,this,h)}else{this.canvas.moveTo(this,h)}return this}});e.util.createAccessors(e.Object);e.Object.prototype.rotate=e.Object.prototype.setAngle;g(e.Object.prototype,e.Observable);e.Object.NUM_FRACTION_DIGITS=2;e.Object.__uid=0})(typeof exports!=="undefined"?exports:this);(function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(c,e,d){var b=c.x,f=c.y;if(e==="left"){b=c.x+(this.getWidth()+(this.strokeWidth*this.scaleX))/2}else{if(e==="right"){b=c.x-(this.getWidth()+(this.strokeWidth*this.scaleX))/2}}if(d==="top"){f=c.y+(this.getHeight()+(this.strokeWidth*this.scaleY))/2}else{if(d==="bottom"){f=c.y-(this.getHeight()+(this.strokeWidth*this.scaleY))/2}}return fabric.util.rotatePoint(new fabric.Point(b,f),c,a(this.angle))},translateToOriginPoint:function(c,e,d){var b=c.x,f=c.y;if(e==="left"){b=c.x-(this.getWidth()+(this.strokeWidth*this.scaleX))/2}else{if(e==="right"){b=c.x+(this.getWidth()+(this.strokeWidth*this.scaleX))/2}}if(d==="top"){f=c.y-(this.getHeight()+(this.strokeWidth*this.scaleY))/2}else{if(d==="bottom"){f=c.y+(this.getHeight()+(this.strokeWidth*this.scaleY))/2}}return fabric.util.rotatePoint(new fabric.Point(b,f),c,a(this.angle))},getCenterPoint:function(){return this.translateToCenterPoint(new fabric.Point(this.left,this.top),this.originX,this.originY)},toLocalPoint:function(d,f,e){var c=this.getCenterPoint();var b,g;if(f!==undefined&&e!==undefined){if(f==="left"){b=c.x-(this.getWidth()+this.strokeWidth*this.scaleX)/2}else{if(f==="right"){b=c.x+(this.getWidth()+this.strokeWidth*this.scaleX)/2}else{b=c.x}}if(e==="top"){g=c.y-(this.getHeight()+this.strokeWidth*this.scaleY)/2}else{if(e==="bottom"){g=c.y+(this.getHeight()+this.strokeWidth*this.scaleY)/2}else{g=c.y}}}else{b=this.left;g=this.top}return fabric.util.rotatePoint(new fabric.Point(d.x,d.y),c,-a(this.angle)).subtractEquals(new fabric.Point(b,g))},setPositionByOrigin:function(f,e,d){var c=this.translateToCenterPoint(f,e,d);var b=this.translateToOriginPoint(c,this.originX,this.originY);this.set("left",b.x);this.set("top",b.y)},adjustPosition:function(i){var g=a(this.angle);var h=this.getWidth()/2;var f=Math.cos(g)*h;var c=Math.sin(g)*h;var e=this.getWidth();var d=Math.cos(g)*e;var b=Math.sin(g)*e;if(this.originX==="center"&&i==="left"||this.originX==="right"&&i==="center"){this.left-=f;this.top-=c}else{if(this.originX==="left"&&i==="center"||this.originX==="center"&&i==="right"){this.left+=f;this.top+=c}else{if(this.originX==="left"&&i==="right"){this.left+=d;this.top+=b}else{if(this.originX==="right"&&i==="left"){this.left-=d;this.top-=b}}}}this.setCoords();this.originX=i},_getLeftTopCoords:function(){var e=a(this.angle);var g=this.getWidth()/2;var d=Math.cos(e)*g;var c=Math.sin(e)*g;var b=this.left;var f=this.top;if(this.originX==="center"||this.originX==="right"){b-=d}if(this.originY==="center"||this.originY==="bottom"){f-=c}return{x:b,y:f}}})})();(function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(c,e){var i=this.oCoords,b=new fabric.Point(i.tl.x,i.tl.y),f=new fabric.Point(i.tr.x,i.tr.y),h=new fabric.Point(i.bl.x,i.bl.y),d=new fabric.Point(i.br.x,i.br.y);var g=fabric.Intersection.intersectPolygonRectangle([b,f,d,h],c,e);return g.status==="Intersection"},intersectsWithObject:function(b){function c(g){return{tl:new fabric.Point(g.tl.x,g.tl.y),tr:new fabric.Point(g.tr.x,g.tr.y),bl:new fabric.Point(g.bl.x,g.bl.y),br:new fabric.Point(g.br.x,g.br.y)}}var d=c(this.oCoords),f=c(b.oCoords);var e=fabric.Intersection.intersectPolygonPolygon([d.tl,d.tr,d.br,d.bl],[f.tl,f.tr,f.br,f.bl]);return e.status==="Intersection"},isContainedWithinObject:function(b){var c=b.getBoundingRect(),e=new fabric.Point(c.left,c.top),d=new fabric.Point(c.left+c.width,c.top+c.height);return this.isContainedWithinRect(e,d)},isContainedWithinRect:function(b,d){var c=this.getBoundingRect();return(c.left>b.x&&c.left+c.width<d.x&&c.top>b.y&&c.top+c.height<d.y)},containsPoint:function(b){var d=this._getImageLines(this.oCoords),c=this._findCrossPoints(b,d);return(c!==0&&c%2===1)},_getImageLines:function(b){return{topline:{o:b.tl,d:b.tr},rightline:{o:b.tr,d:b.br},bottomline:{o:b.br,d:b.bl},leftline:{o:b.bl,d:b.tl}}},_findCrossPoints:function(k,b){var j,i,d,c,h,g,f=0,e;for(var l in b){e=b[l];if((e.o.y<k.y)&&(e.d.y<k.y)){continue}if((e.o.y>=k.y)&&(e.d.y>=k.y)){continue}if((e.o.x===e.d.x)&&(e.o.x>=k.x)){h=e.o.x;g=k.y}else{j=0;i=(e.d.y-e.o.y)/(e.d.x-e.o.x);d=k.y-j*k.x;c=e.o.y-i*e.o.x;h=-(d-c)/(j-i);g=d+j*h}if(h>=k.x){f+=1}if(f===2){break}}return f},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var d=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x];var c=fabric.util.array.min(d);var h=fabric.util.array.max(d);var f=Math.abs(c-h);var e=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y];var i=fabric.util.array.min(e);var g=fabric.util.array.max(e);var b=Math.abs(i-g);return{left:c,top:i,width:f,height:b}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(b){if(Math.abs(b)<this.minScaleLimit){if(b<0){return -this.minScaleLimit}else{return this.minScaleLimit}}return b},scale:function(b){b=this._constrainScale(b);if(b<0){this.flipX=!this.flipX;this.flipY=!this.flipY;b*=-1}this.scaleX=b;this.scaleY=b;this.setCoords();return this},scaleToWidth:function(c){var b=this.getBoundingRectWidth()/this.getWidth();return this.scale(c/this.width/b)},scaleToHeight:function(c){var b=this.getBoundingRectHeight()/this.getHeight();return this.scale(c/this.height/b)},setCoords:function(){var k=this.strokeWidth>1?this.strokeWidth:0,i=this.padding,g=a(this.angle);this.currentWidth=(this.width+k)*this.scaleX+i*2;this.currentHeight=(this.height+k)*this.scaleY+i*2;if(this.currentWidth<0){this.currentWidth=Math.abs(this.currentWidth)}var j=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));var h=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0);var s=Math.cos(h+g)*j,r=Math.sin(h+g)*j,q=Math.sin(g),l=Math.cos(g);var o=this.getCenterPoint();var e={x:o.x-s,y:o.y-r};var c={x:e.x+(this.currentWidth*l),y:e.y+(this.currentWidth*q)};var t={x:c.x-(this.currentHeight*q),y:c.y+(this.currentHeight*l)};var d={x:e.x-(this.currentHeight*q),y:e.y+(this.currentHeight*l)};var p={x:e.x-(this.currentHeight/2*q),y:e.y+(this.currentHeight/2*l)};var m={x:e.x+(this.currentWidth/2*l),y:e.y+(this.currentWidth/2*q)};var n={x:c.x-(this.currentHeight/2*q),y:c.y+(this.currentHeight/2*l)};var b={x:d.x+(this.currentWidth/2*l),y:d.y+(this.currentWidth/2*q)};var f={x:m.x,y:m.y};this.oCoords={tl:e,tr:c,br:t,bl:d,ml:p,mt:m,mr:n,mb:b,mtr:f};this._setCornerCoords&&this._setCornerCoords();return this}})})();fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(a){return this[a]!==this.originalState[a]},this)},saveState:function(a){this.stateProperties.forEach(function(b){this.originalState[b]=this.get(b)},this);if(a&&a.stateProperties){a.stateProperties.forEach(function(b){this.originalState[b]=this.get(b)},this)}return this},setupState:function(){this.originalState={};this.saveState();return this}});(function(){var a=fabric.util.getPointer,b=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_findTargetCorner:function(j,l){if(!this.hasControls||!this.active){return false}var k=a(j,this.canvas.upperCanvasEl),h=k.x-l.left,f=k.y-l.top,d,c;for(var g in this.oCoords){if(g==="mtr"&&!this.hasRotatingPoint){continue}if(this.get("lockUniScaling")&&(g==="mt"||g==="mr"||g==="mb"||g==="ml")){continue}c=this._getImageLines(this.oCoords[g].corner);d=this._findCrossPoints({x:h,y:f},c);if(d!==0&&d%2===1){this.__corner=g;return g}}return false},_setCornerCoords:function(){var i=this.oCoords,d=b(this.angle),f=b(45-this.angle),g=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,c=g*Math.cos(f),e=g*Math.sin(f),j=Math.sin(d),h=Math.cos(d);i.tl.corner={tl:{x:i.tl.x-e,y:i.tl.y-c},tr:{x:i.tl.x+c,y:i.tl.y-e},bl:{x:i.tl.x-c,y:i.tl.y+e},br:{x:i.tl.x+e,y:i.tl.y+c}};i.tr.corner={tl:{x:i.tr.x-e,y:i.tr.y-c},tr:{x:i.tr.x+c,y:i.tr.y-e},br:{x:i.tr.x+e,y:i.tr.y+c},bl:{x:i.tr.x-c,y:i.tr.y+e}};i.bl.corner={tl:{x:i.bl.x-e,y:i.bl.y-c},bl:{x:i.bl.x-c,y:i.bl.y+e},br:{x:i.bl.x+e,y:i.bl.y+c},tr:{x:i.bl.x+c,y:i.bl.y-e}};i.br.corner={tr:{x:i.br.x+c,y:i.br.y-e},bl:{x:i.br.x-c,y:i.br.y+e},br:{x:i.br.x+e,y:i.br.y+c},tl:{x:i.br.x-e,y:i.br.y-c}};i.ml.corner={tl:{x:i.ml.x-e,y:i.ml.y-c},tr:{x:i.ml.x+c,y:i.ml.y-e},bl:{x:i.ml.x-c,y:i.ml.y+e},br:{x:i.ml.x+e,y:i.ml.y+c}};i.mt.corner={tl:{x:i.mt.x-e,y:i.mt.y-c},tr:{x:i.mt.x+c,y:i.mt.y-e},bl:{x:i.mt.x-c,y:i.mt.y+e},br:{x:i.mt.x+e,y:i.mt.y+c}};i.mr.corner={tl:{x:i.mr.x-e,y:i.mr.y-c},tr:{x:i.mr.x+c,y:i.mr.y-e},bl:{x:i.mr.x-c,y:i.mr.y+e},br:{x:i.mr.x+e,y:i.mr.y+c}};i.mb.corner={tl:{x:i.mb.x-e,y:i.mb.y-c},tr:{x:i.mb.x+c,y:i.mb.y-e},bl:{x:i.mb.x-c,y:i.mb.y+e},br:{x:i.mb.x+e,y:i.mb.y+c}};i.mtr.corner={tl:{x:i.mtr.x-e+(j*this.rotatingPointOffset),y:i.mtr.y-c-(h*this.rotatingPointOffset)},tr:{x:i.mtr.x+c+(j*this.rotatingPointOffset),y:i.mtr.y-e-(h*this.rotatingPointOffset)},bl:{x:i.mtr.x-c+(j*this.rotatingPointOffset),y:i.mtr.y+e-(h*this.rotatingPointOffset)},br:{x:i.mtr.x+e+(j*this.rotatingPointOffset),y:i.mtr.y+c-(h*this.rotatingPointOffset)}}},drawBorders:function(l){if(!this.hasBorders){return this}var g=this.padding,c=g*2,f=~~(this.strokeWidth/2)*2;l.save();l.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;l.strokeStyle=this.borderColor;var k=1/this._constrainScale(this.scaleX),i=1/this._constrainScale(this.scaleY);l.lineWidth=1/this.borderScaleFactor;l.scale(k,i);var j=this.getWidth(),e=this.getHeight();l.strokeRect(~~(-(j/2)-g-f/2*this.scaleX)-0.5,~~(-(e/2)-g-f/2*this.scaleY)-0.5,~~(j+c+f*this.scaleX)+1,~~(e+c+f*this.scaleY)+1);if(this.hasRotatingPoint&&!this.get("lockRotation")&&this.hasControls){var d=(this.flipY?e+(f*this.scaleY)+(g*2):-e-(f*this.scaleY)-(g*2))/2;l.beginPath();l.moveTo(0,d);l.lineTo(0,d+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset));l.closePath();l.stroke()}l.restore();return this},drawControls:function(p){if(!this.hasControls){return this}var l=this.cornerSize,f=l/2,d=~~(this.strokeWidth/2),e=-(this.width/2),j=-(this.height/2),v,q,n=l/this.scaleX,k=l/this.scaleY,s=this.padding/this.scaleX,r=this.padding/this.scaleY,t=f/this.scaleY,u=f/this.scaleX,h=(f-l)/this.scaleX,g=(f-l)/this.scaleY,m=this.height,o=this.width,i=this.transparentCorners?"strokeRect":"fillRect",w=this.transparentCorners,c=typeof G_vmlCanvasManager!=="undefined";p.save();p.lineWidth=1/Math.max(this.scaleX,this.scaleY);p.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;p.strokeStyle=p.fillStyle=this.cornerColor;v=e-u-d-s;q=j-t-d-r;c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k);v=e+o-u+d+s;q=j-t-d-r;c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k);v=e-u-d-s;q=j+m+g+d+r;c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k);v=e+o+h+d+s;q=j+m+g+d+r;c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k);if(!this.get("lockUniScaling")){v=e+o/2-u;q=j-t-d-r;c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k);v=e+o/2-u;q=j+m+g+d+r;c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k);v=e+o+h+d+s;q=j+m/2-t;c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k);v=e-u-d-s;q=j+m/2-t;c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k)}if(this.hasRotatingPoint){v=e+o/2-u;q=this.flipY?(j+m+(this.rotatingPointOffset/this.scaleY)-k/2+d+r):(j-(this.rotatingPointOffset/this.scaleY)-k/2-d-r);c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k)}p.restore();return this}})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(g){b.set("left",g);f.renderAll();a()},onComplete:function(){b.setCoords();e()}});return this},fxCenterObjectV:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(g){b.set("top",g);f.renderAll();a()},onComplete:function(){b.setCoords();e()}});return this},fxRemove:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){b.set("active",false)},onChange:function(g){b.set("opacity",g);f.renderAll();a()},onComplete:function(){f.remove(b);e()}});return this}});fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]==="object"){var e=[],d,b;for(d in arguments[0]){e.push(d)}for(var c=0,a=e.length;c<a;c++){d=e[c];b=c!==a-1;this._animate(d,arguments[0][d],arguments[1],b)}}else{this._animate.apply(this,arguments)}return this},_animate:function(e,g,c,a){var f=this,b;g=g.toString();if(!c){c={}}else{c=fabric.util.object.clone(c)}if(~e.indexOf(".")){b=e.split(".")}var d=b?this.get(b[0])[b[1]]:this.get(e);if(!("from" in c)){c.from=d}if(~g.indexOf("=")){g=d+parseFloat(g.replace("=",""))}else{g=parseFloat(g)}fabric.util.animate({startValue:c.from,endValue:g,byValue:c.by,easing:c.easing,duration:c.duration,abort:c.abort&&function(){return c.abort.call(f)},onChange:function(h){if(b){f[b[0]][b[1]]=h}else{f.set(e,h)}if(a){return}c.onChange&&c.onChange()},onComplete:function(){if(a){return}f.setCoords();c.onComplete&&c.onComplete()}})}});(function(b){var c=b.fabric||(b.fabric={}),e=c.util.object.extend,a={x1:1,x2:1,y1:1,y2:1},d=c.StaticCanvas.supports("setLineDash");if(c.Line){c.warn("fabric.Line is already defined");return}c.Line=c.util.createClass(c.Object,{type:"line",initialize:function(g,f){f=f||{};if(!g){g=[0,0,0,0]}this.callSuper("initialize",f);this.set("x1",g[0]);this.set("y1",g[1]);this.set("x2",g[2]);this.set("y2",g[3]);this._setWidthHeight(f)},_setWidthHeight:function(f){f||(f={});this.set("width",Math.abs(this.x2-this.x1)||1);this.set("height",Math.abs(this.y2-this.y1)||1);this.set("left","left" in f?f.left:(Math.min(this.x1,this.x2)+this.width/2));this.set("top","top" in f?f.top:(Math.min(this.y1,this.y2)+this.height/2))},_set:function(f,g){this[f]=g;if(f in a){this._setWidthHeight()}return this},_render:function(g){g.beginPath();var f=this.group&&this.group.type!=="group";if(f&&!this.transformMatrix){g.translate(-this.group.width/2+this.left,-this.group.height/2+this.top)}if(!this.strokeDashArray||this.strokeDashArray&&d){var j=this.x1<=this.x2?-1:1;var h=this.y1<=this.y2?-1:1;g.moveTo(this.width===1?0:(j*this.width/2),this.height===1?0:(h*this.height/2));g.lineTo(this.width===1?0:(j*-1*this.width/2),this.height===1?0:(h*-1*this.height/2))}g.lineWidth=this.strokeWidth;var i=g.strokeStyle;g.strokeStyle=this.stroke||g.fillStyle;this._renderStroke(g);g.strokeStyle=i},_renderDashedStroke:function(g){var j=this.x1<=this.x2?-1:1,h=this.y1<=this.y2?-1:1,f=this.width===1?0:j*this.width/2,i=this.height===1?0:h*this.height/2;g.beginPath();c.util.drawDashedLine(g,f,i,-f,-i,this.strokeDashArray);g.closePath()},toObject:function(f){return e(this.callSuper("toObject",f),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(){var f=this._createBaseSVGMarkup();f.push("<line ",'x1="',this.get("x1"),'" y1="',this.get("y1"),'" x2="',this.get("x2"),'" y2="',this.get("y2"),'" style="',this.getSvgStyles(),'"/>');return f.join("")},complexity:function(){return 1}});c.Line.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" "));c.Line.fromElement=function(g,f){var i=c.parseAttributes(g,c.Line.ATTRIBUTE_NAMES);var h=[i.x1||0,i.y1||0,i.x2||0,i.y2||0];return new c.Line(h,e(i,f))};c.Line.fromObject=function(f){var g=[f.x1,f.y1,f.x2,f.y2];return new c.Line(g,f)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),d=Math.PI*2,e=b.util.object.extend;if(b.Circle){b.warn("fabric.Circle is already defined.");return}b.Circle=b.util.createClass(b.Object,{type:"circle",initialize:function(f){f=f||{};this.set("radius",f.radius||0);this.callSuper("initialize",f);var g=this.get("radius")*2;this.set("width",g).set("height",g)},toObject:function(f){return e(this.callSuper("toObject",f),{radius:this.get("radius")})},toSVG:function(){var f=this._createBaseSVGMarkup();f.push("<circle ",'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return f.join("")},_render:function(f,g){f.beginPath();f.globalAlpha=this.group?(f.globalAlpha*this.opacity):this.opacity;f.arc(g?this.left:0,g?this.top:0,this.radius,0,d,false);f.closePath();this._renderFill(f);this._renderStroke(f)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(f){this.radius=f;this.set("width",f*2).set("height",f*2)},complexity:function(){return 1}});b.Circle.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy r".split(" "));b.Circle.fromElement=function(g,f){f||(f={});var h=b.parseAttributes(g,b.Circle.ATTRIBUTE_NAMES);if(!c(h)){throw new Error("value of `r` attribute is required and can not be negative")}if("left" in h){h.left-=(f.width/2)||0}if("top" in h){h.top-=(f.height/2)||0}var i=new b.Circle(e(h,f));i.cx=parseFloat(g.getAttribute("cx"))||0;i.cy=parseFloat(g.getAttribute("cy"))||0;return i};function c(f){return(("radius" in f)&&(f.radius>0))}b.Circle.fromObject=function(f){return new b.Circle(f)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Triangle){b.warn("fabric.Triangle is already defined");return}b.Triangle=b.util.createClass(b.Object,{type:"triangle",initialize:function(c){c=c||{};this.callSuper("initialize",c);this.set("width",c.width||100).set("height",c.height||100)},_render:function(c){var d=this.width/2,e=this.height/2;c.beginPath();c.moveTo(-d,e);c.lineTo(0,-e);c.lineTo(d,e);c.closePath();this._renderFill(c);this._renderStroke(c)},_renderDashedStroke:function(c){var d=this.width/2,e=this.height/2;c.beginPath();b.util.drawDashedLine(c,-d,e,0,-e,this.strokeDashArray);b.util.drawDashedLine(c,0,-e,d,e,this.strokeDashArray);b.util.drawDashedLine(c,d,e,-d,e,this.strokeDashArray);c.closePath()},toSVG:function(){var c=this._createBaseSVGMarkup(),d=this.width/2,e=this.height/2;var f=[-d+" "+e,"0 "+-e,d+" "+e].join(",");c.push("<polygon ",'points="',f,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return c.join("")},complexity:function(){return 1}});b.Triangle.fromObject=function(c){return new b.Triangle(c)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=Math.PI*2,d=b.util.object.extend;if(b.Ellipse){b.warn("fabric.Ellipse is already defined.");return}b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,initialize:function(e){e=e||{};this.callSuper("initialize",e);this.set("rx",e.rx||0);this.set("ry",e.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(e){return d(this.callSuper("toObject",e),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(){var e=this._createBaseSVGMarkup();e.push("<ellipse ",'rx="',this.get("rx"),'" ry="',this.get("ry"),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return e.join("")},render:function(e,f){if(this.rx===0||this.ry===0){return}return this.callSuper("render",e,f)},_render:function(e,f){e.beginPath();e.save();e.globalAlpha=this.group?(e.globalAlpha*this.opacity):this.opacity;if(this.transformMatrix&&this.group){e.translate(this.cx,this.cy)}e.transform(1,0,0,this.ry/this.rx,0,0);e.arc(f?this.left:0,f?this.top:0,this.rx,0,c,false);this._renderFill(e);this._renderStroke(e);e.restore()},complexity:function(){return 1}});b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" "));b.Ellipse.fromElement=function(g,f){f||(f={});var i=b.parseAttributes(g,b.Ellipse.ATTRIBUTE_NAMES);var e=i.left;var j=i.top;if("left" in i){i.left-=(f.width/2)||0}if("top" in i){i.top-=(f.height/2)||0}var h=new b.Ellipse(d(i,f));h.cx=e||0;h.cy=j||0;return h};b.Ellipse.fromObject=function(e){return new b.Ellipse(e)}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),d=c.util.object.extend;if(c.Rect){console.warn("fabric.Rect is already defined");return}c.Rect=c.util.createClass(c.Object,{type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(e){e=e||{};this._initStateProperties();this.callSuper("initialize",e);this._initRxRy();this.x=e.x||0;this.y=e.y||0},_initStateProperties:function(){this.stateProperties=this.stateProperties.concat(["rx","ry"])},_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx}else{if(this.ry&&!this.rx){this.rx=this.ry}}},_render:function(n){var f=this.rx||0,e=this.ry||0,l=-this.width/2,k=-this.height/2,m=this.width,i=this.height,g=this.group&&this.group.type!=="group";n.beginPath();n.globalAlpha=g?(n.globalAlpha*this.opacity):this.opacity;if(this.transformMatrix&&g){n.translate(this.width/2+this.x,this.height/2+this.y)}if(!this.transformMatrix&&g){n.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y)}var j=f!==0||e!==0;n.moveTo(l+f,k);n.lineTo(l+m-f,k);j&&n.quadraticCurveTo(l+m,k,l+m,k+e,l+m,k+e);n.lineTo(l+m,k+i-e);j&&n.quadraticCurveTo(l+m,k+i,l+m-f,k+i,l+m-f,k+i);n.lineTo(l+f,k+i);j&&n.quadraticCurveTo(l,k+i,l,k+i-e,l,k+i-e);n.lineTo(l,k+e);j&&n.quadraticCurveTo(l,k,l+f,k,l+f,k);n.closePath();this._renderFill(n);this._renderStroke(n)},_renderDashedStroke:function(g){var e=-this.width/2,j=-this.height/2,f=this.width,i=this.height;g.beginPath();c.util.drawDashedLine(g,e,j,e+f,j,this.strokeDashArray);c.util.drawDashedLine(g,e+f,j,e+f,j+i,this.strokeDashArray);c.util.drawDashedLine(g,e+f,j+i,e,j+i,this.strokeDashArray);c.util.drawDashedLine(g,e,j+i,e,j,this.strokeDashArray);g.closePath()},_normalizeLeftTopProperties:function(e){if("left" in e){this.set("left",e.left+this.getWidth()/2)}this.set("x",e.left||0);if("top" in e){this.set("top",e.top+this.getHeight()/2)}this.set("y",e.top||0);return this},toObject:function(e){return d(this.callSuper("toObject",e),{rx:this.get("rx")||0,ry:this.get("ry")||0,x:this.get("x"),y:this.get("y")})},toSVG:function(){var e=this._createBaseSVGMarkup();e.push("<rect ",'x="',(-1*this.width/2),'" y="',(-1*this.height/2),'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return e.join("")},complexity:function(){return 1}});c.Rect.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" "));function a(e){e.left=e.left||0;e.top=e.top||0;return e}c.Rect.fromElement=function(f,e){if(!f){return null}var h=c.parseAttributes(f,c.Rect.ATTRIBUTE_NAMES);h=a(h);var g=new c.Rect(d((e?c.util.object.clone(e):{}),h));g._normalizeLeftTopProperties(h);return g};c.Rect.fromObject=function(e){return new c.Rect(e)}})(typeof exports!=="undefined"?exports:this);(function(c){var d=c.fabric||(c.fabric={}),a=d.util.toFixed,b=d.util.array.min;if(d.Polyline){d.warn("fabric.Polyline is already defined");return}d.Polyline=d.util.createClass(d.Object,{type:"polyline",initialize:function(f,e,g){e=e||{};this.set("points",f);this.callSuper("initialize",e);this._calcDimensions(g)},_calcDimensions:function(e){return d.Polygon.prototype._calcDimensions.call(this,e)},toObject:function(e){return d.Polygon.prototype.toObject.call(this,e)},toSVG:function(){var h=[],f=this._createBaseSVGMarkup();for(var g=0,e=this.points.length;g<e;g++){h.push(a(this.points[g].x,2),",",a(this.points[g].y,2)," ")}f.push("<polyline ",'points="',h.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return f.join("")},_render:function(g){var f;g.beginPath();g.moveTo(this.points[0].x,this.points[0].y);for(var h=0,e=this.points.length;h<e;h++){f=this.points[h];g.lineTo(f.x,f.y)}this._renderFill(g);this._renderStroke(g)},_renderDashedStroke:function(f){var j,h;f.beginPath();for(var g=0,e=this.points.length;g<e;g++){j=this.points[g];h=this.points[g+1]||j;d.util.drawDashedLine(f,j.x,j.y,h.x,h.y,this.strokeDashArray)}},complexity:function(){return this.get("points").length}});d.Polyline.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat();d.Polyline.fromElement=function(j,g){if(!j){return null}g||(g={});var k=d.parsePointsAttribute(j.getAttribute("points")),l=d.parseAttributes(j,d.Polyline.ATTRIBUTE_NAMES),f=b(k,"x"),m=b(k,"y");f=f<0?f:0;m=f<0?m:0;for(var h=0,e=k.length;h<e;h++){k[h].x-=(g.width/2+f)||0;k[h].y-=(g.height/2+m)||0}return new d.Polyline(k,d.util.object.extend(l,g),true)};d.Polyline.fromObject=function(e){var f=e.points;return new d.Polyline(f,e,true)}})(typeof exports!=="undefined"?exports:this);(function(d){var e=d.fabric||(d.fabric={}),f=e.util.object.extend,c=e.util.array.min,b=e.util.array.max,a=e.util.toFixed;if(e.Polygon){e.warn("fabric.Polygon is already defined");return}e.Polygon=e.util.createClass(e.Object,{type:"polygon",initialize:function(h,g,i){g=g||{};this.points=h;this.callSuper("initialize",g);this._calcDimensions(i)},_calcDimensions:function(l){var i=this.points,h=c(i,"x"),n=c(i,"y"),k=b(i,"x"),j=b(i,"y");this.width=(k-h)||1;this.height=(j-n)||1;this.minX=h;this.minY=n;if(l){return}var m=this.width/2+this.minX,g=this.height/2+this.minY;this.points.forEach(function(o){o.x-=m;o.y-=g},this)},toObject:function(g){return f(this.callSuper("toObject",g),{points:this.points.concat()})},toSVG:function(){var k=[],h=this._createBaseSVGMarkup();for(var j=0,g=this.points.length;j<g;j++){k.push(a(this.points[j].x,2),",",a(this.points[j].y,2)," ")}h.push("<polygon ",'points="',k.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return h.join("")},_render:function(j){var h;j.beginPath();j.moveTo(this.points[0].x,this.points[0].y);for(var k=0,g=this.points.length;k<g;k++){h=this.points[k];j.lineTo(h.x,h.y)}this._renderFill(j);if(this.stroke||this.strokeDashArray){j.closePath();this._renderStroke(j)}},_renderDashedStroke:function(h){var l,k;h.beginPath();for(var j=0,g=this.points.length;j<g;j++){l=this.points[j];k=this.points[j+1]||this.points[0];e.util.drawDashedLine(h,l.x,l.y,k.x,k.y,this.strokeDashArray)}h.closePath()},complexity:function(){return this.points.length}});e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat();e.Polygon.fromElement=function(l,j){if(!l){return null}j||(j={});var m=e.parsePointsAttribute(l.getAttribute("points")),n=e.parseAttributes(l,e.Polygon.ATTRIBUTE_NAMES),h=c(m,"x"),o=c(m,"y");h=h<0?h:0;o=h<0?o:0;for(var k=0,g=m.length;k<g;k++){m[k].x-=(j.width/2+h)||0;m[k].y-=(j.height/2+o)||0}return new e.Polygon(m,f(n,j),true)};e.Polygon.fromObject=function(g){return new e.Polygon(g.points,g,true)}})(typeof exports!=="undefined"?exports:this);(function(a){var h={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};"use strict";var c=a.fabric||(a.fabric={}),d=c.util.array.min,f=c.util.array.max,e=c.util.object.extend,b=Object.prototype.toString,g=c.util.drawArc;if(c.Path){c.warn("fabric.Path is already defined");return}function j(k){if(k[0]==="H"){return k[1]}return k[k.length-2]}function i(k){if(k[0]==="V"){return k[1]}return k[k.length-1]}c.Path=c.util.createClass(c.Object,{type:"path",initialize:function(m,l){l=l||{};this.setOptions(l);if(!m){throw new Error("`path` argument is required")}var k=b.call(m)==="[object Array]";this.path=k?m:m.match&&m.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(!this.path){return}if(!k){this.path=this._parsePath()}this._initializePath(l);if(l.sourcePath){this.setSourcePath(l.sourcePath)}},_initializePath:function(l){var k="width" in l&&l.width!=null,o="height" in l&&l.width!=null,m="left" in l,q="top" in l,n=m?this.left:0,p=q?this.top:0;if(!k||!o){e(this,this._parseDimensions());if(k){this.width=l.width}if(o){this.height=l.height}}else{if(!q){this.top=this.height/2}if(!m){this.left=this.width/2}}this.pathOffset=this.pathOffset||this._calculatePathOffset(n,p)},_calculatePathOffset:function(k,l){return{x:this.left-k-(this.width/2),y:this.top-l-(this.height/2)}},_render:function(B){var v,s=null,z=0,w=0,k=0,C=0,r,q,n,m,o=-((this.width/2)+this.pathOffset.x),A=-((this.height/2)+this.pathOffset.y);for(var p=0,u=this.path.length;p<u;++p){v=this.path[p];switch(v[0]){case"l":z+=v[1];w+=v[2];B.lineTo(z+o,w+A);break;case"L":z=v[1];w=v[2];B.lineTo(z+o,w+A);break;case"h":z+=v[1];B.lineTo(z+o,w+A);break;case"H":z=v[1];B.lineTo(z+o,w+A);break;case"v":w+=v[1];B.lineTo(z+o,w+A);break;case"V":w=v[1];B.lineTo(z+o,w+A);break;case"m":z+=v[1];w+=v[2];B[(s&&(s[0]==="m"||s[0]==="M"))?"lineTo":"moveTo"](z+o,w+A);break;case"M":z=v[1];w=v[2];B[(s&&(s[0]==="m"||s[0]==="M"))?"lineTo":"moveTo"](z+o,w+A);break;case"c":r=z+v[5];q=w+v[6];k=z+v[3];C=w+v[4];B.bezierCurveTo(z+v[1]+o,w+v[2]+A,k+o,C+A,r+o,q+A);z=r;w=q;break;case"C":z=v[5];w=v[6];k=v[3];C=v[4];B.bezierCurveTo(v[1]+o,v[2]+A,k+o,C+A,z+o,w+A);break;case"s":r=z+v[3];q=w+v[4];k=k?(2*z-k):z;C=C?(2*w-C):w;B.bezierCurveTo(k+o,C+A,z+v[1]+o,w+v[2]+A,r+o,q+A);k=z+v[1];C=w+v[2];z=r;w=q;break;case"S":r=v[3];q=v[4];k=2*z-k;C=2*w-C;B.bezierCurveTo(k+o,C+A,v[1]+o,v[2]+A,r+o,q+A);z=r;w=q;k=v[1];C=v[2];break;case"q":r=z+v[3];q=w+v[4];k=z+v[1];C=w+v[2];B.quadraticCurveTo(k+o,C+A,r+o,q+A);z=r;w=q;break;case"Q":r=v[3];q=v[4];B.quadraticCurveTo(v[1]+o,v[2]+A,r+o,q+A);z=r;w=q;k=v[1];C=v[2];break;case"t":r=z+v[1];q=w+v[2];if(s[0].match(/[QqTt]/)===null){k=z;C=w}else{if(s[0]==="t"){k=2*z-n;C=2*w-m}else{if(s[0]==="q"){k=2*z-k;C=2*w-C}}}n=k;m=C;B.quadraticCurveTo(k+o,C+A,r+o,q+A);z=r;w=q;k=z+v[1];C=w+v[2];break;case"T":r=v[1];q=v[2];k=2*z-k;C=2*w-C;B.quadraticCurveTo(k+o,C+A,r+o,q+A);z=r;w=q;break;case"a":g(B,z+o,w+A,[v[1],v[2],v[3],v[4],v[5],v[6]+z+o,v[7]+w+A]);z+=v[6];w+=v[7];break;case"A":g(B,z+o,w+A,[v[1],v[2],v[3],v[4],v[5],v[6]+o,v[7]+A]);z=v[6];w=v[7];break;case"z":case"Z":B.closePath();break}s=v}},render:function(l,n){if(!this.visible){return}l.save();var k=this.transformMatrix;if(k){l.transform(k[0],k[1],k[2],k[3],k[4],k[5])}if(!n){this.transform(l)}if(this.overlayFill){l.fillStyle=this.overlayFill}else{if(this.fill){l.fillStyle=this.fill.toLive?this.fill.toLive(l):this.fill}}if(this.stroke){l.lineWidth=this.strokeWidth;l.lineCap=this.strokeLineCap;l.lineJoin=this.strokeLineJoin;l.miterLimit=this.strokeMiterLimit;l.strokeStyle=this.stroke.toLive?this.stroke.toLive(l):this.stroke}this._setShadow(l);this.clipTo&&c.util.clipContext(this,l);l.beginPath();this._render(l);this._renderFill(l);this._renderStroke(l);this.clipTo&&l.restore();this._removeShadow(l);if(!n&&this.active){this.drawBorders(l);this.drawControls(l)}l.restore()},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(l){var k=e(this.callSuper("toObject",l),{path:this.path,pathOffset:this.pathOffset});if(this.sourcePath){k.sourcePath=this.sourcePath}if(this.transformMatrix){k.transformMatrix=this.transformMatrix}return k},toDatalessObject:function(l){var k=this.toObject(l);if(this.sourcePath){k.path=this.sourcePath}delete k.sourcePath;return k},toSVG:function(){var o=[],l=this._createBaseSVGMarkup();for(var m=0,k=this.path.length;m<k;m++){o.push(this.path[m].join(" "))}var n=o.join(" ");l.push('<g transform="',(this.group?"":this.getSvgTransform()),'">',"<path ",'d="',n,'" style="',this.getSvgStyles(),'" transform="translate(',(-this.width/2)," ",(-this.height/2),")",'" stroke-linecap="round" ',"/>","</g>");return l.join("")},complexity:function(){return this.path.length},_parsePath:function(){var A=[],v=[],w,t,y=/(-?\.\d+)|(-?\d+(\.\d+)?)/g,q,l;for(var p=0,u,r=this.path.length;p<r;p++){w=this.path[p];l=w.slice(1).trim();v.length=0;while((q=y.exec(l))){v.push(q[0])}u=[w.charAt(0)];for(var o=0,x=v.length;o<x;o++){t=parseFloat(v[o]);if(!isNaN(t)){u.push(t)}}var n=u[0].toLowerCase(),z=h[n];if(u.length-1>z){for(var m=1,s=u.length;m<s;m+=z){A.push([u[0]].concat(u.slice(m,m+z)))}}else{A.push(u)}}return A},_parseDimensions:function(){var u=[],s=[],v,t,w=false,A,z;this.path.forEach(function(x,o){if(x[0]!=="H"){v=(o===0)?j(x):j(this.path[o-1])}if(x[0]!=="V"){t=(o===0)?i(x):i(this.path[o-1])}if(x[0]===x[0].toLowerCase()){w=true}A=w?v+j(x):x[0]==="V"?v:j(x);z=w?t+i(x):x[0]==="H"?t:i(x);var y=parseInt(A,10);if(!isNaN(y)){u.push(y)}y=parseInt(z,10);if(!isNaN(y)){s.push(y)}},this);var p=d(u),n=d(s),l=f(u),k=f(s),r=l-p,q=k-n;var m={left:this.left+(p+r/2),top:this.top+(n+q/2),width:r,height:q};return m}});c.Path.fromObject=function(k,l){if(typeof k.path==="string"){c.loadSVGFromURL(k.path,function(m){var n=m[0];var o=k.path;delete k.path;c.util.object.extend(n,k);n.setSourcePath(o);l(n)})}else{l(new c.Path(k.path,k))}};c.Path.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["d"]);c.Path.fromElement=function(l,n,k){var m=c.parseAttributes(l,c.Path.ATTRIBUTE_NAMES);n&&n(new c.Path(m.d,e(m,k)))};c.Path.async=true})(typeof exports!=="undefined"?exports:this);(function(c){var d=c.fabric||(c.fabric={}),e=d.util.object.extend,a=d.util.array.invoke,b=d.Object.prototype.toObject;if(d.PathGroup){d.warn("fabric.PathGroup is already defined");return}d.PathGroup=d.util.createClass(d.Path,{type:"path-group",fill:"",initialize:function(h,f){f=f||{};this.paths=h||[];for(var g=this.paths.length;g--;){this.paths[g].group=this}this.setOptions(f);this.setCoords();if(f.sourcePath){this.setSourcePath(f.sourcePath)}},render:function(h){if(!this.visible){return}h.save();var f=this.transformMatrix;if(f){h.transform(f[0],f[1],f[2],f[3],f[4],f[5])}this.transform(h);this._setShadow(h);this.clipTo&&d.util.clipContext(this,h);for(var j=0,g=this.paths.length;j<g;++j){this.paths[j].render(h,true)}this.clipTo&&h.restore();this._removeShadow(h);if(this.active){this.drawBorders(h);this.drawControls(h)}h.restore()},_set:function(h,g){if((h==="fill"||h==="overlayFill")&&g&&this.isSameColor()){var f=this.paths.length;while(f--){this.paths[f]._set(h,g)}}return this.callSuper("_set",h,g)},toObject:function(f){return e(b.call(this,f),{paths:a(this.getObjects(),"toObject",f),sourcePath:this.sourcePath})},toDatalessObject:function(g){var f=this.toObject(g);if(this.sourcePath){f.paths=this.sourcePath}return f},toSVG:function(){var j=this.getObjects();var g=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"];for(var h=0,f=j.length;h<f;h++){g.push(j[h].toSVG())}g.push("</g>");return g.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var f=this.getObjects()[0].get("fill");return this.getObjects().every(function(g){return g.get("fill")===f})},complexity:function(){return this.paths.reduce(function(f,g){return f+((g&&g.complexity)?g.complexity():0)},0)},toGrayscale:function(){var f=this.paths.length;while(f--){this.paths[f].toGrayscale()}return this},getObjects:function(){return this.paths}});d.PathGroup.fromObject=function(f,g){if(typeof f.paths==="string"){d.loadSVGFromURL(f.paths,function(i){var j=f.paths;delete f.paths;var h=d.util.groupSVGElements(i,f,j);g(h)})}else{d.util.enlivenObjects(f.paths,function(h){delete f.paths;g(new d.PathGroup(h,f))})}};d.PathGroup.async=true})(typeof exports!=="undefined"?exports:this);(function(d){var e=d.fabric||(d.fabric={}),g=e.util.object.extend,c=e.util.array.min,a=e.util.array.max,b=e.util.array.invoke;if(e.Group){return}var f={lockMovementX:true,lockMovementY:true,lockRotation:true,lockScalingX:true,lockScalingY:true,lockUniScaling:true};e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",initialize:function(k,h){h=h||{};this._objects=k||[];for(var j=this._objects.length;j--;){this._objects[j].group=this}this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();if(h){g(this,h)}this._setOpacityIfSame();this.setCoords(true);this.saveCoords()},_updateObjectsCoords:function(){var i=this.left,h=this.top;this.forEachObject(function(j){var k=j.get("left"),l=j.get("top");j.set("originalLeft",k);j.set("originalTop",l);j.set("left",k-i);j.set("top",l-h);j.setCoords();j.__origHasControls=j.hasControls;j.hasControls=false},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this._objects},addWithUpdate:function(h){this._restoreObjectsState();this._objects.push(h);h.group=this;this.forEachObject(function(i){i.set("active",true);i.group=this},this);this._calcBounds();this._updateObjectsCoords();return this},removeWithUpdate:function(h){this._restoreObjectsState();this.forEachObject(function(i){i.set("active",true);i.group=this},this);this.remove(h);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(h){h.group=this},_onObjectRemoved:function(h){delete h.group;h.set("active",false)},delegatedProperties:{fill:true,opacity:true,fontFamily:true,fontWeight:true,fontSize:true,fontStyle:true,lineHeight:true,textDecoration:true,textShadow:true,textAlign:true,backgroundColor:true},_set:function(j,k){if(j in this.delegatedProperties){var h=this._objects.length;this[j]=k;while(h--){this._objects[h].set(j,k)}}else{this[j]=k}},toObject:function(h){return g(this.callSuper("toObject",h),{objects:b(this._objects,"toObject",h)})},render:function(k,p){if(!this.visible){return}k.save();this.transform(k);var o=Math.max(this.scaleX,this.scaleY);this.clipTo&&e.util.clipContext(this,k);for(var m=0,h=this._objects.length;m<h;m++){var l=this._objects[m],n=l.borderScaleFactor,j=l.hasRotatingPoint;if(!l.visible){continue}l.borderScaleFactor=o;l.hasRotatingPoint=false;l.render(k);l.borderScaleFactor=n;l.hasRotatingPoint=j}this.clipTo&&k.restore();if(!p&&this.active){this.drawBorders(k);this.drawControls(k)}k.restore();this.setCoords()},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},_restoreObjectState:function(j){var k=this.get("left"),l=this.get("top"),h=this.getAngle()*(Math.PI/180),i=Math.cos(h)*j.get("top")*this.get("scaleY")+Math.sin(h)*j.get("left")*this.get("scaleX"),m=-Math.sin(h)*j.get("top")*this.get("scaleY")+Math.cos(h)*j.get("left")*this.get("scaleX");j.setAngle(j.getAngle()+this.getAngle());j.set("left",k+m);j.set("top",l+i);j.set("scaleX",j.get("scaleX")*this.get("scaleX"));j.set("scaleY",j.get("scaleY")*this.get("scaleY"));j.setCoords();j.hasControls=j.__origHasControls;delete j.__origHasControls;j.set("active",false);j.setCoords();delete j.group;return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(h){h.setCoords()});return this},_setOpacityIfSame:function(){var j=this.getObjects(),i=j[0]?j[0].get("opacity"):1;var h=j.every(function(k){return k.get("opacity")===i});if(h){this.opacity=i}},_calcBounds:function(){var s=[],q=[],p,n,k,h,m,l,u,r=0,t=this._objects.length;for(;r<t;++r){m=this._objects[r];m.setCoords();for(var j in m.oCoords){s.push(m.oCoords[j].x);q.push(m.oCoords[j].y)}}p=c(s);k=a(s);n=c(q);h=a(q);l=(k-p)||0;u=(h-n)||0;this.width=l;this.height=u;this.left=(p+l/2)||0;this.top=(n+u/2)||0},toSVG:function(){var j=[];for(var h=this._objects.length;h--;){j.push(this._objects[h].toSVG())}return('<g transform="'+this.getSvgTransform()+'">'+j.join("")+"</g>")},get:function(k){if(k in f){if(this[k]){return this[k]}else{for(var j=0,h=this._objects.length;j<h;j++){if(this._objects[j][k]){return true}}return false}}else{if(k in this.delegatedProperties){return this._objects[0]&&this._objects[0].get(k)}return this[k]}}});e.Group.fromObject=function(h,i){e.util.enlivenObjects(h.objects,function(j){delete h.objects;i&&i(new e.Group(j,h))})};e.Group.async=true})(typeof exports!=="undefined"?exports:this);(function(a){var b=fabric.util.object.extend;if(!a.fabric){a.fabric={}}if(a.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",initialize:function(d,c){c||(c={});this.filters=[];this.callSuper("initialize",c);this._initElement(d);this._initConfig(c);if(c.filters){this.filters=c.filters;this.applyFilters()}},getElement:function(){return this._element},setElement:function(c,d){this._element=c;this._originalElement=c;this._initConfig();if(this.filters.length!==0){this.applyFilters(d)}return this},getOriginalSize:function(){var c=this.getElement();return{width:c.width,height:c.height}},render:function(e,f){if(!this.visible){return}e.save();var c=this.transformMatrix;var d=this.group&&this.group.type!=="group";if(d){e.translate(-this.group.width/2+this.width/2,-this.group.height/2+this.height/2)}if(c){e.transform(c[0],c[1],c[2],c[3],c[4],c[5])}if(!f){this.transform(e)}e.save();this._setShadow(e);this.clipTo&&fabric.util.clipContext(this,e);this._render(e);if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(e)}this._renderStroke(e);this.clipTo&&e.restore();e.restore();if(this.active&&!f){this.drawBorders(e);this.drawControls(e)}e.restore()},_stroke:function(c){c.save();c.lineWidth=this.strokeWidth;c.lineCap=this.strokeLineCap;c.lineJoin=this.strokeLineJoin;c.miterLimit=this.strokeMiterLimit;c.strokeStyle=this.stroke.toLive?this.stroke.toLive(c):this.stroke;c.beginPath();c.strokeRect(-this.width/2,-this.height/2,this.width,this.height);c.closePath();c.restore()},_renderDashedStroke:function(e){var c=-this.width/2,g=-this.height/2,d=this.width,f=this.height;e.save();e.lineWidth=this.strokeWidth;e.lineCap=this.strokeLineCap;e.lineJoin=this.strokeLineJoin;e.miterLimit=this.strokeMiterLimit;e.strokeStyle=this.stroke.toLive?this.stroke.toLive(e):this.stroke;e.beginPath();fabric.util.drawDashedLine(e,c,g,c+d,g,this.strokeDashArray);fabric.util.drawDashedLine(e,c+d,g,c+d,g+f,this.strokeDashArray);fabric.util.drawDashedLine(e,c+d,g+f,c,g+f,this.strokeDashArray);fabric.util.drawDashedLine(e,c,g+f,c,g,this.strokeDashArray);e.closePath();e.restore()},toObject:function(c){return b(this.callSuper("toObject",c),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(d){return d&&d.toObject()})})},toSVG:function(){var c=[];c.push('<g transform="',this.getSvgTransform(),'">','<image xlink:href="',this.getSvgSrc(),'" style="',this.getSvgStyles(),'" transform="translate('+(-this.width/2)+" "+(-this.height/2)+")",'" width="',this.width,'" height="',this.height,'"></image>');if(this.stroke||this.strokeDashArray){var d=this.fill;this.fill=null;c.push("<rect ",'x="',(-1*this.width/2),'" y="',(-1*this.height/2),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>');this.fill=d}c.push("</g>");return c.join("")},getSrc:function(){return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(d,c){this.constructor.fromObject(this.toObject(c),d)},applyFilters:function(g){if(this.filters.length===0){this._element=this._originalElement;g&&g();return}var e=this._originalElement,c=fabric.util.createCanvasElement(),d=fabric.util.createImage(),f=this;c.width=e.width;c.height=e.height;c.getContext("2d").drawImage(e,0,0,e.width,e.height);this.filters.forEach(function(h){h&&h.applyTo(c)});d.width=e.width;d.height=e.height;if(fabric.isLikelyNode){d.src=c.toBuffer(undefined,fabric.Image.pngCompression);f._element=d;g&&g()}else{d.onload=function(){f._element=d;g&&g();d.onload=c=e=null};d.src=c.toDataURL("image/png")}return this},_render:function(c){c.drawImage(this._element,-this.width/2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var c=this.getElement();this.set("width",c.width);this.set("height",c.height)},_initElement:function(c){this.setElement(fabric.util.getById(c));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(c){c||(c={});this.setOptions(c);this._setWidthHeight(c)},_initFilters:function(c,d){if(c.filters&&c.filters.length){fabric.util.enlivenObjects(c.filters,function(e){d&&d(e)},"fabric.Image.filters")}else{d&&d()}},_setWidthHeight:function(c){this.width="width" in c?c.width:(this.getElement().width||0);this.height="height" in c?c.height:(this.getElement().height||0)},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(d,f){var c=fabric.document.createElement("img"),e=d.src;c.onload=function(){fabric.Image.prototype._initFilters.call(d,d,function(h){d.filters=h||[];var g=new fabric.Image(c,d);f&&f(g);c=c.onload=c.onerror=null})};c.onerror=function(){fabric.log("Error loading "+c.src);f&&f(null,true);c=c.onload=c.onerror=null};c.src=e};fabric.Image.fromURL=function(c,e,d){fabric.util.loadImage(c,function(f){e(new fabric.Image(f,d))})};fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height xlink:href".split(" "));fabric.Image.fromElement=function(d,f,c){var e=fabric.parseAttributes(d,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(e["xlink:href"],f,b((c?fabric.util.object.clone(c):{}),e))};fabric.Image.async=true;fabric.Image.pngCompression=1})(typeof exports!=="undefined"?exports:this);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.getAngle()%360;if(a>0){return Math.round((a-1)/90)*90}return Math.round(a/90)*90},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(b){b=b||{};var c=function(){},d=b.onComplete||c,a=b.onChange||c,e=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(f){e.setAngle(f);a()},onComplete:function(){e.setCoords();d()},onStart:function(){e.set("active",false)}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(a){a.straighten();this.renderAll();return this},fxStraightenObject:function(a){a.fxStraighten({onChange:this.renderAll.bind(this)});return this}});fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}});(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Brightness=b.util.createClass(b.Image.filters.BaseFilter,{type:"Brightness",initialize:function(d){d=d||{};this.brightness=d.brightness||100},applyTo:function(g){var f=g.getContext("2d"),k=f.getImageData(0,0,g.width,g.height),h=k.data,j=this.brightness;for(var e=0,d=h.length;e<d;e+=4){h[e]+=j;h[e+1]+=j;h[e+2]+=j}f.putImageData(k,0,0)},toObject:function(){return c(this.callSuper("toObject"),{brightness:this.brightness})}});b.Image.filters.Brightness.fromObject=function(d){return new b.Image.filters.Brightness(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Convolute=b.util.createClass(b.Image.filters.BaseFilter,{type:"Convolute",initialize:function(d){d=d||{};this.opaque=d.opaque;this.matrix=d.matrix||[0,0,0,0,1,0,0,0,0];var e=b.util.createCanvasElement();this.tmpCtx=e.getContext("2d")},_createImageData:function(d,e){return this.tmpCtx.createImageData(d,e)},applyTo:function(l){var H=this.matrix;var i=l.getContext("2d");var A=i.getImageData(0,0,l.width,l.height);var e=Math.round(Math.sqrt(H.length));var k=Math.floor(e/2);var m=A.data;var B=A.width;var K=A.height;var s=B;var F=K;var n=this._createImageData(s,F);var L=n.data;var t=this.opaque?1:0;for(var o=0;o<F;o++){for(var p=0;p<s;p++){var v=o;var z=p;var C=(o*s+p)*4;var u=0,G=0,I=0,J=0;for(var f=0;f<e;f++){for(var j=0;j<e;j++){var D=v+f-k;var E=z+j-k;if(D>=0&&D<K&&E>=0&&E<B){var q=(D*B+E)*4;var d=H[f*e+j];u+=m[q]*d;G+=m[q+1]*d;I+=m[q+2]*d;J+=m[q+3]*d}}}L[C]=u;L[C+1]=G;L[C+2]=I;L[C+3]=J+t*(255-J)}}i.putImageData(n,0,0)},toObject:function(){return c(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});b.Image.filters.Convolute.fromObject=function(d){return new b.Image.filters.Convolute(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.GradientTransparency=b.util.createClass(b.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(d){d=d||{};this.threshold=d.threshold||100},applyTo:function(h){var g=h.getContext("2d"),l=g.getImageData(0,0,h.width,h.height),k=l.data,e=this.threshold,j=k.length;for(var f=0,d=k.length;f<d;f+=4){k[f+3]=e+255*(j-f)/j}g.putImageData(l,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold})}});b.Image.filters.GradientTransparency.fromObject=function(d){return new b.Image.filters.GradientTransparency(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Grayscale=b.util.createClass(b.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(f){var e=f.getContext("2d"),i=e.getImageData(0,0,f.width,f.height),h=i.data,c=i.width*i.height*4,d=0,g;while(d<c){g=(h[d]+h[d+1]+h[d+2])/3;h[d]=g;h[d+1]=g;h[d+2]=g;d+=4}e.putImageData(i,0,0)}});b.Image.filters.Grayscale.fromObject=function(){return new b.Image.filters.Grayscale()}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Invert=b.util.createClass(b.Image.filters.BaseFilter,{type:"Invert",applyTo:function(f){var e=f.getContext("2d"),h=e.getImageData(0,0,f.width,f.height),g=h.data,c=g.length,d;for(d=0;d<c;d+=4){g[d]=255-g[d];g[d+1]=255-g[d+1];g[d+2]=255-g[d+2]}e.putImageData(h,0,0)}});b.Image.filters.Invert.fromObject=function(){return new b.Image.filters.Invert()}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Mask=b.util.createClass(b.Image.filters.BaseFilter,{type:"Mask",initialize:function(d){d=d||{};this.mask=d.mask;this.channel=[0,1,2,3].indexOf(d.channel)>-1?d.channel:0},applyTo:function(h){if(!this.mask){return}var e=h.getContext("2d"),d=e.getImageData(0,0,h.width,h.height),j=d.data,l=this.mask.getElement(),n=b.util.createCanvasElement(),m=this.channel,k,g=d.width*d.height*4;n.width=l.width;n.height=l.height;n.getContext("2d").drawImage(l,0,0,l.width,l.height);var f=n.getContext("2d").getImageData(0,0,l.width,l.height),o=f.data;for(k=0;k<g;k+=4){j[k+3]=o[k+m]}e.putImageData(d,0,0)},toObject:function(){return c(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});b.Image.filters.Mask.fromObject=function(e,g){var d=b.document.createElement("img"),f=e.mask.src;d.onload=function(){e.mask=new b.Image(d,e.mask);g&&g(new b.Image.filters.Mask(e));d=d.onload=d.onerror=null};d.onerror=function(){b.log("Error loading "+d.src);g&&g(null,true);d=d.onload=d.onerror=null};d.src=f};b.Image.filters.Mask.async=true})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Noise=b.util.createClass(b.Image.filters.BaseFilter,{type:"Noise",initialize:function(d){d=d||{};this.noise=d.noise||100},applyTo:function(h){var g=h.getContext("2d"),l=g.getImageData(0,0,h.width,h.height),k=l.data,e=this.noise,j;for(var f=0,d=k.length;f<d;f+=4){j=(0.5-Math.random())*e;k[f]+=j;k[f+1]+=j;k[f+2]+=j}g.putImageData(l,0,0)},toObject:function(){return c(this.callSuper("toObject"),{noise:this.noise})}});b.Image.filters.Noise.fromObject=function(d){return new b.Image.filters.Noise(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Pixelate=b.util.createClass(b.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(d){d=d||{};this.blocksize=d.blocksize||4},applyTo:function(h){var f=h.getContext("2d"),e=f.getImageData(0,0,h.width,h.height),o=e.data,k=e.height,x=e.width,s,p,n,d,q,u,v;for(p=0;p<k;p+=this.blocksize){for(n=0;n<x;n+=this.blocksize){s=(p*4)*x+(n*4);d=o[s];q=o[s+1];u=o[s+2];v=o[s+3];for(var m=p,w=p+this.blocksize;m<w;m++){for(var l=n,t=n+this.blocksize;l<t;l++){s=(m*4)*x+(l*4);o[s]=d;o[s+1]=q;o[s+2]=u;o[s+3]=v}}}}f.putImageData(e,0,0)},toObject:function(){return c(this.callSuper("toObject"),{blocksize:this.blocksize})}});b.Image.filters.Pixelate.fromObject=function(d){return new b.Image.filters.Pixelate(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.RemoveWhite=b.util.createClass(b.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(d){d=d||{};this.threshold=d.threshold||30;this.distance=d.distance||20},applyTo:function(j){var h=j.getContext("2d"),e=h.getImageData(0,0,j.width,j.height),m=e.data,n=this.threshold,f=this.distance,k=255-n,s=Math.abs,d,o,q;for(var l=0,p=m.length;l<p;l+=4){d=m[l];o=m[l+1];q=m[l+2];if(d>k&&o>k&&q>k&&s(d-o)<f&&s(d-q)<f&&s(o-q)<f){m[l+3]=1}}h.putImageData(e,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});b.Image.filters.RemoveWhite.fromObject=function(d){return new b.Image.filters.RemoveWhite(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Sepia=b.util.createClass(b.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(f){var e=f.getContext("2d"),j=e.getImageData(0,0,f.width,f.height),g=j.data,c=g.length,d,h;for(d=0;d<c;d+=4){h=0.3*g[d]+0.59*g[d+1]+0.11*g[d+2];g[d]=h+100;g[d+1]=h+50;g[d+2]=h+255}e.putImageData(j,0,0)}});b.Image.filters.Sepia.fromObject=function(){return new b.Image.filters.Sepia()}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Sepia2=b.util.createClass(b.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(f){var e=f.getContext("2d"),c=e.getImageData(0,0,f.width,f.height),j=c.data,h=j.length,k,d,l,m;for(k=0;k<h;k+=4){d=j[k];l=j[k+1];m=j[k+2];j[k]=(d*0.393+l*0.769+m*0.189)/1.351;j[k+1]=(d*0.349+l*0.686+m*0.168)/1.203;j[k+2]=(d*0.272+l*0.534+m*0.131)/2.14}e.putImageData(c,0,0)}});b.Image.filters.Sepia2.fromObject=function(){return new b.Image.filters.Sepia2()}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Tint=b.util.createClass(b.Image.filters.BaseFilter,{type:"Tint",initialize:function(d){d=d||{};this.color=d.color||0},applyTo:function(g){var f=g.getContext("2d"),d=f.getImageData(0,0,g.width,g.height),k=d.data,h=k.length,l,o;var n=parseInt(this.color,10).toString(16);while(n.length<6){n="0"+n}var m=parseInt("0x"+n.substr(0,2),16);var e=parseInt("0x"+n.substr(2,2),16);var j=parseInt("0x"+n.substr(4,2),16);for(l=0;l<h;l+=4){o=k[l+3];if(o>0){k[l]=m;k[l+1]=e;k[l+2]=j}}f.putImageData(d,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color})}});b.Image.filters.Tint.fromObject=function(d){return new b.Image.filters.Tint(d)}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),g=c.util.object.extend,f=c.util.object.clone,a=c.util.toFixed,d=c.StaticCanvas.supports("setLineDash");if(c.Text){c.warn("fabric.Text is already defined");return}var e=c.Object.prototype.stateProperties.concat();e.push("fontFamily","fontWeight","fontSize","path","text","textDecoration","textShadow","textAlign","fontStyle","lineHeight","backgroundColor","textBackgroundColor","useNative");c.Text=c.util.createClass(c.Object,{_dimensionAffectingProps:{fontSize:true,fontWeight:true,fontFamily:true,textDecoration:true,fontStyle:true,lineHeight:true,stroke:true,strokeWidth:true,text:true},type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textShadow:"",textAlign:"left",fontStyle:"",lineHeight:1.3,backgroundColor:"",textBackgroundColor:"",path:null,useNative:true,stateProperties:e,initialize:function(i,h){h=h||{};this.text=i;this.__skipDimension=true;this.setOptions(h);this.__skipDimension=false;this._initDimensions();this.setCoords()},_initDimensions:function(){if(this.__skipDimension){return}var h=c.util.createCanvasElement();this._render(h.getContext("2d"))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(i){var h=this.group&&this.group.type!=="group";if(h&&!this.transformMatrix){i.translate(-this.group.width/2+this.left,-this.group.height/2+this.top)}else{if(h&&this.transformMatrix){i.translate(-this.group.width/2,-this.group.height/2)}}if(typeof Cufon==="undefined"||this.useNative===true){this._renderViaNative(i)}else{this._renderViaCufon(i)}},_renderViaNative:function(h){this.transform(h,c.isLikelyNode);this._setTextStyles(h);var i=this.text.split(/\r?\n/);this.width=this._getTextWidth(h,i);this.height=this._getTextHeight(h,i);this.clipTo&&c.util.clipContext(this,h);this._renderTextBackground(h,i);if(this.textAlign!=="left"&&this.textAlign!=="justify"){h.save();h.translate(this.textAlign==="center"?(this.width/2):this.width,0)}h.save();this._setTextShadow(h);this._renderTextFill(h,i);this._renderTextStroke(h,i);this.textShadow&&h.restore();h.restore();if(this.textAlign!=="left"&&this.textAlign!=="justify"){h.restore()}this._renderTextDecoration(h,i);this.clipTo&&h.restore();this._setBoundaries(h,i);this._totalLineHeight=0},_setBoundaries:function(k,m){this._boundaries=[];for(var l=0,j=m.length;l<j;l++){var h=this._getLineWidth(k,m[l]);var n=this._getLineLeftOffset(h);this._boundaries.push({height:this.fontSize*this.lineHeight,width:h,left:n})}},_setTextStyles:function(h){if(this.fill){h.fillStyle=this.fill.toLive?this.fill.toLive(h):this.fill}if(this.stroke){h.lineWidth=this.strokeWidth;h.lineCap=this.strokeLineCap;h.lineJoin=this.strokeLineJoin;h.miterLimit=this.strokeMiterLimit;h.strokeStyle=this.stroke.toLive?this.stroke.toLive(h):this.stroke}h.textBaseline="alphabetic";h.textAlign=this.textAlign;h.font=this._getFontDeclaration()},_getTextHeight:function(h,i){return this.fontSize*i.length*this.lineHeight},_getTextWidth:function(j,l){var m=j.measureText(l[0]).width;for(var k=1,h=l.length;k<h;k++){var n=j.measureText(l[k]).width;if(n>m){m=n}}return m},_setTextShadow:function(h){if(!this.textShadow){return}var l=/\s+(-?\d+)(?:px)?\s+(-?\d+)(?:px)?\s+(\d+)(?:px)?\s*/;var i=this.textShadow;var k=l.exec(this.textShadow);var j=i.replace(l,"");h.save();h.shadowColor=j;h.shadowOffsetX=parseInt(k[1],10);h.shadowOffsetY=parseInt(k[2],10);h.shadowBlur=parseInt(k[3],10);this._shadows=[{blur:h.shadowBlur,color:h.shadowColor,offX:h.shadowOffsetX,offY:h.shadowOffsetY}];this._shadowOffsets=[[parseInt(h.shadowOffsetX,10),parseInt(h.shadowOffsetY,10)]]},_drawChars:function(l,h,i,k,j){h[l](i,k,j)},_drawTextLine:function(h,v,x,k,s,u){if(this.textAlign!=="justify"){this._drawChars(h,v,x,k,s,u);return}var p=v.measureText(x).width;var o=this.width;if(o>p){var r=x.split(/\s+/);var w=v.measureText(x.replace(/\s+/g,"")).width;var n=o-w;var m=r.length-1;var t=n/m;var j=0;for(var l=0,q=r.length;l<q;l++){this._drawChars(h,v,r[l],k+j,s,u);j+=v.measureText(r[l]).width+t}}else{this._drawChars(h,v,x,k,s,u)}},_getLeftOffset:function(){if(c.isLikelyNode&&(this.originX==="left"||this.originX==="center")){return 0}return -this.width/2},_getTopOffset:function(){if(c.isLikelyNode){if(this.originY==="center"){return -this.height/2}else{if(this.originY==="bottom"){return -this.height}}return 0}return -this.height/2},_renderTextFill:function(j,l){if(!this.fill&&!this.skipFillStrokeCheck){return}this._boundaries=[];for(var k=0,h=l.length;k<h;k++){this._drawTextLine("fillText",j,l[k],this._getLeftOffset(),this._getTopOffset()+(k*this.fontSize*this.lineHeight)+this.fontSize,k)}},_renderTextStroke:function(j,l){if(!this.stroke&&!this.skipFillStrokeCheck){return}j.save();if(this.strokeDashArray){if(1&this.strokeDashArray.length){this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray)}d&&j.setLineDash(this.strokeDashArray)}j.beginPath();for(var k=0,h=l.length;k<h;k++){this._drawTextLine("strokeText",j,l[k],this._getLeftOffset(),this._getTopOffset()+(k*this.fontSize*this.lineHeight)+this.fontSize,k)}j.closePath();j.restore()},_renderTextBackground:function(h,i){this._renderTextBoxBackground(h);this._renderTextLinesBackground(h,i)},_renderTextBoxBackground:function(h){if(!this.backgroundColor){return}h.save();h.fillStyle=this.backgroundColor;h.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height);h.restore()},_renderTextLinesBackground:function(k,m){if(!this.textBackgroundColor){return}k.save();k.fillStyle=this.textBackgroundColor;for(var l=0,j=m.length;l<j;l++){if(m[l]!==""){var h=this._getLineWidth(k,m[l]);var n=this._getLineLeftOffset(h);k.fillRect(this._getLeftOffset()+n,this._getTopOffset()+(l*this.fontSize*this.lineHeight),h,this.fontSize*this.lineHeight)}}k.restore()},_getLineLeftOffset:function(h){if(this.textAlign==="center"){return(this.width-h)/2}if(this.textAlign==="right"){return this.width-h}return 0},_getLineWidth:function(i,h){return this.textAlign==="justify"?this.width:i.measureText(h).width},_renderTextDecoration:function(i,j){if(!this.textDecoration){return}var k=this.originY==="top"?0:this._getTextHeight(i,j)/2;var l=this;function h(q){for(var o=0,n=j.length;o<n;o++){var m=l._getLineWidth(i,j[o]);var p=l._getLineLeftOffset(m);i.fillRect(l._getLeftOffset()+p,(q+(o*l.fontSize*l.lineHeight))-k,m,1)}}if(this.textDecoration.indexOf("underline")>-1){h(this.fontSize)}if(this.textDecoration.indexOf("line-through")>-1){h(this.fontSize/2)}if(this.textDecoration.indexOf("overline")>-1){h(0)}},_getFontDeclaration:function(){return[(c.isLikelyNode?this.fontWeight:this.fontStyle),(c.isLikelyNode?this.fontStyle:this.fontWeight),this.fontSize+"px",(c.isLikelyNode?('"'+this.fontFamily+'"'):this.fontFamily)].join(" ")},render:function(h,i){if(!this.visible){return}h.save();this._render(h);if(!i&&this.active){this.drawBorders(h);this.drawControls(h)}h.restore()},toObject:function(h){return g(this.callSuper("toObject",h),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textShadow:this.textShadow,textAlign:this.textAlign,path:this.path,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative})},toSVG:function(){var k=this.text.split(/\r?\n/),l=this.useNative?this.fontSize*this.lineHeight:(-this._fontAscent-((this._fontAscent/5)*this.lineHeight)),i=-(this.width/2),h=this.useNative?this.fontSize-1:(this.height/2)-(k.length*this.fontSize)-this._totalLineHeight,j=this._getSVGTextAndBg(l,i,k),m=this._getSVGShadows(l,k);h+=(this._fontAscent?((this._fontAscent/5)*this.lineHeight):0);return['<g transform="',this.getSvgTransform(),'">',j.textBgRects.join(""),"<text ",(this.fontFamily?"font-family=\"'"+this.fontFamily+"'\" ":""),(this.fontSize?'font-size="'+this.fontSize+'" ':""),(this.fontStyle?'font-style="'+this.fontStyle+'" ':""),(this.fontWeight?'font-weight="'+this.fontWeight+'" ':""),(this.textDecoration?'text-decoration="'+this.textDecoration+'" ':""),'style="',this.getSvgStyles(),'" ','transform="translate(',a(i,2)," ",a(h,2),')">',m.join(""),j.textSpans.join(""),"</text>","</g>"].join("")},_getSVGShadows:function(l,p){var q=[],m,n,r,k,h=1;if(!this._shadows||!this._boundaries){return q}for(m=0,r=this._shadows.length;m<r;m++){for(n=0,k=p.length;n<k;n++){if(p[n]!==""){var o=(this._boundaries&&this._boundaries[n])?this._boundaries[n].left:0;q.push('<tspan x="',a((o+h)+this._shadowOffsets[m][0],2),((n===0||this.useNative)?'" y':'" dy'),'="',a(this.useNative?((l*n)-this.height/2+this._shadowOffsets[m][1]):(l+(n===0?this._shadowOffsets[m][1]:0)),2),'" ',this._getFillAttributes(this._shadows[m].color),">",c.util.string.escapeXml(p[n]),"</tspan>");h=1}else{h++}}}return q},_getSVGTextAndBg:function(l,k,p){var j=[],m=[],n,o,q,h=1;if(this.backgroundColor&&this._boundaries){m.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,2),'" y="',a(-this.height/2,2),'" width="',a(this.width,2),'" height="',a(this.height,2),'"></rect>')}for(n=0,q=p.length;n<q;n++){if(p[n]!==""){o=(this._boundaries&&this._boundaries[n])?a(this._boundaries[n].left,2):0;j.push('<tspan x="',o,'" ',(n===0||this.useNative?"y":"dy"),'="',a(this.useNative?((l*n)-this.height/2):(l*h),2),'" ',this._getFillAttributes(this.fill),">",c.util.string.escapeXml(p[n]),"</tspan>");h=1}else{h++}if(!this.textBackgroundColor||!this._boundaries){continue}m.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',a(k+this._boundaries[n].left,2),'" y="',a((l*n)-this.height/2,2),'" width="',a(this._boundaries[n].width,2),'" height="',a(this._boundaries[n].height,2),'"></rect>')}return{textSpans:j,textBgRects:m}},_getFillAttributes:function(h){var i=(h&&typeof h==="string")?new c.Color(h):"";if(!i||!i.getSource()||i.getAlpha()===1){return'fill="'+h+'"'}return'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"'},setColor:function(h){this.set("fill",h);return this},getText:function(){return this.text},_set:function(h,i){if(h==="fontFamily"&&this.path){this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+i+"$3")}this.callSuper("_set",h,i);if(h in this._dimensionAffectingProps){this._initDimensions();this.setCoords()}},complexity:function(){return 1}});c.Text.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y font-family font-style font-weight font-size text-decoration".split(" "));c.Text.fromElement=function(i,h){if(!i){return null}var j=c.parseAttributes(i,c.Text.ATTRIBUTE_NAMES);h=c.util.object.extend((h?c.util.object.clone(h):{}),j);var k=new c.Text(i.textContent,h);k.set({left:k.getLeft()+k.getWidth()/2,top:k.getTop()-k.getHeight()/2});return k};c.Text.fromObject=function(h){return new c.Text(h.text,f(h))};c.util.createAccessors(c.Text)})(typeof exports!=="undefined"?exports:this);fabric.util.object.extend(fabric.Text.prototype,{_renderViaCufon:function(a){var c=Cufon.textOptions||(Cufon.textOptions={});c.left=this.left;c.top=this.top;c.context=a;c.color=this.fill;var b=this._initDummyElementForCufon();this.transform(a);Cufon.replaceElement(b,{engine:"canvas",separate:"none",fontFamily:this.fontFamily,fontWeight:this.fontWeight,textDecoration:this.textDecoration,textShadow:this.textShadow,textAlign:this.textAlign,fontStyle:this.fontStyle,lineHeight:this.lineHeight,stroke:this.stroke,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor});this.width=c.width;this.height=c.height;this._totalLineHeight=c.totalLineHeight;this._fontAscent=c.fontAscent;this._boundaries=c.boundaries;this._shadowOffsets=c.shadowOffsets;this._shadows=c.shadows||[];b=null;this.setCoords()},_initDummyElementForCufon:function(){var b=fabric.document.createElement("pre"),a=fabric.document.createElement("div");a.appendChild(b);if(typeof G_vmlCanvasManager==="undefined"){b.innerHTML=this.text}else{b.innerText=this.text.replace(/\r?\n/gi,"\r")}b.style.fontSize=this.fontSize+"px";b.style.letterSpacing="normal";return b}});(function(){if(typeof document!=="undefined"&&typeof window!=="undefined"){return}var DOMParser=new require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;function request(url,encoding,callback){var oURL=URL.parse(url);if(!oURL.port){oURL.port=(oURL.protocol.indexOf("https:")===0)?443:80}var reqHandler=(oURL.port===443)?HTTPS:HTTP;var req=reqHandler.request({hostname:oURL.hostname,port:oURL.port,path:oURL.path,method:"GET"},function(response){var body="";if(encoding){response.setEncoding(encoding)}response.on("end",function(){callback(body)});response.on("data",function(chunk){if(response.statusCode===200){body+=chunk}})});req.on("error",function(err){if(err.errno===process.ECONNREFUSED){fabric.log("ECONNREFUSED: connection refused to "+oURL.hostname+":"+oURL.port)}else{fabric.log(err.message)}});req.end()}function request_fs(url,callback){var fs=require("fs"),stream=fs.createReadStream(url),body="";stream.on("data",function(chunk){body+=chunk});stream.on("end",function(){callback(body)})}fabric.util.loadImage=function(url,callback,context){var createImageAndCallBack=function(data){img.src=new Buffer(data,"binary");img._src=url;callback&&callback.call(context,img)};var img=new Image();if(url&&(url instanceof Buffer||url.indexOf("data")===0)){img.src=img._src=url;callback&&callback.call(context,img)}else{if(url&&url.indexOf("http")!==0){request_fs(url,createImageAndCallBack)}else{if(url){request(url,"binary",createImageAndCallBack)}}}};fabric.loadSVGFromURL=function(url,callback,reviver){url=url.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();if(url.indexOf("http")!==0){request_fs(url,function(body){fabric.loadSVGFromString(body,callback,reviver)})}else{request(url,"",function(body){fabric.loadSVGFromString(body,callback,reviver)})}};fabric.loadSVGFromString=function(string,callback,reviver){var doc=new DOMParser().parseFromString(string);fabric.parseSVGDocument(doc.documentElement,function(results,options){callback&&callback(results,options)},reviver)};fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body);callback&&callback()})};fabric.Image.fromObject=function(object,callback){fabric.util.loadImage(object.src,function(img){var oImg=new fabric.Image(img);oImg._initConfig(object);oImg._initFilters(object,function(filters){oImg.filters=filters||[];callback&&callback(oImg)})})};fabric.createCanvasForNode=function(width,height){var canvasEl=fabric.document.createElement("canvas"),nodeCanvas=new Canvas(width||600,height||600);canvasEl.style={};canvasEl.width=nodeCanvas.width;canvasEl.height=nodeCanvas.height;var FabricCanvas=fabric.Canvas||fabric.StaticCanvas;var fabricCanvas=new FabricCanvas(canvasEl);fabricCanvas.contextContainer=nodeCanvas.getContext("2d");fabricCanvas.nodeCanvas=nodeCanvas;fabricCanvas.Font=Canvas.Font;return fabricCanvas};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(opts){return this.nodeCanvas.createJPEGStream(opts)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(width){origSetWidth.call(this,width);this.nodeCanvas.width=width;return this};if(fabric.Canvas){fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth}var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(height){origSetHeight.call(this,height);this.nodeCanvas.height=height;return this};if(fabric.Canvas){fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight}})();