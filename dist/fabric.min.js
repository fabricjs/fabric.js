var fabric=fabric||{version:"1.4.4"};"undefined"!==typeof exports&&(exports.fabric=fabric);"undefined"!==typeof document&&"undefined"!==typeof window?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow());fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;fabric.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof window;
fabric.SHARED_ATTRIBUTES="transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width".split(" ");
var Cufon=function(){function e(b){var f=this.face=b.face;this.glyphs=b.glyphs;this.w=b.w;this.baseSize=parseInt(f["units-per-em"],10);this.family=f["font-family"].toLowerCase();this.weight=f["font-weight"];this.style=f["font-style"]||"normal";this.viewBox=function(){var b=f.bbox.split(/\s+/),b={minX:parseInt(b[0],10),minY:parseInt(b[1],10),maxX:parseInt(b[2],10),maxY:parseInt(b[3],10)};b.width=b.maxX-b.minX;b.height=b.maxY-b.minY;b.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")};
return b}();this.ascent=-parseInt(f.ascent,10);this.descent=-parseInt(f.descent,10);this.height=-this.ascent+this.descent}function c(){var b={},f={oblique:"italic",italic:"oblique"};this.add=function(f){(b[f.style]||(b[f.style]={}))[f.weight]=f};this.get=function(a,d){var c=b[a]||b[f[a]]||b.normal||b.italic||b.oblique;if(!c)return null;d={normal:400,bold:700}[d]||parseInt(d,10);if(c[d])return c[d];var g={1:1,99:0}[d%100],h=[],e,l;void 0===g&&(g=400<d);500==d&&(d=400);for(var k in c){k=parseInt(k,
10);if(!e||k<e)e=k;if(!l||k>l)l=k;h.push(k)}d<e&&(d=e);d>l&&(d=l);h.sort(function(b,f){return(g?b>d&&f>d?b<f:b>f:b<d&&f<d?b>f:b<f)?-1:1});return c[h[0]]}}function a(b){var f={},a={};this.get=function(a){return void 0!=f[a]?f[a]:b[a]};this.getSize=function(b,f){return a[b]||(a[b]=new n.Size(this.get(b),f))};this.extend=function(b){for(var a in b)f[a]=b[a];return this}}function d(b,f,a){b.addEventListener?b.addEventListener(f,a,!1):b.attachEvent&&b.attachEvent("on"+f,function(){return a.call(b,fabric.window.event)})}
function b(b){var f={};return function(a){f.hasOwnProperty(a)||(f[a]=b.apply(null,arguments));return f[a]}}function g(b){return fabric.document.getElementsByTagName(b)}function f(){for(var b={},f,a=0,d=arguments.length;a<d;++a)for(f in arguments[a])b[f]=arguments[a][f];return b}function h(b,f,a,d,c,g){var h=d.separate;if("none"==h)return t[d.engine].apply(null,arguments);var e=fabric.document.createDocumentFragment(),l=f.split(v[h]),k="words"==h;k&&p&&(/^\s/.test(f)&&l.unshift(""),/\s$/.test(f)&&
l.push(""));for(var m=0,q=l.length;m<q;++m)(h=t[d.engine](b,k?n.textAlign(l[m],a,m,q):l[m],a,d,c,g,m<q-1))&&e.appendChild(h);return e}function l(b,f){var a,d,c,g;c=q.get(b);c.options||(f.hover&&f.hoverables[b.nodeName.toLowerCase()]&&s.attach(b),c.options=f);for(var e=b.firstChild;e;e=c){c=e.nextSibling;g=!1;if(1==e.nodeType){if(!e.firstChild)continue;if(/cufon/.test(e.className))g=!0;else{arguments.callee(e,f);continue}}d||(d=n.getStyle(b).extend(f));if(!a)a:{(a=d)||(a=n.getStyle(b));for(var l=n.quotedList(a.get("fontFamily").toLowerCase()),
k=void 0,m=0,p=l.length;m<p;++m)if(k=l[m],w[k]){a=w[k].get(a.get("fontStyle"),a.get("fontWeight"));break a}a=null}if(a)if(g)t[f.engine](a,null,d,f,e,b);else g=e.data,"undefined"!=typeof G_vmlCanvasManager&&(g=g.replace(/\r/g,"\n")),""!==g&&((g=h(a,g,d,f,e,b))?e.parentNode.replaceChild(g,e):e.parentNode.removeChild(e))}}var k=function(){return k.replace.apply(null,arguments)},m=k.DOM={ready:function(){var b=!1,f={loaded:1,complete:1},a=[],c=function(){if(!b){b=!0;for(var f;f=a.shift();f());}};fabric.document.addEventListener&&
(fabric.document.addEventListener("DOMContentLoaded",c,!1),fabric.window.addEventListener("pageshow",c,!1));!fabric.window.opera&&fabric.document.readyState&&function(){f[fabric.document.readyState]?c():setTimeout(arguments.callee,10)}();fabric.document.readyState&&fabric.document.createStyleSheet&&function(){try{fabric.document.body.doScroll("left"),c()}catch(b){setTimeout(arguments.callee,1)}}();d(fabric.window,"load",c);return function(f){arguments.length?b?f():a.push(f):c()}}()},n=k.CSS={Size:function(b,
f){this.value=parseFloat(b);this.unit=String(b).match(/[a-z%]*$/)[0]||"px";this.convert=function(b){return b/f*this.value};this.convertFrom=function(b){return b/this.value*f};this.toString=function(){return this.value+this.unit}},getStyle:function(b){return new a(b.style)},quotedList:b(function(b){for(var f=[],a=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g,d;d=a.exec(b);)f.push(d[3]||d[1]);return f}),ready:function(){var b=!1,f=[],a=Object.prototype.propertyIsEnumerable?g("style"):{length:0},d=g("link");
m.ready(function(){for(var c=0,g,h=0,e=d.length;g=d[h],h<e;++h)g.disabled||"stylesheet"!=g.rel.toLowerCase()||++c;if(fabric.document.styleSheets.length>=a.length+c)for(b=!0;c=f.shift();c());else setTimeout(arguments.callee,10)});return function(a){b?a():f.push(a)}}(),supports:function(b,f){var a=fabric.document.createElement("span").style;if(void 0===a[b])return!1;a[b]=f;return a[b]===f},textAlign:function(b,f,a,d){"right"==f.get("textAlign")?0<a&&(b=" "+b):a<d-1&&(b+=" ");return b},textDecoration:function(b,
f){f||(f=this.getStyle(b));for(var a={underline:null,overline:null,"line-through":null},d=b;d.parentNode&&1==d.parentNode.nodeType;){var c=!0,g;for(g in a)a[g]||(-1!=f.get("textDecoration").indexOf(g)&&(a[g]=f.get("color")),c=!1);if(c)break;f=this.getStyle(d=d.parentNode)}return a},textShadow:b(function(b){if("none"==b)return null;for(var f=[],a={},d,c=0,g=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/ig;d=g.exec(b);)","==d[0]?(f.push(a),a={},c=0):d[1]?a.color=d[1]:a[["offX","offY","blur"][c++]]=
d[2];f.push(a);return f}),color:b(function(b){var f={};f.color=b.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(b,a,d){f.opacity=parseFloat(d);return"rgb("+a+")"});return f}),textTransform:function(b,f){return b[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[f.get("textTransform")]||"toString"]()}},p=0==" ".split(/\s+/).length,q=new function(){var b={},f=0;this.get=function(a){a=a.cufid||(a.cufid=++f);return b[a]||(b[a]={})}},s=new function(){function b(f){f=f.relatedTarget;var d;(d=!f)||(d=this.contains?
this.contains(f):this.compareDocumentPosition(f)&16);d||a(this)}function f(b){a(this)}function a(b){setTimeout(function(){k.replace(b,q.get(b).options,!0)},10)}this.attach=function(a){void 0===a.onmouseenter?(d(a,"mouseover",b),d(a,"mouseout",b)):(d(a,"mouseenter",f),d(a,"mouseleave",f))}},x=[],t={},w={},A={engine:null,hover:!1,hoverables:{a:!0},printable:!0,selector:fabric.window.Sizzle||fabric.window.jQuery&&function(b){return jQuery(b)}||fabric.window.dojo&&dojo.query||fabric.window.$$&&function(b){return $$(b)}||
fabric.window.$&&function(b){return $(b)}||fabric.document.querySelectorAll&&function(b){return fabric.document.querySelectorAll(b)}||g,separate:"words",textShadow:"none"},v={words:/\s+/,characters:""};k.now=function(){m.ready();return k};k.refresh=function(){for(var b=x.splice(0,x.length),f=0,a=b.length;f<a;++f)k.replace.apply(null,b[f]);return k};k.registerEngine=function(b,f){if(!f)return k;t[b]=f;return k.set("engine",b)};k.registerFont=function(b){b=new e(b);var f=b.family;w[f]||(w[f]=new c);
w[f].add(b);return k.set("fontFamily",'"'+f+'"')};k.replace=function(b,a,d){a=f(A,a);if(!a.engine)return k;"string"==typeof a.textShadow&&a.textShadow&&(a.textShadow=n.textShadow(a.textShadow));d||x.push(arguments);if(b.nodeType||"string"==typeof b)b=[b];n.ready(function(){for(var f=0,d=b.length;f<d;++f){var c=b[f];"string"==typeof c?k.replace(a.selector(c),a,!0):l(c,a)}});return k};k.replaceElement=function(b,a){a=f(A,a);"string"==typeof a.textShadow&&a.textShadow&&(a.textShadow=n.textShadow(a.textShadow));
return l(b,a)};k.engines=t;k.fonts=w;k.getOptions=function(){return f(A)};k.set=function(b,f){A[b]=f;return k};return k}();
Cufon.registerEngine("canvas",function(){var e=Cufon.CSS.supports("display","inline-block"),c=!e&&("BackCompat"==fabric.document.compatMode||/frameset|transitional/i.test(fabric.document.doctype.publicId)),a=fabric.document.createElement("style");a.type="text/css";c=fabric.document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(c?"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+
(e?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}");try{a.appendChild(c)}catch(d){a.setAttribute("type","text/css"),a.styleSheet.cssText=c.data}fabric.document.getElementsByTagName("head")[0].appendChild(a);return function(b,a,f,d,c,k){function m(a){y.fillStyle=a||Cufon.textOptions.color||f.get("color");var c=a=0;"right"===d.textAlign?
y.translate(F[c],0):"center"===d.textAlign&&y.translate(F[c]/2,0);for(var g=0,e=C.length;g<e;++g)if("\n"===C[g]){c++;var l=-b.ascent-b.ascent/5*d.lineHeight;"right"===d.textAlign?(y.translate(-B,l),y.translate(F[c],0)):"center"===d.textAlign?(y.translate(-a-F[c-1]/2,l),y.translate(F[c]/2,0)):y.translate(-a,l);a=0}else{var k=b.glyphs[C[g]]||b.missingGlyph;if(k){l=Number(k.w||b.w)+s;I&&(y.save(),y.strokeStyle=y.fillStyle,y.lineWidth+=y.lineWidth,y.beginPath(),I.underline&&(y.moveTo(0,-b.face["underline-position"]+
0.5),y.lineTo(l,-b.face["underline-position"]+0.5)),I.overline&&(y.moveTo(0,b.ascent+0.5),y.lineTo(l,b.ascent+0.5)),I["line-through"]&&(y.moveTo(0,-b.descent+0.5),y.lineTo(l,-b.descent+0.5)),y.stroke(),y.restore());J&&(y.save(),y.transform(1,0,-0.25,1,0,0));y.beginPath();if(k.d)if(k.code)for(var m=k.code,k=y,n=0,q=m.length;n<q;++n){var p=m[n];k[p.m].apply(k,p.a)}else{var m=k,k="m"+k.d,n=y,p=q=0,x=[],A=/([mrvxe])([^a-z]*)/g,v=void 0,t=0;a:for(;v=A.exec(k);++t){var u=v[2].split(",");switch(v[1]){case "v":x[t]=
{m:"bezierCurveTo",a:[q+~~u[0],p+~~u[1],q+~~u[2],p+~~u[3],q+=~~u[4],p+=~~u[5]]};break;case "r":x[t]={m:"lineTo",a:[q+=~~u[0],p+=~~u[1]]};break;case "m":x[t]={m:"moveTo",a:[q=~~u[0],p=~~u[1]]};break;case "x":x[t]={m:"closePath",a:[]};break;case "e":break a}n[x[t].m].apply(n,x[t].a)}m.code=x}y.fill();d.strokeStyle&&(y.closePath(),y.save(),y.lineWidth=d.strokeWidth,y.strokeStyle=d.strokeStyle,y.stroke(),y.restore());J&&y.restore();y.translate(l,0);a+=l}}}var n=null===a,p=b.viewBox,q=f.getSize("fontSize",
b.baseSize),s=f.get("letterSpacing"),s="normal"==s?0:q.convertFrom(parseInt(s,10)),x=k=0,t=0,w=d.textShadow,A=[];Cufon.textOptions.shadowOffsets=[];Cufon.textOptions.shadows=null;if(w){Cufon.textOptions.shadows=w;for(var v=0,u=w.length;v<u;++v){var r=w[v],z=q.convertFrom(parseFloat(r.offX)),r=q.convertFrom(parseFloat(r.offY));A[v]=[z,r]}}for(var C=Cufon.CSS.textTransform(n?c.alt:a,f).split(""),B=0,r=null,z=0,D=1,H=[],v=0,u=C.length;v<u;++v)if("\n"===C[v])D++,B>z&&(z=B),H.push(B),B=0;else{var G=b.glyphs[C[v]]||
b.missingGlyph;G&&(B+=r=Number(G.w||b.w)+s)}H.push(B);for(var B=Math.max(z,B),F=[],v=H.length;v--;)F[v]=B-H[v];if(null===r)return null;x+=p.width-r;t+=p.minX;n?(n=c,c=c.firstChild):(n=fabric.document.createElement("span"),n.className="cufon cufon-canvas",n.alt=a,c=fabric.document.createElement("canvas"),n.appendChild(c),d.printable&&(v=fabric.document.createElement("span"),v.className="cufon-alt",v.appendChild(fabric.document.createTextNode(a)),n.appendChild(v)));a=n.style;u=c.style||{};r=q.convert(p.height-
k+0);v=Math.ceil(r);r=v/r;c.width=Math.ceil(q.convert(B+x-t)*r);c.height=v;k+=p.minY;u.top=Math.round(q.convert(k-b.ascent))+"px";u.left=Math.round(q.convert(t))+"px";x=Math.ceil(q.convert(B*r));u=x+"px";r=q.convert(b.height);q=(d.lineHeight-1)*q.convert(-b.ascent/5)*(D-1);Cufon.textOptions.width=x;Cufon.textOptions.height=r*D+q;Cufon.textOptions.lines=D;Cufon.textOptions.totalLineHeight=q;e?(a.width=u,a.height=r+"px"):(a.paddingLeft=u,a.paddingBottom=r-1+"px");var y=Cufon.textOptions.context||c.getContext("2d"),
E=v/p.height;Cufon.textOptions.fontAscent=b.ascent*E;Cufon.textOptions.boundaries=null;p=Cufon.textOptions.shadowOffsets;for(v=A.length;v--;)p[v]=[A[v][0]*E,A[v][1]*E];y.save();y.scale(E,E);y.translate(-t-1/E*c.width/2+(Cufon.fonts[b.family].offsetLeft||0),-k-Cufon.textOptions.height/E/2+(Cufon.fonts[b.family].offsetTop||0));y.lineWidth=b.face["underline-thickness"];y.save();var I=Cufon.getTextDecoration(d),J="italic"===d.fontStyle;y.save();(function(){y.save();var f=0,a=0,c=[{left:0}];d.backgroundColor&&
(y.save(),y.fillStyle=d.backgroundColor,y.translate(0,b.ascent),y.fillRect(0,0,B+10,(-b.ascent+b.descent)*D),y.restore());"right"===d.textAlign?(y.translate(F[a],0),c[0].left=F[a]*E):"center"===d.textAlign&&(y.translate(F[a]/2,0),c[0].left=F[a]/2*E);for(var g=0,e=C.length;g<e;++g)if("\n"===C[g]){a++;var l=-b.ascent-b.ascent/5*d.lineHeight,k=c[c.length-1],m={left:0};k.width=f*E;k.height=(-b.ascent+b.descent)*E;"right"===d.textAlign?(y.translate(-B,l),y.translate(F[a],0),m.left=F[a]*E):"center"===d.textAlign?
(y.translate(-f-F[a-1]/2,l),y.translate(F[a]/2,0),m.left=F[a]/2*E):y.translate(-f,l);c.push(m);f=0}else if(l=b.glyphs[C[g]]||b.missingGlyph)l=Number(l.w||b.w)+s,d.textBackgroundColor&&(y.save(),y.fillStyle=d.textBackgroundColor,y.translate(0,b.ascent),y.fillRect(0,0,l+10,-b.ascent+b.descent),y.restore()),y.translate(l,0),f+=l,g==e-1&&(c[c.length-1].width=f*E,c[c.length-1].height=(-b.ascent+b.descent)*E);y.restore();Cufon.textOptions.boundaries=c})();if(w)for(v=0,u=w.length;v<u;++v)r=w[v],y.save(),
y.translate.apply(y,A[v]),m(r.color),y.restore();m();y.restore();y.restore();y.restore();return n}}());
Cufon.registerEngine("vml",function(){function e(a,d){if(/px$/i.test(d))return parseFloat(d);var b=a.style.left,c=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;a.style.left=d;var f=a.style.pixelLeft;a.style.left=b;a.runtimeStyle.left=c;return f}if(fabric.document.namespaces){var c=fabric.document.createElement("canvas");if(!(c&&c.getContext&&c.getContext.apply)&&(null==fabric.document.namespaces.cvml&&fabric.document.namespaces.add("cvml","urn:schemas-microsoft-com:vml"),c=fabric.document.createElement("cvml:shape"),
c.style.behavior="url(#default#VML)",c.coordsize))return c=null,fabric.document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}</style>'),
function(a,d,b,c,f,h,l){var k=null===d;k&&(d=f.alt);var m=a.viewBox,n;if(!(n=b.computedFontSize)){n=Cufon.CSS.Size;var p;p=b.get("fontSize");p=e(h,/(?:em|ex|%)$/i.test(p)?"1em":p);n=b.computedFontSize=new n(p+"px",a.baseSize)}p=b.computedLSpacing;void 0==p&&(p=b.get("letterSpacing"),b.computedLSpacing=p="normal"==p?0:~~n.convertFrom(e(h,p)));if(k)h=f,f=f.firstChild;else{h=fabric.document.createElement("span");h.className="cufon cufon-vml";h.alt=d;f=fabric.document.createElement("span");f.className=
"cufon-vml-canvas";h.appendChild(f);if(c.printable){var q=fabric.document.createElement("span");q.className="cufon-alt";q.appendChild(fabric.document.createTextNode(d));h.appendChild(q)}l||h.appendChild(fabric.document.createElement("cvml:shape"))}l=h.style;var s=f.style,x=n.convert(m.height),q=Math.ceil(x),x=q/x,t=m.minX,w=m.minY;s.height=q;s.top=Math.round(n.convert(w-a.ascent));s.left=Math.round(n.convert(t));l.height=n.convert(a.height)+"px";Cufon.getTextDecoration(c);s=b.get("color");d=Cufon.CSS.textTransform(d,
b).split("");var A=b=0,v=null,u;c=c.textShadow;for(var r=0,z=0,C=d.length;r<C;++r)(u=a.glyphs[d[r]]||a.missingGlyph)&&(b+=v=~~(u.w||a.w)+p);if(null===v)return null;u=-t+b+(m.width-v);for(var r=n.convert(u*x),v=Math.round(r),B=u+","+m.height,D,H="r"+B+"nsnf",r=0;r<C;++r)if(u=a.glyphs[d[r]]||a.missingGlyph){k?(m=f.childNodes[z],m.firstChild&&m.removeChild(m.firstChild)):(m=fabric.document.createElement("cvml:shape"),f.appendChild(m));m.stroked="f";m.coordsize=B;m.coordorigin=D=t-A+","+w;m.path=(u.d?
"m"+u.d+"xe":"")+"m"+D+H;m.fillcolor=s;D=m.style;D.width=v;D.height=q;if(c){D=c[0];var G=c[1],F=Cufon.CSS.color(D.color),y,E=fabric.document.createElement("cvml:shadow");E.on="t";E.color=F.color;E.offset=D.offX+","+D.offY;G&&(y=Cufon.CSS.color(G.color),E.type="double",E.color2=y.color,E.offset2=G.offX+","+G.offY);E.opacity=F.opacity||y&&y.opacity||1;m.appendChild(E)}A+=~~(u.w||a.w)+p;++z}l.width=Math.max(Math.ceil(n.convert(b*x)),0);return h}}}());
Cufon.getTextDecoration=function(e){return{underline:"underline"===e.textDecoration,overline:"overline"===e.textDecoration,"line-through":"line-through"===e.textDecoration}};"undefined"!=typeof exports&&(exports.Cufon=Cufon);"object"!==typeof JSON&&(JSON={});
(function(){function e(b){return 10>b?"0"+b:b}function c(f){b.lastIndex=0;return b.test(f)?'"'+f.replace(b,function(b){var f=h[b];return"string"===typeof f?f:"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+f+'"'}function a(b,d){var h,e,q,s,x=g,t,w=d[b];w&&"object"===typeof w&&"function"===typeof w.toJSON&&(w=w.toJSON(b));"function"===typeof l&&(w=l.call(d,b,w));switch(typeof w){case "string":return c(w);case "number":return isFinite(w)?String(w):"null";case "boolean":case "null":return String(w);
case "object":if(!w)return"null";g+=f;t=[];if("[object Array]"===Object.prototype.toString.apply(w)){s=w.length;for(h=0;h<s;h+=1)t[h]=a(h,w)||"null";q=0===t.length?"[]":g?"[\n"+g+t.join(",\n"+g)+"\n"+x+"]":"["+t.join(",")+"]";g=x;return q}if(l&&"object"===typeof l)for(s=l.length,h=0;h<s;h+=1)"string"===typeof l[h]&&(e=l[h],(q=a(e,w))&&t.push(c(e)+(g?": ":":")+q));else for(e in w)Object.prototype.hasOwnProperty.call(w,e)&&(q=a(e,w))&&t.push(c(e)+(g?": ":":")+q);q=0===t.length?"{}":g?"{\n"+g+t.join(",\n"+
g)+"\n"+x+"}":"{"+t.join(",")+"}";g=x;return q}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var d,b,g,f,h,l;"function"!==typeof JSON.stringify&&(b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(b,d,c){var h;f=g="";if("number"===typeof c)for(h=0;h<c;h+=1)f+=" ";else"string"===typeof c&&(f=c);if((l=d)&&"function"!==typeof d&&("object"!==typeof d||"number"!==typeof d.length))throw Error("JSON.stringify");return a("",{"":b})});"function"!==typeof JSON.parse&&(d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(b,
f){function a(b,d){var c,g,h=b[d];if(h&&"object"===typeof h)for(c in h)Object.prototype.hasOwnProperty.call(h,c)&&(g=a(h,c),void 0!==g?h[c]=g:delete h[c]);return f.call(b,d,h)}var c;b=String(b);d.lastIndex=0;d.test(b)&&(b=b.replace(d,function(b){return"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return c=
eval("("+b+")"),"function"===typeof f?a({"":c},""):c;throw new SyntaxError("JSON.parse");})})();if("undefined"===typeof Event)var Event={};if("undefined"===typeof eventjs)var eventjs=Event;
(function(e){e.modifyEventListener=!1;e.modifySelectors=!1;e.add=function(b,f,d,c){return a(b,f,d,c,"add")};e.remove=function(b,f,d,c){return a(b,f,d,c,"remove")};e.stop=function(b){b&&(b.stopPropagation&&b.stopPropagation(),b.cancelBubble=!0,b.bubble=0)};e.prevent=function(b){b&&(b.preventDefault&&b.preventDefault(),b.preventManipulation&&b.preventManipulation(),b.returnValue=!1)};e.cancel=function(b){e.stop(b);e.prevent(b)};e.getEventSupport=function(b,f){"string"===typeof b&&(f=b,b=window);f="on"+
f;if(f in b)return!0;b.setAttribute||(b=document.createElement("div"));if(b.setAttribute&&b.removeAttribute){b.setAttribute(f,"");var a="function"===typeof b[f];"undefined"!==typeof b[f]&&(b[f]=null);b.removeAttribute(f);return a}};var c=function(b){if(!b||"object"!==typeof b)return b;var f=new b.constructor,a;for(a in b)f[a]=b[a]&&"object"===typeof b[a]?c(b[a]):b[a];return f},a=function(f,g,k,t,w,A){t=t||{};if("[object Object]"===String(f)){var v=f;f=v.target;g=v.type;k=v.listener;delete v.target;
delete v.type;delete v.listener;for(var u in v)t[u]=v[u]}if(f&&g&&k)if("string"===typeof f&&"ready"===g)var r=(new Date).getTime(),z=t.timeout,C=window.setInterval(function(){(new Date).getTime()-r>z&&window.clearInterval(C);document.querySelector(f)&&(window.clearInterval(C),setTimeout(k,1))},t.interval||1E3/60);else{if("string"===typeof f){f=document.querySelectorAll(f);if(0===f.length)return b("Missing target on listener!",arguments);1===f.length&&(f=f[0])}var B,v={};if(0<f.length&&f!==window){u=
0;for(var D=f.length;u<D;u++)(B=a(f[u],g,k,c(t),w))&&(v[u]=B);return d(v)}g.indexOf&&-1!==g.indexOf(" ")&&(g=g.split(" "));g.indexOf&&-1!==g.indexOf(",")&&(g=g.split(","));if("string"!==typeof g){if("number"===typeof g.length)for(u=0,D=g.length;u<D;u++)(B=a(f,g[u],k,c(t),w))&&(v[g[u]]=B);else for(u in g)(B="function"===typeof g[u]?a(f,u,g[u],c(t),w):a(f,u,g[u].listener,c(g[u]),w))&&(v[u]=B);return d(v)}if("object"!==typeof f)return b("Target is not defined!",arguments);if("function"!==typeof k)return b("Listener is not a function!",
arguments);v=t.useCapture||!1;u=m(f)+"."+m(k)+"."+(v?1:0);if(e.Gesture&&e.Gesture._gestureHandlers[g]){u=g+u;if("remove"===w){if(!l[u])return;l[u].remove();delete l[u]}else if("add"===w){if(l[u])return l[u].add(),l[u];if(t.useCall&&!e.modifyEventListener){var H=k;k=function(b,a){for(var d in a)b[d]=a[d];return H.call(f,b)}}t.gesture=g;t.target=f;t.listener=k;t.fromOverwrite=A;l[u]=e.proxy[g](t)}return l[u]}for(var G=h(g),D=0;D<G.length;D++)if(g=G[D],B=g+"."+u,"remove"===w)l[B]&&(f[p](g,k,v),delete l[B]);
else if("add"===w){if(l[B])break;f[n](g,k,v);l[B]={id:B,type:g,target:f,listener:k,remove:function(){for(var b=0;b<G.length;b++)e.remove(f,G[b],k,t)}}}return l[B]}},d=function(b){return{remove:function(){for(var f in b)b[f].remove()},add:function(){for(var f in b)b[f].add()}}},b=function(b,f){"undefined"!==typeof console&&"undefined"!==typeof console.error&&console.error(b,f)},g={msPointer:["MSPointerDown","MSPointerMove","MSPointerUp"],touch:["touchstart","touchmove","touchend"],mouse:["mousedown",
"mousemove","mouseup"]},f={MSPointerDown:0,MSPointerMove:1,MSPointerUp:2,touchstart:0,touchmove:1,touchend:2,mousedown:0,mousemove:1,mouseup:2};e.supports={};window.navigator.msPointerEnabled&&(e.supports.msPointer=!0);e.getEventSupport("touchstart")&&(e.supports.touch=!0);e.getEventSupport("mousedown")&&(e.supports.mouse=!0);var h=function(){return function(b){var a=document.addEventListener?"":"on",d=f[b];if(isFinite(d)){b=[];for(var c in e.supports)b.push(a+g[c][d]);return b}return[a+b]}}(),l=
{},k=0,m=function(b){if(b===window)return"#window";if(b===document)return"#document";b.uniqueID||(b.uniqueID="e"+k++);return b.uniqueID},n=document.addEventListener?"addEventListener":"attachEvent",p=document.removeEventListener?"removeEventListener":"detachEvent";e.createPointerEvent=function(b,f,a){var d=f.gesture,c=f.target,g=b.changedTouches||e.proxy.getCoords(b);if(g.length){var h=g[0];f.pointers=a?[]:g;f.pageX=h.pageX;f.pageY=h.pageY;f.x=f.pageX;f.y=f.pageY}a=document.createEvent("Event");a.initEvent(d,
!0,!0);a.originalEvent=b;for(var l in f)"target"!==l&&(a[l]=f[l]);b=a.type;e.Gesture&&e.Gesture._gestureHandlers[b]&&f.oldListener.call(c,a,f,!1)};e.modifyEventListener&&window.HTMLElement&&function(){var b=function(b){var f=function(f){var d=f+"EventListener",c=b[d];b[d]=function(b,d,g){if(e.Gesture&&e.Gesture._gestureHandlers[b]){var l=g;"object"===typeof g?l.useCall=!0:l={useCall:!0,useCapture:g};a(this,b,d,l,f,!0)}else for(b=h(b),l=0;l<b.length;l++)c.call(this,b[l],d,g)}};f("add");f("remove")};
navigator.userAgent.match(/Firefox/)?(b(HTMLDivElement.prototype),b(HTMLCanvasElement.prototype)):b(HTMLElement.prototype);b(document);b(window)}();e.modifySelectors&&function(){var b=NodeList.prototype;b.removeEventListener=function(b,f,a){for(var d=0,c=this.length;d<c;d++)this[d].removeEventListener(b,f,a)};b.addEventListener=function(b,f,a){for(var d=0,c=this.length;d<c;d++)this[d].addEventListener(b,f,a)}}();return e})(Event);"undefined"===typeof Event&&(Event={});
"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.pointerSetup=function(a,d){a.doc=a.target.ownerDocument||a.target;a.minFingers=a.minFingers||a.fingers||1;a.maxFingers=a.maxFingers||a.fingers||Infinity;a.position=a.position||"relative";delete a.fingers;d=d||{};d.enabled=!0;d.gesture=a.gesture;d.target=a.target;d.env=a.env;Event.modifyEventListener&&a.fromOverwrite&&(a.oldListener=a.listener,a.listener=Event.createPointerEvent);var b=0,c=0===d.gesture.indexOf("pointer")&&Event.modifyEventListener?"pointer":"mouse";a.oldListener&&
(d.oldListener=a.oldListener);d.listener=a.listener;d.proxy=function(b){d.defaultListener=a.listener;a.listener=b;b(a.event,d)};d.add=function(){!0!==d.enabled&&(a.onPointerDown&&Event.add(a.target,c+"down",a.onPointerDown),a.onPointerMove&&Event.add(a.doc,c+"move",a.onPointerMove),a.onPointerUp&&Event.add(a.doc,c+"up",a.onPointerUp),d.enabled=!0)};d.remove=function(){!1!==d.enabled&&(a.onPointerDown&&Event.remove(a.target,c+"down",a.onPointerDown),a.onPointerMove&&Event.remove(a.doc,c+"move",a.onPointerMove),
a.onPointerUp&&Event.remove(a.doc,c+"up",a.onPointerUp),d.reset(),d.enabled=!1)};d.pause=function(f){!a.onPointerMove||f&&!f.move||Event.remove(a.doc,c+"move",a.onPointerMove);!a.onPointerUp||f&&!f.up||Event.remove(a.doc,c+"up",a.onPointerUp);b=a.fingers;a.fingers=0};d.resume=function(f){!a.onPointerMove||f&&!f.move||Event.add(a.doc,c+"move",a.onPointerMove);!a.onPointerUp||f&&!f.up||Event.add(a.doc,c+"up",a.onPointerUp);a.fingers=b};d.reset=function(){a.tracker={};a.fingers=0};return d};var c=Event.supports;
Event.pointerType=c.mouse?"mouse":c.touch?"touch":"mspointer";e.pointerStart=function(a,d,b){var c=(a.type||"mousedown").toUpperCase();0===c.indexOf("MOUSE")?Event.pointerType="mouse":0===c.indexOf("TOUCH")?Event.pointerType="touch":0===c.indexOf("MSPOINTER")&&(Event.pointerType="mspointer");var f=function(f,a){var d=b.bbox,c=h[a]={};switch(b.position){case "absolute":c.offsetX=0;c.offsetY=0;break;case "differenceFromLast":c.offsetX=f.pageX;c.offsetY=f.pageY;break;case "difference":c.offsetX=f.pageX;
c.offsetY=f.pageY;break;case "move":c.offsetX=f.pageX-d.x1;c.offsetY=f.pageY-d.y1;break;default:c.offsetX=d.x1,c.offsetY=d.y1}if("relative"===b.position)var g=f.pageX+d.scrollLeft-c.offsetX,d=f.pageY+d.scrollTop-c.offsetY;else g=f.pageX-c.offsetX,d=f.pageY-c.offsetY;c.rotation=0;c.scale=1;c.startTime=c.moveTime=(new Date).getTime();c.move={x:g,y:d};c.start={x:g,y:d};b.fingers++};b.event=a;d.defaultListener&&(b.listener=d.defaultListener,delete d.defaultListener);var c=!b.fingers,h=b.tracker;a=a.changedTouches||
e.getCoords(a);for(var l=a.length,k=0;k<l;k++){var m=a[k],n=m.identifier||Infinity;if(b.fingers){if(b.fingers>=b.maxFingers){var p=[];for(n in b.tracker)p.push(n);d.identifier=p.join(",");return c}var q=0;for(p in h){if(h[p].up){delete h[p];f(m,n);b.cancel=!0;break}q++}h[n]||f(m,n)}else h=b.tracker={},d.bbox=b.bbox=e.getBoundingBox(b.target),b.fingers=0,b.cancel=!1,f(m,n)}p=[];for(n in b.tracker)p.push(n);d.identifier=p.join(",");return c};e.pointerEnd=function(a,d,b,c){var f=a.touches||[],h=f.length;
a={};for(var e=0;e<h;e++){var k=f[e].identifier;a[k||Infinity]=!0}for(k in b.tracker)f=b.tracker[k],a[k]||f.up||(c&&c({pageX:f.pageX,pageY:f.pageY,changedTouches:[{pageX:f.pageX,pageY:f.pageY,identifier:"Infinity"===k?Infinity:k}]},"up"),f.up=!0,b.fingers--);if(0!==b.fingers)return!1;c=[];b.gestureFingers=0;for(k in b.tracker)b.gestureFingers++,c.push(k);d.identifier=c.join(",");return!0};e.getCoords=function(a){e.getCoords="undefined"!==typeof a.pageX?function(a){return Array({type:"mouse",x:a.pageX,
y:a.pageY,pageX:a.pageX,pageY:a.pageY,identifier:a.pointerId||Infinity})}:function(a){a=a||window.event;return Array({type:"mouse",x:a.clientX+document.documentElement.scrollLeft,y:a.clientY+document.documentElement.scrollTop,pageX:a.clientX+document.documentElement.scrollLeft,pageY:a.clientY+document.documentElement.scrollTop,identifier:Infinity})};return e.getCoords(a)};e.getCoord=function(a){if("ontouchstart"in window){var d=0,b=0;e.getCoord=function(a){return(a=a.changedTouches)&&a.length?{x:d=
a[0].pageX,y:b=a[0].pageY}:{x:d,y:b}}}else e.getCoord="undefined"!==typeof a.pageX&&"undefined"!==typeof a.pageY?function(b){return{x:b.pageX,y:b.pageY}}:function(b){b=b||window.event;return{x:b.clientX+document.documentElement.scrollLeft,y:b.clientY+document.documentElement.scrollTop}};return e.getCoord(a)};e.getBoundingBox=function(a){if(a===window||a===document)a=document.body;var d={},b=a.getBoundingClientRect();d.width=b.width;d.height=b.height;d.x1=b.left;d.y1=b.top;d.x2=d.x1+d.width;d.y2=d.y1+
d.height;d.scaleX=b.width/a.offsetWidth||1;d.scaleY=b.height/a.offsetHeight||1;d.scrollLeft=0;d.scrollTop=0;for(a=a.parentNode;null!==a&&a!==document.body&&void 0!==a.scrollTop;){b=window.getComputedStyle(a).getPropertyValue("position");if("absolute"===b)break;else if("fixed"===b){d.scrollTop-=a.parentNode.scrollTop;break}else d.scrollLeft+=a.scrollLeft,d.scrollTop+=a.scrollTop;a=a.parentNode}return d};(function(){var a=navigator.userAgent.toLowerCase(),d=-1!==a.indexOf("macintosh"),b=d&&-1!==a.indexOf("khtml")?
{91:!0,93:!0}:d&&-1!==a.indexOf("firefox")?{224:!0}:{17:!0};e.metaTrackerReset=function(){e.metaKey=!1;e.ctrlKey=!1;e.shiftKey=!1;e.altKey=!1};e.metaTracker=function(a){var f=!!b[a.keyCode];f&&(e.metaKey="keydown"===a.type);e.ctrlKey=a.ctrlKey;e.shiftKey=a.shiftKey;e.altKey=a.altKey;return f}})();return e}(Event.proxy);"undefined"===typeof Event&&(Event={});
Event.MutationObserver=function(){var e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,c=function(){var a=document.createElement("p"),d=!1,b=function(){d=!0};if(a.addEventListener)a.addEventListener("DOMAttrModified",b,!1);else if(a.attachEvent)a.attachEvent("onDOMAttrModified",b);else return!1;a.setAttribute("id","target");return d}();return function(a,d){e?(new e(function(b){b.forEach(function(b){d.call(b.target,b.attributeName)})})).observe(a,{subtree:!1,attributes:!0}):
c?Event.add(a,"DOMAttrModified",function(b){d.call(a,b.attrName)}):"onpropertychange"in document.body&&Event.add(a,"propertychange",function(b){d.call(a,window.event.propertyName)})}}();"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.click=function(c){c.gesture=c.gesture||"click";c.maxFingers=c.maxFingers||c.fingers||1;var a;c.onPointerDown=function(b){e.pointerStart(b,d,c)&&(Event.add(c.doc,"mousemove",c.onPointerMove).listener(b),Event.add(c.doc,"mouseup",c.onPointerUp))};c.onPointerMove=function(b){a=b};c.onPointerUp=function(b){if(e.pointerEnd(b,d,c)&&(Event.remove(c.doc,"mousemove",c.onPointerMove),Event.remove(c.doc,"mouseup",c.onPointerUp),!(a.cancelBubble&&1<++a.bubble))){var g=(a.changedTouches||
e.getCoords(a))[0];b=c.bbox;var f=e.getBoundingBox(c.target);if("relative"===c.position)var h=g.pageX+b.scrollLeft-b.x1,g=g.pageY+b.scrollTop-b.y1;else h=g.pageX-b.x1,g=g.pageY-b.y1;if(0<h&&h<b.width&&0<g&&g<b.height&&b.scrollTop===f.scrollTop){for(var l in c.tracker)break;l=c.tracker[l];d.x=l.start.x;d.y=l.start.y;c.listener(a,d)}}};var d=e.pointerSetup(c);d.state="click";Event.add(c.target,"mousedown",c.onPointerDown);return d};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||
{};Event.Gesture._gestureHandlers.click=e.click;return e}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.dbltap=e.dblclick=function(c){c.gesture=c.gesture||"dbltap";c.maxFingers=c.maxFingers||c.fingers||1;var a,d,b,g,f;c.onPointerDown=function(l){var k=l.changedTouches||e.getCoords(l);a&&!d?(f=k[0],d=(new Date).getTime()-a):(g=k[0],a=(new Date).getTime(),d=0,clearTimeout(b),b=setTimeout(function(){a=0},700));e.pointerStart(l,h,c)&&(Event.add(c.doc,"mousemove",c.onPointerMove).listener(l),Event.add(c.doc,"mouseup",c.onPointerUp))};c.onPointerMove=function(h){a&&!d&&(f=(h.changedTouches||
e.getCoords(h))[0]);h=c.bbox;if("relative"===c.position)var k=f.pageX+h.scrollLeft-h.x1,m=f.pageY+h.scrollTop-h.y1;else k=f.pageX-h.x1,m=f.pageY-h.y1;0<k&&k<h.width&&0<m&&m<h.height&&25>=Math.abs(f.pageX-g.pageX)&&25>=Math.abs(f.pageY-g.pageY)||(Event.remove(c.doc,"mousemove",c.onPointerMove),clearTimeout(b),a=d=0)};c.onPointerUp=function(f){e.pointerEnd(f,h,c)&&(Event.remove(c.doc,"mousemove",c.onPointerMove),Event.remove(c.doc,"mouseup",c.onPointerUp));if(a&&d){if(700>=d&&!(f.cancelBubble&&1<++f.bubble)){h.state=
c.gesture;for(var g in c.tracker)break;g=c.tracker[g];h.x=g.start.x;h.y=g.start.y;c.listener(f,h)}clearTimeout(b);a=d=0}};var h=e.pointerSetup(c);h.state="dblclick";Event.add(c.target,"mousedown",c.onPointerDown);return h};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.dbltap=e.dbltap;Event.Gesture._gestureHandlers.dblclick=e.dblclick;return e}(Event.proxy);"undefined"===typeof Event&&(Event={});
"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.dragElement=function(c,a){e.drag({event:a,target:c,position:"move",listener:function(a,b){c.style.left=b.x+"px";c.style.top=b.y+"px";Event.prevent(a)}})};e.drag=function(c){c.gesture="drag";c.onPointerDown=function(d){e.pointerStart(d,a,c)&&!c.monitor&&(Event.add(c.doc,"mousemove",c.onPointerMove),Event.add(c.doc,"mouseup",c.onPointerUp));c.onPointerMove(d,"down")};c.onPointerMove=function(d,b){if(!c.tracker)return c.onPointerDown(d);for(var g=c.bbox,f=d.changedTouches||
e.getCoords(d),h=f.length,l=0;l<h;l++){var k=f[l],m=k.identifier||Infinity,n=c.tracker[m];n&&(n.pageX=k.pageX,n.pageY=k.pageY,a.state=b||"move",a.identifier=m,a.start=n.start,a.fingers=c.fingers,"differenceFromLast"===c.position?(a.x=n.pageX-n.offsetX,a.y=n.pageY-n.offsetY,n.offsetX=n.pageX,n.offsetY=n.pageY):"relative"===c.position?(a.x=n.pageX+g.scrollLeft-n.offsetX,a.y=n.pageY+g.scrollTop-n.offsetY):(a.x=n.pageX-n.offsetX,a.y=n.pageY-n.offsetY),c.listener(d,a))}};c.onPointerUp=function(d){e.pointerEnd(d,
a,c,c.onPointerMove)&&!c.monitor&&(Event.remove(c.doc,"mousemove",c.onPointerMove),Event.remove(c.doc,"mouseup",c.onPointerUp))};var a=e.pointerSetup(c);if(c.event)c.onPointerDown(c.event);else Event.add(c.target,"mousedown",c.onPointerDown),c.monitor&&(Event.add(c.doc,"mousemove",c.onPointerMove),Event.add(c.doc,"mouseup",c.onPointerUp));return a};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.drag=e.drag;return e}(Event.proxy);
"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){var c=Math.PI/180;e.gesture=function(a){a.gesture=a.gesture||"gesture";a.minFingers=a.minFingers||a.fingers||2;a.onPointerDown=function(b){var c=a.fingers;e.pointerStart(b,d,a)&&(Event.add(a.doc,"mousemove",a.onPointerMove),Event.add(a.doc,"mouseup",a.onPointerUp));if(a.fingers===a.minFingers&&c!==a.fingers){d.fingers=a.minFingers;d.scale=1;d.rotation=0;d.state="start";var c="",f;for(f in a.tracker)c+=f;d.identifier=parseInt(c);a.listener(b,d)}};a.onPointerMove=function(b,
g){for(var f=a.bbox,h=a.tracker,l=b.changedTouches||e.getCoords(b),k=l.length,m=0;m<k;m++){var n=l[m],p=n.identifier||Infinity,q=h[p];q&&("relative"===a.position?(q.move.x=n.pageX+f.scrollLeft-f.x1,q.move.y=n.pageY+f.scrollTop-f.y1):(q.move.x=n.pageX-f.x1,q.move.y=n.pageY-f.y1))}if(!(a.fingers<a.minFingers)){var l=[],s=q=m=f=0,k=0;for(p in h)n=h[p],n.up||(q+=n.move.x,s+=n.move.y,k++);q/=k;s/=k;for(p in h)if(n=h[p],!n.up){k=n.start;if(!k.distance){var x=k.x-q,t=k.y-s;k.distance=Math.sqrt(x*x+t*t);
k.angle=Math.atan2(x,t)/c}var x=n.move.x-q,t=n.move.y-s,w=Math.sqrt(x*x+t*t),f=f+w/k.distance,x=Math.atan2(x,t)/c,k=(k.angle-x+360)%360-180;n.DEG2=n.DEG1;n.DEG1=0<k?k:-k;"undefined"!==typeof n.DEG2&&(n.rotation=0<k?n.rotation+(n.DEG1-n.DEG2):n.rotation-(n.DEG1-n.DEG2),m+=n.rotation);l.push(n.move)}d.touches=l;d.fingers=a.fingers;d.scale=f/a.fingers;d.rotation=m/a.fingers;d.state="change";a.listener(b,d)}};a.onPointerUp=function(b){var c=a.fingers;e.pointerEnd(b,d,a)&&(Event.remove(a.doc,"mousemove",
a.onPointerMove),Event.remove(a.doc,"mouseup",a.onPointerUp));c===a.minFingers&&a.fingers<a.minFingers&&(d.fingers=a.fingers,d.state="end",a.listener(b,d))};var d=e.pointerSetup(a);Event.add(a.target,"mousedown",a.onPointerDown);return d};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.gesture=e.gesture;return e}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.pointerdown=e.pointermove=e.pointerup=function(c){c.gesture=c.gesture||"pointer";if(!c.target.isPointerEmitter){var a=!0;c.onPointerDown=function(b){a=!1;d.gesture="pointerdown";c.listener(b,d)};c.onPointerMove=function(b){d.gesture="pointermove";c.listener(b,d,a)};c.onPointerUp=function(b){a=!0;d.gesture="pointerup";c.listener(b,d,!0)};var d=e.pointerSetup(c);Event.add(c.target,"mousedown",c.onPointerDown);Event.add(c.target,"mousemove",c.onPointerMove);Event.add(c.doc,
"mouseup",c.onPointerUp);c.target.isPointerEmitter=!0;return d}};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.pointerdown=e.pointerdown;Event.Gesture._gestureHandlers.pointermove=e.pointermove;Event.Gesture._gestureHandlers.pointerup=e.pointerup;return e}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.shake=function(c){var a={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:c.target,listener:c.listener,remove:function(){window.removeEventListener("devicemotion",f,!1)}},d=(new Date).getTime(),b={x:0,y:0,z:0},g={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}},f=function(f){var e=f.accelerationIncludingGravity;b.x=0.8*b.x+(1-0.8)*e.x;b.y=0.8*b.y+(1-0.8)*e.y;b.z=0.8*b.z+(1-0.8)*e.z;a.accelerationIncludingGravity=b;a.acceleration.x=
e.x-b.x;a.acceleration.y=e.y-b.y;a.acceleration.z=e.z-b.z;if("devicemotion"===c.gesture)c.listener(f,a);else for(var e=(new Date).getTime(),k=0;3>k;k++){var m="xyz"[k],n=a.acceleration[m],m=g[m],p=Math.abs(n);!(1E3>e-d)&&4<p&&(n=e*n/p,p=Math.abs(n+m.value),m.value&&200>p?(m.value=n,m.count++,3===m.count&&(c.listener(f,a),d=e,m.value=0,m.count=0)):(m.value=n,m.count=1))}};if(window.addEventListener)return window.addEventListener("devicemotion",f,!1),a};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=
Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.shake=e.shake;return e}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){var c=Math.PI/180;e.swipe=function(a){a.snap=a.snap||90;a.threshold=a.threshold||1;a.gesture=a.gesture||"swipe";a.onPointerDown=function(b){e.pointerStart(b,d,a)&&(Event.add(a.doc,"mousemove",a.onPointerMove).listener(b),Event.add(a.doc,"mouseup",a.onPointerUp))};a.onPointerMove=function(b){b=b.changedTouches||e.getCoords(b);for(var d=b.length,f=0;f<d;f++){var c=b[f],l=a.tracker[c.identifier||Infinity];l&&(l.move.x=c.pageX,l.move.y=c.pageY,l.moveTime=(new Date).getTime())}};
a.onPointerUp=function(b){if(e.pointerEnd(b,d,a)){Event.remove(a.doc,"mousemove",a.onPointerMove);Event.remove(a.doc,"mouseup",a.onPointerUp);var g,f,h,l,k={x:0,y:0},m=0,n=0,p=0,q;for(q in a.tracker){var s=a.tracker[q];l=s.move.x-s.start.x;var x=s.move.y-s.start.y,m=m+s.move.x,n=n+s.move.y;k.x+=s.start.x;k.y+=s.start.y;p++;f=Math.sqrt(l*l+x*x);s=s.moveTime-s.startTime;l=Math.atan2(l,x)/c+180;f=s?f/s:0;if("undefined"===typeof h)h=l,g=f;else if(20>=Math.abs(l-h))h=(h+l)/2,g=(g+f)/2;else return}q=a.gestureFingers;
a.minFingers<=q&&a.maxFingers>=q&&g>a.threshold&&(k.x/=p,k.y/=p,d.start=k,d.x=m/p,d.y=n/p,d.angle=-(((h/a.snap+0.5>>0)*a.snap||360)-360),d.velocity=g,d.fingers=q,d.state="swipe",a.listener(b,d))}};var d=e.pointerSetup(a);Event.add(a.target,"mousedown",a.onPointerDown);return d};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.swipe=e.swipe;return e}(Event.proxy);"undefined"===typeof Event&&(Event={});
"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.longpress=function(c){c.gesture="longpress";return e.tap(c)};e.tap=function(c){c.delay=c.delay||500;c.timeout=c.timeout||250;c.driftDeviance=c.driftDeviance||10;c.gesture=c.gesture||"tap";var a,d;c.onPointerDown=function(g){e.pointerStart(g,b,c)&&(a=(new Date).getTime(),Event.add(c.doc,"mousemove",c.onPointerMove).listener(g),Event.add(c.doc,"mouseup",c.onPointerUp),"longpress"===c.gesture&&(d=setTimeout(function(){if(!(g.cancelBubble&&1<++g.bubble)){var f=0,a;for(a in c.tracker){var d=
c.tracker[a];if(!0===d.end||c.cancel)return;f++}c.minFingers<=f&&c.maxFingers>=f&&(b.state="start",b.fingers=f,b.x=d.start.x,b.y=d.start.y,c.listener(g,b))}},c.delay)))};c.onPointerMove=function(b){var f=c.bbox;b=b.changedTouches||e.getCoords(b);for(var a=b.length,d=0;d<a;d++){var k=b[d],m=c.tracker[k.identifier||Infinity];if(m){if("relative"===c.position)var n=k.pageX+f.scrollLeft-f.x1,k=k.pageY+f.scrollTop-f.y1;else n=k.pageX-f.x1,k=k.pageY-f.y1;var p=n-m.start.x,m=k-m.start.y,m=Math.sqrt(p*p+m*
m);if(!(0<n&&n<f.width&&0<k&&k<f.height&&m<=c.driftDeviance)){Event.remove(c.doc,"mousemove",c.onPointerMove);c.cancel=!0;break}}}};c.onPointerUp=function(g){if(e.pointerEnd(g,b,c)&&(clearTimeout(d),Event.remove(c.doc,"mousemove",c.onPointerMove),Event.remove(c.doc,"mouseup",c.onPointerUp),!(g.cancelBubble&&1<++g.bubble)))if("longpress"===c.gesture)"start"===b.state&&(b.state="end",c.listener(g,b));else if(!(c.cancel||(new Date).getTime()-a>c.timeout)){var f=c.gestureFingers;c.minFingers<=f&&c.maxFingers>=
f&&(b.state="tap",b.fingers=c.gestureFingers,c.listener(g,b))}};var b=e.pointerSetup(c);Event.add(c.target,"mousedown",c.onPointerDown);return b};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.tap=e.tap;Event.Gesture._gestureHandlers.longpress=e.longpress;return e}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.wheel=function(c){var a,d=c.timeout||150,b=0,g={gesture:"wheel",state:"start",wheelDelta:0,target:c.target,listener:c.listener,preventElasticBounce:function(){var b=this.target,f=b.scrollTop;f+b.offsetHeight===b.scrollHeight&&0>=this.wheelDelta?Event.cancel(event):0===f&&0<=this.wheelDelta&&Event.cancel(event);Event.stop(event)},add:function(){c.target[h](k,f,!1)},remove:function(){c.target[e](k,f,!1)}},f=function(f){f=f||window.event;g.state=b++?"change":"start";g.wheelDelta=
f.detail?-20*f.detail:f.wheelDelta;c.listener(f,g);clearTimeout(a);a=setTimeout(function(){b=0;g.state="end";g.wheelDelta=0;c.listener(f,g)},d)},h=document.addEventListener?"addEventListener":"attachEvent",e=document.removeEventListener?"removeEventListener":"detachEvent",k=Event.getEventSupport("mousewheel")?"mousewheel":"DOMMouseScroll";c.target[h](k,f,!1);return g};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.wheel=
e.wheel;return e}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.orientation=function(c){var a={gesture:"orientationchange",previous:null,current:window.orientation,target:c.target,listener:c.listener,remove:function(){window.removeEventListener("orientationchange",d,!1)}},d=function(b){a.previous=a.current;a.current=window.orientation;null!==a.previous&&a.previous!=a.current&&c.listener(b,a)};window.DeviceOrientationEvent&&window.addEventListener("orientationchange",d,!1);return a};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=
Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.orientation=e.orientation;return e}(Event.proxy);
(function(){function e(b,a){this.__eventListeners[b]&&(a?fabric.util.removeFromArray(this.__eventListeners[b],a):this.__eventListeners[b].length=0)}function c(b,a){this.__eventListeners||(this.__eventListeners={});if(1===arguments.length)for(var f in b)this.on(f,b[f]);else this.__eventListeners[b]||(this.__eventListeners[b]=[]),this.__eventListeners[b].push(a);return this}function a(b,a){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"===
typeof arguments[0])for(var f in b)e.call(this,f,b[f]);else e.call(this,b,a);return this}}function d(b,a){if(this.__eventListeners){var f=this.__eventListeners[b];if(f){for(var d=0,c=f.length;d<c;d++)f[d].call(this,a||{});return this}}}fabric.Observable={observe:c,stopObserving:a,fire:d,on:c,off:a,trigger:d}})();
fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var e=0,c=arguments.length;e<c;e++)this._onObjectAdded(arguments[e]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(e,c,a){var d=this.getObjects();a?d[c]=e:d.splice(c,0,e);this._onObjectAdded(e);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var e=this.getObjects(),c,a=0,d=arguments.length;a<d;a++)c=e.indexOf(arguments[a]),-1!==c&&(e.splice(c,1),this._onObjectRemoved(arguments[a]));
this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(e,c){for(var a=this.getObjects(),d=a.length;d--;)e.call(c,a[d],d,a);return this},getObjects:function(e){return"undefined"===typeof e?this._objects:this._objects.filter(function(c){return c.type===e})},item:function(e){return this.getObjects()[e]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(e){return-1<this.getObjects().indexOf(e)},complexity:function(){return this.getObjects().reduce(function(e,
c){return e+=c.complexity?c.complexity():0},0)}};
(function(e){var c=Math.sqrt,a=Math.atan2,d=Math.PI/180;fabric.util={removeFromArray:function(b,a){var f=b.indexOf(a);-1!==f&&b.splice(f,1);return b},getRandomInt:function(b,a){return Math.floor(Math.random()*(a-b+1))+b},degreesToRadians:function(b){return b*d},radiansToDegrees:function(b){return b/d},rotatePoint:function(b,a,f){var d=Math.sin(f);f=Math.cos(f);b.subtractEquals(a);return(new fabric.Point(b.x*f-b.y*d,b.x*d+b.y*f)).addEquals(a)},toFixed:function(b,a){return parseFloat(Number(b).toFixed(a))},
falseFunction:function(){return!1},getKlass:function(b,a){b=fabric.util.string.camelize(b.charAt(0).toUpperCase()+b.slice(1));return fabric.util.resolveNamespace(a)[b]},resolveNamespace:function(b){if(!b)return fabric;b=b.split(".");for(var a=b.length,f=e||fabric.window,d=0;d<a;++d)f=f[b[d]];return f},loadImage:function(b,a,f,d){if(b){var c=fabric.util.createImage();c.onload=function(){a&&a.call(f,c);c=c.onload=c.onerror=null};c.onerror=function(){fabric.log("Error loading "+c.src);a&&a.call(f,null,
!0);c=c.onload=c.onerror=null};0!==b.indexOf("data")&&"undefined"!==typeof d&&(c.crossOrigin=d);c.src=b}else a&&a.call(f,b)},enlivenObjects:function(b,a,f,d){function c(){++m===n&&a&&a(e)}b=b||[];var e=[],m=0,n=b.length;n?b.forEach(function(b,a){if(b&&b.type){var g=fabric.util.getKlass(b.type,f);g.async?g.fromObject(b,function(f,g){g||(e[a]=f,d&&d(b,e[a]));c()}):(e[a]=g.fromObject(b),d&&d(b,e[a]),c())}else c()}):a&&a(e)},groupSVGElements:function(b,a,f){b=1<b.length?new fabric.PathGroup(b,a):b[0];
"undefined"!==typeof f&&b.setSourcePath(f);return b},populateWithProperties:function(b,a,f){if(f&&"[object Array]"===Object.prototype.toString.call(f))for(var d=0,c=f.length;d<c;d++)f[d]in b&&(a[f[d]]=b[f[d]])},drawDashedLine:function(b,d,f,h,e,k){h-=d;var m=e-f;e=c(h*h+m*m);h=a(m,h);var m=k.length,n=0,p=!0;b.save();b.translate(d,f);b.moveTo(0,0);b.rotate(h);for(d=0;e>d;)d+=k[n++%m],d>e&&(d=e),b[p?"lineTo":"moveTo"](d,0),p=!p;b.restore()},createCanvasElement:function(b){b||(b=fabric.document.createElement("canvas"));
b.getContext||"undefined"===typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(b);return b},createImage:function(){return fabric.isLikelyNode?new (require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(b){b=b.prototype;for(var a=b.stateProperties.length;a--;){var f=b.stateProperties[a],d=f.charAt(0).toUpperCase()+f.slice(1),c="set"+d,d="get"+d;b[d]||(b[d]=new Function('return this.get("'+f+'")'));b[c]||(b[c]=new Function("value",'return this.set("'+f+'", value)'))}},
clipContext:function(b,a){a.save();a.beginPath();b.clipTo(a);a.clip()},multiplyTransformMatrices:function(b,a){for(var f=[[b[0],b[2],b[4]],[b[1],b[3],b[5]],[0,0,1]],d=[[a[0],a[2],a[4]],[a[1],a[3],a[5]],[0,0,1]],c=[],e=0;3>e;e++){c[e]=[];for(var m=0;3>m;m++){for(var n=0,p=0;3>p;p++)n+=f[e][p]*d[p][m];c[e][m]=n}}return[c[0][0],c[1][0],c[0][1],c[1][1],c[0][2],c[1][2]]},getFunctionBody:function(b){return(String(b).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},normalizePoints:function(b,a){for(var f=fabric.util.array.min(b,
"x"),d=fabric.util.array.min(b,"y"),f=0>f?f:0,d=0>f?d:0,c=0,e=b.length;c<e;c++)b[c].x-=a.width/2+f||0,b[c].y-=a.height/2+d||0},isTransparent:function(b,a,f,d){0<d&&(a=a>d?a-d:0,f=f>d?f-d:0);var c=!0;b=b.getImageData(a,f,2*d||1,2*d||1);a=3;for(f=b.data.length;a<f&&(c=0>=b.data[a],!1!==c);a+=4);return c}}})("undefined"!==typeof exports?exports:this);
(function(){function e(f,d,c,e,m,n,p,q,s){var x,t,w,A,v,u;g=b.call(arguments);if(a[g])return a[g];var r=c;x=e;t=q;w=s;var z=f;A=d;u=p*(Math.PI/180);v=Math.sin(u);u=Math.cos(u);r=Math.abs(r);x=Math.abs(x);var C=0.5*u*(t-z)+0.5*v*(w-A),B=0.5*u*(w-A)-0.5*v*(t-z),C=C*C/(r*r)+B*B/(x*x);1<C&&(C=Math.sqrt(C),r*=C,x*=C);var C=u/r,B=v/r,r=-v/x,D=u/x;x=C*t+B*w;t=r*t+D*w;w=C*z+B*A;A=r*z+D*A;z=1/((w-x)*(w-x)+(A-t)*(A-t))-0.25;0>z&&(z=0);C=Math.sqrt(z);n===m&&(C=-C);z=0.5*(x+w)-C*(A-t);C=0.5*(t+A)+C*(w-x);x=Math.atan2(t-
C,x-z);A=Math.atan2(A-C,w-z)-x;0>A&&1===n?A+=2*Math.PI:0<A&&0===n&&(A-=2*Math.PI);t=Math.ceil(Math.abs(A/(0.5*Math.PI+0.001)));w=[];for(r=0;r<t;r++)w[r]=[z,C,x+r*A/t,x+(r+1)*A/t,c,e,v,u];return a[g]=w}function c(f,a,c,e,m,n,p,q){g=b.call(arguments);if(d[g])return d[g];var s=q*m,x=-p*n,t=p*m,w=q*n,A=0.5*(e-c),v=8/3*Math.sin(0.5*A)*Math.sin(0.5*A)/Math.sin(A),A=f+Math.cos(c)-v*Math.sin(c),u=a+Math.sin(c)+v*Math.cos(c),r=f+Math.cos(e),z=a+Math.sin(e),C=r+v*Math.sin(e),v=z-v*Math.cos(e);d[g]=[s*A+x*u,
t*A+w*u,s*C+x*v,t*C+w*v,s*r+x*z,t*r+w*z];return d[g]}var a={},d={},b=Array.prototype.join,g;fabric.util.drawArc=function(b,a,d,g){a=e(g[5],g[6],g[0],g[1],g[3],g[4],g[2],a,d);for(d=0;d<a.length;d++)g=c.apply(this,a[d]),b.bezierCurveTo.apply(b,g)}})();
(function(){function e(a,d,b){if(a&&0!==a.length){var c=a.length-1,f=d?a[c][d]:a[c];if(d)for(;c--;)b(a[c][d],f)&&(f=a[c][d]);else for(;c--;)b(a[c],f)&&(f=a[c]);return f}}var c=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(void 0===this||null===this)throw new TypeError;var d=Object(this),b=d.length>>>0;if(0===b)return-1;var c=0;0<arguments.length&&(c=Number(arguments[1]),c!==c?c=0:0!==c&&c!==Number.POSITIVE_INFINITY&&c!==Number.NEGATIVE_INFINITY&&(c=(0<c||-1)*
Math.floor(Math.abs(c))));if(c>=b)return-1;for(c=0<=c?c:Math.max(b-Math.abs(c),0);c<b;c++)if(c in d&&d[c]===a)return c;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(a,d){for(var b=0,c=this.length>>>0;b<c;b++)b in this&&a.call(d,this[b],b,this)});Array.prototype.map||(Array.prototype.map=function(a,d){for(var b=[],c=0,f=this.length>>>0;c<f;c++)c in this&&(b[c]=a.call(d,this[c],c,this));return b});Array.prototype.every||(Array.prototype.every=function(a,d){for(var b=0,c=this.length>>>
0;b<c;b++)if(b in this&&!a.call(d,this[b],b,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(a,d){for(var b=0,c=this.length>>>0;b<c;b++)if(b in this&&a.call(d,this[b],b,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(a,d){for(var b=[],c,f=0,h=this.length>>>0;f<h;f++)f in this&&(c=this[f],a.call(d,c,f,this)&&b.push(c));return b});Array.prototype.reduce||(Array.prototype.reduce=function(a){var d=this.length>>>0,b=0,c;if(1<arguments.length)c=
arguments[1];else{do{if(b in this){c=this[b++];break}if(++b>=d)throw new TypeError;}while(1)}for(;b<d;b++)b in this&&(c=a.call(null,c,this[b],b,this));return c});fabric.util.array={invoke:function(a,d){for(var b=c.call(arguments,2),g=[],f=0,h=a.length;f<h;f++)g[f]=b.length?a[f][d].apply(a[f],b):a[f][d].call(a[f]);return g},min:function(a,c){return e(a,c,function(b,a){return b<a})},max:function(a,c){return e(a,c,function(b,a){return b>=a})}}})();
(function(){function e(c,a){for(var d in a)c[d]=a[d];return c}fabric.util.object={extend:e,clone:function(c){return e({},c)}}})();
(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});fabric.util.string={camelize:function(e){return e.replace(/-+(.)?/g,function(c,a){return a?a.toUpperCase():""})},capitalize:function(e,c){return e.charAt(0).toUpperCase()+(c?e.slice(1):e.slice(1).toLowerCase())},escapeXml:function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();
(function(){var e=Array.prototype.slice,c=Function.prototype.apply,a=function(){};Function.prototype.bind||(Function.prototype.bind=function(d){var b=this,g=e.call(arguments,1),f;f=g.length?function(){return c.call(b,this instanceof a?this:d,g.concat(e.call(arguments)))}:function(){return c.call(b,this instanceof a?this:d,arguments)};a.prototype=this.prototype;f.prototype=new a;return f})})();
(function(){function e(){}function c(b){var c=this.constructor.superclass.prototype[b];return 1<arguments.length?c.apply(this,a.call(arguments,1)):c.call(this)}var a=Array.prototype.slice,d=function(){},b=function(){for(var b in{toString:1})if("toString"===b)return!1;return!0}(),g=function(f,a,c){for(var d in a)d in f.prototype&&"function"===typeof f.prototype[d]&&-1<(a[d]+"").indexOf("callSuper")?f.prototype[d]=function(b){return function(){var f=this.constructor.superclass;this.constructor.superclass=
c;var d=a[b].apply(this,arguments);this.constructor.superclass=f;if("initialize"!==b)return d}}(d):f.prototype[d]=a[d],b&&(a.toString!==Object.prototype.toString&&(f.prototype.toString=a.toString),a.valueOf!==Object.prototype.valueOf&&(f.prototype.valueOf=a.valueOf))};fabric.util.createClass=function(){function b(){this.initialize.apply(this,arguments)}var h=null,l=a.call(arguments,0);"function"===typeof l[0]&&(h=l.shift());b.superclass=h;b.subclasses=[];h&&(e.prototype=h.prototype,b.prototype=new e,
h.subclasses.push(b));for(var k=0,m=l.length;k<m;k++)g(b,l[k],h);b.prototype.initialize||(b.prototype.initialize=d);b.prototype.constructor=b;b.prototype.callSuper=c;return b}})();
(function(){function e(b){var f=Array.prototype.slice.call(arguments,1),a,c,d=f.length;for(c=0;c<d;c++)if(a=typeof b[f[c]],!/^(?:function|object|unknown)$/.test(a))return!1;return!0}function c(f,a){return function(c){a.call(b(f),c||fabric.window.event)}}function a(b,f){return function(a){if(m[b]&&m[b][f])for(var c=m[b][f],d=0,g=c.length;d<g;d++)c[d].call(this,a||fabric.window.event)}}function d(b,f,a){var c="touchend"===b.type?"changedTouches":"touches";return b[c]&&b[c][0]?b[c][0][f]-(b[c][0][f]-
b[c][0][a])||b[a]:b[a]}var b,g,f=function(){var b=0;return function(f){return f.__uniqueID||(f.__uniqueID="uniqueID__"+b++)}}();(function(){var f={};b=function(b){return f[b]};g=function(b,a){f[b]=a}})();var h=e(fabric.document.documentElement,"addEventListener","removeEventListener")&&e(fabric.window,"addEventListener","removeEventListener"),l=e(fabric.document.documentElement,"attachEvent","detachEvent")&&e(fabric.window,"attachEvent","detachEvent"),k={},m={};h?(h=function(b,f,a){b.addEventListener(f,
a,!1)},l=function(b,f,a){b.removeEventListener(f,a,!1)}):l?(h=function(b,a,d){var h=f(b);g(h,b);k[h]||(k[h]={});k[h][a]||(k[h][a]=[]);d={handler:d,wrappedHandler:c(h,d)};k[h][a].push(d);b.attachEvent("on"+a,d.wrappedHandler)},l=function(b,a,c){var d=f(b),g;if(k[d]&&k[d][a])for(var h=0,e=k[d][a].length;h<e;h++)(g=k[d][a][h])&&g.handler===c&&(b.detachEvent("on"+a,g.wrappedHandler),k[d][a][h]=null)}):(h=function(b,c,d){var g=f(b);m[g]||(m[g]={});if(!m[g][c]){m[g][c]=[];var h=b["on"+c];h&&m[g][c].push(h);
b["on"+c]=a(g,c)}m[g][c].push(d)},l=function(b,a,c){b=f(b);if(m[b]&&m[b][a]){a=m[b][a];b=0;for(var d=a.length;b<d;b++)a[b]===c&&a.splice(b,1)}});fabric.util.addListener=h;fabric.util.removeListener=l;var n=function(b){return"unknown"!==typeof b.clientX?b.clientX:0},p=function(b){return"unknown"!==typeof b.clientY?b.clientY:0};fabric.isTouchSupported&&(n=function(b){return d(b,"pageX","clientX")},p=function(b){return d(b,"pageY","clientY")});fabric.util.getPointer=function(b,f){b||(b=fabric.window.event);
var a=fabric.util.getScrollLeftTop(b.target||("unknown"!==typeof b.srcElement?b.srcElement:null),f);return{x:n(b)+a.left,y:p(b)+a.top}};fabric.util.object.extend(fabric.util,fabric.Observable)})();
(function(){var e=fabric.document.createElement("div"),c="string"===typeof e.style.filter,a=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,d=function(b){return b};"string"===typeof e.style.opacity?d=function(b,a){b.style.opacity=a;return b}:c&&(d=function(b,c){var f=b.style;b.currentStyle&&!b.currentStyle.hasLayout&&(f.zoom=1);a.test(f.filter)?f.filter=f.filter.replace(a,0.9999<=c?"":"alpha(opacity="+100*c+")"):f.filter+=" alpha(opacity="+100*c+")";return b});fabric.util.setStyle=function(b,a){var f=b.style;
if(!f)return b;if("string"===typeof a)return b.style.cssText+=";"+a,-1<a.indexOf("opacity")?d(b,a.match(/opacity:\s*(\d?\.?\d*)/)[1]):b;for(var c in a)"opacity"===c?d(b,a[c]):f["float"===c||"cssFloat"===c?"undefined"===typeof f.styleFloat?"cssFloat":"styleFloat":c]=a[c];return b}})();
(function(){function e(b,a){var c=fabric.document.createElement(b),d;for(d in a)"class"===d?c.className=a[d]:"for"===d?c.htmlFor=a[d]:c.setAttribute(d,a[d]);return c}var c=Array.prototype.slice,a,d=function(b){return c.call(b,0)};try{a=d(fabric.document.childNodes)instanceof Array}catch(b){}a||(d=function(b){for(var a=Array(b.length),c=b.length;c--;)a[c]=b[c];return a});var g;g=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(b,a){return fabric.document.defaultView.getComputedStyle(b,
null)[a]}:function(b,a){var c=b.style[a];!c&&b.currentStyle&&(c=b.currentStyle[a]);return c};(function(){var b=fabric.document.documentElement.style,a="userSelect"in b?"userSelect":"MozUserSelect"in b?"MozUserSelect":"WebkitUserSelect"in b?"WebkitUserSelect":"KhtmlUserSelect"in b?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(b){"undefined"!==typeof b.onselectstart&&(b.onselectstart=fabric.util.falseFunction);a?b.style[a]="none":"string"===typeof b.unselectable&&(b.unselectable=
"on");return b};fabric.util.makeElementSelectable=function(b){"undefined"!==typeof b.onselectstart&&(b.onselectstart=null);a?b.style[a]="":"string"===typeof b.unselectable&&(b.unselectable="");return b}})();(function(){fabric.util.getScript=function(b,a){var c=fabric.document.getElementsByTagName("head")[0],d=fabric.document.createElement("script"),g=!0;d.onload=d.onreadystatechange=function(b){!g||"string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(g=!1,
a(b||fabric.window.event),d=d.onload=d.onreadystatechange=null)};d.src=b;c.appendChild(d)}})();fabric.util.getById=function(b){return"string"===typeof b?fabric.document.getElementById(b):b};fabric.util.toArray=d;fabric.util.makeElement=e;fabric.util.addClass=function(b,a){b&&-1===(" "+b.className+" ").indexOf(" "+a+" ")&&(b.className+=(b.className?" ":"")+a)};fabric.util.wrapElement=function(b,a,c){"string"===typeof a&&(a=e(a,c));b.parentNode&&b.parentNode.replaceChild(a,b);a.appendChild(b);return a};
fabric.util.getScrollLeftTop=function(b,a){var c,d,g=0,e=0,p=fabric.document.documentElement,q=fabric.document.body||{scrollLeft:0,scrollTop:0};for(d=b;b&&b.parentNode&&!c;)b=b.parentNode,b!==fabric.document&&"fixed"===fabric.util.getElementStyle(b,"position")&&(c=b),b!==fabric.document&&d!==a&&"absolute"===fabric.util.getElementStyle(b,"position")?e=g=0:b===fabric.document?(g=q.scrollLeft||p.scrollLeft||0,e=q.scrollTop||p.scrollTop||0):(g+=b.scrollLeft||0,e+=b.scrollTop||0);return{left:g,top:e}};
fabric.util.getElementOffset=function(b){var a;a=b&&b.ownerDocument;var c={left:0,top:0},d={left:0,top:0},e={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!a)return{left:0,top:0};for(var n in e)d[e[n]]+=parseInt(g(b,n),10)||0;a=a.documentElement;"undefined"!==typeof b.getBoundingClientRect&&(c=b.getBoundingClientRect());b=fabric.util.getScrollLeftTop(b,null);return{left:c.left+b.left-(a.clientLeft||0)+d.left,top:c.top+b.top-(a.clientTop||0)+d.top}};fabric.util.getElementStyle=
g})();
(function(){function e(){}var c=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],c=a.length;c--;)try{if(a[c]())return a[c]}catch(b){}}();fabric.util.request=function(a,d){d||(d={});var b=d.method?d.method.toUpperCase():"GET",g=d.onComplete||function(){},f=c(),h;f.onreadystatechange=function(){4===f.readyState&&(g(f),
f.onreadystatechange=e)};"GET"===b&&(h=null,"string"===typeof d.parameters&&(a=a+(/\?/.test(a)?"&":"?")+d.parameters));f.open(b,a,!0);"POST"!==b&&"PUT"!==b||f.setRequestHeader("Content-Type","application/x-www-form-urlencoded");f.send(h);return f}})();fabric.log=function(){};fabric.warn=function(){};"undefined"!==typeof console&&["log","warn"].forEach(function(e){"undefined"!==typeof console[e]&&console[e].apply&&(fabric[e]=function(){return console[e].apply(console,arguments)})});
(function(){function e(){return c.apply(fabric.window,arguments)}var c=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(a){fabric.window.setTimeout(a,1E3/60)};fabric.util.animate=function(a){e(function(c){a||(a={});var b=c||+new Date,g=a.duration||500,f=b+g,h,l=a.onChange||function(){},k=a.abort||function(){return!1},m=a.easing||function(b,a,
f,c){return-f*Math.cos(b/c*(Math.PI/2))+f+a},n="startValue"in a?a.startValue:0;c="endValue"in a?a.endValue:100;var p=a.byValue||c-n;a.onStart&&a.onStart();(function s(c){h=c||+new Date;c=h>f?g:h-b;k()?a.onComplete&&a.onComplete():(l(m(c,n,p,g)),h>f?a.onComplete&&a.onComplete():e(s))})(b)})};fabric.util.requestAnimFrame=e})();
(function(){function e(b,a,f,c){b<Math.abs(a)?(b=a,c=f/4):c=f/(2*Math.PI)*Math.asin(a/b);return{a:b,c:a,p:f,s:c}}function c(b,a,f){return b.a*Math.pow(2,10*(a-=1))*Math.sin(2*(a*f-b.s)*Math.PI/b.p)}function a(b,a,f,c){return f-d(c-b,0,f,c)+a}function d(b,a,f,c){return(b/=c)<1/2.75?7.5625*f*b*b+a:b<2/2.75?f*(7.5625*(b-=1.5/2.75)*b+0.75)+a:b<2.5/2.75?f*(7.5625*(b-=2.25/2.75)*b+0.9375)+a:f*(7.5625*(b-=2.625/2.75)*b+0.984375)+a}fabric.util.ease={easeInQuad:function(b,a,f,c){return f*(b/=c)*b+a},easeOutQuad:function(b,
a,f,c){return-f*(b/=c)*(b-2)+a},easeInOutQuad:function(b,a,f,c){b/=c/2;return 1>b?f/2*b*b+a:-f/2*(--b*(b-2)-1)+a},easeInCubic:function(b,a,f,c){return f*(b/=c)*b*b+a},easeOutCubic:function(b,a,f,c){return f*((b=b/c-1)*b*b+1)+a},easeInOutCubic:function(b,a,f,c){b/=c/2;return 1>b?f/2*b*b*b+a:f/2*((b-=2)*b*b+2)+a},easeInQuart:function(b,a,f,c){return f*(b/=c)*b*b*b+a},easeOutQuart:function(b,a,f,c){return-f*((b=b/c-1)*b*b*b-1)+a},easeInOutQuart:function(b,a,f,c){b/=c/2;return 1>b?f/2*b*b*b*b+a:-f/2*
((b-=2)*b*b*b-2)+a},easeInQuint:function(b,a,f,c){return f*(b/=c)*b*b*b*b+a},easeOutQuint:function(b,a,f,c){return f*((b=b/c-1)*b*b*b*b+1)+a},easeInOutQuint:function(b,a,f,c){b/=c/2;return 1>b?f/2*b*b*b*b*b+a:f/2*((b-=2)*b*b*b*b+2)+a},easeInSine:function(b,a,f,c){return-f*Math.cos(b/c*(Math.PI/2))+f+a},easeOutSine:function(b,a,f,c){return f*Math.sin(b/c*(Math.PI/2))+a},easeInOutSine:function(b,a,f,c){return-f/2*(Math.cos(Math.PI*b/c)-1)+a},easeInExpo:function(b,a,f,c){return 0===b?a:f*Math.pow(2,
10*(b/c-1))+a},easeOutExpo:function(b,a,f,c){return b===c?a+f:f*(-Math.pow(2,-10*b/c)+1)+a},easeInOutExpo:function(b,a,f,c){if(0===b)return a;if(b===c)return a+f;b/=c/2;return 1>b?f/2*Math.pow(2,10*(b-1))+a:f/2*(-Math.pow(2,-10*--b)+2)+a},easeInCirc:function(b,a,f,c){return-f*(Math.sqrt(1-(b/=c)*b)-1)+a},easeOutCirc:function(b,a,f,c){return f*Math.sqrt(1-(b=b/c-1)*b)+a},easeInOutCirc:function(b,a,f,c){b/=c/2;return 1>b?-f/2*(Math.sqrt(1-b*b)-1)+a:f/2*(Math.sqrt(1-(b-=2)*b)+1)+a},easeInElastic:function(b,
a,f,d){var l=0;if(0===b)return a;b/=d;if(1===b)return a+f;l||(l=0.3*d);f=e(f,f,l,1.70158);return-c(f,b,d)+a},easeOutElastic:function(b,a,f,c){var d=0;if(0===b)return a;b/=c;if(1===b)return a+f;d||(d=0.3*c);f=e(f,f,d,1.70158);return f.a*Math.pow(2,-10*b)*Math.sin(2*(b*c-f.s)*Math.PI/f.p)+f.c+a},easeInOutElastic:function(b,a,f,d){var l=0;if(0===b)return a;b/=d/2;if(2===b)return a+f;l||(l=0.3*1.5*d);f=e(f,f,l,1.70158);return 1>b?-0.5*c(f,b,d)+a:0.5*f.a*Math.pow(2,-10*(b-=1))*Math.sin(2*(b*d-f.s)*Math.PI/
f.p)+f.c+a},easeInBack:function(b,a,f,c,d){void 0===d&&(d=1.70158);return f*(b/=c)*b*((d+1)*b-d)+a},easeOutBack:function(b,a,f,c,d){void 0===d&&(d=1.70158);return f*((b=b/c-1)*b*((d+1)*b+d)+1)+a},easeInOutBack:function(b,a,f,c,d){void 0===d&&(d=1.70158);b/=c/2;return 1>b?f/2*b*b*(((d*=1.525)+1)*b-d)+a:f/2*((b-=2)*b*(((d*=1.525)+1)*b+d)+2)+a},easeInBounce:a,easeOutBounce:d,easeInOutBounce:function(b,c,f,h){return b<h/2?0.5*a(2*b,0,f,h)+c:0.5*d(2*b-h,0,f,h)+0.5*f+c}}})();
(function(e){function c(b){return b in x?x[b]:b}function a(b,a,f){"fill"!==b&&"stroke"!==b||"none"!==a?"fillRule"===b?a="evenodd"===a?"destination-over":a:"strokeDashArray"===b?a=a.replace(/,/g," ").split(/\s+/):"transformMatrix"===b&&(a=f&&f.transformMatrix?s(f.transformMatrix,k.parseTransformAttribute(a)):k.parseTransformAttribute(a)):a="";f=(b="[object Array]"===Object.prototype.toString.call(a))?a.map(parseFloat):parseFloat(a);return!b&&isNaN(f)?a:f}function d(b){for(var a in t)if(b[a]&&"undefined"!==
typeof b[t[a]]&&0!==b[a].indexOf("url(")){var f=new k.Color(b[a]);b[a]=f.setAlpha(q(f.getAlpha()*b[t[a]],2)).toRgba();delete b[t[a]]}return b}function b(b,a){var f=b.match(/(normal|italic)?\s*(normal|small-caps)?\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\s*(\d+)px(?:\/(normal|[\d\.]+))?\s+(.*)/);if(f){var c=f[1],d=f[3],g=f[4],h=f[5],f=f[6];c&&(a.fontStyle=c);d&&(a.fontSize=isNaN(parseFloat(d))?d:parseFloat(d));g&&(a.fontSize=parseFloat(g));f&&(a.fontFamily=f);h&&(a.lineHeight=
"normal"===h?1:h)}}function g(f,d){var g,h;f.replace(/;$/,"").split(";").forEach(function(f){f=f.split(":");g=c(f[0].trim().toLowerCase());h=a(g,f[1].trim());"font"===g?b(h,d):d[g]=h})}function f(b){var a=b.nodeName,f=b.getAttribute("class");b=b.getAttribute("id");var c={},d;for(d in k.cssRules)if(f&&RegExp("^\\."+f).test(d)||b&&RegExp("^#"+b).test(d)||RegExp("^"+a).test(d))for(var g in k.cssRules[d])c[g]=k.cssRules[d][g];return c}function h(b){var a=b.objects;b=b.options;a=a.map(function(b){return k[n(b.type)].fromObject(b)});
return{objects:a,options:b}}function l(b,a,f){a[f]&&a[f].toSVG&&b.push('<pattern x="0" y="0" id="',f,'Pattern" ','width="',a[f].source.width,'" height="',a[f].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',a[f].source.width,'" height="',a[f].source.height,'" xlink:href="',a[f].source.src,'"></image></pattern>')}var k=e.fabric||(e.fabric={}),m=k.util.object.extend,n=k.util.string.capitalize,p=k.util.object.clone,q=k.util.toFixed,s=k.util.multiplyTransformMatrices,
x={cx:"left",x:"left",r:"radius",cy:"top",y:"top",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration"},t={stroke:"strokeOpacity",fill:"fillOpacity"};
k.parseTransformAttribute=function(){function b(a,f){var c=f[0];a[0]=Math.cos(c);a[1]=Math.sin(c);a[2]=-Math.sin(c);a[3]=Math.cos(c)}function a(b,f){var c=2===f.length?f[1]:f[0];b[0]=f[0];b[3]=c}function f(b,a){b[4]=a[0];2===a.length&&(b[5]=a[1])}var c=[1,0,0,1,0,0],d=RegExp("^\\s*(?:(?:(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))(?:(?:\\s+,?\\s*|,\\s*)(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))))*)?)\\s*$"),
g=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))",
"g");return function(h){var e=c.concat(),l=[];if(!h||h&&!d.test(h))return e;h.replace(g,function(d){var g=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))").exec(d).filter(function(b){return""!==
b&&null!=b});d=g[1];g=g.slice(2).map(parseFloat);switch(d){case "translate":f(e,g);break;case "rotate":b(e,g);break;case "scale":a(e,g);break;case "skewX":e[2]=g[0];break;case "skewY":e[1]=g[0];break;case "matrix":e=g}l.push(e.concat());e=c.concat()});for(h=l[0];1<l.length;)l.shift(),h=k.util.multiplyTransformMatrices(h,l[0]);return h}}();k.parseSVGDocument=function(){var b=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,a=RegExp("^\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*$");
return function(f,c,d){if(f){var g=new Date,h=k.util.toArray(f.getElementsByTagName("*"));if(0===h.length){for(var h=f.selectNodes('//*[name(.)!="svg"]'),e=[],l=0,m=h.length;l<m;l++)e[l]=h[l];h=e}if((h=h.filter(function(a){var f;if(f=b.test(a.tagName)){a:{for(f=/^(?:pattern|defs)$/;a&&(a=a.parentNode);)if(f.test(a.nodeName)){a=!0;break a}a=!1}f=!a}return f}))&&(!h||h.length)){var e=f.getAttribute("viewBox"),l=f.getAttribute("width"),m=f.getAttribute("height"),n=null,q=null;e&&(e=e.match(a))&&(parseInt(e[1],
10),parseInt(e[2],10),n=parseInt(e[3],10),q=parseInt(e[4],10));var n=l?parseFloat(l):n,q=m?parseFloat(m):q,s={width:n,height:q};k.gradientDefs=k.getGradientDefs(f);k.cssRules=k.getCSSRules(f);k.parseElements(h,function(b){k.documentParsingTime=new Date-g;c&&c(b,s)},p(s),d)}}}}();var w={has:function(b,a){a(!1)},get:function(){},set:function(){}};m(k,{resolveGradients:function(b){for(var a=b.length;a--;){var f=b[a].get("fill");/^url\(/.test(f)&&(f=f.slice(5,f.length-1),k.gradientDefs[f]&&b[a].set("fill",
k.Gradient.fromElement(k.gradientDefs[f],b[a])))}},getGradientDefs:function(b){var a=b.getElementsByTagName("linearGradient");b=b.getElementsByTagName("radialGradient");var f,c,d={};for(c=a.length;c--;)f=a[c],d[f.getAttribute("id")]=f;for(c=b.length;c--;)f=b[c],d[f.getAttribute("id")]=f;return d},parseAttributes:function(b,g){if(b){var h,e={};b.parentNode&&/^g$/i.test(b.parentNode.nodeName)&&(e=k.parseAttributes(b.parentNode,g));var l=g.reduce(function(f,d){if(h=b.getAttribute(d))d=c(d),h=a(d,h,e),
f[d]=h;return f},{}),l=m(l,m(f(b),k.parseStyleAttribute(b)));return d(m(e,l))}},parseElements:function(b,a,f,c){(new k.ElementsParser(b,a,f,c)).parse()},parseStyleAttribute:function(f){var d={};f=f.getAttribute("style");if(!f)return d;if("string"===typeof f)g(f,d);else{var h,e,l;for(l in f)"undefined"!==typeof f[l]&&(h=c(l.toLowerCase()),e=a(h,f[l]),"font"===h?b(e,d):d[h]=e)}return d},parsePointsAttribute:function(b){if(!b)return null;b=b.trim();var a=-1<b.indexOf(",");b=b.split(/\s+/);var f=[],c;
if(a)for(a=0,c=b.length;a<c;a++){var d=b[a].split(",");f.push({x:parseFloat(d[0]),y:parseFloat(d[1])})}else for(a=0,c=b.length;a<c;a+=2)f.push({x:parseFloat(b[a]),y:parseFloat(b[a+1])});return f},getCSSRules:function(b){b=b.getElementsByTagName("style");for(var a={},f,c=0,d=b.length;c<d;c++)f=b[0].textContent,f=f.replace(/\/\*[\s\S]*?\*\//g,""),f=f.match(/[^{]*\{[\s\S]*?\}/g),f=f.map(function(b){return b.trim()}),f.forEach(function(b){var f=b.match(/([\s\S]*?)\s*\{([^}]*)\}/);b=f[1];f=f[2].trim().replace(/;$/,
"").split(/\s*;\s*/);a[b]||(a[b]={});for(var c=0,d=f.length;c<d;c++){var g=f[c].split(/\s*:\s*/);a[b][g[0]]=g[1]}});return a},loadSVGFromURL:function(b,a,f){function c(d){var g=d.responseXML;g&&!g.documentElement&&k.window.ActiveXObject&&d.responseText&&(g=new ActiveXObject("Microsoft.XMLDOM"),g.async="false",g.loadXML(d.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));g&&g.documentElement&&k.parseSVGDocument(g.documentElement,function(f,c){w.set(b,{objects:k.util.array.invoke(f,"toObject"),
options:c});a(f,c)},f)}b=b.replace(/^\n\s*/,"").trim();w.has(b,function(f){f?w.get(b,function(b){b=h(b);a(b.objects,b.options)}):new k.util.request(b,{method:"get",onComplete:c})})},loadSVGFromString:function(b,a,f){b=b.trim();var c;if("undefined"!==typeof DOMParser){var d=new DOMParser;d&&d.parseFromString&&(c=d.parseFromString(b,"text/xml"))}else k.window.ActiveXObject&&(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));k.parseSVGDocument(c.documentElement,
function(b,f){a(b,f)},f)},createSVGFontFacesMarkup:function(b){for(var a="",f=0,c=b.length;f<c;f++)"text"===b[f].type&&b[f].path&&(a+=["@font-face {font-family: ",b[f].fontFamily,"; src: url('",b[f].path,"')}"].join(""));a&&(a=['<style type="text/css"><![CDATA[',a,"]]\x3e</style>"].join(""));return a},createSVGRefElementsMarkup:function(b){var a=[];l(a,b,"backgroundColor");l(a,b,"overlayColor");return a.join("")}})})("undefined"!==typeof exports?exports:this);
fabric.ElementsParser=function(e,c,a,d){this.elements=e;this.callback=c;this.options=a;this.reviver=d};fabric.ElementsParser.prototype.parse=function(){this.instances=Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};fabric.ElementsParser.prototype.createObjects=function(){for(var e=0,c=this.elements.length;e<c;e++)(function(a,c){setTimeout(function(){a.createObject(a.elements[c],c)},0)})(this,e)};
fabric.ElementsParser.prototype.createObject=function(e,c){var a=fabric[fabric.util.string.capitalize(e.tagName)];if(a&&a.fromElement)try{this._createObject(a,e,c)}catch(d){fabric.log(d)}else this.checkIfDone()};fabric.ElementsParser.prototype._createObject=function(e,c,a){e.async?e.fromElement(c,this.createCallback(a,c),this.options):(e=e.fromElement(c,this.options),this.reviver&&this.reviver(c,e),this.instances.splice(a,0,e),this.checkIfDone())};
fabric.ElementsParser.prototype.createCallback=function(e,c){var a=this;return function(d){a.reviver&&a.reviver(c,d);a.instances.splice(e,0,d);a.checkIfDone()}};fabric.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(e){return null!=e}),fabric.resolveGradients(this.instances),this.callback(this.instances))};
(function(e){function c(a,c){this.x=a;this.y=c}e=e.fabric||(e.fabric={});e.Point?e.warn("fabric.Point is already defined"):(e.Point=c,c.prototype={constructor:c,add:function(a){return new c(this.x+a.x,this.y+a.y)},addEquals:function(a){this.x+=a.x;this.y+=a.y;return this},scalarAdd:function(a){return new c(this.x+a,this.y+a)},scalarAddEquals:function(a){this.x+=a;this.y+=a;return this},subtract:function(a){return new c(this.x-a.x,this.y-a.y)},subtractEquals:function(a){this.x-=a.x;this.y-=a.y;return this},
scalarSubtract:function(a){return new c(this.x-a,this.y-a)},scalarSubtractEquals:function(a){this.x-=a;this.y-=a;return this},multiply:function(a){return new c(this.x*a,this.y*a)},multiplyEquals:function(a){this.x*=a;this.y*=a;return this},divide:function(a){return new c(this.x/a,this.y/a)},divideEquals:function(a){this.x/=a;this.y/=a;return this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>
a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(a,d){return new c(this.x+(a.x-this.x)*d,this.y+(a.y-this.y)*d)},distanceFrom:function(a){var c=this.x-a.x;a=this.y-a.y;return Math.sqrt(c*c+a*a)},midPointFrom:function(a){return new c(this.x+(a.x-this.x)/2,this.y+(a.y-this.y)/2)},min:function(a){return new c(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return new c(Math.max(this.x,a.x),Math.max(this.y,a.y))},toString:function(){return this.x+","+this.y},
setXY:function(a,c){this.x=a;this.y=c},setFromPoint:function(a){this.x=a.x;this.y=a.y},swap:function(a){var c=this.x,b=this.y;this.x=a.x;this.y=a.y;a.x=c;a.y=b}})})("undefined"!==typeof exports?exports:this);
(function(e){function c(a){this.status=a;this.points=[]}var a=e.fabric||(e.fabric={});a.Intersection?a.warn("fabric.Intersection is already defined"):(a.Intersection=c,a.Intersection.prototype={appendPoint:function(a){this.points.push(a)},appendPoints:function(a){this.points=this.points.concat(a)}},a.Intersection.intersectLineLine=function(d,b,g,f){var h,e=(f.x-g.x)*(d.y-g.y)-(f.y-g.y)*(d.x-g.x);h=(b.x-d.x)*(d.y-g.y)-(b.y-d.y)*(d.x-g.x);g=(f.y-g.y)*(b.x-d.x)-(f.x-g.x)*(b.y-d.y);0!==g?(e/=g,h/=g,0<=
e&&1>=e&&0<=h&&1>=h?(h=new c("Intersection"),h.points.push(new a.Point(d.x+e*(b.x-d.x),d.y+e*(b.y-d.y)))):h=new c):h=0===e||0===h?new c("Coincident"):new c("Parallel");return h},a.Intersection.intersectLinePolygon=function(a,b,g){for(var f=new c,h=g.length,e=0;e<h;e++){var k=c.intersectLineLine(a,b,g[e],g[(e+1)%h]);f.appendPoints(k.points)}0<f.points.length&&(f.status="Intersection");return f},a.Intersection.intersectPolygonPolygon=function(a,b){for(var g=new c,f=a.length,h=0;h<f;h++){var e=c.intersectLinePolygon(a[h],
a[(h+1)%f],b);g.appendPoints(e.points)}0<g.points.length&&(g.status="Intersection");return g},a.Intersection.intersectPolygonRectangle=function(d,b,g){var f=b.min(g),h=b.max(g);g=new a.Point(h.x,f.y);var e=new a.Point(f.x,h.y);b=c.intersectLinePolygon(f,g,d);g=c.intersectLinePolygon(g,h,d);h=c.intersectLinePolygon(h,e,d);d=c.intersectLinePolygon(e,f,d);f=new c;f.appendPoints(b.points);f.appendPoints(g.points);f.appendPoints(h.points);f.appendPoints(d.points);0<f.points.length&&(f.status="Intersection");
return f})})("undefined"!==typeof exports?exports:this);
(function(e){function c(b){b?this._tryParsingColor(b):this.setSource([0,0,0,1])}function a(b,a,f){0>f&&(f+=1);1<f&&(f-=1);return f<1/6?b+6*(a-b)*f:0.5>f?a:f<2/3?b+6*(a-b)*(2/3-f):b}var d=e.fabric||(e.fabric={});d.Color?d.warn("fabric.Color is already defined."):(d.Color=c,d.Color.prototype={_tryParsingColor:function(b){var a;b in c.colorNameMap&&(b=c.colorNameMap[b]);(a=c.sourceFromHex(b))||(a=c.sourceFromRgb(b));a||(a=c.sourceFromHsl(b));a&&this.setSource(a)},_rgbToHsl:function(b,a,f){b/=255;a/=
255;f/=255;var c,e,k,m=d.util.array.max([b,a,f]);e=d.util.array.min([b,a,f]);k=(m+e)/2;if(m===e)c=e=0;else{var n=m-e;e=0.5<k?n/(2-m-e):n/(m+e);switch(m){case b:c=(a-f)/n+(a<f?6:0);break;case a:c=(f-b)/n+2;break;case f:c=(b-a)/n+4}c/=6}return[Math.round(360*c),Math.round(100*e),Math.round(100*k)]},getSource:function(){return this._source},setSource:function(b){this._source=b},toRgb:function(){var b=this.getSource();return"rgb("+b[0]+","+b[1]+","+b[2]+")"},toRgba:function(){var b=this.getSource();return"rgba("+
b[0]+","+b[1]+","+b[2]+","+b[3]+")"},toHsl:function(){var b=this.getSource(),b=this._rgbToHsl(b[0],b[1],b[2]);return"hsl("+b[0]+","+b[1]+"%,"+b[2]+"%)"},toHsla:function(){var b=this.getSource(),a=this._rgbToHsl(b[0],b[1],b[2]);return"hsla("+a[0]+","+a[1]+"%,"+a[2]+"%,"+b[3]+")"},toHex:function(){var b=this.getSource(),a,f;a=b[0].toString(16);a=1===a.length?"0"+a:a;f=b[1].toString(16);f=1===f.length?"0"+f:f;b=b[2].toString(16);b=1===b.length?"0"+b:b;return a.toUpperCase()+f.toUpperCase()+b.toUpperCase()},
getAlpha:function(){return this.getSource()[3]},setAlpha:function(b){var a=this.getSource();a[3]=b;this.setSource(a);return this},toGrayscale:function(){var b=this.getSource(),a=parseInt((0.3*b[0]+0.59*b[1]+0.11*b[2]).toFixed(0),10);this.setSource([a,a,a,b[3]]);return this},toBlackWhite:function(b){var a=this.getSource(),f=(0.3*a[0]+0.59*a[1]+0.11*a[2]).toFixed(0),a=a[3],f=Number(f)<Number(b||127)?0:255;this.setSource([f,f,f,a]);return this},overlayWith:function(b){b instanceof c||(b=new c(b));var a=
[],f=this.getAlpha(),d=this.getSource();b=b.getSource();for(var e=0;3>e;e++)a.push(Math.round(0.5*d[e]+0.5*b[e]));a[3]=f;this.setSource(a);return this}},d.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,d.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,d.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,d.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",
blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},d.Color.fromRgb=function(b){return c.fromSource(c.sourceFromRgb(b))},d.Color.sourceFromRgb=function(b){if(b=b.match(c.reRGBa)){var a=parseInt(b[1],10)/(/%$/.test(b[1])?100:1)*(/%$/.test(b[1])?255:1),f=parseInt(b[2],10)/(/%$/.test(b[2])?100:1)*(/%$/.test(b[2])?
255:1),d=parseInt(b[3],10)/(/%$/.test(b[3])?100:1)*(/%$/.test(b[3])?255:1);return[parseInt(a,10),parseInt(f,10),parseInt(d,10),b[4]?parseFloat(b[4]):1]}},d.Color.fromRgba=c.fromRgb,d.Color.fromHsl=function(b){return c.fromSource(c.sourceFromHsl(b))},d.Color.sourceFromHsl=function(b){if(b=b.match(c.reHSLa)){var d=(parseFloat(b[1])%360+360)%360/360,f=parseFloat(b[2])/(/%$/.test(b[2])?100:1),h=parseFloat(b[3])/(/%$/.test(b[3])?100:1);if(0===f)h=f=d=h;else var e=0.5>=h?h*(f+1):h+f-h*f,k=2*h-e,h=a(k,e,
d+1/3),f=a(k,e,d),d=a(k,e,d-1/3);return[Math.round(255*h),Math.round(255*f),Math.round(255*d),b[4]?parseFloat(b[4]):1]}},d.Color.fromHsla=c.fromHsl,d.Color.fromHex=function(b){return c.fromSource(c.sourceFromHex(b))},d.Color.sourceFromHex=function(b){if(b.match(c.reHex)){var a=b.slice(b.indexOf("#")+1),f=3===a.length;b=f?a.charAt(0)+a.charAt(0):a.substring(0,2);var d=f?a.charAt(1)+a.charAt(1):a.substring(2,4),a=f?a.charAt(2)+a.charAt(2):a.substring(4,6);return[parseInt(b,16),parseInt(d,16),parseInt(a,
16),1]}},d.Color.fromSource=function(b){var a=new c;a.setSource(b);return a})})("undefined"!==typeof exports?exports:this);
(function(){function e(b){var a=b.getAttribute("style"),f=b.getAttribute("offset"),c,d,f=parseFloat(f)/(/%$/.test(f)?100:1);if(a){a=a.split(/\s*;\s*/);""===a[a.length-1]&&a.pop();for(var e=a.length;e--;){var m=a[e].split(/\s*:\s*/),n=m[0].trim(),m=m[1].trim();"stop-color"===n?c=m:"stop-opacity"===n&&(d=m)}}c||(c=b.getAttribute("stop-color")||"rgb(0,0,0)");d||(d=b.getAttribute("stop-opacity"));c=(new fabric.Color(c)).toRgb();return{offset:f,color:c,opacity:isNaN(parseFloat(d))?1:parseFloat(d)}}function c(b,
c){for(var f in c){if("string"===typeof c[f]&&/^\d+%$/.test(c[f])){var d=parseFloat(c[f],10);if("x1"===f||"x2"===f||"r2"===f)c[f]=fabric.util.toFixed(b.width*d/100,2);else if("y1"===f||"y2"===f)c[f]=fabric.util.toFixed(b.height*d/100,2)}a(c,f,b)}}function a(b,a,f){if("x1"===a||"x2"===a)b[a]-=fabric.util.toFixed(f.width/2,2);else if("y1"===a||"y2"===a)b[a]-=fabric.util.toFixed(f.height/2,2)}function d(b,c){for(var f in c)if(a(c,f,b),"x1"===f||"x2"===f||"r2"===f)c[f]=fabric.util.toFixed(100*(c[f]/b.width),
2)+"%";else if("y1"===f||"y2"===f)c[f]=fabric.util.toFixed(100*(c[f]/b.height),2)+"%"}fabric.Gradient=fabric.util.createClass({initialize:function(b){b||(b={});var a={};this.id=fabric.Object.__uid++;this.type=b.type||"linear";a={x1:b.coords.x1||0,y1:b.coords.y1||0,x2:b.coords.x2||0,y2:b.coords.y2||0};"radial"===this.type&&(a.r1=b.coords.r1||0,a.r2=b.coords.r2||0);this.coords=a;this.gradientUnits=b.gradientUnits||"objectBoundingBox";this.colorStops=b.colorStops.slice()},addColorStop:function(b){for(var a in b){var f=
new fabric.Color(b[a]);this.colorStops.push({offset:a,color:f.toRgb(),opacity:f.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toSVG:function(b,a){var f=fabric.util.object.clone(this.coords),c;this.colorStops.sort(function(b,a){return b.offset-a.offset});a&&"userSpaceOnUse"===this.gradientUnits?(f.x1+=b.width/2,f.y1+=b.height/2,f.x2+=b.width/2,f.y2+=b.height/2):"objectBoundingBox"===this.gradientUnits&&
d(b,f);"linear"===this.type?c=["<linearGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" x1="',f.x1,'" y1="',f.y1,'" x2="',f.x2,'" y2="',f.y2,'">']:"radial"===this.type&&(c=["<radialGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" cx="',f.x2,'" cy="',f.y2,'" r="',f.r2,'" fx="',f.x1,'" fy="',f.y1,'">']);for(f=0;f<this.colorStops.length;f++)c.push("<stop ",'offset="',100*this.colorStops[f].offset+"%",'" style="stop-color:',this.colorStops[f].color,this.colorStops[f].opacity?
";stop-opacity: "+this.colorStops[f].opacity:";",'"/>');c.push("linear"===this.type?"</linearGradient>":"</radialGradient>");return c.join("")},toLive:function(b){var a;if(this.type){"linear"===this.type?a=b.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2,this.coords.y2):"radial"===this.type&&(a=b.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2));b=0;for(var f=this.colorStops.length;b<f;b++){var c=this.colorStops[b].color,
d=this.colorStops[b].opacity,e=this.colorStops[b].offset;"undefined"!==typeof d&&(c=(new fabric.Color(c)).setAlpha(d).toRgba());a.addColorStop(parseFloat(e),c)}return a}}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(b,a){var f=b.getElementsByTagName("stop"),d="linearGradient"===b.nodeName?"linear":"radial",l=b.getAttribute("gradientUnits")||"objectBoundingBox",k=[],m={};"linear"===d?m={x1:b.getAttribute("x1")||0,y1:b.getAttribute("y1")||0,x2:b.getAttribute("x2")||"100%",y2:b.getAttribute("y2")||
0}:"radial"===d&&(m={x1:b.getAttribute("fx")||b.getAttribute("cx")||"50%",y1:b.getAttribute("fy")||b.getAttribute("cy")||"50%",r1:0,x2:b.getAttribute("cx")||"50%",y2:b.getAttribute("cy")||"50%",r2:b.getAttribute("r")||"50%"});for(var n=f.length;n--;)k.push(e(f[n]));c(a,m);return new fabric.Gradient({type:d,coords:m,gradientUnits:l,colorStops:k})},forObject:function(b,a){a||(a={});c(b,a);return new fabric.Gradient(a)}})})();
fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(e){e||(e={});this.id=fabric.Object.__uid++;if(e.source)if("string"===typeof e.source)if("undefined"!==typeof fabric.util.getFunctionBody(e.source))this.source=new Function(fabric.util.getFunctionBody(e.source));else{var c=this;this.source=fabric.util.createImage();fabric.util.loadImage(e.source,function(a){c.source=a})}else this.source=e.source;e.repeat&&(this.repeat=e.repeat);e.offsetX&&(this.offsetX=
e.offsetX);e.offsetY&&(this.offsetY=e.offsetY)},toObject:function(){var e;"function"===typeof this.source?e=String(this.source):"string"===typeof this.source.src&&(e=this.source.src);return{source:e,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(e){var c="function"===typeof this.source?this.source():this.source,a=c.width/e.getWidth();e=c.height/e.getHeight();var d="";c.src?d=c.src:c.toDataURL&&(d=c.toDataURL());return'<pattern id="SVGID_'+this.id+'" x="'+this.offsetX+
'" y="'+this.offsetY+'" width="'+a+'" height="'+e+'"><image x="0" y="0" width="'+c.width+'" height="'+c.height+'" xlink:href="'+d+'"></image></pattern>'},toLive:function(e){var c="function"===typeof this.source?this.source():this.source;return c&&("undefined"===typeof c.src||c.complete&&0!==c.naturalWidth&&0!==c.naturalHeight)?e.createPattern(c,this.repeat):""}});
(function(e){var c=e.fabric||(e.fabric={});c.Shadow?c.warn("fabric.Shadow is already defined."):(c.Shadow=c.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(a){"string"===typeof a&&(a=this._parseShadow(a));for(var d in a)this[d]=a[d];this.id=c.Object.__uid++},_parseShadow:function(a){a=a.trim();var d=c.Shadow.reOffsetsAndBlur.exec(a)||[];return{color:(a.replace(c.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(d[1],
10)||0,offsetY:parseInt(d[2],10)||0,blur:parseInt(d[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(a){var c="SourceAlpha";!a||a.fill!==this.color&&a.stroke!==this.color||(c="SourceGraphic");return'<filter id="SVGID_'+this.id+'" y="-40%" height="180%"><feGaussianBlur in="'+c+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"></feGaussianBlur><feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset><feMerge><feMergeNode></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>'},
toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var a={},d=c.Shadow.prototype;this.color!==d.color&&(a.color=this.color);this.blur!==d.blur&&(a.blur=this.blur);this.offsetX!==d.offsetX&&(a.offsetX=this.offsetX);this.offsetY!==d.offsetY&&(a.offsetY=this.offsetY);return a}}),c.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)})("undefined"!==typeof exports?
exports:this);
(function(){if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var e=fabric.util.object.extend,c=fabric.util.getElementOffset,a=fabric.util.removeFromArray,d=Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(b,a){a||(a={});this._initStatic(b,a);fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,
clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,onBeforeScaleRotate:function(){},_initStatic:function(b,a){this._objects=[];this._createLowerCanvas(b);this._initOptions(a);a.overlayImage&&this.setOverlayImage(a.overlayImage,this.renderAll.bind(this));a.backgroundImage&&this.setBackgroundImage(a.backgroundImage,this.renderAll.bind(this));a.backgroundColor&&this.setBackgroundColor(a.backgroundColor,this.renderAll.bind(this));a.overlayColor&&this.setOverlayColor(a.overlayColor,this.renderAll.bind(this));
this.calcOffset()},calcOffset:function(){this._offset=c(this.lowerCanvasEl);return this},setOverlayImage:function(b,a,f){return this.__setBgOverlayImage("overlayImage",b,a,f)},setBackgroundImage:function(b,a,f){return this.__setBgOverlayImage("backgroundImage",b,a,f)},setOverlayColor:function(b,a){return this.__setBgOverlayColor("overlayColor",b,a)},setBackgroundColor:function(b,a){return this.__setBgOverlayColor("backgroundColor",b,a)},__setBgOverlayImage:function(b,a,f,c){"string"===typeof a?fabric.util.loadImage(a,
function(a){this[b]=new fabric.Image(a,c);f&&f()},this):(this[b]=a,f&&f());return this},__setBgOverlayColor:function(b,a,f){if(a.source){var c=this;fabric.util.loadImage(a.source,function(d){c[b]=new fabric.Pattern({source:d,repeat:a.repeat,offsetX:a.offsetX,offsetY:a.offsetY});f&&f()})}else this[b]=a,f&&f();return this},_createCanvasElement:function(){var b=fabric.document.createElement("canvas");b.style||(b.style={});if(!b)throw d;this._initCanvasElement(b);return b},_initCanvasElement:function(b){fabric.util.createCanvasElement(b);
if("undefined"===typeof b.getContext)throw d;},_initOptions:function(b){for(var a in b)this[a]=b[a];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px")},_createLowerCanvas:function(b){this.lowerCanvasEl=fabric.util.getById(b)||
this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(b){return this._setDimension("width",b)},setHeight:function(b){return this._setDimension("height",b)},setDimensions:function(b){for(var a in b)this._setDimension(a,
b[a]);return this},_setDimension:function(b,a){this.lowerCanvasEl[b]=a;this.lowerCanvasEl.style[b]=a+"px";this.upperCanvasEl&&(this.upperCanvasEl[b]=a,this.upperCanvasEl.style[b]=a+"px");this.cacheCanvasEl&&(this.cacheCanvasEl[b]=a);this.wrapperEl&&(this.wrapperEl.style[b]=a+"px");this[b]=a;this.calcOffset();this.renderAll();return this},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(b,a){if(a)if(this.controlsAboveOverlay){var f=
a.hasBorders,c=a.hasControls;a.hasBorders=a.hasControls=!1;a.render(b);a.hasBorders=f;a.hasControls=c}else a.render(b)},_onObjectAdded:function(b){this.stateful&&b.setupState();b.setCoords();b.canvas=this;this.fire("object:added",{target:b});b.fire("added")},_onObjectRemoved:function(b){this.getActiveObject()===b&&(this.fire("before:selection:cleared",{target:b}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",{target:b});b.fire("removed")},clearContext:function(b){b.clearRect(0,
0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.discardActiveGroup&&this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(b){var a=this[!0===b&&this.interactive?"contextTop":"contextContainer"],f=this.getActiveGroup();
this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);b||this.clearContext(a);this.fire("before:render");this.clipTo&&fabric.util.clipContext(this,a);this._renderBackground(a);this._renderObjects(a,f);this._renderActiveGroup(a,f);this.clipTo&&a.restore();this._renderOverlay(a);this.controlsAboveOverlay&&this.interactive&&this.drawControls(a);this.fire("after:render");return this},_renderObjects:function(b,a){var f,c;if(a)for(f=0,c=this._objects.length;f<c;++f)this._objects[f]&&
!a.contains(this._objects[f])&&this._draw(b,this._objects[f]);else for(f=0,c=this._objects.length;f<c;++f)this._draw(b,this._objects[f])},_renderActiveGroup:function(b,a){if(a){var f=[];this.forEachObject(function(b){a.contains(b)&&f.push(b)});a._set("objects",f);this._draw(b,a)}},_renderBackground:function(b){this.backgroundColor&&(b.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(b):this.backgroundColor,b.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,
this.width,this.height));this.backgroundImage&&this.backgroundImage.render(b)},_renderOverlay:function(b){this.overlayColor&&(b.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(b):this.overlayColor,b.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height));this.overlayImage&&this.overlayImage.render(b)},renderTop:function(){var b=this.contextTop||this.contextContainer;this.clearContext(b);this.selection&&this._groupSelector&&this._drawSelection();var a=
this.getActiveGroup();a&&a.render(b);this._renderOverlay(b);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(b){this._centerObject(b,new fabric.Point(this.getCenter().left,b.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(b){this._centerObject(b,new fabric.Point(b.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},centerObject:function(b){var a=this.getCenter();this._centerObject(b,
new fabric.Point(a.left,a.top));this.renderAll();return this},_centerObject:function(b,a){b.setPositionByOrigin(a,"center","center");return this},toDatalessJSON:function(b){return this.toDatalessObject(b)},toObject:function(b){return this._toObjectMethod("toObject",b)},toDatalessObject:function(b){return this._toObjectMethod("toDatalessObject",b)},_toObjectMethod:function(b,a){var f=this.getActiveGroup();f&&this.discardActiveGroup();var c={objects:this._toObjects(b,a)};e(c,this.__serializeBgOverlay());
fabric.util.populateWithProperties(this,c,a);f&&(this.setActiveGroup(new fabric.Group(f.getObjects(),{originX:"center",originY:"center"})),f.forEachObject(function(b){b.set("active",!0)}));this._currentTransform&&(this._currentTransform.target=this.getActiveGroup());return c},_toObjects:function(b,a){return this.getObjects().map(function(f){return this._toObject(f,b,a)},this)},_toObject:function(b,a,f){var c;this.includeDefaultValues||(c=b.includeDefaultValues,b.includeDefaultValues=!1);a=b[a](f);
this.includeDefaultValues||(b.includeDefaultValues=c);return a},__serializeBgOverlay:function(){var b={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};this.overlayColor&&(b.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor);this.backgroundImage&&(b.backgroundImage=this.backgroundImage.toObject());this.overlayImage&&(b.overlayImage=this.overlayImage.toObject());return b},toSVG:function(b,a){b||(b={});
var f=[];this._setSVGPreamble(f,b);this._setSVGHeader(f,b);this._setSVGBgOverlayColor(f,"backgroundColor");this._setSVGBgOverlayImage(f,"backgroundImage");this._setSVGObjects(f,a);this._setSVGBgOverlayColor(f,"overlayColor");this._setSVGBgOverlayImage(f,"overlayImage");f.push("</svg>");return f.join("")},_setSVGPreamble:function(b,a){a.suppressPreamble||b.push('<?xml version="1.0" encoding="',a.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},
_setSVGHeader:function(b,a){b.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',a.viewBox?a.viewBox.width:this.width,'" ','height="',a.viewBox?a.viewBox.height:this.height,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,a.viewBox?'viewBox="'+a.viewBox.x+" "+a.viewBox.y+" "+a.viewBox.width+" "+a.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",
fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(b,a){var f=this.getActiveGroup();f&&this.discardActiveGroup();for(var c=0,d=this.getObjects(),e=d.length;c<e;c++)b.push(d[c].toSVG(a));f&&(this.setActiveGroup(new fabric.Group(f.getObjects())),f.forEachObject(function(b){b.set("active",!0)}))},_setSVGBgOverlayImage:function(b,a){this[a]&&this[a].toSVG&&b.push(this[a].toSVG())},_setSVGBgOverlayColor:function(b,
a){this[a]&&this[a].source?b.push('<rect x="',this[a].offsetX,'" y="',this[a].offsetY,'" ','width="',"repeat-y"===this[a].repeat||"no-repeat"===this[a].repeat?this[a].source.width:this.width,'" height="',"repeat-x"===this[a].repeat||"no-repeat"===this[a].repeat?this[a].source.height:this.height,'" fill="url(#'+a+'Pattern)"',"></rect>"):this[a]&&"overlayColor"===a&&b.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[a],'"',"></rect>")},sendToBack:function(b){a(this._objects,
b);this._objects.unshift(b);return this.renderAll&&this.renderAll()},bringToFront:function(b){a(this._objects,b);this._objects.push(b);return this.renderAll&&this.renderAll()},sendBackwards:function(b,c){var f=this._objects.indexOf(b);0!==f&&(f=this._findNewLowerIndex(b,f,c),a(this._objects,b),this._objects.splice(f,0,b),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(b,a,f){if(f)for(f=a,a-=1;0<=a;--a){if(b.intersectsWithObject(this._objects[a])||b.isContainedWithinObject(this._objects[a])||
this._objects[a].isContainedWithinObject(b)){f=a;break}}else f=a-1;return f},bringForward:function(b,c){var f=this._objects.indexOf(b);f!==this._objects.length-1&&(f=this._findNewUpperIndex(b,f,c),a(this._objects,b),this._objects.splice(f,0,b),this.renderAll&&this.renderAll());return this},_findNewUpperIndex:function(b,a,f){if(f)for(f=a,a+=1;a<this._objects.length;++a){if(b.intersectsWithObject(this._objects[a])||b.isContainedWithinObject(this._objects[a])||this._objects[a].isContainedWithinObject(b)){f=
a;break}}else f=a+1;return f},moveTo:function(b,c){a(this._objects,b);this._objects.splice(c,0,b);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});e(fabric.StaticCanvas.prototype,fabric.Observable);e(fabric.StaticCanvas.prototype,fabric.Collection);e(fabric.StaticCanvas.prototype,fabric.DataURLExporter);e(fabric.StaticCanvas,
{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(b){var a=fabric.util.createCanvasElement();if(!a||!a.getContext)return null;var f=a.getContext("2d");if(!f)return null;switch(b){case "getImageData":return"undefined"!==typeof f.getImageData;case "setLineDash":return"undefined"!==typeof f.setLineDash;case "toDataURL":return"undefined"!==typeof a.toDataURL;case "toDataURLWithQuality":try{return a.toDataURL("image/jpeg",0),!0}catch(c){}return!1;default:return null}}});fabric.StaticCanvas.prototype.toJSON=
fabric.StaticCanvas.prototype.toObject}})();
fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(e){this.shadow=new fabric.Shadow(e);return this},_setBrushStyles:function(){var e=this.canvas.contextTop;e.strokeStyle=this.color;e.lineWidth=this.width;e.lineCap=this.strokeLineCap;e.lineJoin=this.strokeLineJoin},_setShadow:function(){if(this.shadow){var e=this.canvas.contextTop;e.shadowColor=this.shadow.color;e.shadowBlur=this.shadow.blur;e.shadowOffsetX=
this.shadow.offsetX;e.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="";e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0}});
(function(){var e=fabric.util.array.min,c=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(a){this.canvas=a;this._points=[]},onMouseDown:function(a){this._prepareForDrawing(a);this._captureDrawingPath(a);this._render()},onMouseMove:function(a){this._captureDrawingPath(a);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(a){a=new fabric.Point(a.x,a.y);this._reset();
this._addPoint(a);this.canvas.contextTop.moveTo(a.x,a.y)},_addPoint:function(a){this._points.push(a)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(a){a=new fabric.Point(a.x,a.y);this._addPoint(a)},_render:function(){var a=this.canvas.contextTop;a.beginPath();var c=this._points[0],b=this._points[1];2===this._points.length&&c.x===b.x&&c.y===b.y&&(c.x-=0.5,b.x+=0.5);a.moveTo(c.x,c.y);for(var e=1,f=this._points.length;e<f;e++)b=c.midPointFrom(b),
a.quadraticCurveTo(c.x,c.y,b.x,b.y),c=this._points[e],b=this._points[e+1];a.lineTo(c.x,c.y);a.stroke()},_getSVGPathData:function(){this.box=this.getPathBoundingBox(this._points);return this.convertPointsToSVGPath(this._points,this.box.minx,this.box.maxx,this.box.miny,this.box.maxy)},getPathBoundingBox:function(a){for(var d=[],b=[],g=a[0],f=a[1],h=g,l=1,k=a.length;l<k;l++){var m=g.midPointFrom(f);d.push(h.x);d.push(m.x);b.push(h.y);b.push(m.y);g=a[l];f=a[l+1];h=m}d.push(g.x);b.push(g.y);return{minx:e(d),
miny:e(b),maxx:c(d),maxy:c(b)}},convertPointsToSVGPath:function(a,c,b,e){b=[];var f=new fabric.Point(a[0].x-c,a[0].y-e),h=new fabric.Point(a[1].x-c,a[1].y-e);b.push("M ",a[0].x-c," ",a[0].y-e," ");for(var l=1,k=a.length;l<k;l++){var m=f.midPointFrom(h);b.push("Q ",f.x," ",f.y," ",m.x," ",m.y," ");f=new fabric.Point(a[l].x-c,a[l].y-e);l+1<a.length&&(h=new fabric.Point(a[l+1].x-c,a[l+1].y-e))}b.push("L ",f.x," ",f.y," ");return b},createPath:function(a){a=new fabric.Path(a);a.fill=null;a.stroke=this.color;
a.strokeWidth=this.width;a.strokeLineCap=this.strokeLineCap;a.strokeLineJoin=this.strokeLineJoin;this.shadow&&(this.shadow.affectStroke=!0,a.setShadow(this.shadow));return a},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var a=this._getSVGPathData().join("");if("M 0 0 Q 0 0 0 0 L 0 0"===a)this.canvas.renderAll();else{var c=this.box.minx+(this.box.maxx-this.box.minx)/2,b=this.box.miny+(this.box.maxy-this.box.miny)/2;this.canvas.contextTop.arc(c,b,3,0,2*Math.PI,!1);a=this.createPath(a);
a.set({left:c,top:b,originX:"center",originY:"center"});this.canvas.add(a);a.setCoords();this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderAll();this.canvas.fire("path:created",{path:a})}}})})();
fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(e){this.canvas=e;this.points=[]},drawDot:function(e){e=this.addPoint(e);var c=this.canvas.contextTop;c.fillStyle=e.fill;c.beginPath();c.arc(e.x,e.y,e.radius,0,2*Math.PI,!1);c.closePath();c.fill()},onMouseDown:function(e){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(e)},onMouseMove:function(e){this.drawDot(e)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;
this.canvas.renderOnAddRemove=!1;for(var c=[],a=0,d=this.points.length;a<d;a++){var b=this.points[a],b=new fabric.Circle({radius:b.radius,left:b.x,top:b.y,originX:"center",originY:"center",fill:b.fill});this.shadow&&b.setShadow(this.shadow);c.push(b)}c=new fabric.Group(c,{originX:"center",originY:"center"});this.canvas.add(c);this.canvas.fire("path:created",{path:c});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},addPoint:function(e){e=
new fabric.Point(e.x,e.y);var c=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,a=(new fabric.Color(this.color)).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();e.radius=c;e.fill=a;this.points.push(e);return e}});
fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e;this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(e);this.render()},onMouseMove:function(e){this.addSprayChunk(e);this.render()},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=
!1;for(var c=[],a=0,d=this.sprayChunks.length;a<d;a++)for(var b=this.sprayChunks[a],g=0,f=b.length;g<f;g++){var h=new fabric.Rect({width:b[g].width,height:b[g].width,left:b[g].x+1,top:b[g].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&h.setShadow(this.shadow);c.push(h)}this.optimizeOverlapping&&(c=this._getOptimizedRects(c));c=new fabric.Group(c,{originX:"center",originY:"center"});this.canvas.add(c);this.canvas.fire("path:created",{path:c});this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},_getOptimizedRects:function(e){for(var c={},a,d=0,b=e.length;d<b;d++)a=e[d].left+""+e[d].top,c[a]||(c[a]=e[d]);e=[];for(a in c)e.push(c[a]);return e},render:function(){var e=this.canvas.contextTop;e.fillStyle=this.color;e.save();for(var c=0,a=this.sprayChunkPoints.length;c<a;c++){var d=this.sprayChunkPoints[c];"undefined"!==typeof d.opacity&&(e.globalAlpha=d.opacity);e.fillRect(d.x,d.y,d.width,d.width)}e.restore()},addSprayChunk:function(e){this.sprayChunkPoints=
[];for(var c,a,d,b=this.width/2,g=0;g<this.density;g++)c=fabric.util.getRandomInt(e.x-b,e.x+b),a=fabric.util.getRandomInt(e.y-b,e.y+b),d=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,c={x:c,y:a,width:d},this.randomOpacity&&(c.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(c);this.sprayChunks.push(this.sprayChunkPoints)}});
fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var e=fabric.document.createElement("canvas"),c=e.getContext("2d");e.width=e.height=25;c.fillStyle=this.color;c.beginPath();c.arc(10,10,10,0,2*Math.PI,!1);c.closePath();c.fill();return e},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");
this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(e){e=this.callSuper("createPath",e);e.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()});return e}});
(function(){var e=fabric.util.getPointer,c=fabric.util.degreesToRadians,a=fabric.util.radiansToDegrees,d=Math.atan2,b=Math.abs;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(b,a){a||(a={});this._initStatic(b,a);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",
selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(b){var a=
this._currentTransform;a.target.set({scaleX:a.original.scaleX,scaleY:a.original.scaleY,left:a.original.left,top:a.original.top});this._shouldCenterTransform(b,a.target)?"rotate"===a.action?this._setOriginToCenter(a.target):("center"!==a.originX&&(a.mouseXSign="right"===a.originX?-1:1),"center"!==a.originY&&(a.mouseYSign="bottom"===a.originY?-1:1),a.originX="center",a.originY="center"):(a.originX=a.original.originX,a.originY=a.original.originY)},containsPoint:function(a,b){var c=this.getPointer(a),
d=this._normalizePointer(b,c);return b.containsPoint(d)||b._findTargetCorner(c)},_normalizePointer:function(a,b){var c=this.getActiveGroup(),d=b.x,e=b.y;c&&"group"!==a.type&&c.contains(a)&&(d-=c.left,e-=c.top);return{x:d,y:e}},isTargetTransparent:function(a,b,c){var d=a.hasBorders,e=a.transparentCorners;a.hasBorders=a.transparentCorners=!1;this._draw(this.contextCache,a);a.hasBorders=d;a.transparentCorners=e;a=fabric.util.isTransparent(this.contextCache,b,c,this.targetFindTolerance);this.clearContext(this.contextCache);
return a},_shouldClearSelection:function(a,b){var c=this.getActiveGroup(),d=this.getActiveObject();return!b||b&&c&&!c.contains(b)&&c!==b&&!a.shiftKey||b&&!b.evented||b&&!b.selectable&&d&&d!==b},_shouldCenterTransform:function(a,b){if(b){var c=this._currentTransform,d;"scale"===c.action||"scaleX"===c.action||"scaleY"===c.action?d=this.centeredScaling||b.centeredScaling:"rotate"===c.action&&(d=this.centeredRotation||b.centeredRotation);return d?!a.altKey:a.altKey}},_getOriginFromCorner:function(a,b){var c=
{x:a.originX,y:a.originY};if("ml"===b||"tl"===b||"bl"===b)c.x="right";else if("mr"===b||"tr"===b||"br"===b)c.x="left";if("tl"===b||"mt"===b||"tr"===b)c.y="bottom";else if("bl"===b||"mb"===b||"br"===b)c.y="top";return c},_getActionFromCorner:function(b,a){var c="drag";a&&(c="ml"===a||"mr"===a?"scaleX":"mt"===a||"mb"===a?"scaleY":"mtr"===a?"rotate":"scale");return c},_setupCurrentTransform:function(a,b){if(b){var d=this.getPointer(a),e=b._findTargetCorner(d),g=this._getActionFromCorner(b,e),e=this._getOriginFromCorner(b,
e);this._currentTransform={target:b,action:g,scaleX:b.scaleX,scaleY:b.scaleY,offsetX:d.x-b.left,offsetY:d.y-b.top,originX:e.x,originY:e.y,ex:d.x,ey:d.y,left:b.left,top:b.top,theta:c(b.angle),width:b.width*b.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:b.left,top:b.top,scaleX:b.scaleX,scaleY:b.scaleY,originX:e.x,originY:e.y};this._resetCurrentTransform(a)}},_translateObject:function(b,a){var c=this._currentTransform.target;c.get("lockMovementX")||c.set("left",b-this._currentTransform.offsetX);
c.get("lockMovementY")||c.set("top",a-this._currentTransform.offsetY)},_scaleObject:function(b,a,c){var d=this._currentTransform,e=d.target,g=e.get("lockScalingX"),p=e.get("lockScalingY");if(!g||!p){var q=e.translateToOriginPoint(e.getCenterPoint(),d.originX,d.originY);b=e.toLocalPoint(new fabric.Point(b,a),d.originX,d.originY);this._setLocalMouse(b,d);this._setObjectScale(b,d,g,p,c);e.setPositionByOrigin(q,d.originX,d.originY)}},_setObjectScale:function(b,a,c,d,e){var g=a.target;a.newScaleX=g.scaleX;
a.newScaleY=g.scaleY;"equally"!==e||c||d?e?"x"!==e||g.get("lockUniScaling")?"y"!==e||g.get("lockUniScaling")||(a.newScaleY=b.y/(g.height+g.strokeWidth),d||g.set("scaleY",a.newScaleY)):(a.newScaleX=b.x/(g.width+g.strokeWidth),c||g.set("scaleX",a.newScaleX)):(a.newScaleX=b.x/(g.width+g.strokeWidth),a.newScaleY=b.y/(g.height+g.strokeWidth),c||g.set("scaleX",a.newScaleX),d||g.set("scaleY",a.newScaleY)):this._scaleObjectEqually(b,g,a);this._flipObject(a)},_scaleObjectEqually:function(b,a,c){b=b.y+b.x;
var d=(a.height+a.strokeWidth)*c.original.scaleY+(a.width+a.strokeWidth)*c.original.scaleX;c.newScaleX=c.original.scaleX*b/d;c.newScaleY=c.original.scaleY*b/d;a.set("scaleX",c.newScaleX);a.set("scaleY",c.newScaleY)},_flipObject:function(b){0>b.newScaleX&&("left"===b.originX?b.originX="right":"right"===b.originX&&(b.originX="left"));0>b.newScaleY&&("top"===b.originY?b.originY="bottom":"bottom"===b.originY&&(b.originY="top"))},_setLocalMouse:function(a,c){var d=c.target;"right"===c.originX?a.x*=-1:
"center"===c.originX&&(a.x=2*a.x*c.mouseXSign,0>a.x&&(c.mouseXSign=-c.mouseXSign));"bottom"===c.originY?a.y*=-1:"center"===c.originY&&(a.y=2*a.y*c.mouseYSign,0>a.y&&(c.mouseYSign=-c.mouseYSign));b(a.x)>d.padding?a.x=0>a.x?a.x+d.padding:a.x-d.padding:a.x=0;b(a.y)>d.padding?a.y=0>a.y?a.y+d.padding:a.y-d.padding:a.y=0},_rotateObject:function(b,c){var e=this._currentTransform;if(!e.target.get("lockRotation")){var g=d(e.ey-e.top,e.ex-e.left),m=d(c-e.top,b-e.left),g=a(m-g+e.theta);0>g&&(g=360+g);e.target.angle=
g}},_setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=1;a.scaleY=1;a.setAngle(0)},_drawSelection:function(){var a=this.contextTop,c=this._groupSelector,d=c.left,e=c.top,g=b(d),n=b(e);a.fillStyle=this.selectionColor;a.fillRect(c.ex-(0<d?0:-d),c.ey-(0<e?0:-e),g,n);a.lineWidth=this.selectionLineWidth;a.strokeStyle=this.selectionBorderColor;1<this.selectionDashArray.length?(d=c.ex+0.5-(0<d?0:g),c=c.ey+0.5-(0<e?0:n),a.beginPath(),fabric.util.drawDashedLine(a,
d,c,d+g,c,this.selectionDashArray),fabric.util.drawDashedLine(a,d,c+n-1,d+g,c+n-1,this.selectionDashArray),fabric.util.drawDashedLine(a,d,c,d,c+n,this.selectionDashArray),fabric.util.drawDashedLine(a,d+g-1,c,d+g-1,c+n,this.selectionDashArray),a.closePath(),a.stroke()):a.strokeRect(c.ex+0.5-(0<d?0:g),c.ey+0.5-(0<e?0:n),g,n)},_isLastRenderedObject:function(a){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(a,
this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(a))},findTarget:function(a,b){if(!this.skipTargetFind){if(this._isLastRenderedObject(a))return this.lastRenderedObjectWithControlsAboveOverlay;var c=this.getActiveGroup();if(c&&!b&&this.containsPoint(a,c))return c;c=this._searchPossibleTargets(a);this._fireOverOutEvents(c);return c}},_fireOverOutEvents:function(a){a?this._hoveredTarget!==a&&(this.fire("mouse:over",{target:a}),
a.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),this._hoveredTarget=a):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(a,b,c){if(b&&b.visible&&b.evented&&this.containsPoint(a,b)&&(!this.perPixelTargetFind&&!b.perPixelTargetFind||b.isEditing||!this.isTargetTransparent(b,c.x,c.y)))return!0},_searchPossibleTargets:function(a){var b,
c=this.getPointer(a);if(this._activeObject&&this._checkTarget(a,this._activeObject,c))return this.relatedTarget=this._activeObject;for(var d=this._objects.length;d--;)if(this._checkTarget(a,this._objects[d],c)){this.relatedTarget=this._objects[d];b=this._objects[d];break}return b},getPointer:function(a){var b,c=e(a,this.upperCanvasEl);b=this.upperCanvasEl.getBoundingClientRect();0===b.width||0===b.height?b=a=1:(a=this.upperCanvasEl.width/b.width,b=this.upperCanvasEl.height/b.height);return{x:(c.x-
this._offset.left)*a,y:(c.y-this._offset.top)*b}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+a);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=
this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var b=
this.getWidth()||a.width,c=this.getHeight()||a.height;fabric.util.setStyle(a,{position:"absolute",width:b+"px",height:c+"px",left:0,top:0});a.width=b;a.height=c;fabric.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=a;a.set("active",!0)},
setActiveObject:function(a,b){this._setActiveObject(a);this.renderAll();this.fire("object:selected",{target:a,e:b});a.fire("selected",{e:b});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(a){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:a});return this},_setActiveGroup:function(a){if(this._activeGroup=a)a.canvas=
this,a.set("active",!0)},setActiveGroup:function(a,b){this._setActiveGroup(a);a&&(this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b}));return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy();this.setActiveGroup(null)},discardActiveGroup:function(a){this._discardActiveGroup();this.fire("selection:cleared",{e:a});return this},deactivateAll:function(){for(var a=this.getObjects(),b=0,c=a.length;b<c;b++)a[b].set("active",
!1);this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(a){var b=this.getActiveGroup()||this.getActiveObject();b&&this.fire("before:selection:cleared",{target:b,e:a});this.deactivateAll();b&&this.fire("selection:cleared",{e:a});return this},drawControls:function(a){var b=this.getActiveGroup();b?this._drawGroupControls(a,b):this._drawObjectsControls(a)},_drawGroupControls:function(a,b){this._drawControls(a,b,"Group")},_drawObjectsControls:function(a){for(var b=
0,c=this._objects.length;b<c;++b)this._objects[b]&&this._objects[b].active&&(this._drawControls(a,this._objects[b],"Object"),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[b])},_drawControls:function(a,b,c){a.save();fabric[c].prototype.transform.call(b,a);b.drawBorders(a).drawControls(a);a.restore()}});for(var g in fabric.StaticCanvas)"prototype"!==g&&(fabric.Canvas[g]=fabric.StaticCanvas[g]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){});fabric.Element=
fabric.Canvas})();
(function(){var e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},c=fabric.util.addListener,a=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),_initEventListeners:function(){this._bindEvents();c(fabric.window,"resize",this._onResize);c(this.upperCanvasEl,"mousedown",this._onMouseDown);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"mousewheel",this._onMouseWheel);
c(this.upperCanvasEl,"touchstart",this._onMouseDown);c(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof Event&&"add"in Event&&(Event.add(this.upperCanvasEl,"gesture",this._onGesture),Event.add(this.upperCanvasEl,"drag",this._onDrag),Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.add(this.upperCanvasEl,"shake",this._onShake))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=
this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){a(fabric.window,"resize",this._onResize);a(this.upperCanvasEl,"mousedown",this._onMouseDown);a(this.upperCanvasEl,"mousemove",this._onMouseMove);a(this.upperCanvasEl,"mousewheel",
this._onMouseWheel);a(this.upperCanvasEl,"touchstart",this._onMouseDown);a(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof Event&&"remove"in Event&&(Event.remove(this.upperCanvasEl,"gesture",this._onGesture),Event.remove(this.upperCanvasEl,"drag",this._onDrag),Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.remove(this.upperCanvasEl,"shake",this._onShake))},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,
b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a,b){this.__onMouseWheel&&this.__onMouseWheel(a,b)},_onOrientationChange:function(a,b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onMouseDown:function(d){this.__onMouseDown(d);c(fabric.document,"touchend",this._onMouseUp);c(fabric.document,"touchmove",this._onMouseMove);a(this.upperCanvasEl,"mousemove",this._onMouseMove);a(this.upperCanvasEl,"touchmove",this._onMouseMove);
"touchstart"===d.type?a(this.upperCanvasEl,"mousedown",this._onMouseDown):(c(fabric.document,"mouseup",this._onMouseUp),c(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(d){this.__onMouseUp(d);a(fabric.document,"mouseup",this._onMouseUp);a(fabric.document,"touchend",this._onMouseUp);a(fabric.document,"mousemove",this._onMouseMove);a(fabric.document,"touchmove",this._onMouseMove);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"touchmove",this._onMouseMove);
"touchend"===d.type&&setTimeout(function(){c(this.upperCanvasEl,"mousedown",this._onMouseDown)},400)},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault();this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a,b){var c=this.getActiveGroup()||this.getActiveObject();return!!(a&&(a.isMoving||a!==c)||!a&&c||!a&&!c&&!this._groupSelector||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y))},
__onMouseUp:function(a){var b;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(a);else{this._currentTransform?(this._finalizeCurrentTransform(),b=this._currentTransform.target):b=this.findTarget(a,!0);var c=this._shouldRender(b,this.getPointer(a));this._maybeGroupObjects(a);b&&(b.isMoving=!1);c&&this.renderAll();this._handleCursorAndEvent(a,b)}},_handleCursorAndEvent:function(a,b){this._setCursorFromEvent(a,b);var c=this;setTimeout(function(){c._setCursorFromEvent(a,b)},
50);this.fire("mouse:up",{target:b,e:a});b&&b.fire("mouseup",{e:a})},_finalizeCurrentTransform:function(){var a=this._currentTransform.target;a._scaling&&(a._scaling=!1);a.setCoords();this.stateful&&a.hasStateChanged()&&(this.fire("object:modified",{target:a}),a.fire("modified"));this._restoreOriginXY(a)},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;
a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null}},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0;this.discardActiveObject(a).renderAll();this.clipTo&&fabric.util.clipContext(this,this.contextTop);this.freeDrawingBrush.onMouseDown(this.getPointer(a));this.fire("mouse:down",{e:a})},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=this.getPointer(a);this.freeDrawingBrush.onMouseMove(b)}this.upperCanvasEl.style.cursor=
this.freeDrawingCursor;this.fire("mouse:move",{e:a})},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:a})},__onMouseDown:function(a){if(("which"in a?1===a.which:1===a.button)||fabric.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(a);else if(!this._currentTransform){var b=this.findTarget(a),c=this.getPointer(a);this._previousPointer=c;var f=this._shouldRender(b,c),
e=this._shouldGroup(a,b);this._shouldClearSelection(a,b)?this._clearSelection(a,b,c):e&&(this._handleGrouping(a,b),b=this.getActiveGroup());b&&b.selectable&&!e&&(this._beforeTransform(a,b),this._setupCurrentTransform(a,b));f&&this.renderAll();this.fire("mouse:down",{target:b,e:a});b&&b.fire("mousedown",{e:a})}},_beforeTransform:function(a,b){this.stateful&&b.saveState();if(b._findTargetCorner(this.getPointer(a)))this.onBeforeScaleRotate(b);b!==this.getActiveGroup()&&b!==this.getActiveObject()&&(this.deactivateAll(),
this.setActiveObject(b,a))},_clearSelection:function(a,b,c){this.deactivateAllWithDispatch(a);b&&b.selectable?this.setActiveObject(b,a):this.selection&&(this._groupSelector={ex:c.x,ey:c.y,top:0,left:0})},_setOriginToCenter:function(a){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var b=a.getCenterPoint();a.originX="center";a.originY="center";a.left=b.x;a.top=b.y;this._currentTransform.left=a.left;this._currentTransform.top=
a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null},__onMouseMove:function(a){var b,c;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(a);else{var f=this._groupSelector;f?(c=this.getPointer(a),f.left=c.x-f.ex,f.top=c.y-f.ey,this.renderTop()):this._currentTransform?this._transformObject(a):
(b=this.findTarget(a),!b||b&&!b.selectable?this.upperCanvasEl.style.cursor=this.defaultCursor:this._setCursorFromEvent(a,b));this.fire("mouse:move",{target:b,e:a});b&&b.fire("mousemove",{e:a})}},_transformObject:function(a){var b=this.getPointer(a),c=this._currentTransform;c.reset=!1;c.target.isMoving=!0;this._beforeScaleTransform(a,c);this._performTransformAction(a,c,b);this.renderAll()},_performTransformAction:function(a,b,c){var f=c.x;c=c.y;var e=b.target,l=b.action;"rotate"===l?(this._rotateObject(f,
c),this._fire("rotating",e,a)):"scale"===l?(this._onScale(a,b,f,c),this._fire("scaling",e,a)):"scaleX"===l?(this._scaleObject(f,c,"x"),this._fire("scaling",e,a)):"scaleY"===l?(this._scaleObject(f,c,"y"),this._fire("scaling",e,a)):(this._translateObject(f,c),this._fire("moving",e,a),this._setCursor(this.moveCursor))},_fire:function(a,b,c){this.fire("object:"+a,{target:b,e:c});b.fire(a,{e:c})},_beforeScaleTransform:function(a,b){if("scale"===b.action||"scaleX"===b.action||"scaleY"===b.action){var c=
this._shouldCenterTransform(a,b.target);if(c&&("center"!==b.originX||"center"!==b.originY)||!c&&"center"===b.originX&&"center"===b.originY)this._resetCurrentTransform(a),b.reset=!0}},_onScale:function(a,b,c,f){!a.shiftKey&&!this.uniScaleTransform||b.target.get("lockUniScaling")?(b.reset||"scale"!==b.currentAction||this._resetCurrentTransform(a,b.target),b.currentAction="scaleEqually",this._scaleObject(c,f,"equally")):(b.currentAction="scale",this._scaleObject(c,f))},_setCursorFromEvent:function(a,
b){var c=this.upperCanvasEl.style;if(b&&b.selectable){var f=this.getActiveGroup();(f=b._findTargetCorner&&(!f||!f.contains(b))&&b._findTargetCorner(this.getPointer(a)))?this._setCornerCursor(f,b):c.cursor=b.hoverCursor||this.hoverCursor}else return c.cursor=this.defaultCursor,!1;return!0},_setCornerCursor:function(a,b){var c=this.upperCanvasEl.style;if(a in e)c.cursor=this._getRotatedCornerCursor(a,b);else if("mtr"===a&&b.hasRotatingPoint)c.cursor=this.rotationCursor;else return c.cursor=this.defaultCursor,
!1},_getRotatedCornerCursor:function(a,b){var c=Math.round(b.getAngle()%360/45);0>c&&(c+=8);c+=e[a];return this.cursorMap[c%8]}})})();
(function(){var e=Math.min,c=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(a,c){var b=this.getActiveObject();return a.shiftKey&&(this.getActiveGroup()||b&&b!==c)&&this.selection},_handleGrouping:function(a,c){if(c===this.getActiveGroup()&&(c=this.findTarget(a,!0),!c||c.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(c,a):this._createActiveGroup(c,a);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(a,c){var b=this.getActiveGroup();
if(b.contains(a)){if(b.removeWithUpdate(a),this._resetObjectTransform(b),a.set("active",!1),1===b.size()){this.discardActiveGroup(c);this.setActiveObject(b.item(0));return}}else b.addWithUpdate(a),this._resetObjectTransform(b);this.fire("selection:created",{target:b,e:c});b.set("active",!0)},_createActiveGroup:function(a,c){if(this._activeObject&&a!==this._activeObject){var b=this._createGroup(a);this.setActiveGroup(b);this._activeObject=null;this.fire("selection:created",{target:b,e:c})}a.set("active",
!0)},_createGroup:function(a){var c=this.getObjects();a=c.indexOf(this._activeObject)<c.indexOf(a)?[this._activeObject,a]:[a,this._activeObject];return new fabric.Group(a,{originX:"center",originY:"center"})},_groupSelectedObjects:function(a){var c=this._collectObjects();1===c.length?this.setActiveObject(c[0],a):1<c.length&&(c=new fabric.Group(c.reverse(),{originX:"center",originY:"center"}),this.setActiveGroup(c,a),c.saveCoords(),this.fire("selection:created",{target:c}),this.renderAll())},_collectObjects:function(){var a=
[],d;d=this._groupSelector.ex;for(var b=this._groupSelector.ey,g=d+this._groupSelector.left,f=b+this._groupSelector.top,h=new fabric.Point(e(d,g),e(b,f)),l=new fabric.Point(c(d,g),c(b,f)),b=d===g&&b===f,g=this._objects.length;g--&&!((d=this._objects[g])&&d.selectable&&d.visible&&(d.intersectsWithRect(h,l)||d.isContainedWithinRect(h,l)||d.containsPoint(h)||d.containsPoint(l))&&(d.set("active",!0),a.push(d),b)););return a},_maybeGroupObjects:function(a){this.selection&&this._groupSelector&&this._groupSelectedObjects(a);
if(a=this.getActiveGroup())a.setObjectsCoords().setCoords(),a.isMoving=!1,this._setCursor(this.defaultCursor);this._currentTransform=this._groupSelector=null}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var c=e.format||"png",a=e.quality||1,d=e.multiplier||1;e={left:e.left,top:e.top,width:e.width,height:e.height};return 1!==d?this.__toDataURLWithMultiplier(c,a,e,d):this.__toDataURL(c,a,e)},__toDataURL:function(e,c,a){this.renderAll(!0);var d=this.upperCanvasEl||this.lowerCanvasEl;a=this.__getCroppedCanvas(d,a);"jpg"===e&&(e="jpeg");e=fabric.StaticCanvas.supports("toDataURLWithQuality")?(a||d).toDataURL("image/"+
e,c):(a||d).toDataURL("image/"+e);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return e},__getCroppedCanvas:function(e,c){var a,d;if("left"in c||"top"in c||"width"in c||"height"in c)a=fabric.util.createCanvasElement(),d=a.getContext("2d"),a.width=c.width||this.width,a.height=c.height||this.height,d.drawImage(e,-c.left||0,-c.top||0);return a},__toDataURLWithMultiplier:function(e,c,a,d){var b=this.getWidth(),g=this.getHeight(),f=b*d,h=g*d,l=this.getActiveObject(),k=this.getActiveGroup(),
m=this.contextTop||this.contextContainer;1<d&&this.setWidth(f).setHeight(h);m.scale(d,d);a.left&&(a.left*=d);a.top&&(a.top*=d);a.width?a.width*=d:1>d&&(a.width=f);a.height?a.height*=d:1>d&&(a.height=h);k?this._tempRemoveBordersControlsFromGroup(k):l&&this.deactivateAll&&this.deactivateAll();this.renderAll(!0);e=this.__toDataURL(e,c,a);this.width=b;this.height=g;m.scale(1/d,1/d);this.setWidth(b).setHeight(g);k?this._restoreBordersControlsOnGroup(k):l&&this.setActiveObject&&this.setActiveObject(l);
this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return e},toDataURLWithMultiplier:function(e,c,a){return this.toDataURL({format:e,multiplier:c,quality:a})},_tempRemoveBordersControlsFromGroup:function(e){e.origHasControls=e.hasControls;e.origBorderColor=e.borderColor;e.hasControls=!0;e.borderColor="rgba(0,0,0,0)";e.forEachObject(function(c){c.origBorderColor=c.borderColor;c.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(e){e.hideControls=e.origHideControls;
e.borderColor=e.origBorderColor;e.forEachObject(function(c){c.borderColor=c.origBorderColor;delete c.origBorderColor})}});
fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(e,c,a){return this.loadFromJSON(e,c,a)},loadFromJSON:function(e,c,a){if(e){var d="string"===typeof e?JSON.parse(e):e;this.clear();var b=this;this._enlivenObjects(d.objects,function(){b._setBgOverlay(d,c)},a);return this}},_setBgOverlay:function(e,c){var a=this,d={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(e.backgroundImage||e.overlayImage||e.background||e.overlay){var b=function(){d.backgroundImage&&
d.overlayImage&&d.backgroundColor&&d.overlayColor&&(a.renderAll(),c&&c())};this.__setBgOverlay("backgroundImage",e.backgroundImage,d,b);this.__setBgOverlay("overlayImage",e.overlayImage,d,b);this.__setBgOverlay("backgroundColor",e.background,d,b);this.__setBgOverlay("overlayColor",e.overlay,d,b);b()}else c&&c()},__setBgOverlay:function(e,c,a,d){var b=this;if(c)if("backgroundImage"===e||"overlayImage"===e)fabric.Image.fromObject(c,function(c){b[e]=c;a[e]=!0;d&&d()});else this["set"+fabric.util.string.capitalize(e,
!0)](c,function(){a[e]=!0;d&&d()});else a[e]=!0},_enlivenObjects:function(e,c,a){var d=this;if(0===e.length)c&&c();else{var b=this.renderOnAddRemove;this.renderOnAddRemove=!1;fabric.util.enlivenObjects(e,function(a){a.forEach(function(a,b){d.insertAt(a,b,!0)});d.renderOnAddRemove=b;c&&c()},null,a)}},_toDataURL:function(e,c){this.clone(function(a){c(a.toDataURL(e))})},_toDataURLWithMultiplier:function(e,c,a){this.clone(function(d){a(d.toDataURLWithMultiplier(e,c))})},clone:function(e,c){var a=JSON.stringify(this.toJSON(c));
this.cloneWithoutData(function(c){c.loadFromJSON(a,function(){e&&e(c)})})},cloneWithoutData:function(e){var c=fabric.document.createElement("canvas");c.width=this.getWidth();c.height=this.getHeight();var a=new fabric.Canvas(c);a.clipTo=this.clipTo;this.backgroundImage?(a.setBackgroundImage(this.backgroundImage.src,function(){a.renderAll();e&&e(a)}),a.backgroundImageOpacity=this.backgroundImageOpacity,a.backgroundImageStretch=this.backgroundImageStretch):e&&e(a)}});
(function(){var e=fabric.util.degreesToRadians,c=fabric.util.radiansToDegrees;fabric.util.object.extend(fabric.Canvas.prototype,{__onTransformGesture:function(a,c){if(!this.isDrawingMode&&a.touches&&2===a.touches.length&&"gesture"===c.gesture){var b=this.findTarget(a);"undefined"!==typeof b&&(this.onBeforeScaleRotate(b),this._rotateObjectByAngle(c.rotation),this._scaleObjectBy(c.scale));this.fire("touch:gesture",{target:b,e:a,self:c})}},__onDrag:function(a,c){this.fire("touch:drag",{e:a,self:c})},
__onOrientationChange:function(a,c){this.fire("touch:orientation",{e:a,self:c})},__onShake:function(a,c){this.fire("touch:shake",{e:a,self:c})},_scaleObjectBy:function(a,c){var b=this._currentTransform,e=b.target,f=e.get("lockScalingX"),h=e.get("lockScalingY");f&&h||(e._scaling=!0,c?"x"!==c||e.get("lockUniScaling")?"y"!==c||e.get("lockUniScaling")||h||e.set("scaleY",b.scaleY*a):f||e.set("scaleX",b.scaleX*a):(f||e.set("scaleX",b.scaleX*a),h||e.set("scaleY",b.scaleY*a)))},_rotateObjectByAngle:function(a){var d=
this._currentTransform;d.target.get("lockRotation")||(d.target.angle=c(e(a)+d.theta))}})})();
(function(e){var c=e.fabric||(e.fabric={});e=c.util.object.extend;var a=c.util.toFixed,d=c.util.string.capitalize,b=c.util.degreesToRadians,g=c.StaticCanvas.supports("setLineDash");c.Object||(c.Object=c.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,
centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,
lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule shadow clipTo visible backgroundColor".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(a){!a.fill||!a.fill.colorStops||a.fill instanceof c.Gradient||this.set("fill",new c.Gradient(a.fill))},_initPattern:function(a){!a.fill||
!a.fill.source||a.fill instanceof c.Pattern||this.set("fill",new c.Pattern(a.fill));!a.stroke||!a.stroke.source||a.stroke instanceof c.Pattern||this.set("stroke",new c.Pattern(a.stroke))},_initClipping:function(a){a.clipTo&&"string"===typeof a.clipTo&&(a=c.util.getFunctionBody(a.clipTo),"undefined"!==typeof a&&(this.clipTo=new Function("ctx",a)))},setOptions:function(a){for(var b in a)this.set(b,a[b]);this._initGradient(a);this._initPattern(a);this._initClipping(a)},transform:function(a,c){a.globalAlpha=
this.opacity;var d=c?this._getLeftTopCoords():this.getCenterPoint();a.translate(d.x,d.y);a.rotate(b(this.angle));a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(b){var d=c.Object.NUM_FRACTION_DIGITS,d={type:this.type,originX:this.originX,originY:this.originY,left:a(this.left,d),top:a(this.top,d),width:a(this.width,d),height:a(this.height,d),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():
this.stroke,strokeWidth:a(this.strokeWidth,d),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:a(this.strokeMiterLimit,d),scaleX:a(this.scaleX,d),scaleY:a(this.scaleY,d),angle:a(this.getAngle(),d),flipX:this.flipX,flipY:this.flipY,opacity:a(this.opacity,d),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor};
this.includeDefaultValues||(d=this._removeDefaultValues(d));c.util.populateWithProperties(this,d,b);return d},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var b=c.util.getKlass(a.type).prototype;b.stateProperties.forEach(function(c){a[c]===b[c]&&delete a[c]});return a},toString:function(){return"#<fabric."+d(this.type)+">"},get:function(a){return this[a]},_setObject:function(a){for(var b in a)this._set(b,a[b])},set:function(a,b){"object"===typeof a?this._setObject(a):
"function"===typeof b&&"clipTo"!==a?this._set(a,b(this.get(a))):this._set(a,b);return this},_set:function(b,d){if("scaleX"===b||"scaleY"===b)d=this._constrainScale(d);"scaleX"===b&&0>d?(this.flipX=!this.flipX,d*=-1):"scaleY"===b&&0>d?(this.flipY=!this.flipY,d*=-1):"width"===b||"height"===b?this.minScaleLimit=a(Math.min(0.1,1/Math.max(this.width,this.height)),2):"shadow"!==b||!d||d instanceof c.Shadow||(d=new c.Shadow(d));this[b]=d;return this},toggle:function(a){var b=this.get(a);"boolean"===typeof b&&
this.set(a,!b);return this},setSourcePath:function(a){this.sourcePath=a;return this},render:function(a,b){if(0!==this.width&&0!==this.height&&this.visible){a.save();this._setupFillRule(a);this._transform(a,b);this._setStrokeStyles(a);this._setFillStyles(a);var d=this.transformMatrix;d&&this.group&&(a.translate(-this.group.width/2,-this.group.height/2),a.transform(d[0],d[1],d[2],d[3],d[4],d[5]));this._setShadow(a);this.clipTo&&c.util.clipContext(this,a);this._render(a,b);this.clipTo&&a.restore();this._removeShadow(a);
this._restoreFillRule(a);this.active&&!b&&(this.drawBorders(a),this.drawControls(a));a.restore()}},_transform:function(a,b){var c=this.transformMatrix;c&&!this.group&&a.setTransform(c[0],c[1],c[2],c[3],c[4],c[5]);b||this.transform(a)},_setStrokeStyles:function(a){this.stroke&&(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a):this.stroke)},_setFillStyles:function(a){this.fill&&
(a.fillStyle=this.fill.toLive?this.fill.toLive(a):this.fill)},_setShadow:function(a){this.shadow&&(a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur,a.shadowOffsetX=this.shadow.offsetX,a.shadowOffsetY=this.shadow.offsetY)},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_renderFill:function(a){this.fill&&(this.fill.toLive&&(a.save(),a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)),a.fill(),this.fill.toLive&&
a.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a))},_renderStroke:function(a){this.stroke&&(a.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),g?(a.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke()):this._stroke?this._stroke(a):a.stroke(),this._removeShadow(a),a.restore())},clone:function(a,b){return this.constructor.fromObject?
this.constructor.fromObject(this.toObject(b),a):new c.Object(this.toObject(b))},cloneAsImage:function(a){var b=this.toDataURL();c.util.loadImage(b,function(b){a&&a(new c.Image(b))});return this},toDataURL:function(a){a||(a={});var b=c.util.createCanvasElement(),d=this.getBoundingRect();b.width=d.width;b.height=d.height;c.util.wrapElement(b,"div");d=new c.Canvas(b);"jpg"===a.format&&(a.format="jpeg");"jpeg"===a.format&&(d.backgroundColor="#fff");var e={active:this.get("active"),left:this.getLeft(),
top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new c.Point(b.width/2,b.height/2),"center","center");b=this.canvas;d.add(this);a=d.toDataURL(a);this.set(e).setCoords();this.canvas=b;d.dispose();return a},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,b){b||(b={});var d={colorStops:[]};d.type=b.type||(b.r1||b.r2?"radial":"linear");d.coords={x1:b.x1,y1:b.y1,x2:b.x2,y2:b.y2};if(b.r1||b.r2)d.coords.r1=
b.r1,d.coords.r2=b.r2;for(var e in b.colorStops){var g=new c.Color(b.colorStops[e]);d.colorStops.push({offset:e,color:g.toRgb(),opacity:g.getAlpha()})}return this.set(a,c.Gradient.forObject(this,d))},setPatternFill:function(a){return this.set("fill",new c.Pattern(a))},setShadow:function(a){return this.set("shadow",new c.Shadow(a))},setColor:function(a){this.set("fill",a);return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);
return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(a,b){b=b||this.canvas.getPointer(a);var c=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:b.x-c.x,y:b.y-c.y}},_setupFillRule:function(a){this.fillRule&&(this._prevFillRule=a.globalCompositeOperation,a.globalCompositeOperation=this.fillRule)},_restoreFillRule:function(a){this.fillRule&&this._prevFillRule&&(a.globalCompositeOperation=
this._prevFillRule)}}),c.util.createAccessors(c.Object),c.Object.prototype.rotate=c.Object.prototype.setAngle,e(c.Object.prototype,c.Observable),c.Object.NUM_FRACTION_DIGITS=2,c.Object.__uid=0)})("undefined"!==typeof exports?exports:this);
(function(){var e=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(c,a,d){var b=c.x,g=c.y,f=this.stroke?this.strokeWidth:0;"left"===a?b=c.x+(this.getWidth()+f*this.scaleX)/2:"right"===a&&(b=c.x-(this.getWidth()+f*this.scaleX)/2);"top"===d?g=c.y+(this.getHeight()+f*this.scaleY)/2:"bottom"===d&&(g=c.y-(this.getHeight()+f*this.scaleY)/2);return fabric.util.rotatePoint(new fabric.Point(b,g),c,e(this.angle))},translateToOriginPoint:function(c,
a,d){var b=c.x,g=c.y,f=this.stroke?this.strokeWidth:0;"left"===a?b=c.x-(this.getWidth()+f*this.scaleX)/2:"right"===a&&(b=c.x+(this.getWidth()+f*this.scaleX)/2);"top"===d?g=c.y-(this.getHeight()+f*this.scaleY)/2:"bottom"===d&&(g=c.y+(this.getHeight()+f*this.scaleY)/2);return fabric.util.rotatePoint(new fabric.Point(b,g),c,e(this.angle))},getCenterPoint:function(){var c=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(c,this.originX,this.originY)},getPointByOrigin:function(c,
a){var d=this.getCenterPoint();return this.translateToOriginPoint(d,c,a)},toLocalPoint:function(c,a,d){var b=this.getCenterPoint(),g=this.stroke?this.strokeWidth:0;a&&d?(a="left"===a?b.x-(this.getWidth()+g*this.scaleX)/2:"right"===a?b.x+(this.getWidth()+g*this.scaleX)/2:b.x,d="top"===d?b.y-(this.getHeight()+g*this.scaleY)/2:"bottom"===d?b.y+(this.getHeight()+g*this.scaleY)/2:b.y):(a=this.left,d=this.top);return fabric.util.rotatePoint(new fabric.Point(c.x,c.y),b,-e(this.angle)).subtractEquals(new fabric.Point(a,
d))},setPositionByOrigin:function(c,a,d){c=this.translateToCenterPoint(c,a,d);c=this.translateToOriginPoint(c,this.originX,this.originY);this.set("left",c.x);this.set("top",c.y)},adjustPosition:function(c){var a=e(this.angle),d=this.getWidth()/2,b=Math.cos(a)*d,d=Math.sin(a)*d,g=this.getWidth(),f=Math.cos(a)*g,a=Math.sin(a)*g;"center"===this.originX&&"left"===c||"right"===this.originX&&"center"===c?(this.left-=b,this.top-=d):"left"===this.originX&&"center"===c||"center"===this.originX&&"right"===
c?(this.left+=b,this.top+=d):"left"===this.originX&&"right"===c?(this.left+=f,this.top+=a):"right"===this.originX&&"left"===c&&(this.left-=f,this.top-=a);this.setCoords();this.originX=c},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})})();
(function(){var e=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(c,a){var d=this.oCoords,b=new fabric.Point(d.tl.x,d.tl.y),e=new fabric.Point(d.tr.x,d.tr.y),f=new fabric.Point(d.bl.x,d.bl.y),d=new fabric.Point(d.br.x,d.br.y);return"Intersection"===fabric.Intersection.intersectPolygonRectangle([b,e,d,f],c,a).status},intersectsWithObject:function(c){function a(a){return{tl:new fabric.Point(a.tl.x,a.tl.y),tr:new fabric.Point(a.tr.x,
a.tr.y),bl:new fabric.Point(a.bl.x,a.bl.y),br:new fabric.Point(a.br.x,a.br.y)}}var d=a(this.oCoords);c=a(c.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonPolygon([d.tl,d.tr,d.br,d.bl],[c.tl,c.tr,c.br,c.bl]).status},isContainedWithinObject:function(c){var a=c.getBoundingRect();c=new fabric.Point(a.left,a.top);a=new fabric.Point(a.left+a.width,a.top+a.height);return this.isContainedWithinRect(c,a)},isContainedWithinRect:function(c,a){var d=this.getBoundingRect();return d.left>=
c.x&&d.left+d.width<=a.x&&d.top>=c.y&&d.top+d.height<=a.y},containsPoint:function(c){var a=this._getImageLines(this.oCoords);c=this._findCrossPoints(c,a);return 0!==c&&1===c%2},_getImageLines:function(c){return{topline:{o:c.tl,d:c.tr},rightline:{o:c.tr,d:c.br},bottomline:{o:c.br,d:c.bl},leftline:{o:c.bl,d:c.tl}}},_findCrossPoints:function(c,a){var d,b,e,f=0,h;for(h in a)if(e=a[h],!(e.o.y<c.y&&e.d.y<c.y||e.o.y>=c.y&&e.d.y>=c.y)&&(e.o.x===e.d.x&&e.o.x>=c.x?d=e.o.x:(d=(e.d.y-e.o.y)/(e.d.x-e.o.x),b=c.y-
0*c.x,e=e.o.y-d*e.o.x,d=-(b-e)/(0-d)),d>=c.x&&(f+=1),2===f))break;return f},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var c=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],a=fabric.util.array.min(c),c=fabric.util.array.max(c),c=Math.abs(a-c),d=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],b=
fabric.util.array.min(d),d=fabric.util.array.max(d),d=Math.abs(b-d);return{left:a,top:b,width:c,height:d}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(c){return Math.abs(c)<this.minScaleLimit?0>c?-this.minScaleLimit:this.minScaleLimit:c},scale:function(c){c=this._constrainScale(c);0>c&&(this.flipX=!this.flipX,this.flipY=!this.flipY,c*=-1);this.scaleY=this.scaleX=c;this.setCoords();return this},scaleToWidth:function(c){var a=
this.getBoundingRectWidth()/this.getWidth();return this.scale(c/this.width/a)},scaleToHeight:function(c){var a=this.getBoundingRectHeight()/this.getHeight();return this.scale(c/this.height/a)},setCoords:function(){var c=1<this.strokeWidth?this.strokeWidth:0,a=this.padding,d=e(this.angle);this.currentWidth=(this.width+c)*this.scaleX+2*a;this.currentHeight=(this.height+c)*this.scaleY+2*a;0>this.currentWidth&&(this.currentWidth=Math.abs(this.currentWidth));var c=Math.sqrt(Math.pow(this.currentWidth/
2,2)+Math.pow(this.currentHeight/2,2)),b=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0),a=Math.cos(b+d)*c,b=Math.sin(b+d)*c,c=Math.sin(d),d=Math.cos(d),g=this.getCenterPoint(),a={x:g.x-a,y:g.y-b},b={x:a.x+this.currentWidth*d,y:a.y+this.currentWidth*c},g={x:a.x-this.currentHeight*c,y:a.y+this.currentHeight*d},f={x:a.x+this.currentWidth/2*d,y:a.y+this.currentWidth/2*c};this.oCoords={tl:a,tr:b,br:{x:b.x-this.currentHeight*c,y:b.y+this.currentHeight*d},
bl:g,ml:{x:a.x-this.currentHeight/2*c,y:a.y+this.currentHeight/2*d},mt:f,mr:{x:b.x-this.currentHeight/2*c,y:b.y+this.currentHeight/2*d},mb:{x:g.x+this.currentWidth/2*d,y:g.y+this.currentWidth/2*c},mtr:{x:f.x,y:f.y}};this._setCornerCoords&&this._setCornerCoords();return this}})})();
fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(e){this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas.sendBackwards(this,e);return this},bringForward:function(e){this.group?
fabric.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas.bringForward(this,e);return this},moveTo:function(e){this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas.moveTo(this,e);return this}});
fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var e=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",c=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",a=this.strokeWidth?this.strokeWidth:"0",d=this.strokeDashArray?this.strokeDashArray.join(" "):"";return["stroke: ",c,"; stroke-width: ",a,"; stroke-dasharray: ",d,"; stroke-linecap: ",this.strokeLineCap?this.strokeLineCap:"butt","; stroke-linejoin: ",this.strokeLineJoin?
this.strokeLineJoin:"miter","; stroke-miterlimit: ",this.strokeMiterLimit?this.strokeMiterLimit:"4","; fill: ",e,"; opacity: ","undefined"!==typeof this.opacity?this.opacity:"1",";",this.shadow&&"text"!==this.type?"filter: url(#SVGID_"+this.shadow.id+");":"",this.visible?"":" visibility: hidden;"].join("")},getSvgTransform:function(){var e=fabric.util.toFixed,c=this.getAngle(),a=this.getCenterPoint(),d=fabric.Object.NUM_FRACTION_DIGITS,a="translate("+e(a.x,d)+" "+e(a.y,d)+")",c=0!==c?" rotate("+e(c,
d)+")":"",e=1===this.scaleX&&1===this.scaleY?"":" scale("+e(this.scaleX,d)+" "+e(this.scaleY,d)+")";return[a,c,e,this.flipX?"matrix(-1 0 0 1 0 0) ":"",this.flipY?"matrix(1 0 0 -1 0 0)":""].join("")},_createBaseSVGMarkup:function(){var e=[];this.fill&&this.fill.toLive&&e.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&e.push(this.stroke.toSVG(this,!1));this.shadow&&e.push(this.shadow.toSVG(this));return e}});
fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(e){return this.get(e)!==this.originalState[e]},this)},saveState:function(e){this.stateProperties.forEach(function(c){this.originalState[c]=this.get(c)},this);e&&e.stateProperties&&e.stateProperties.forEach(function(c){this.originalState[c]=this.get(c)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});
(function(){var e=fabric.util.degreesToRadians,c="undefined"!==typeof G_vmlCanvasManager;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(a){if(!this.hasControls||!this.active)return!1;var c=a.x;a=a.y;var b,e;for(e in this.oCoords)if(this.isControlVisible(e)&&("mtr"!==e||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==e&&"mr"!==e&&"mb"!==e&&"ml"!==e)&&(b=this._getImageLines(this.oCoords[e].corner),b=this._findCrossPoints({x:c,y:a},
b),0!==b&&1===b%2))return this.__corner=e;return!1},_setCornerCoords:function(){var a=this.oCoords,c=e(this.angle),b=e(45-this.angle),g=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,f=g*Math.cos(b),b=g*Math.sin(b),g=Math.sin(c),c=Math.cos(c);a.tl.corner={tl:{x:a.tl.x-b,y:a.tl.y-f},tr:{x:a.tl.x+f,y:a.tl.y-b},bl:{x:a.tl.x-f,y:a.tl.y+b},br:{x:a.tl.x+b,y:a.tl.y+f}};a.tr.corner={tl:{x:a.tr.x-b,y:a.tr.y-f},tr:{x:a.tr.x+f,y:a.tr.y-b},br:{x:a.tr.x+b,y:a.tr.y+f},bl:{x:a.tr.x-f,y:a.tr.y+b}};a.bl.corner={tl:{x:a.bl.x-
b,y:a.bl.y-f},bl:{x:a.bl.x-f,y:a.bl.y+b},br:{x:a.bl.x+b,y:a.bl.y+f},tr:{x:a.bl.x+f,y:a.bl.y-b}};a.br.corner={tr:{x:a.br.x+f,y:a.br.y-b},bl:{x:a.br.x-f,y:a.br.y+b},br:{x:a.br.x+b,y:a.br.y+f},tl:{x:a.br.x-b,y:a.br.y-f}};a.ml.corner={tl:{x:a.ml.x-b,y:a.ml.y-f},tr:{x:a.ml.x+f,y:a.ml.y-b},bl:{x:a.ml.x-f,y:a.ml.y+b},br:{x:a.ml.x+b,y:a.ml.y+f}};a.mt.corner={tl:{x:a.mt.x-b,y:a.mt.y-f},tr:{x:a.mt.x+f,y:a.mt.y-b},bl:{x:a.mt.x-f,y:a.mt.y+b},br:{x:a.mt.x+b,y:a.mt.y+f}};a.mr.corner={tl:{x:a.mr.x-b,y:a.mr.y-f},
tr:{x:a.mr.x+f,y:a.mr.y-b},bl:{x:a.mr.x-f,y:a.mr.y+b},br:{x:a.mr.x+b,y:a.mr.y+f}};a.mb.corner={tl:{x:a.mb.x-b,y:a.mb.y-f},tr:{x:a.mb.x+f,y:a.mb.y-b},bl:{x:a.mb.x-f,y:a.mb.y+b},br:{x:a.mb.x+b,y:a.mb.y+f}};a.mtr.corner={tl:{x:a.mtr.x-b+g*this.rotatingPointOffset,y:a.mtr.y-f-c*this.rotatingPointOffset},tr:{x:a.mtr.x+f+g*this.rotatingPointOffset,y:a.mtr.y-b-c*this.rotatingPointOffset},bl:{x:a.mtr.x-f+g*this.rotatingPointOffset,y:a.mtr.y+b-c*this.rotatingPointOffset},br:{x:a.mtr.x+b+g*this.rotatingPointOffset,
y:a.mtr.y+f-c*this.rotatingPointOffset}}},drawBorders:function(a){if(!this.hasBorders)return this;var c=this.padding,b=2*c,e=2*~~(this.strokeWidth/2);a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var f=1/this._constrainScale(this.scaleX),h=1/this._constrainScale(this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(f,h);f=this.getWidth();h=this.getHeight();a.strokeRect(~~(-(f/2)-c-e/2*this.scaleX)-0.5,~~(-(h/2)-c-e/2*this.scaleY)-0.5,~~(f+b+
e*this.scaleX)+1,~~(h+b+e*this.scaleY)+1);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(c=(this.flipY?h+e*this.scaleY+2*c:-h-e*this.scaleY-2*c)/2,a.beginPath(),a.moveTo(0,c),a.lineTo(0,c+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),a.closePath(),a.stroke());a.restore();return this},drawControls:function(a){if(!this.hasControls)return this;var c=this.cornerSize,b=c/2,e=~~(this.strokeWidth/2),f=-(this.width/2),h=-(this.height/
2),l=this.padding/this.scaleX,k=this.padding/this.scaleY,m=b/this.scaleY,n=b/this.scaleX,p=(b-c)/this.scaleX,c=(b-c)/this.scaleY,b=this.height,q=this.width,s=this.transparentCorners?"strokeRect":"fillRect";a.save();a.lineWidth=1/Math.max(this.scaleX,this.scaleY);a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=a.fillStyle=this.cornerColor;this._drawControl("tl",a,s,f-n-e-l,h-m-e-k);this._drawControl("tr",a,s,f+q-n+e+l,h-m-e-k);this._drawControl("bl",a,s,f-n-e-l,h+b+c+e+k);
this._drawControl("br",a,s,f+q+p+e+l,h+b+c+e+k);this.get("lockUniScaling")||(this._drawControl("mt",a,s,f+q/2-n,h-m-e-k),this._drawControl("mb",a,s,f+q/2-n,h+b+c+e+k),this._drawControl("mb",a,s,f+q+p+e+l,h+b/2-m),this._drawControl("ml",a,s,f-n-e-l,h+b/2-m));this.hasRotatingPoint&&this._drawControl("mtr",a,s,f+q/2-n,this.flipY?h+b+this.rotatingPointOffset/this.scaleY-this.cornerSize/this.scaleX/2+e+k:h-this.rotatingPointOffset/this.scaleY-this.cornerSize/this.scaleY/2-e-k);a.restore();return this},
_drawControl:function(a,d,b,e,f){var h=this.cornerSize/this.scaleX,l=this.cornerSize/this.scaleY;this.isControlVisible(a)&&(c||this.transparentCorners||d.clearRect(e,f,h,l),d[b](e,f,h,l))},isControlVisible:function(a){return this._getControlsVisibility()[a]},setControlVisible:function(a,c){this._getControlsVisibility()[a]=c;return this},setControlsVisibility:function(a){a||(a={});for(var c in a)this.setControlVisible(c,a[c]);return this},_getControlsVisibility:function(){this._controlsVisibility||
(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0});return this._controlsVisibility}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,c){c=c||{};var a=function(){},d=c.onComplete||a,b=c.onChange||a,g=this;fabric.util.animate({startValue:e.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(a){e.set("left",a);g.renderAll();b()},onComplete:function(){e.setCoords();d()}});return this},fxCenterObjectV:function(e,c){c=c||{};var a=function(){},d=c.onComplete||a,b=c.onChange||a,g=this;fabric.util.animate({startValue:e.get("top"),
endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(a){e.set("top",a);g.renderAll();b()},onComplete:function(){e.setCoords();d()}});return this},fxRemove:function(e,c){c=c||{};var a=function(){},d=c.onComplete||a,b=c.onChange||a,g=this;fabric.util.animate({startValue:e.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){e.set("active",!1)},onChange:function(a){e.set("opacity",a);g.renderAll();b()},onComplete:function(){g.remove(e);d()}});return this}});
fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"===typeof arguments[0]){var e=[],c,a;for(c in arguments[0])e.push(c);for(var d=0,b=e.length;d<b;d++)c=e[d],a=d!==b-1,this._animate(c,arguments[0][c],arguments[1],a)}else this._animate.apply(this,arguments);return this},_animate:function(e,c,a,d){var b=this,g;c=c.toString();a=a?fabric.util.object.clone(a):{};~e.indexOf(".")&&(g=e.split("."));var f=g?this.get(g[0])[g[1]]:this.get(e);"from"in a||(a.from=f);
c=~c.indexOf("=")?f+parseFloat(c.replace("=","")):parseFloat(c);fabric.util.animate({startValue:a.from,endValue:c,byValue:a.by,easing:a.easing,duration:a.duration,abort:a.abort&&function(){return a.abort.call(b)},onChange:function(c){g?b[g[0]][g[1]]=c:b.set(e,c);d||a.onChange&&a.onChange()},onComplete:function(){d||(b.setCoords(),a.onComplete&&a.onComplete())}})}});
(function(e){function c(a,b){var c=a.origin,d=a.axis1,e=a.axis2,g=a.dimension,p=b.nearest,q=b.center,s=b.farthest;return function(){switch(this.get(c)){case p:return Math.min(this.get(d),this.get(e));case q:return Math.min(this.get(d),this.get(e))+0.5*this.get(g);case s:return Math.max(this.get(d),this.get(e))}}}var a=e.fabric||(e.fabric={}),d=a.util.object.extend,b={x1:1,x2:1,y1:1,y2:1},g=a.StaticCanvas.supports("setLineDash");a.Line?a.warn("fabric.Line is already defined"):(a.Line=a.util.createClass(a.Object,
{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,b){b=b||{};a||(a=[0,0,0,0]);this.callSuper("initialize",b);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1)||1;this.height=Math.abs(this.y2-this.y1)||1;this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,c){this[a]=c;"undefined"!==typeof b[a]&&this._setWidthHeight();
return this},_getLeftToOriginX:c({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:c({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a){a.beginPath();if(this.group&&"path-group"===this.group.type&&!this.transformMatrix){var b=this.getCenterPoint();a.translate(-this.group.width/2+b.x,-this.group.height/2+b.y)}if(!this.strokeDashArray||this.strokeDashArray&&
g){var b=this.x1<=this.x2?-1:1,c=this.y1<=this.y2?-1:1;a.moveTo(1===this.width?0:b*this.width/2,1===this.height?0:c*this.height/2);a.lineTo(1===this.width?0:-1*b*this.width/2,1===this.height?0:-1*c*this.height/2)}a.lineWidth=this.strokeWidth;b=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=b},_renderDashedStroke:function(b){var c=this.x1<=this.x2?-1:1,d=this.y1<=this.y2?-1:1,c=1===this.width?0:c*this.width/2,d=1===this.height?0:d*this.height/
2;b.beginPath();a.util.drawDashedLine(b,c,d,-c,-d,this.strokeDashArray);b.closePath()},toObject:function(a){return d(this.callSuper("toObject",a),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(a){var b=this._createBaseSVGMarkup();b.push("<line ",'x1="',this.get("x1"),'" y1="',this.get("y1"),'" x2="',this.get("x2"),'" y2="',this.get("y2"),'" style="',this.getSvgStyles(),'"/>');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),a.Line.ATTRIBUTE_NAMES=
a.SHARED_ATTRIBUTES.concat(["x1","y1","x2","y2"]),a.Line.fromElement=function(b,c){var e=a.parseAttributes(b,a.Line.ATTRIBUTE_NAMES);return new a.Line([e.x1||0,e.y1||0,e.x2||0,e.y2||0],d(e,c))},a.Line.fromObject=function(b){return new a.Line([b.x1,b.y1,b.x2,b.y2],b)})})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),a=2*Math.PI,d=c.util.object.extend;c.Circle?c.warn("fabric.Circle is already defined."):(c.Circle=c.util.createClass(c.Object,{type:"circle",radius:0,initialize:function(a){a=a||{};this.set("radius",a.radius||0);this.callSuper("initialize",a)},_set:function(a,c){this.callSuper("_set",a,c);"radius"===a&&this.setRadius(c);return this},toObject:function(a){return d(this.callSuper("toObject",a),{radius:this.get("radius")})},toSVG:function(a){var c=this._createBaseSVGMarkup();
c.push("<circle ",'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(c.join("")):c.join("")},_render:function(b,c){b.beginPath();b.globalAlpha=this.group?b.globalAlpha*this.opacity:this.opacity;b.arc(c?this.left:0,c?this.top:0,this.radius,0,a,!1);b.closePath();this._renderFill(b);this.stroke&&this._renderStroke(b)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*
this.get("scaleY")},setRadius:function(a){this.radius=a;this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),c.Circle.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),c.Circle.fromElement=function(a,e){e||(e={});var f=c.parseAttributes(a,c.Circle.ATTRIBUTE_NAMES);if(!("radius"in f&&0<f.radius))throw Error("value of `r` attribute is required and can not be negative");"left"in f&&(f.left-=e.width/2||0);"top"in f&&(f.top-=e.height/2||0);f=new c.Circle(d(f,e));f.cx=parseFloat(a.getAttribute("cx"))||
0;f.cy=parseFloat(a.getAttribute("cy"))||0;return f},c.Circle.fromObject=function(a){return new c.Circle(a)})})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={});c.Triangle?c.warn("fabric.Triangle is already defined"):(c.Triangle=c.util.createClass(c.Object,{type:"triangle",initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("width",a.width||100).set("height",a.height||100)},_render:function(a){var c=this.width/2,b=this.height/2;a.beginPath();a.moveTo(-c,b);a.lineTo(0,-b);a.lineTo(c,b);a.closePath();this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(a){var d=this.width/2,b=
this.height/2;a.beginPath();c.util.drawDashedLine(a,-d,b,0,-b,this.strokeDashArray);c.util.drawDashedLine(a,0,-b,d,b,this.strokeDashArray);c.util.drawDashedLine(a,d,b,-d,b,this.strokeDashArray);a.closePath()},toSVG:function(a){var c=this._createBaseSVGMarkup(),b=this.width/2,e=this.height/2,b=[-b+" "+e,"0 "+-e,b+" "+e].join();c.push("<polygon ",'points="',b,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(c.join("")):c.join("")},complexity:function(){return 1}}),
c.Triangle.fromObject=function(a){return new c.Triangle(a)})})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),a=2*Math.PI,d=c.util.object.extend;c.Ellipse?c.warn("fabric.Ellipse is already defined."):(c.Ellipse=c.util.createClass(c.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0);this.set("width",2*this.get("rx"));this.set("height",2*this.get("ry"))},toObject:function(a){return d(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var c=
this._createBaseSVGMarkup();c.push("<ellipse ",'rx="',this.get("rx"),'" ry="',this.get("ry"),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(c.join("")):c.join("")},render:function(a,c){if(0!==this.rx&&0!==this.ry)return this.callSuper("render",a,c)},_render:function(b,c){b.beginPath();b.save();b.globalAlpha=this.group?b.globalAlpha*this.opacity:this.opacity;this.transformMatrix&&this.group&&b.translate(this.cx,this.cy);b.transform(1,0,0,this.ry/this.rx,0,
0);b.arc(c?this.left:0,c?this.top:0,this.rx,0,a,!1);b.restore();this._renderFill(b);this._renderStroke(b)},complexity:function(){return 1}}),c.Ellipse.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["cx","cy","rx","ry"]),c.Ellipse.fromElement=function(a,e){e||(e={});var f=c.parseAttributes(a,c.Ellipse.ATTRIBUTE_NAMES),h=f.left,l=f.top;"left"in f&&(f.left-=e.width/2||0);"top"in f&&(f.top-=e.height/2||0);f=new c.Ellipse(d(f,e));f.cx=h||0;f.cy=l||0;return f},c.Ellipse.fromObject=function(a){return new c.Ellipse(a)})})("undefined"!==
typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),a=c.util.object.extend;c.Rect?console.warn("fabric.Rect is already defined"):(e=c.Object.prototype.stateProperties.concat(),e.push("rx","ry","x","y"),c.Rect=c.util.createClass(c.Object,{stateProperties:e,type:"rect",rx:0,ry:0,x:0,y:0,strokeDashArray:null,initialize:function(a){a=a||{};this.callSuper("initialize",a);this._initRxRy();this.x=a.x||0;this.y=a.y||0},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a){if(1===
this.width&&1===this.height)a.fillRect(0,0,1,1);else{var b=this.rx||0,c=this.ry||0,f=this.width,e=this.height,l=-f/2,k=-e/2,m=this.group&&"path-group"===this.group.type,n=0!==b||0!==c;a.beginPath();a.globalAlpha=m?a.globalAlpha*this.opacity:this.opacity;this.transformMatrix&&m&&a.translate(this.width/2+this.x,this.height/2+this.y);!this.transformMatrix&&m&&a.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y);a.moveTo(l+b,k);a.lineTo(l+f-b,k);n&&a.quadraticCurveTo(l+
f,k,l+f,k+c,l+f,k+c);a.lineTo(l+f,k+e-c);n&&a.quadraticCurveTo(l+f,k+e,l+f-b,k+e,l+f-b,k+e);a.lineTo(l+b,k+e);n&&a.quadraticCurveTo(l,k+e,l,k+e-c,l,k+e-c);a.lineTo(l,k+c);n&&a.quadraticCurveTo(l,k,l+b,k,l+b,k);a.closePath();this._renderFill(a);this._renderStroke(a)}},_renderDashedStroke:function(a){var b=-this.width/2,e=-this.height/2,f=this.width,h=this.height;a.beginPath();c.util.drawDashedLine(a,b,e,b+f,e,this.strokeDashArray);c.util.drawDashedLine(a,b+f,e,b+f,e+h,this.strokeDashArray);c.util.drawDashedLine(a,
b+f,e+h,b,e+h,this.strokeDashArray);c.util.drawDashedLine(a,b,e+h,b,e,this.strokeDashArray);a.closePath()},_normalizeLeftTopProperties:function(a){"left"in a&&this.set("left",a.left+this.getWidth()/2);this.set("x",a.left||0);"top"in a&&this.set("top",a.top+this.getHeight()/2);this.set("y",a.top||0);return this},toObject:function(c){c=a(this.callSuper("toObject",c),{rx:this.get("rx")||0,ry:this.get("ry")||0,x:this.get("x"),y:this.get("y")});this.includeDefaultValues||this._removeDefaultValues(c);return c},
toSVG:function(a){var b=this._createBaseSVGMarkup();b.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),c.Rect.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),c.Rect.fromElement=function(d,b){if(!d)return null;var e=
c.parseAttributes(d,c.Rect.ATTRIBUTE_NAMES);e.left=e.left||0;e.top=e.top||0;var f=new c.Rect(a(b?c.util.object.clone(b):{},e));f._normalizeLeftTopProperties(e);return f},c.Rect.fromObject=function(a){return new c.Rect(a)})})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),a=c.util.toFixed;c.Polyline?c.warn("fabric.Polyline is already defined"):(c.Polyline=c.util.createClass(c.Object,{type:"polyline",points:null,initialize:function(a,b,c){b=b||{};this.set("points",a);this.callSuper("initialize",b);this._calcDimensions(c)},_calcDimensions:function(a){return c.Polygon.prototype._calcDimensions.call(this,a)},toObject:function(a){return c.Polygon.prototype.toObject.call(this,a)},toSVG:function(c){for(var b=[],e=this._createBaseSVGMarkup(),
f=0,h=this.points.length;f<h;f++)b.push(a(this.points[f].x,2),",",a(this.points[f].y,2)," ");e.push("<polyline ",'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return c?c(e.join("")):e.join("")},_render:function(a){var b;a.beginPath();a.moveTo(this.points[0].x,this.points[0].y);for(var c=0,f=this.points.length;c<f;c++)b=this.points[c],a.lineTo(b.x,b.y);this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(a){var b,e;a.beginPath();
for(var f=0,h=this.points.length;f<h;f++)b=this.points[f],e=this.points[f+1]||b,c.util.drawDashedLine(a,b.x,b.y,e.x,e.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),c.Polyline.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(),c.Polyline.fromElement=function(a,b){if(!a)return null;b||(b={});var e=c.parsePointsAttribute(a.getAttribute("points")),f=c.parseAttributes(a,c.Polyline.ATTRIBUTE_NAMES);c.util.normalizePoints(e,b);return new c.Polyline(e,c.util.object.extend(f,
b),!0)},c.Polyline.fromObject=function(a){return new c.Polyline(a.points,a,!0)})})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),a=c.util.object.extend,d=c.util.array.min,b=c.util.array.max,g=c.util.toFixed;c.Polygon?c.warn("fabric.Polygon is already defined"):(c.Polygon=c.util.createClass(c.Object,{type:"polygon",points:null,initialize:function(a,b,c){b=b||{};this.points=a;this.callSuper("initialize",b);this._calcDimensions(c)},_calcDimensions:function(a){var c=this.points,e=d(c,"x"),g=d(c,"y"),m=b(c,"x"),c=b(c,"y");this.width=m-e||1;this.height=c-g||1;this.minX=e;this.minY=g;if(!a){var n=
this.width/2+this.minX,p=this.height/2+this.minY;this.points.forEach(function(a){a.x-=n;a.y-=p},this)}},toObject:function(b){return a(this.callSuper("toObject",b),{points:this.points.concat()})},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d=0,e=this.points.length;d<e;d++)b.push(g(this.points[d].x,2),",",g(this.points[d].y,2)," ");c.push("<polygon ",'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(c.join("")):c.join("")},
_render:function(a){var b;a.beginPath();a.moveTo(this.points[0].x,this.points[0].y);for(var c=0,d=this.points.length;c<d;c++)b=this.points[c],a.lineTo(b.x,b.y);this._renderFill(a);if(this.stroke||this.strokeDashArray)a.closePath(),this._renderStroke(a)},_renderDashedStroke:function(a){var b,d;a.beginPath();for(var e=0,g=this.points.length;e<g;e++)b=this.points[e],d=this.points[e+1]||this.points[0],c.util.drawDashedLine(a,b.x,b.y,d.x,d.y,this.strokeDashArray);a.closePath()},complexity:function(){return this.points.length}}),
c.Polygon.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(),c.Polygon.fromElement=function(b,d){if(!b)return null;d||(d={});var e=c.parsePointsAttribute(b.getAttribute("points")),g=c.parseAttributes(b,c.Polygon.ATTRIBUTE_NAMES);c.util.normalizePoints(e,d);return new c.Polygon(e,a(g,d),!0)},c.Polygon.fromObject=function(a){return new c.Polygon(a.points,a,!0)})})("undefined"!==typeof exports?exports:this);
(function(e){function c(a){return"H"===a[0]?a[1]:a[a.length-2]}function a(a){return"V"===a[0]?a[1]:a[a.length-1]}var d=e.fabric||(e.fabric={}),b=d.util.array.min,g=d.util.array.max,f=d.util.object.extend,h=Object.prototype.toString,l=d.util.drawArc,k={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};d.Path?d.warn("fabric.Path is already defined"):(d.Path=d.util.createClass(d.Object,{type:"path",path:null,initialize:function(a,b){b=b||{};this.setOptions(b);if(!a)throw Error("`path` argument is required");var c=
"[object Array]"===h.call(a);if(this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))c||(this.path=this._parsePath()),this._initializePath(b),b.sourcePath&&this.setSourcePath(b.sourcePath)},_initializePath:function(a){var b="width"in a&&null!=a.width,c="height"in a&&null!=a.width,d="left"in a,e="top"in a,g=d?this.left:0,h=e?this.top:0;b&&c?(e||(this.top=this.height/2),d||(this.left=this.width/2)):(f(this,this._parseDimensions()),b&&(this.width=a.width),c&&(this.height=a.height));this.pathOffset=
this.pathOffset||this._calculatePathOffset(g,h)},_calculatePathOffset:function(a,b){return{x:this.left-a-this.width/2,y:this.top-b-this.height/2}},_render:function(a){for(var b,c=null,d=0,f=0,e=0,g=0,h,k,v,u,r=-(this.width/2+this.pathOffset.x),z=-(this.height/2+this.pathOffset.y),C=0,B=this.path.length;C<B;++C){b=this.path[C];switch(b[0]){case "l":d+=b[1];f+=b[2];a.lineTo(d+r,f+z);break;case "L":d=b[1];f=b[2];a.lineTo(d+r,f+z);break;case "h":d+=b[1];a.lineTo(d+r,f+z);break;case "H":d=b[1];a.lineTo(d+
r,f+z);break;case "v":f+=b[1];a.lineTo(d+r,f+z);break;case "V":f=b[1];a.lineTo(d+r,f+z);break;case "m":d+=b[1];f+=b[2];c=!c||"m"!==c[0]&&"M"!==c[0]?"moveTo":"lineTo";a[c](d+r,f+z);break;case "M":d=b[1];f=b[2];c=!c||"m"!==c[0]&&"M"!==c[0]?"moveTo":"lineTo";a[c](d+r,f+z);break;case "c":h=d+b[5];k=f+b[6];e=d+b[3];g=f+b[4];a.bezierCurveTo(d+b[1]+r,f+b[2]+z,e+r,g+z,h+r,k+z);d=h;f=k;break;case "C":d=b[5];f=b[6];e=b[3];g=b[4];a.bezierCurveTo(b[1]+r,b[2]+z,e+r,g+z,d+r,f+z);break;case "s":h=d+b[3];k=f+b[4];
e=e?2*d-e:d;g=g?2*f-g:f;a.bezierCurveTo(e+r,g+z,d+b[1]+r,f+b[2]+z,h+r,k+z);e=d+b[1];g=f+b[2];d=h;f=k;break;case "S":h=b[3];k=b[4];e=2*d-e;g=2*f-g;a.bezierCurveTo(e+r,g+z,b[1]+r,b[2]+z,h+r,k+z);d=h;f=k;e=b[1];g=b[2];break;case "q":h=d+b[3];k=f+b[4];e=d+b[1];g=f+b[2];a.quadraticCurveTo(e+r,g+z,h+r,k+z);d=h;f=k;break;case "Q":h=b[3];k=b[4];a.quadraticCurveTo(b[1]+r,b[2]+z,h+r,k+z);d=h;f=k;e=b[1];g=b[2];break;case "t":h=d+b[1];k=f+b[2];null===c[0].match(/[QqTt]/)?(e=d,g=f):"t"===c[0]?(e=2*d-v,g=2*f-u):
"q"===c[0]&&(e=2*d-e,g=2*f-g);v=e;u=g;a.quadraticCurveTo(e+r,g+z,h+r,k+z);d=h;f=k;e=d+b[1];g=f+b[2];break;case "T":h=b[1];k=b[2];e=2*d-e;g=2*f-g;a.quadraticCurveTo(e+r,g+z,h+r,k+z);d=h;f=k;break;case "a":l(a,d+r,f+z,[b[1],b[2],b[3],b[4],b[5],b[6]+d+r,b[7]+f+z]);d+=b[6];f+=b[7];break;case "A":l(a,d+r,f+z,[b[1],b[2],b[3],b[4],b[5],b[6]+r,b[7]+z]);d=b[6];f=b[7];break;case "z":case "Z":a.closePath()}c=b}},render:function(a,b){if(this.visible){a.save();var c=this.transformMatrix;c&&a.transform(c[0],c[1],
c[2],c[3],c[4],c[5]);b||this.transform(a);this._setStrokeStyles(a);this._setFillStyles(a);this._setShadow(a);this.clipTo&&d.util.clipContext(this,a);a.beginPath();this._render(a);this._renderFill(a);this._renderStroke(a);this.clipTo&&a.restore();this._removeShadow(a);!b&&this.active&&(this.drawBorders(a),this.drawControls(a));a.restore()}},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){a=f(this.callSuper("toObject",
a),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});this.sourcePath&&(a.sourcePath=this.sourcePath);this.transformMatrix&&(a.transformMatrix=this.transformMatrix);return a},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.path=this.sourcePath);delete a.sourcePath;return a},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d=0,f=this.path.length;d<f;d++)b.push(this.path[d].join(" "));b=b.join(" ");c.push('<g transform="',this.group?"":this.getSvgTransform(),
'">',"<path ",'d="',b,'" style="',this.getSvgStyles(),'" transform="translate(',-this.width/2," ",-this.height/2,")",'" stroke-linecap="round" ',"/>","</g>");return a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],b=[],c,d,f=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,e,g=0,h=this.path.length;g<h;g++){c=this.path[g];e=c.slice(1).trim();for(b.length=0;d=f.exec(e);)b.push(d[0]);c=[c.charAt(0)];e=0;for(var l=b.length;e<l;e++)d=parseFloat(b[e]),
isNaN(d)||c.push(d);d=c[0].toLowerCase();d=k[d];if(c.length-1>d)for(e=1,l=c.length;e<l;e+=d)a.push([c[0]].concat(c.slice(e,e+d)));else a.push(c)}return a},_parseDimensions:function(){var a=[],c=[],d={};this.path.forEach(function(b,f){this._getCoordsFromCommand(b,f,a,c,d)},this);var f=b(a),e=b(c),h=g(a),k=g(c),h=h-f,k=k-e;return{left:this.left+(f+h/2),top:this.top+(e+k/2),width:h,height:k}},_getCoordsFromCommand:function(b,d,f,e,g){var h=!1;"H"!==b[0]&&(g.x=0===d?c(b):c(this.path[d-1]));"V"!==b[0]&&
(g.y=0===d?a(b):a(this.path[d-1]));b[0]===b[0].toLowerCase()&&(h=!0);b=this._getXY(b,h,g);d=parseInt(b.x,10);isNaN(d)||f.push(d);d=parseInt(b.y,10);isNaN(d)||e.push(d)},_getXY:function(b,d,f){var e=d?f.x+c(b):"V"===b[0]?f.x:c(b);b=d?f.y+a(b):"H"===b[0]?f.y:a(b);return{x:e,y:b}}}),d.Path.fromObject=function(a,b){"string"===typeof a.path?d.loadSVGFromURL(a.path,function(c){c=c[0];var f=a.path;delete a.path;d.util.object.extend(c,a);c.setSourcePath(f);b(c)}):b(new d.Path(a.path,a))},d.Path.ATTRIBUTE_NAMES=
d.SHARED_ATTRIBUTES.concat(["d"]),d.Path.fromElement=function(a,b,c){a=d.parseAttributes(a,d.Path.ATTRIBUTE_NAMES);b&&b(new d.Path(a.d,f(a,c)))},d.Path.async=!0)})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),a=c.util.object.extend,d=c.util.array.invoke,b=c.Object.prototype.toObject;c.PathGroup?c.warn("fabric.PathGroup is already defined"):(c.PathGroup=c.util.createClass(c.Path,{type:"path-group",fill:"",initialize:function(a,b){b=b||{};this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;this.setOptions(b);this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)},render:function(a){if(this.visible){a.save();var b=this.transformMatrix;
b&&a.transform(b[0],b[1],b[2],b[3],b[4],b[5]);this.transform(a);this._setShadow(a);this.clipTo&&c.util.clipContext(this,a);for(var b=0,d=this.paths.length;b<d;++b)this.paths[b].render(a,!0);this.clipTo&&a.restore();this._removeShadow(a);this.active&&(this.drawBorders(a),this.drawControls(a));a.restore()}},_set:function(a,b){if("fill"===a&&b&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(c){c=a(b.call(this,c),{paths:d(this.getObjects(),
"toObject",c)});this.sourcePath&&(c.sourcePath=this.sourcePath);return c},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.paths=this.sourcePath);return a},toSVG:function(a){for(var b=this.getObjects(),c=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"],d=0,e=b.length;d<e;d++)c.push(b[d].toSVG(a));c.push("</g>");return a?a(c.join("")):c.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+
this.left+" }>"},isSameColor:function(){var a=this.getObjects()[0].get("fill");return this.getObjects().every(function(b){return b.get("fill")===a})},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},getObjects:function(){return this.paths}}),c.PathGroup.fromObject=function(a,b){"string"===typeof a.paths?c.loadSVGFromURL(a.paths,function(d){var e=a.paths;delete a.paths;d=c.util.groupSVGElements(d,a,e);b(d)}):c.util.enlivenObjects(a.paths,
function(d){delete a.paths;b(new c.PathGroup(d,a))})},c.PathGroup.async=!0)})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),a=c.util.object.extend,d=c.util.array.min,b=c.util.array.max,g=c.util.array.invoke;if(!c.Group){var f={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};c.Group=c.util.createClass(c.Object,c.Collection,{type:"group",initialize:function(b,c){c=c||{};this._objects=b||[];for(var d=this._objects.length;d--;)this._objects[d].group=this;this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();
c&&a(this,c);this._setOpacityIfSame();this.setCoords(!0);this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(a){var b=a.getLeft(),c=a.getTop();a.set({originalLeft:b,originalTop:c,left:b-this.left,top:c-this.top});a.setCoords();a.__origHasControls=a.hasControls;a.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();this._objects.push(a);
a.group=this;this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){this._moveFlippedObject(a);this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=this},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,
opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){if(a in this.delegatedProperties){var c=this._objects.length;for(this[a]=b;c--;)this._objects[c].set(a,b)}else this[a]=b},toObject:function(b){return a(this.callSuper("toObject",b),{objects:g(this._objects,"toObject",b)})},render:function(a,b){if(this.visible){a.save();this.transform(a);this.clipTo&&c.util.clipContext(this,a);for(var d=0,f=this._objects.length;d<
f;d++)this._renderObject(this._objects[d],a);this.clipTo&&a.restore();!b&&this.active&&(this.drawBorders(a),this.drawControls(a));a.restore()}},_renderObject:function(a,b){var c=a.borderScaleFactor,d=a.hasRotatingPoint,f=Math.max(this.scaleX,this.scaleY);a.visible&&(a.borderScaleFactor=f,a.hasRotatingPoint=!1,a.render(b),a.borderScaleFactor=c,a.hasRotatingPoint=d)},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},_moveFlippedObject:function(a){var b=
a.get("originX"),c=a.get("originY"),d=a.getCenterPoint();a.set({originX:"center",originY:"center",left:d.x,top:d.y});this._toggleFlipping(a);d=a.getPointByOrigin(b,c);a.set({originX:b,originY:c,left:d.x,top:d.y});return this},_toggleFlipping:function(a){this.flipX&&(a.toggle("flipX"),a.set("left",-a.get("left")),a.setAngle(-a.getAngle()));this.flipY&&(a.toggle("flipY"),a.set("top",-a.get("top")),a.setAngle(-a.getAngle()))},_restoreObjectState:function(a){this._setObjectPosition(a);a.setCoords();a.hasControls=
a.__origHasControls;delete a.__origHasControls;a.set("active",!1);a.setCoords();delete a.group;return this},_setObjectPosition:function(a){var b=this.getLeft(),c=this.getTop(),d=this._getRotatedLeftTop(a);a.set({angle:a.getAngle()+this.getAngle(),left:b+d.left,top:c+d.top,scaleX:a.get("scaleX")*this.get("scaleX"),scaleY:a.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(a){var b=this.getAngle()*(Math.PI/180);return{left:-Math.sin(b)*a.getTop()*this.get("scaleY")+Math.cos(b)*a.getLeft()*
this.get("scaleX"),top:Math.cos(b)*a.getTop()*this.get("scaleY")+Math.sin(b)*a.getLeft()*this.get("scaleX")}},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});return this},
_setOpacityIfSame:function(){var a=this.getObjects(),b=a[0]?a[0].get("opacity"):1;a.every(function(a){return a.get("opacity")===b})&&(this.opacity=b)},_calcBounds:function(a){for(var b=[],c=[],d,f=0,e=this._objects.length;f<e;++f){d=this._objects[f];d.setCoords();for(var g in d.oCoords)b.push(d.oCoords[g].x),c.push(d.oCoords[g].y)}this.set(this._getBounds(b,c,a))},_getBounds:function(a,c,f){var e=d(a),g=b(a);a=d(c);var p=b(c);c=g-e||0;g=p-a||0;p={width:c,height:g};f||(p.left=e+c/2||0,p.top=a+g/2||
0);return p},toSVG:function(a){for(var b=["<g ",'transform="',this.getSvgTransform(),'">'],c=0,d=this._objects.length;c<d;c++)b.push(this._objects[c].toSVG(a));b.push("</g>");return a?a(b.join("")):b.join("")},get:function(a){if(a in f){if(this[a])return this[a];for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}});c.Group.fromObject=function(a,b){c.util.enlivenObjects(a.objects,
function(d){delete a.objects;b&&b(new c.Group(d,a))})};c.Group.async=!0}})("undefined"!==typeof exports?exports:this);
(function(e){var c=fabric.util.object.extend;e.fabric||(e.fabric={});e.fabric.Image?fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",initialize:function(a,c){c||(c={});this.filters=[];this.callSuper("initialize",c);this._initElement(a,c);this._initConfig(c);c.filters&&(this.filters=c.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(a,c){this._originalElement=this._element=a;
this._initConfig();0!==this.filters.length&&this.applyFilters(c);return this},setCrossOrigin:function(a){this.crossOrigin=a;this._element.crossOrigin=a;return this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},render:function(a,c){if(this.visible){a.save();var b=this.transformMatrix;this.group&&"path-group"===this.group.type&&a.translate(-this.group.width/2+this.width/2,-this.group.height/2+this.height/2);b&&a.transform(b[0],b[1],b[2],b[3],b[4],b[5]);c||
this.transform(a);a.save();this._setShadow(a);this.clipTo&&fabric.util.clipContext(this,a);this._render(a);this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a);this._renderStroke(a);this.clipTo&&a.restore();a.restore();this.active&&!c&&(this.drawBorders(a),this.drawControls(a));a.restore()}},_stroke:function(a){a.save();this._setStrokeStyles(a);a.beginPath();a.strokeRect(-this.width/2,-this.height/2,this.width,this.height);a.closePath();a.restore()},_renderDashedStroke:function(a){var c=
-this.width/2,b=-this.height/2,e=this.width,f=this.height;a.save();this._setStrokeStyles(a);a.beginPath();fabric.util.drawDashedLine(a,c,b,c+e,b,this.strokeDashArray);fabric.util.drawDashedLine(a,c+e,b,c+e,b+f,this.strokeDashArray);fabric.util.drawDashedLine(a,c+e,b+f,c,b+f,this.strokeDashArray);fabric.util.drawDashedLine(a,c,b+f,c,b,this.strokeDashArray);a.closePath();a.restore()},toObject:function(a){return c(this.callSuper("toObject",a),{src:this._originalElement.src||this._originalElement._src,
filters:this.filters.map(function(a){return a&&a.toObject()}),crossOrigin:this.crossOrigin})},toSVG:function(a){var c=[];c.push('<g transform="',this.getSvgTransform(),'">','<image xlink:href="',this.getSvgSrc(),'" style="',this.getSvgStyles(),'" transform="translate('+-this.width/2+" "+-this.height/2+")",'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="none"',"></image>");if(this.stroke||this.strokeDashArray){var b=this.fill;this.fill=null;c.push("<rect ",'x="',-1*this.width/
2,'" y="',-1*this.height/2,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>');this.fill=b}c.push("</g>");return a?a(c.join("")):c.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(a,c){this.constructor.fromObject(this.toObject(c),a)},applyFilters:function(a){if(this._originalElement)if(0===this.filters.length)this._element=
this._originalElement,a&&a();else{var c=this._originalElement,b=fabric.util.createCanvasElement(),e=fabric.util.createImage(),f=this;b.width=c.width;b.height=c.height;b.getContext("2d").drawImage(c,0,0,c.width,c.height);this.filters.forEach(function(a){a&&a.applyTo(b)});e.width=c.width;e.height=c.height;fabric.isLikelyNode?(e.src=b.toBuffer(void 0,fabric.Image.pngCompression),f._element=e,a&&a()):(e.onload=function(){f._element=e;a&&a();e.onload=b=c=null},e.src=b.toDataURL("image/png"));return this}},
_render:function(a){this._element&&a.drawImage(this._element,-this.width/2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width);this.set("height",a.height)},_initElement:function(a){this.setElement(fabric.util.getById(a));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={});this.setOptions(a);this._setWidthHeight(a);this._element&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(a,
c){a.filters&&a.filters.length?fabric.util.enlivenObjects(a.filters,function(a){c&&c(a)},"fabric.Image.filters"):c&&c()},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement()?this.getElement().width||0:0;this.height="height"in a?a.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(a,c){fabric.util.loadImage(a.src,
function(b){fabric.Image.prototype._initFilters.call(a,a,function(e){a.filters=e||[];e=new fabric.Image(b,a);c&&c(e)})},null,a.crossOrigin)},fabric.Image.fromURL=function(a,c,b){fabric.util.loadImage(a,function(a){c(new fabric.Image(a,b))},null,b&&b.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(["x","y","width","height","xlink:href"]),fabric.Image.fromElement=function(a,d,b){a=fabric.parseAttributes(a,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(a["xlink:href"],
d,c(b?fabric.util.object.clone(b):{},a))},fabric.Image.async=!0,fabric.Image.pngCompression=1)})("undefined"!==typeof exports?exports:this);
fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.getAngle()%360;return 0<e?90*Math.round((e-1)/90):90*Math.round(e/90)},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(e){e=e||{};var c=function(){},a=e.onComplete||c,d=e.onChange||c,b=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){b.setAngle(a);
d()},onComplete:function(){b.setCoords();a()},onStart:function(){b.set("active",!1)}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(e){e.straighten();this.renderAll();return this},fxStraightenObject:function(e){e.fxStraighten({onChange:this.renderAll.bind(this)});return this}});fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}});
(function(e){var c=e.fabric||(e.fabric={}),a=c.util.object.extend;c.Image.filters.Brightness=c.util.createClass(c.Image.filters.BaseFilter,{type:"Brightness",initialize:function(a){a=a||{};this.brightness=a.brightness||100},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,f=this.brightness,e=0,l=c.length;e<l;e+=4)c[e]+=f,c[e+1]+=f,c[e+2]+=f;b.putImageData(a,0,0)},toObject:function(){return a(this.callSuper("toObject"),{brightness:this.brightness})}});
c.Image.filters.Brightness.fromObject=function(a){return new c.Image.filters.Brightness(a)}})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),a=c.util.object.extend;c.Image.filters.Convolute=c.util.createClass(c.Image.filters.BaseFilter,{type:"Convolute",initialize:function(a){a=a||{};this.opaque=a.opaque;this.matrix=a.matrix||[0,0,0,0,1,0,0,0,0];this.tmpCtx=c.util.createCanvasElement().getContext("2d")},_createImageData:function(a,b){return this.tmpCtx.createImageData(a,b)},applyTo:function(a){var b=this.matrix,c=a.getContext("2d"),f=c.getImageData(0,0,a.width,a.height);a=Math.round(Math.sqrt(b.length));
for(var e=Math.floor(a/2),l=f.data,k=f.width,f=f.height,m=this._createImageData(k,f),n=m.data,p=this.opaque?1:0,q=0;q<f;q++)for(var s=0;s<k;s++){for(var x=q,t=s,w=4*(q*k+s),A=0,v=0,u=0,r=0,z=0;z<a;z++)for(var C=0;C<a;C++){var B=x+z-e,D=t+C-e;0>B||B>f||0>D||D>k||(B=4*(B*k+D),D=b[z*a+C],A+=l[B]*D,v+=l[B+1]*D,u+=l[B+2]*D,r+=l[B+3]*D)}n[w]=A;n[w+1]=v;n[w+2]=u;n[w+3]=r+p*(255-r)}c.putImageData(m,0,0)},toObject:function(){return a(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});c.Image.filters.Convolute.fromObject=
function(a){return new c.Image.filters.Convolute(a)}})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),a=c.util.object.extend;c.Image.filters.GradientTransparency=c.util.createClass(c.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(a){a=a||{};this.threshold=a.threshold||100},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,f=this.threshold,e=c.length,l=0,k=c.length;l<k;l+=4)c[l+3]=f+255*(e-l)/e;b.putImageData(a,0,0)},toObject:function(){return a(this.callSuper("toObject"),{threshold:this.threshold})}});
c.Image.filters.GradientTransparency.fromObject=function(a){return new c.Image.filters.GradientTransparency(a)}})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={});c.Image.filters.Grayscale=c.util.createClass(c.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(a){var c=a.getContext("2d");a=c.getImageData(0,0,a.width,a.height);for(var b=a.data,e=4*a.width*a.height,f=0,h;f<e;)h=(b[f]+b[f+1]+b[f+2])/3,b[f]=h,b[f+1]=h,b[f+2]=h,f+=4;c.putImageData(a,0,0)}});c.Image.filters.Grayscale.fromObject=function(){return new c.Image.filters.Grayscale}})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={});c.Image.filters.Invert=c.util.createClass(c.Image.filters.BaseFilter,{type:"Invert",applyTo:function(a){var c=a.getContext("2d");a=c.getImageData(0,0,a.width,a.height);var b=a.data,e=b.length,f;for(f=0;f<e;f+=4)b[f]=255-b[f],b[f+1]=255-b[f+1],b[f+2]=255-b[f+2];c.putImageData(a,0,0)}});c.Image.filters.Invert.fromObject=function(){return new c.Image.filters.Invert}})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),a=c.util.object.extend;c.Image.filters.Mask=c.util.createClass(c.Image.filters.BaseFilter,{type:"Mask",initialize:function(a){a=a||{};this.mask=a.mask;this.channel=-1<[0,1,2,3].indexOf(a.channel)?a.channel:0},applyTo:function(a){if(this.mask){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);var e=a.data,f=this.mask.getElement(),h=c.util.createCanvasElement(),l=this.channel,k=4*a.width*a.height;h.width=f.width;h.height=f.height;h.getContext("2d").drawImage(f,
0,0,f.width,f.height);h=h.getContext("2d").getImageData(0,0,f.width,f.height).data;for(f=0;f<k;f+=4)e[f+3]=h[f+l];b.putImageData(a,0,0)}},toObject:function(){return a(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});c.Image.filters.Mask.fromObject=function(a,b){c.util.loadImage(a.mask.src,function(e){a.mask=new c.Image(e,a.mask);b&&b(new c.Image.filters.Mask(a))})};c.Image.filters.Mask.async=!0})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),a=c.util.object.extend;c.Image.filters.Noise=c.util.createClass(c.Image.filters.BaseFilter,{type:"Noise",initialize:function(a){a=a||{};this.noise=a.noise||100},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,f=this.noise,e,l=0,k=c.length;l<k;l+=4)e=(0.5-Math.random())*f,c[l]+=e,c[l+1]+=e,c[l+2]+=e;b.putImageData(a,0,0)},toObject:function(){return a(this.callSuper("toObject"),{noise:this.noise})}});c.Image.filters.Noise.fromObject=
function(a){return new c.Image.filters.Noise(a)}})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),a=c.util.object.extend;c.Image.filters.Pixelate=c.util.createClass(c.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(a){a=a||{};this.blocksize=a.blocksize||4},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);var c=a.data,f=a.height,e=a.width,l,k,m,n,p,q,s;for(k=0;k<f;k+=this.blocksize)for(m=0;m<e;m+=this.blocksize){l=4*k*e+4*m;n=c[l];p=c[l+1];q=c[l+2];s=c[l+3];for(var x=k,t=k+this.blocksize;x<t;x++)for(var w=
m,A=m+this.blocksize;w<A;w++)l=4*x*e+4*w,c[l]=n,c[l+1]=p,c[l+2]=q,c[l+3]=s}b.putImageData(a,0,0)},toObject:function(){return a(this.callSuper("toObject"),{blocksize:this.blocksize})}});c.Image.filters.Pixelate.fromObject=function(a){return new c.Image.filters.Pixelate(a)}})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),a=c.util.object.extend;c.Image.filters.RemoveWhite=c.util.createClass(c.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(a){a=a||{};this.threshold=a.threshold||30;this.distance=a.distance||20},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,f=this.distance,e=255-this.threshold,l=Math.abs,k,m,n,p=0,q=c.length;p<q;p+=4)k=c[p],m=c[p+1],n=c[p+2],k>e&&m>e&&n>e&&l(k-m)<f&&l(k-n)<f&&l(m-n)<f&&
(c[p+3]=1);b.putImageData(a,0,0)},toObject:function(){return a(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});c.Image.filters.RemoveWhite.fromObject=function(a){return new c.Image.filters.RemoveWhite(a)}})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={});c.Image.filters.Sepia=c.util.createClass(c.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(a){var c=a.getContext("2d");a=c.getImageData(0,0,a.width,a.height);var b=a.data,e=b.length,f,h;for(f=0;f<e;f+=4)h=0.3*b[f]+0.59*b[f+1]+0.11*b[f+2],b[f]=h+100,b[f+1]=h+50,b[f+2]=h+255;c.putImageData(a,0,0)}});c.Image.filters.Sepia.fromObject=function(){return new c.Image.filters.Sepia}})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={});c.Image.filters.Sepia2=c.util.createClass(c.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(a){var c=a.getContext("2d");a=c.getImageData(0,0,a.width,a.height);var b=a.data,e=b.length,f,h,l,k;for(f=0;f<e;f+=4)h=b[f],l=b[f+1],k=b[f+2],b[f]=(0.393*h+0.769*l+0.189*k)/1.351,b[f+1]=(0.349*h+0.686*l+0.168*k)/1.203,b[f+2]=(0.272*h+0.534*l+0.131*k)/2.14;c.putImageData(a,0,0)}});c.Image.filters.Sepia2.fromObject=function(){return new c.Image.filters.Sepia2}})("undefined"!==
typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),a=c.util.object.extend;c.Image.filters.Tint=c.util.createClass(c.Image.filters.BaseFilter,{type:"Tint",initialize:function(a){a=a||{};this.color=a.color||"#000000";this.opacity="undefined"!==typeof a.opacity?a.opacity:(new c.Color(this.color)).getAlpha()},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);var e=a.data,f=e.length,h,l,k,m,n,p,q,s;h=(new c.Color(this.color)).getSource();l=h[0]*this.opacity;k=h[1]*this.opacity;
m=h[2]*this.opacity;s=1-this.opacity;for(h=0;h<f;h+=4)n=e[h],p=e[h+1],q=e[h+2],e[h]=l+n*s,e[h+1]=k+p*s,e[h+2]=m+q*s;b.putImageData(a,0,0)},toObject:function(){return a(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}});c.Image.filters.Tint.fromObject=function(a){return new c.Image.filters.Tint(a)}})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),a=c.util.object.extend,d=c.util.object.clone,b=c.util.toFixed,g=c.StaticCanvas.supports("setLineDash");c.Text?c.warn("fabric.Text is already defined"):(e=c.Object.prototype.stateProperties.concat(),e.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path"),c.Text=c.util.createClass(c.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,textDecoration:!0,
fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:!0,stateProperties:e,stroke:null,shadow:null,initialize:function(a,b){b=b||{};this.text=a;this.__skipDimension=!0;this.setOptions(b);this.__skipDimension=!1;this._initDimensions();this.setCoords()},_initDimensions:function(){if(!this.__skipDimension){var a=
c.util.createCanvasElement();this._render(a.getContext("2d"))}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){var b=this.group&&"path-group"===this.group.type;b&&!this.transformMatrix?a.translate(-this.group.width/2+this.left,-this.group.height/2+this.top):b&&this.transformMatrix&&a.translate(-this.group.width/2,-this.group.height/2);"undefined"===typeof Cufon||!0===this.useNative?this._renderViaNative(a):
this._renderViaCufon(a)},_renderViaNative:function(a){var b=this.text.split(this._reNewline);this.transform(a,c.isLikelyNode);this._setTextStyles(a);this.width=this._getTextWidth(a,b);this.height=this._getTextHeight(a,b);this.clipTo&&c.util.clipContext(this,a);this._renderTextBackground(a,b);this._translateForTextAlign(a);this._renderText(a,b);"left"!==this.textAlign&&"justify"!==this.textAlign&&a.restore();this._renderTextDecoration(a,b);this.clipTo&&a.restore();this._setBoundaries(a,b);this._totalLineHeight=
0},_renderText:function(a,b){a.save();this._setShadow(a);this._renderTextFill(a,b);this._renderTextStroke(a,b);this._removeShadow(a);a.restore()},_translateForTextAlign:function(a){"left"!==this.textAlign&&"justify"!==this.textAlign&&(a.save(),a.translate("center"===this.textAlign?this.width/2:this.width,0))},_setBoundaries:function(a,b){this._boundaries=[];for(var c=0,d=b.length;c<d;c++){var e=this._getLineWidth(a,b[c]),g=this._getLineLeftOffset(e);this._boundaries.push({height:this.fontSize*this.lineHeight,
width:e,left:g})}},_setTextStyles:function(a){this._setFillStyles(a);this._setStrokeStyles(a);a.textBaseline="alphabetic";this.skipTextAlign||(a.textAlign=this.textAlign);a.font=this._getFontDeclaration()},_getTextHeight:function(a,b){return this.fontSize*b.length*this.lineHeight},_getTextWidth:function(a,b){for(var c=a.measureText(b[0]||"|").width,d=1,e=b.length;d<e;d++){var g=a.measureText(b[d]).width;g>c&&(c=g)}return c},_renderChars:function(a,b,c,d,e){b[a](c,d,e)},_renderTextLine:function(a,
b,c,d,e,g){e-=this.fontSize/4;if("justify"!==this.textAlign)this._renderChars(a,b,c,d,e,g);else{var p=b.measureText(c).width,q=this.width;if(q>p){p=c.split(/\s+/);c=b.measureText(c.replace(/\s+/g,"")).width;for(var q=(q-c)/(p.length-1),s=c=0,x=p.length;s<x;s++)this._renderChars(a,b,p[s],d+c,e,g),c+=b.measureText(p[s]).width+q}else this._renderChars(a,b,c,d,e,g)}},_getLeftOffset:function(){return c.isLikelyNode?0:-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a,
b){if(this.fill||this._skipFillStrokeCheck){this._boundaries=[];for(var c=0,d=0,e=b.length;d<e;d++){var g=this._getHeightOfLine(a,d,b),c=c+g;this._renderTextLine("fillText",a,b[d],this._getLeftOffset(),this._getTopOffset()+c,d)}}},_renderTextStroke:function(a,b){if(this.stroke||this._skipFillStrokeCheck){var c=0;a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),g&&a.setLineDash(this.strokeDashArray));a.beginPath();
for(var d=0,e=b.length;d<e;d++){var n=this._getHeightOfLine(a,d,b),c=c+n;this._renderTextLine("strokeText",a,b[d],this._getLeftOffset(),this._getTopOffset()+c,d)}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_renderTextBackground:function(a,b){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a,b)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.save(),a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),
this.width,this.height),a.restore())},_renderTextLinesBackground:function(a,b){if(this.textBackgroundColor){a.save();a.fillStyle=this.textBackgroundColor;for(var c=0,d=b.length;c<d;c++)if(""!==b[c]){var e=this._getLineWidth(a,b[c]),g=this._getLineLeftOffset(e);a.fillRect(this._getLeftOffset()+g,this._getTopOffset()+c*this.fontSize*this.lineHeight,e,this.fontSize*this.lineHeight)}a.restore()}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?
this.width-a:0},_getLineWidth:function(a,b){return"justify"===this.textAlign?this.width:a.measureText(b).width},_renderTextDecoration:function(a,b){function c(g){for(var l=0,q=b.length;l<q;l++){var s=e._getLineWidth(a,b[l]),x=e._getLineLeftOffset(s);a.fillRect(e._getLeftOffset()+x,~~(g+l*e._getHeightOfLine(a,l,b)-d),s,1)}}if(this.textDecoration){var d=this._getTextHeight(a,b)/2,e=this;-1<this.textDecoration.indexOf("underline")&&c(this.fontSize*this.lineHeight);-1<this.textDecoration.indexOf("line-through")&&
c(this.fontSize*this.lineHeight-this.fontSize/2);-1<this.textDecoration.indexOf("overline")&&c(this.fontSize*this.lineHeight-this.fontSize)}},_getFontDeclaration:function(){return[c.isLikelyNode?this.fontWeight:this.fontStyle,c.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",c.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){if(this.visible){a.save();var c=this.transformMatrix;c&&!this.group&&a.setTransform(c[0],c[1],c[2],c[3],c[4],c[5]);this._render(a);
!b&&this.active&&(this.drawBorders(a),this.drawControls(a));a.restore()}},toObject:function(b){b=a(this.callSuper("toObject",b),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});this.includeDefaultValues||this._removeDefaultValues(b);return b},toSVG:function(a){var b=
[],c=this.text.split(this._reNewline),d=this._getSVGLeftTopOffsets(c),e=this._getSVGTextAndBg(d.lineTop,d.textLeft,c),c=this._getSVGShadows(d.lineTop,c);d.textTop+=this._fontAscent?this._fontAscent/5*this.lineHeight:0;this._wrapSVGTextAndBg(b,e,c,d);return a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){return{textLeft:-(this.width/2),textTop:this.useNative?this.fontSize-1:this.height/2-a.length*this.fontSize-this._totalLineHeight,lineTop:this.useNative?this.fontSize*this.lineHeight:
-this._fontAscent-this._fontAscent/5*this.lineHeight}},_wrapSVGTextAndBg:function(a,c,d,e){a.push('<g transform="',this.getSvgTransform(),'">',c.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),
'" ','transform="translate(',b(e.textLeft,2)," ",b(e.textTop,2),')">',d.join(""),c.textSpans.join(""),"</text>","</g>")},_getSVGShadows:function(a,d){var e=[],g,m,n=1;if(!this.shadow||!this._boundaries)return e;g=0;for(m=d.length;g<m;g++)""!==d[g]?(e.push('<tspan x="',b((this._boundaries&&this._boundaries[g]?this._boundaries[g].left:0)+n+this.shadow.offsetX,2),0===g||this.useNative?'" y':'" dy','="',b(this.useNative?a*g-this.height/2+this.shadow.offsetY:a+(0===g?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),
">",c.util.string.escapeXml(d[g]),"</tspan>"),n=1):n++;return e},_getSVGTextAndBg:function(a,b,c){var d=[],e=[],g=1;this._setSVGBg(e);for(var p=0,q=c.length;p<q;p++)""!==c[p]?(this._setSVGTextLineText(c[p],p,d,a,g,e),g=1):g++,this.textBackgroundColor&&this._boundaries&&this._setSVGTextLineBg(e,p,b,a);return{textSpans:d,textBgRects:e}},_setSVGTextLineText:function(a,d,e,g,m){var n=this._boundaries&&this._boundaries[d]?b(this._boundaries[d].left,2):0;e.push('<tspan x="',n,'" ',0===d||this.useNative?
"y":"dy",'="',b(this.useNative?g*d-this.height/2:g*m,2),'" ',this._getFillAttributes(this.fill),">",c.util.string.escapeXml(a),"</tspan>")},_setSVGTextLineBg:function(a,c,d,e){a.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',b(d+this._boundaries[c].left,2),'" y="',b(e*c-this.height/2,2),'" width="',b(this._boundaries[c].width,2),'" height="',b(this._boundaries[c].height,2),'"></rect>')},_setSVGBg:function(a){this.backgroundColor&&this._boundaries&&a.push("<rect ",this._getFillAttributes(this.backgroundColor),
' x="',b(-this.width/2,2),'" y="',b(-this.height/2,2),'" width="',b(this.width,2),'" height="',b(this.height,2),'"></rect>')},_getFillAttributes:function(a){var b=a&&"string"===typeof a?new c.Color(a):"";return b&&b.getSource()&&1!==b.getAlpha()?'opacity="'+b.getAlpha()+'" fill="'+b.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,b){"fontFamily"===a&&this.path&&(this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+b+"$3"));this.callSuper("_set",a,b);a in this._dimensionAffectingProps&&
(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),c.Text.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y font-family font-style font-weight font-size text-decoration".split(" ")),c.Text.fromElement=function(a,b){if(!a)return null;var d=c.parseAttributes(a,c.Text.ATTRIBUTE_NAMES);b=c.util.object.extend(b?c.util.object.clone(b):{},d);d=new c.Text(a.textContent,b);d.set({left:d.getLeft()+d.getWidth()/2,top:d.getTop()-d.getHeight()/2});return d},c.Text.fromObject=function(a){return new c.Text(a.text,
d(a))},c.util.createAccessors(c.Text))})("undefined"!==typeof exports?exports:this);
fabric.util.object.extend(fabric.Text.prototype,{_renderViaCufon:function(e){var c=Cufon.textOptions||(Cufon.textOptions={});c.left=this.left;c.top=this.top;c.context=e;c.color=this.fill;var a=this._initDummyElementForCufon();this.transform(e);Cufon.replaceElement(a,{engine:"canvas",separate:"none",fontFamily:this.fontFamily,fontWeight:this.fontWeight,textDecoration:this.textDecoration,textShadow:this.shadow&&this.shadow.toString(),textAlign:this.textAlign,fontStyle:this.fontStyle,lineHeight:this.lineHeight,
stroke:this.stroke,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor});this.width=c.width;this.height=c.height;this._totalLineHeight=c.totalLineHeight;this._fontAscent=c.fontAscent;this._boundaries=c.boundaries;this.setCoords()},_initDummyElementForCufon:function(){var e=fabric.document.createElement("pre");fabric.document.createElement("div").appendChild(e);"undefined"===typeof G_vmlCanvasManager?e.innerHTML=this.text:e.innerText=this.text.replace(/\r?\n/gi,
"\r");e.style.fontSize=this.fontSize+"px";e.style.letterSpacing="normal";return e}});
(function(){var e=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1E3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!0,_reSpace:/\s|\n/,_fontSizeFraction:4,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},
initialize:function(c,a){this.styles=a?a.styles||{}:{};this.callSuper("initialize",c,a);this.initBehavior();fabric.IText.instances.push(this);this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},isEmptyStyles:function(){if(!this.styles)return!0;var c=this.styles,a;for(a in c)for(var d in c[a])for(var b in c[a][d])return!1;return!0},setSelectionStart:function(c){this.selectionStart!==c&&this.canvas&&this.canvas.fire("text:selection:changed",{target:this});this.selectionStart=c;this.hiddenTextarea&&
(this.hiddenTextarea.selectionStart=c)},setSelectionEnd:function(c){this.selectionEnd!==c&&this.canvas&&this.canvas.fire("text:selection:changed",{target:this});this.selectionEnd=c;this.hiddenTextarea&&(this.hiddenTextarea.selectionEnd=c)},getSelectionStyles:function(c,a){if(2===arguments.length){for(var d=[],b=c;b<a;b++)d.push(this.getSelectionStyles(b));return d}d=this.get2DCursorLocation(c);return this.styles[d.lineIndex]?this.styles[d.lineIndex][d.charIndex]||{}:{}},setSelectionStyles:function(c){if(this.selectionStart===
this.selectionEnd)this._extendStyles(this.selectionStart,c);else for(var a=this.selectionStart;a<this.selectionEnd;a++)this._extendStyles(a,c);return this},_extendStyles:function(c,a){var d=this.get2DCursorLocation(c);this.styles[d.lineIndex]||(this.styles[d.lineIndex]={});this.styles[d.lineIndex][d.charIndex]||(this.styles[d.lineIndex][d.charIndex]={});fabric.util.object.extend(this.styles[d.lineIndex][d.charIndex],a)},_render:function(c){this.callSuper("_render",c);this.ctx=c;this.isEditing&&this.renderCursorOrSelection()},
renderCursorOrSelection:function(){if(this.active){var c=this.text.split(""),a;this.selectionStart===this.selectionEnd?(a=this._getCursorBoundaries(c,"cursor"),this.renderCursor(a)):(a=this._getCursorBoundaries(c,"selection"),this.renderSelection(c,a))}},get2DCursorLocation:function(c){"undefined"===typeof c&&(c=this.selectionStart);c=this.text.slice(0,c).split(this._reNewline);return{lineIndex:c.length-1,charIndex:c[c.length-1].length}},getCurrentCharStyle:function(c,a){var d=this.styles[c]&&this.styles[c][0===
a?0:a-1];return{fontSize:d&&d.fontSize||this.fontSize,fill:d&&d.fill||this.fill,textBackgroundColor:d&&d.textBackgroundColor||this.textBackgroundColor,textDecoration:d&&d.textDecoration||this.textDecoration,fontFamily:d&&d.fontFamily||this.fontFamily,stroke:d&&d.stroke||this.stroke,strokeWidth:d&&d.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(c,a){return this.styles[c]&&this.styles[c][0===a?0:a-1]&&this.styles[c][0===a?0:a-1].fontSize||this.fontSize},getCurrentCharColor:function(c,
a){return this.styles[c]&&this.styles[c][0===a?0:a-1]&&this.styles[c][0===a?0:a-1].fill||this.cursorColor},_getCursorBoundaries:function(c,a){var d=this.get2DCursorLocation(),b=this.text.split(this._reNewline),e=Math.round(this._getLeftOffset()),f=-this.height/2,d=this._getCursorBoundariesOffsets(c,a,d,b);return{left:e,top:f,leftOffset:d.left+d.lineLeft,topOffset:d.top}},_getCursorBoundariesOffsets:function(c,a,d,b){var e=0,f=0,h=0,l=0;d="cursor"===a?this._getHeightOfLine(this.ctx,0)-this.getCurrentCharFontSize(d.lineIndex,
d.charIndex):0;for(var k=0;k<this.selectionStart;k++)"\n"===c[k]?(l=0,d+=this._getCachedLineHeight(f+("cursor"===a?1:0)),f++,h=0):(l+=this._getWidthOfChar(this.ctx,c[k],f,h),h++),e=this._getCachedLineOffset(f,b);this._clearCache();return{top:d,left:l,lineLeft:e}},_clearCache:function(){this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},_getCachedLineHeight:function(c){return this.__lineHeights[c]||(this.__lineHeights[c]=this._getHeightOfLine(this.ctx,c))},_getCachedLineWidth:function(c,
a){return this.__lineWidths[c]||(this.__lineWidths[c]=this._getWidthOfLine(this.ctx,c,a))},_getCachedLineOffset:function(c,a){var d=this._getCachedLineWidth(c,a);return this.__lineOffsets[c]||(this.__lineOffsets[c]=this._getLineLeftOffset(d))},renderCursor:function(c){var a=this.ctx;a.save();var d=this.get2DCursorLocation(),b=d.lineIndex,d=d.charIndex,e=this.getCurrentCharFontSize(b,d),f=0===b&&0===d?this._getCachedLineOffset(b,this.text.split(this._reNewline)):c.leftOffset;a.fillStyle=this.getCurrentCharColor(b,
d);a.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;a.fillRect(c.left+f,c.top+c.topOffset,this.cursorWidth/this.scaleX,e);a.restore()},renderSelection:function(c,a){var d=this.ctx;d.save();d.fillStyle=this.selectionColor;for(var b=this.get2DCursorLocation(this.selectionStart),e=this.get2DCursorLocation(this.selectionEnd),f=b.lineIndex,h=e.lineIndex,l=this.text.split(this._reNewline),k=f;k<=h;k++){var m=this._getCachedLineOffset(k,l)||0,n=this._getCachedLineHeight(k),p=0;if(k===f)for(var q=
0,s=l[k].length;q<s;q++)q>=b.charIndex&&(k!==h||q<e.charIndex)&&(p+=this._getWidthOfChar(d,l[k][q],k,q)),q<b.charIndex&&(m+=this._getWidthOfChar(d,l[k][q],k,q));else if(k>f&&k<h)p+=this._getCachedLineWidth(k,l)||5;else if(k===h)for(q=0,s=e.charIndex;q<s;q++)p+=this._getWidthOfChar(d,l[k][q],k,q);d.fillRect(a.left+m,a.top+a.topOffset,p,n);a.topOffset+=n}d.restore()},_renderChars:function(c,a,d,b,e,f){if(this.isEmptyStyles())return this._renderCharsFast(c,a,d,b,e);this.skipTextAlign=!0;b-="center"===
this.textAlign?this.width/2:"right"===this.textAlign?this.width:0;var h=this.text.split(this._reNewline),l=this._getWidthOfLine(a,f,h),h=this._getHeightOfLine(a,f,h),k=this._getLineLeftOffset(l);d=d.split("");var m,l="";b+=k||0;a.save();for(var k=0,n=d.length;k<=n;k++){m=m||this.getCurrentCharStyle(f,k);var p=this.getCurrentCharStyle(f,k+1);if(this._hasStyleChanged(m,p)||k===n)this._renderChar(c,a,f,k-1,l,b,e,h),l="",m=p;l+=d[k]}a.restore()},_renderCharsFast:function(c,a,d,b,e){this.skipTextAlign=
!1;"fillText"===c&&this.fill&&this.callSuper("_renderChars",c,a,d,b,e);"strokeText"===c&&this.stroke&&this.callSuper("_renderChars",c,a,d,b,e)},_renderChar:function(c,a,d,b,e,f,h,l){var k;if(this.styles&&this.styles[d]&&(k=this.styles[d][b])){var m=k.stroke||this.stroke,n=k.fill||this.fill;a.save();c=this._applyCharStylesGetWidth(a,e,d,b,k);d=this._getHeightOfChar(a,e,d,b);n&&a.fillText(e,f,h);m&&a.strokeText(e,f,h);this._renderCharDecoration(a,k,f,h,c,l,d);a.restore();a.translate(c,0)}else{if("strokeText"===
c&&this.stroke)a[c](e,f,h);if("fillText"===c&&this.fill)a[c](e,f,h);c=this._applyCharStylesGetWidth(a,e,d,b);this._renderCharDecoration(a,null,f,h,c,l);a.translate(a.measureText(e).width,0)}},_hasStyleChanged:function(c,a){return c.fill!==a.fill||c.fontSize!==a.fontSize||c.textBackgroundColor!==a.textBackgroundColor||c.textDecoration!==a.textDecoration||c.fontFamily!==a.fontFamily||c.stroke!==a.stroke||c.strokeWidth!==a.strokeWidth},_renderCharDecoration:function(c,a,d,b,e,f,h){var l=a?a.textDecoration||
this.textDecoration:this.textDecoration;a=(a?a.fontSize:null)||this.fontSize;l&&(-1<l.indexOf("underline")&&this._renderCharDecorationAtOffset(c,d,b+this.fontSize/this._fontSizeFraction,e,0,this.fontSize/20),-1<l.indexOf("line-through")&&this._renderCharDecorationAtOffset(c,d,b+this.fontSize/this._fontSizeFraction,e,h/2,a/20),-1<l.indexOf("overline")&&this._renderCharDecorationAtOffset(c,d,b,e,f-this.fontSize/this._fontSizeFraction,this.fontSize/20))},_renderCharDecorationAtOffset:function(c,a,d,
b,e,f){c.fillRect(a,d-e,b,f)},_renderTextLine:function(c,a,d,b,e,f){e+=this.fontSize/4;this.callSuper("_renderTextLine",c,a,d,b,e,f)},_renderTextDecoration:function(c,a){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",c,a)},_renderTextLinesBackground:function(c,a){if(this.textBackgroundColor||this.styles){c.save();this.textBackgroundColor&&(c.fillStyle=this.textBackgroundColor);for(var d=0,b=this.fontSize/this._fontSizeFraction,e=0,f=a.length;e<f;e++){var h=this._getHeightOfLine(c,
e,a);if(""!==a[e]){var l=this._getWidthOfLine(c,e,a),k=this._getLineLeftOffset(l);this.textBackgroundColor&&(c.fillStyle=this.textBackgroundColor,c.fillRect(this._getLeftOffset()+k,this._getTopOffset()+d+b,l,h));if(this.styles[e])for(var l=0,m=a[e].length;l<m;l++)if(this.styles[e]&&this.styles[e][l]&&this.styles[e][l].textBackgroundColor){var n=a[e][l];c.fillStyle=this.styles[e][l].textBackgroundColor;c.fillRect(this._getLeftOffset()+k+this._getWidthOfCharsAt(c,e,l,a),this._getTopOffset()+d+b,this._getWidthOfChar(c,
n,e,l,a)+1,h)}}d+=h}c.restore()}},_getCacheProp:function(c,a){return c+a.fontFamily+a.fontSize+a.fontWeight+a.fontStyle+a.shadow},_applyCharStylesGetWidth:function(c,a,d,b,g){d=(d=g||this.styles[d]&&this.styles[d][b])?e(d):{};this._applyFontStyles(d);b=this._getCacheProp(a,d);if(this.isEmptyStyles()&&this._charWidthsCache[b]&&this.caching)return this._charWidthsCache[b];"string"===typeof d.shadow&&(d.shadow=new fabric.Shadow(d.shadow));g=d.fill||this.fill;c.fillStyle=g.toLive?g.toLive(c):g;d.stroke&&
(c.strokeStyle=d.stroke&&d.stroke.toLive?d.stroke.toLive(c):d.stroke);c.lineWidth=d.strokeWidth||this.strokeWidth;c.font=this._getFontDeclaration.call(d);this._setShadow.call(d,c);if(!this.caching)return c.measureText(a).width;this._charWidthsCache[b]||(this._charWidthsCache[b]=c.measureText(a).width);return this._charWidthsCache[b]},_applyFontStyles:function(c){c.fontFamily||(c.fontFamily=this.fontFamily);c.fontSize||(c.fontSize=this.fontSize);c.fontWeight||(c.fontWeight=this.fontWeight);c.fontStyle||
(c.fontStyle=this.fontStyle)},_getStyleDeclaration:function(c,a){return this.styles[c]&&this.styles[c][a]?e(this.styles[c][a]):{}},_getWidthOfChar:function(c,a,d,b){var e=this._getStyleDeclaration(d,b);this._applyFontStyles(e);e=this._getCacheProp(a,e);if(this._charWidthsCache[e]&&this.caching)return this._charWidthsCache[e];if(c)return c.save(),a=this._applyCharStylesGetWidth(c,a,d,b),c.restore(),a},_getHeightOfChar:function(c,a,d,b){return this.styles[d]&&this.styles[d][b]?this.styles[d][b].fontSize||
this.fontSize:this.fontSize},_getWidthOfCharAt:function(c,a,d,b){b=b||this.text.split(this._reNewline);b=b[a].split("")[d];return this._getWidthOfChar(c,b,a,d)},_getHeightOfCharAt:function(c,a,d,b){b=b||this.text.split(this._reNewline);b=b[a].split("")[d];return this._getHeightOfChar(c,b,a,d)},_getWidthOfCharsAt:function(c,a,d,b){for(var e=0,f=0;f<d;f++)e+=this._getWidthOfCharAt(c,a,f,b);return e},_getWidthOfLine:function(c,a,d){return this._getWidthOfCharsAt(c,a,d[a].length,d)},_getTextWidth:function(c,
a){if(this.isEmptyStyles())return this.callSuper("_getTextWidth",c,a);for(var d=this._getWidthOfLine(c,0,a),b=1,e=a.length;b<e;b++){var f=this._getWidthOfLine(c,b,a);f>d&&(d=f)}return d},_getHeightOfLine:function(c,a,d){d=d||this.text.split(this._reNewline);var b=this._getHeightOfChar(c,d[a][0],a,0);d=d[a].split("");for(var e=1,f=d.length;e<f;e++){var h=this._getHeightOfChar(c,d[e],a,e);h>b&&(b=h)}return b*this.lineHeight},_getTextHeight:function(c,a){for(var d=0,b=0,e=a.length;b<e;b++)d+=this._getHeightOfLine(c,
b,a);return d},_getTopOffset:function(){return fabric.Text.prototype._getTopOffset.call(this)-this.fontSize/this._fontSizeFraction},_renderTextBoxBackground:function(c){this.backgroundColor&&(c.save(),c.fillStyle=this.backgroundColor,c.fillRect(this._getLeftOffset(),this._getTopOffset()+this.fontSize/this._fontSizeFraction,this.width,this.height),c.restore())},toObject:function(c){return fabric.util.object.extend(this.callSuper("toObject",c),{styles:e(this.styles)})}});fabric.IText.fromObject=function(c){return new fabric.IText(c.text,
e(c))};fabric.IText.instances=[]})();
(function(){var e=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var c=this;setTimeout(function(){c.selected=!0},100);this.canvas&&!this.canvas._hasITextHandlers&&(this._initCanvasHandlers(),this.canvas._hasITextHandlers=!0)})},_initCanvasHandlers:function(){this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers.call()});
this.canvas.on("mouse:up",function(){fabric.IText.instances.forEach(function(c){c.__isMousedown=!1})});this.canvas.on("object:selected",function(c){fabric.IText.prototype.exitEditingOnOthers.call(c.target)})},_tick:function(){var c=this;this._abortCursorAnimation||this.animate("_currentCursorOpacity",1,{duration:this.cursorDuration,onComplete:function(){c._onTickComplete()},onChange:function(){c.canvas&&c.canvas.renderAll()},abort:function(){return c._abortCursorAnimation}})},_onTickComplete:function(){if(!this._abortCursorAnimation){var c=
this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){c.animate("_currentCursorOpacity",0,{duration:this.cursorDuration/2,onComplete:function(){c._tick()},onChange:function(){c.canvas&&c.canvas.renderAll()},abort:function(){return c._abortCursorAnimation}})},100)}},initDelayedCursor:function(c){var a=this,d=c?0:this.cursorDelay;c&&(this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&this.canvas.renderAll());
this._cursorTimeout2&&clearTimeout(this._cursorTimeout2);this._cursorTimeout2=setTimeout(function(){a._abortCursorAnimation=!1;a._tick()},d)},abortCursorAnimation:function(){this._abortCursorAnimation=!0;clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;this.canvas&&this.canvas.renderAll();var c=this;setTimeout(function(){c._abortCursorAnimation=!1},10)},selectAll:function(){this.selectionStart=0;this.selectionEnd=this.text.length;this.canvas&&this.canvas.fire("text:selection:changed",
{target:this})},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(c){var a=0,d=c-1;if(this._reSpace.test(this.text.charAt(d)))for(;this._reSpace.test(this.text.charAt(d));)a++,d--;for(;/\S/.test(this.text.charAt(d))&&-1<d;)a++,d--;return c-a},findWordBoundaryRight:function(c){var a=0,d=c;if(this._reSpace.test(this.text.charAt(d)))for(;this._reSpace.test(this.text.charAt(d));)a++,d++;for(;/\S/.test(this.text.charAt(d))&&d<this.text.length;)a++,
d++;return c+a},findLineBoundaryLeft:function(c){for(var a=0,d=c-1;!/\n/.test(this.text.charAt(d))&&-1<d;)a++,d--;return c-a},findLineBoundaryRight:function(c){for(var a=0,d=c;!/\n/.test(this.text.charAt(d))&&d<this.text.length;)a++,d++;return c+a},getNumNewLinesInSelectedText:function(){for(var c=0,a=0,d=this.getSelectedText().split(""),b=d.length;a<b;a++)"\n"===d[a]&&c++;return c},searchWordBoundary:function(c,a){for(var d=this._reSpace.test(this.text.charAt(c))?c-1:c,b=this.text.charAt(d),e=/[ \n\.,;!\?\-]/;!e.test(b)&&
0<d&&d<this.text.length;)d+=a,b=this.text.charAt(d);e.test(b)&&"\n"!==b&&(d+=1===a?0:1);return d},selectWord:function(c){var a=this.searchWordBoundary(c,-1);c=this.searchWordBoundary(c,1);this.setSelectionStart(a);this.setSelectionEnd(c);this.initDelayedCursor(!0)},selectLine:function(c){var a=this.findLineBoundaryLeft(c);c=this.findLineBoundaryRight(c);this.setSelectionStart(a);this.setSelectionEnd(c);this.initDelayedCursor(!0)},enterEditing:function(){if(!this.isEditing&&this.editable)return this.exitEditingOnOthers(),
this.isEditing=!0,this.initHiddenTextarea(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.canvas&&this.canvas.renderAll(),this.fire("editing:entered"),this.canvas&&this.canvas.fire("text:editing:entered",{target:this}),this},exitEditingOnOthers:function(){fabric.IText.instances.forEach(function(c){c.selected=!1;c.isEditing&&c.exitEditing()},this)},_setEditingProps:function(){this.hoverCursor="text";this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor=
"text");this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,
moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){this.isEditing=this.selected=
!1;this.selectable=!0;this.selectionEnd=this.selectionStart;this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);this.hiddenTextarea=null;this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;this.fire("editing:exited");this.canvas&&this.canvas.fire("text:editing:exited",{target:this});return this},_removeExtraneousStyles:function(){var c=this.text.split(this._reNewline),a;for(a in this.styles)c[a]||delete this.styles[a]},
_removeCharsFromTo:function(c,a){for(var d=a;d!==c;){var b=this.get2DCursorLocation(d).charIndex;d--;(b=this.get2DCursorLocation(d).charIndex>b)?this.removeStyleObject(b,d+1):this.removeStyleObject(0===this.get2DCursorLocation(d).charIndex,d)}this.text=this.text.slice(0,c)+this.text.slice(a)},insertChars:function(c){var a="\n"===this.text.slice(this.selectionStart,this.selectionStart+1);this.text=this.text.slice(0,this.selectionStart)+c+this.text.slice(this.selectionEnd);this.selectionStart===this.selectionEnd&&
this.insertStyleObjects(c,a,this.copiedStyles);this.selectionEnd=this.selectionStart+=c.length;this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(c,a,d){this.shiftLineStyles(c,1);this.styles[c+1]||(this.styles[c+1]={});var b=this.styles[c][a-1],g={};if(d)g[0]=e(b);else for(var f in this.styles[c])parseInt(f,10)>=a&&(g[parseInt(f,10)-a]=this.styles[c][f],delete this.styles[c][f]);
this.styles[c+1]=g},insertCharStyleObject:function(c,a,d){var b=this.styles[c],g=e(b);0!==a||d||(a=1);for(var f in g){var h=parseInt(f,10);h>=a&&(b[h+1]=g[h])}this.styles[c][a]=d||e(b[a-1])},insertStyleObjects:function(c,a,d){if(!this.isEmptyStyles()){var b=this.get2DCursorLocation(),e=b.lineIndex,b=b.charIndex;this.styles[e]||(this.styles[e]={});"\n"===c?this.insertNewlineStyleObject(e,b,a):d?this._insertStyles(d):this.insertCharStyleObject(e,b)}},_insertStyles:function(c){for(var a=0,d=c.length;a<
d;a++){var b=this.get2DCursorLocation(this.selectionStart+a);this.insertCharStyleObject(b.lineIndex,b.charIndex,c[a])}},shiftLineStyles:function(c,a){var d=e(this.styles),b;for(b in this.styles){var g=parseInt(b,10);g>c&&(this.styles[g+a]=d[g])}},removeStyleObject:function(c,a){var d=this.get2DCursorLocation(a),b=d.lineIndex,d=d.charIndex;if(c){var g=this.text.split(this._reNewline)[b-1],g=g?g.length:0;this.styles[b-1]||(this.styles[b-1]={});for(d in this.styles[b])this.styles[b-1][parseInt(d,10)+
g]=this.styles[b][d];this.shiftLineStyles(b,-1)}else{(b=this.styles[b])&&delete b[d+(this.selectionStart===this.selectionEnd?-1:0)];var f=e(b);for(g in f){var h=parseInt(g,10);h>=d&&0!==h&&(b[h-1]=f[h],delete b[h])}}},insertNewline:function(){this.insertChars("\n")}})})();
fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(e){this.__newClickTime=+new Date;var c=this.canvas.getPointer(e.e);this.isTripleClick(c)?(this.fire("tripleclick",e),this._stopEvent(e.e)):this.isDoubleClick(c)&&(this.fire("dblclick",e),this._stopEvent(e.e));this.__lastLastClickTime=this.__lastClickTime;
this.__lastClickTime=this.__newClickTime;this.__lastPointer=c;this.__lastIsEditing=this.isEditing},isDoubleClick:function(e){return 500>this.__newClickTime-this.__lastClickTime&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y&&this.__lastIsEditing},isTripleClick:function(e){return 500>this.__newClickTime-this.__lastClickTime&&500>this.__lastClickTime-this.__lastLastClickTime&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(e){e.preventDefault&&e.preventDefault();
e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMousemoveHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(e){this.selectWord(this.getSelectionStartFromPointer(e.e))});this.on("tripleclick",function(e){this.selectLine(this.getSelectionStartFromPointer(e.e))})},initMousedownHandler:function(){this.on("mousedown",function(e){var c=this.canvas.getPointer(e.e);
this.__mousedownX=c.x;this.__mousedownY=c.y;this.__isMousedown=!0;this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea);this.selected&&this.setCursorByClick(e.e);this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))})},initMousemoveHandler:function(){this.on("mousemove",function(e){this.__isMousedown&&this.isEditing&&(e=this.getSelectionStartFromPointer(e.e),e>=this.__selectionStartOnMouseDown?(this.setSelectionStart(this.__selectionStartOnMouseDown),
this.setSelectionEnd(e)):(this.setSelectionStart(e),this.setSelectionEnd(this.__selectionStartOnMouseDown)))})},_isObjectMoved:function(e){e=this.canvas.getPointer(e);return this.__mousedownX!==e.x||this.__mousedownY!==e.y},initMouseupHandler:function(){this.on("mouseup",function(e){this.__isMousedown=!1;this._isObjectMoved(e.e)||(this.selected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0)})},setCursorByClick:function(e){var c=this.getSelectionStartFromPointer(e);e.shiftKey?
c<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(c)):this.setSelectionEnd(c):(this.setSelectionStart(c),this.setSelectionEnd(c))},_getLocalRotatedPointer:function(e){var c=this.canvas.getPointer(e),c=new fabric.Point(c.x,c.y),a=new fabric.Point(this.left,this.top),c=fabric.util.rotatePoint(c,a,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(e,c)},getSelectionStartFromPointer:function(e){e=this._getLocalRotatedPointer(e);for(var c=this.text.split(this._reNewline),
a=0,d=0,b=0,g=0,f=0,h=c.length;f<h;f++){b+=this._getHeightOfLine(this.ctx,f)*this.scaleY;d=this._getWidthOfLine(this.ctx,f,c);d=this._getLineLeftOffset(d)*this.scaleX;this.flipX&&(c[f]=c[f].split("").reverse().join(""));for(var l=0,k=c[f].length;l<k;l++){var m=c[f][l],a=d,d=d+this._getWidthOfChar(this.ctx,m,f,this.flipX?k-l:l)*this.scaleX;if(b<=e.y||d<=e.x)g++;else return this._getNewSelectionStartFromOffset(e,a,d,g+f,k)}if(e.y<b)return this._getNewSelectionStartFromOffset(e,a,d,g+f,k,l)}return this.text.length},
_getNewSelectionStartFromOffset:function(e,c,a,d,b,g){e=d+(a-e.x>e.x-c?0:1);this.flipX&&(e=b-e);e>this.text.length&&(e=this.text.length);g===b&&e--;return e}});
fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: absolute; top: 0; left: -9999px";fabric.document.body.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,"paste",this.onPaste.bind(this));fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,
"keypress",this.onKeyPress.bind(this));!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",13:"insertNewline",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",86:"paste",88:"cut"},onPaste:function(e){this.insertChars(e.clipboardData.getData("text"))},onClick:function(){this.hiddenTextarea&&
this.hiddenTextarea.focus()},onKeyDown:function(e){if(this.isEditing){if(e.keyCode in this._keysMap)this[this._keysMap[e.keyCode]](e);else if(e.keyCode in this._ctrlKeysMap&&(e.ctrlKey||e.metaKey))this[this._ctrlKeysMap[e.keyCode]](e);else return;e.stopPropagation();this.canvas&&this.canvas.renderAll()}},forwardDelete:function(e){this.selectionStart===this.selectionEnd&&this.moveCursorRight(e);this.removeChars(e)},paste:function(){this.copiedText&&this.insertChars(this.copiedText)},cut:function(e){this.removeChars(e)},
onKeyPress:function(e){!this.isEditing||e.metaKey||e.ctrlKey||8===e.keyCode||13===e.keyCode||(this.insertChars(String.fromCharCode(e.which)),e.stopPropagation())},getDownCursorOffset:function(e,c){var a=c?this.selectionEnd:this.selectionStart,d=this.text.split(this._reNewline),b=this.text.slice(0,a),g=this.text.slice(a),f=b.slice(b.lastIndexOf("\n")+1),b=g.match(/(.*)\n?/)[1],g=(g.match(/.*\n(.*)\n?/)||{})[1]||"",h=this.get2DCursorLocation(a);if(h.lineIndex===d.length-1||e.metaKey)return this.text.length-
a;for(var a=this._getWidthOfLine(this.ctx,h.lineIndex,d),l=this._getLineLeftOffset(a),k=h.lineIndex,m=0,n=f.length;m<n;m++)a=f[m],l+=this._getWidthOfChar(this.ctx,a,k,m);d=this._getIndexOnNextLine(h,g,l,d);return b.length+1+d},_getIndexOnNextLine:function(e,c,a,d){e=e.lineIndex+1;d=this._getWidthOfLine(this.ctx,e,d);var b=this._getLineLeftOffset(d),g=0,f;d=0;for(var h=c.length;d<h;d++){var l=this._getWidthOfChar(this.ctx,c[d],e,d),b=b+l;if(b>a){f=!0;e=b;b=Math.abs(b-l-a);g=Math.abs(e-a)<b?d+1:d;break}}f||
(g=c.length);return g},moveCursorDown:function(e){this.abortCursorAnimation();this._currentCursorOpacity=1;var c=this.getDownCursorOffset(e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorDownWithShift(c):this.moveCursorDownWithoutShift(c);this.initDelayedCursor()},moveCursorDownWithoutShift:function(e){this._selectionDirection="right";this.selectionStart+=e;this.selectionStart>this.text.length&&(this.selectionStart=this.text.length);this.selectionEnd=this.selectionStart},moveCursorDownWithShift:function(e){"left"===
this._selectionDirection&&this.selectionStart!==this.selectionEnd?(this.selectionStart+=e,this._selectionDirection="left"):(this._selectionDirection="right",this.selectionEnd+=e,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length))},getUpCursorOffset:function(e,c){var a=c?this.selectionEnd:this.selectionStart,d=this.get2DCursorLocation(a);if(0===d.lineIndex||e.metaKey)return a;var b=this.text.slice(0,a),a=b.slice(b.lastIndexOf("\n")+1),b=(b.match(/\n?(.*)\n.*$/)||{})[1]||"",g=
this.text.split(this._reNewline),f;f=this._getWidthOfLine(this.ctx,d.lineIndex,g);for(var h=this._getLineLeftOffset(f),l=d.lineIndex,k=0,m=a.length;k<m;k++)f=a[k],h+=this._getWidthOfChar(this.ctx,f,l,k);d=this._getIndexOnPrevLine(d,b,h,g);return b.length-d+a.length},_getIndexOnPrevLine:function(e,c,a,d){e=e.lineIndex-1;d=this._getWidthOfLine(this.ctx,e,d);var b=this._getLineLeftOffset(d),g=0,f;d=0;for(var h=c.length;d<h;d++){var l=this._getWidthOfChar(this.ctx,c[d],e,d),b=b+l;if(b>a){f=!0;e=b;b=Math.abs(b-
l-a);g=Math.abs(e-a)<b?d:d-1;break}}f||(g=c.length-1);return g},moveCursorUp:function(e){this.abortCursorAnimation();this._currentCursorOpacity=1;var c=this.getUpCursorOffset(e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorUpWithShift(c):this.moveCursorUpWithoutShift(c);this.initDelayedCursor()},moveCursorUpWithShift:function(e){this.selectionStart!==this.selectionEnd&&"right"===this._selectionDirection?(this.selectionEnd-=e,this._selectionDirection="right"):(this.selectionStart-=
e,0>this.selectionStart&&(this.selectionStart=0),this._selectionDirection="left")},moveCursorUpWithoutShift:function(e){this.selectionStart===this.selectionEnd&&(this.selectionStart-=e);0>this.selectionStart&&(this.selectionStart=0);this.selectionEnd=this.selectionStart;this._selectionDirection="left"},moveCursorLeft:function(e){if(0!==this.selectionStart||0!==this.selectionEnd)this.abortCursorAnimation(),this._currentCursorOpacity=1,e.shiftKey?this.moveCursorLeftWithShift(e):this.moveCursorLeftWithoutShift(e),
this.initDelayedCursor()},_move:function(e,c,a){this[c]=e.altKey?this["findWordBoundary"+a](this[c]):e.metaKey?this["findLineBoundary"+a](this[c]):this[c]+("Left"===a?-1:1)},_moveLeft:function(e,c){this._move(e,c,"Left")},_moveRight:function(e,c){this._move(e,c,"Right")},moveCursorLeftWithoutShift:function(e){this._selectionDirection="left";this.selectionEnd===this.selectionStart&&this._moveLeft(e,"selectionStart");this.selectionEnd=this.selectionStart},moveCursorLeftWithShift:function(e){"right"===
this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(e,"selectionStart"),"\n"===this.text.charAt(this.selectionStart)&&this.selectionStart--,0>this.selectionStart&&(this.selectionStart=0))},moveCursorRight:function(e){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,e.shiftKey?this.moveCursorRightWithShift(e):this.moveCursorRightWithoutShift(e),
this.initDelayedCursor())},moveCursorRightWithShift:function(e){"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(e,"selectionStart"):(this._selectionDirection="right",this._moveRight(e,"selectionEnd"),"\n"===this.text.charAt(this.selectionEnd-1)&&this.selectionEnd++,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length))},moveCursorRightWithoutShift:function(e){this._selectionDirection="right";this.selectionStart===this.selectionEnd?(this._moveRight(e,
"selectionStart"),this.selectionEnd=this.selectionStart):(this.selectionEnd+=this.getNumNewLinesInSelectedText(),this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length),this.selectionStart=this.selectionEnd)},removeChars:function(e){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(e):this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.selectionEnd=this.selectionStart;this._removeExtraneousStyles();this.canvas&&this.canvas.renderAll().renderAll();
this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(e){0!==this.selectionStart&&(e.metaKey?(e=this.findLineBoundaryLeft(this.selectionStart),this._removeCharsFromTo(e,this.selectionStart),this.selectionStart=e):e.altKey?(e=this.findWordBoundaryLeft(this.selectionStart),this._removeCharsFromTo(e,this.selectionStart),this.selectionStart=e):(e="\n"===this.text.slice(this.selectionStart-1,this.selectionStart),this.removeStyleObject(e),
this.selectionStart--,this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)))}});
fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(e,c,a,d,b,g){this.styles[c]?this._setSVGTextLineChars(e,c,a,d,b,g):this.callSuper("_setSVGTextLineText",e,c,a,d,b)},_setSVGTextLineChars:function(e,c,a,d,b,g){d=0===c||this.useNative?"y":"dy";e=e.split("");b=0;for(var f=this._getSVGLineLeftOffset(c),h=this._getSVGLineTopOffset(c),l=this._getHeightOfLine(this.ctx,c),k=0,m=e.length;k<m;k++){var n=this.styles[c][k]||{};a.push(this._createTextCharSpan(e[k],n,f,h,d,b));var p=
this._getWidthOfChar(this.ctx,e[k],c,k);n.textBackgroundColor&&g.push(this._createTextCharBg(n,f,h,l,p,b));b+=p}},_getSVGLineLeftOffset:function(e){return this._boundaries&&this._boundaries[e]?fabric.util.toFixed(this._boundaries[e].left,2):0},_getSVGLineTopOffset:function(e){for(var c=0,a=0;a<=e;a++)c+=this._getHeightOfLine(this.ctx,a);return c-this.height/2},_createTextCharBg:function(e,c,a,d,b,g){return['<rect fill="',e.textBackgroundColor,'" transform="translate(',-this.width/2," ",-this.height+
d,')" x="',c+g,'" y="',a+d,'" width="',b,'" height="',d,'"></rect>'].join("")},_createTextCharSpan:function(e,c,a,d,b,g){var f=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},c));return['<tspan x="',a+g,'" ',b,'="',d,'" ',c.fontFamily?'font-family="'+c.fontFamily.replace(/"/g,"'")+'" ':"",c.fontSize?'font-size="'+c.fontSize+'" ':"",c.fontStyle?'font-style="'+c.fontStyle+'" ':"",c.fontWeight?'font-weight="'+c.fontWeight+'" ':"",c.textDecoration?
'text-decoration="'+c.textDecoration+'" ':"",'style="',f,'">',fabric.util.string.escapeXml(e),"</tspan>"].join("")}});
(function(){function e(a,c,e){var f=d.parse(a);f.port||(f.port=0===f.protocol.indexOf("https:")?443:80);a=(443===f.port?g:b).request({hostname:f.hostname,port:f.port,path:f.path,method:"GET"},function(a){var b="";c&&a.setEncoding(c);a.on("end",function(){e(b)});a.on("data",function(c){200===a.statusCode&&(b+=c)})});a.on("error",function(a){a.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+f.hostname+":"+f.port):fabric.log(a.message)});a.end()}function c(a,b){require("fs").readFile(a,
function(a,c){if(a)throw fabric.log(a),a;b(c)})}if("undefined"===typeof document||"undefined"===typeof window){var a=require("xmldom").DOMParser,d=require("url"),b=require("http"),g=require("https"),f=require("canvas"),h=require("canvas").Image;fabric.util.loadImage=function(a,b,d){function f(c){g.src=new Buffer(c,"binary");g._src=a;b&&b.call(d,g)}var g=new h;a&&(a instanceof Buffer||0===a.indexOf("data"))?(g.src=g._src=a,b&&b.call(d,g)):a&&0!==a.indexOf("http")?c(a,f):a?e(a,"binary",f):b&&b.call(d,
a)};fabric.loadSVGFromURL=function(a,b,d){a=a.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();0!==a.indexOf("http")?c(a,function(a){fabric.loadSVGFromString(a.toString(),b,d)}):e(a,"",function(a){fabric.loadSVGFromString(a,b,d)})};fabric.loadSVGFromString=function(b,c,d){b=(new a).parseFromString(b);fabric.parseSVGDocument(b.documentElement,function(a,b){c&&c(a,b)},d)};fabric.util.getScript=function(a,b){e(a,"",function(a){eval(a);b&&b()})};fabric.Image.fromObject=function(a,b){fabric.util.loadImage(a.src,
function(c){var d=new fabric.Image(c);d._initConfig(a);d._initFilters(a,function(a){d.filters=a||[];b&&b(d)})})};fabric.createCanvasForNode=function(a,b,c,d){d=d||c;var e=fabric.document.createElement("canvas");a=new f(a||600,b||600,d);e.style={};e.width=a.width;e.height=a.height;c=new (fabric.Canvas||fabric.StaticCanvas)(e,c);c.contextContainer=a.getContext("2d");c.nodeCanvas=a;c.Font=f.Font;return c};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};
fabric.StaticCanvas.prototype.createJPEGStream=function(a){return this.nodeCanvas.createJPEGStream(a)};var l=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(a){l.call(this,a);this.nodeCanvas.width=a;return this};fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var k=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(a){k.call(this,a);this.nodeCanvas.height=a;return this};fabric.Canvas&&
(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}})();
