{"version":3,"file":"RemoveColor.min.mjs","sources":["../../../src/filters/RemoveColor.ts"],"sourcesContent":["import { classRegistry } from '../ClassRegistry';\nimport { Color } from '../color/Color';\nimport { BaseFilter } from './BaseFilter';\nimport { fragmentShader } from './shaders/removeColor';\nimport type { T2DPipelineState, TWebGLUniformLocationMap } from './typedefs';\n\nexport type RemoveColorOwnProps = {\n  color: string;\n  distance: number;\n  useAlpha: boolean;\n};\n\nexport const removeColorDefaultValues: RemoveColorOwnProps = {\n  color: '#FFFFFF',\n  distance: 0.02,\n  useAlpha: false,\n};\n\n/**\n * Remove white filter class\n * @example\n * const filter = new RemoveColor({\n *   threshold: 0.2,\n * });\n * object.filters.push(filter);\n * object.applyFilters();\n * canvas.renderAll();\n */\nexport class RemoveColor extends BaseFilter<\n  'RemoveColor',\n  RemoveColorOwnProps\n> {\n  /**\n   * Color to remove, in any format understood by {@link Color}.\n   * @param {String} type\n   * @default\n   */\n  declare color: RemoveColorOwnProps['color'];\n\n  /**\n   * distance to actual color, as value up or down from each r,g,b\n   * between 0 and 1\n   **/\n  declare distance: RemoveColorOwnProps['distance'];\n\n  /**\n   * For color to remove inside distance, use alpha channel for a smoother deletion\n   * NOT IMPLEMENTED YET\n   **/\n  declare useAlpha: RemoveColorOwnProps['useAlpha'];\n\n  static type = 'RemoveColor';\n\n  static defaults = removeColorDefaultValues;\n\n  static uniformLocations = ['uLow', 'uHigh'];\n\n  getFragmentSource() {\n    return fragmentShader;\n  }\n\n  /**\n   * Applies filter to canvas element\n   * @param {Object} canvasEl Canvas element to apply filter to\n   */\n  applyTo2d({ imageData: { data } }: T2DPipelineState) {\n    const distance = this.distance * 255,\n      source = new Color(this.color).getSource(),\n      lowC = [source[0] - distance, source[1] - distance, source[2] - distance],\n      highC = [\n        source[0] + distance,\n        source[1] + distance,\n        source[2] + distance,\n      ];\n\n    for (let i = 0; i < data.length; i += 4) {\n      const r = data[i];\n      const g = data[i + 1];\n      const b = data[i + 2];\n\n      if (\n        r > lowC[0] &&\n        g > lowC[1] &&\n        b > lowC[2] &&\n        r < highC[0] &&\n        g < highC[1] &&\n        b < highC[2]\n      ) {\n        data[i + 3] = 0;\n      }\n    }\n  }\n\n  /**\n   * Send data from this filter to its shader program's uniforms.\n   *\n   * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n   * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n   */\n  sendUniformData(\n    gl: WebGLRenderingContext,\n    uniformLocations: TWebGLUniformLocationMap,\n  ) {\n    const source = new Color(this.color).getSource(),\n      distance = this.distance,\n      lowC = [\n        0 + source[0] / 255 - distance,\n        0 + source[1] / 255 - distance,\n        0 + source[2] / 255 - distance,\n        1,\n      ],\n      highC = [\n        source[0] / 255 + distance,\n        source[1] / 255 + distance,\n        source[2] / 255 + distance,\n        1,\n      ];\n    gl.uniform4fv(uniformLocations.uLow, lowC);\n    gl.uniform4fv(uniformLocations.uHigh, highC);\n  }\n}\n\nclassRegistry.setClass(RemoveColor);\n"],"names":["removeColorDefaultValues","color","distance","useAlpha","RemoveColor","BaseFilter","getFragmentSource","fragmentShader","applyTo2d","_ref","imageData","data","this","source","Color","getSource","lowC","highC","i","length","r","g","b","sendUniformData","gl","uniformLocations","uniform4fv","uLow","uHigh","_defineProperty","classRegistry","setClass"],"mappings":"2SAYO,MAAMA,EAAgD,CAC3DC,MAAO,UACPC,SAAU,IACVC,UAAU,GAaL,MAAMC,UAAoBC,EA6B/BC,iBAAAA,GACE,OAAOC,CACT,CAMAC,SAAAA,CAASC,GAA4C,IAAzCC,WAAWC,KAAEA,IAA0BF,EACjD,MAAMP,EAA2B,IAAhBU,KAAKV,SACpBW,EAAS,IAAIC,EAAMF,KAAKX,OAAOc,YAC/BC,EAAO,CAACH,EAAO,GAAKX,EAAUW,EAAO,GAAKX,EAAUW,EAAO,GAAKX,GAChEe,EAAQ,CACNJ,EAAO,GAAKX,EACZW,EAAO,GAAKX,EACZW,EAAO,GAAKX,GAGhB,IAAK,IAAIgB,EAAI,EAAGA,EAAIP,EAAKQ,OAAQD,GAAK,EAAG,CACvC,MAAME,EAAIT,EAAKO,GACTG,EAAIV,EAAKO,EAAI,GACbI,EAAIX,EAAKO,EAAI,GAGjBE,EAAIJ,EAAK,IACTK,EAAIL,EAAK,IACTM,EAAIN,EAAK,IACTI,EAAIH,EAAM,IACVI,EAAIJ,EAAM,IACVK,EAAIL,EAAM,KAEVN,EAAKO,EAAI,GAAK,EAElB,CACF,CAQAK,eAAAA,CACEC,EACAC,GAEA,MAAMZ,EAAS,IAAIC,EAAMF,KAAKX,OAAOc,YACnCb,EAAWU,KAAKV,SAChBc,EAAO,CACL,EAAIH,EAAO,GAAK,IAAMX,EACtB,EAAIW,EAAO,GAAK,IAAMX,EACtB,EAAIW,EAAO,GAAK,IAAMX,EACtB,GAEFe,EAAQ,CACNJ,EAAO,GAAK,IAAMX,EAClBW,EAAO,GAAK,IAAMX,EAClBW,EAAO,GAAK,IAAMX,EAClB,GAEJsB,EAAGE,WAAWD,EAAiBE,KAAMX,GACrCQ,EAAGE,WAAWD,EAAiBG,MAAOX,EACxC,EA1EAY,EAjBWzB,EAAW,OAuBR,eAAayB,EAvBhBzB,EAAW,WAyBJJ,GAAwB6B,EAzB/BzB,EAAW,mBA2BI,CAAC,OAAQ,UAmErC0B,EAAcC,SAAS3B"}